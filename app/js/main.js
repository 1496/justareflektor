!function(a,b){var c,d,e=typeof b,f=a.location,g=a.document,h=g.documentElement,i=a.jQuery,j=a.$,k={},l=[],m="2.0.0",n=l.concat,o=l.push,p=l.slice,q=l.indexOf,r=k.toString,s=k.hasOwnProperty,t=m.trim,u=function(a,b){return new u.fn.init(a,b,c)},v=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,x=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,y=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,z=/^-ms-/,A=/-([\da-z])/gi,B=function(a,b){return b.toUpperCase()},C=function(){g.removeEventListener("DOMContentLoaded",C,false);a.removeEventListener("load",C,false);u.ready()};u.fn=u.prototype={jquery:m,constructor:u,init:function(a,c,d){var e,f;if(!a){return this}if(typeof a==="string"){if(a.charAt(0)==="<"&&a.charAt(a.length-1)===">"&&a.length>=3){e=[null,a,null]}else{e=x.exec(a)}if(e&&(e[1]||!c)){if(e[1]){c=c instanceof u?c[0]:c;u.merge(this,u.parseHTML(e[1],c&&c.nodeType?c.ownerDocument||c:g,true));if(y.test(e[1])&&u.isPlainObject(c)){for(e in c){if(u.isFunction(this[e])){this[e](c[e])}else{this.attr(e,c[e])}}}return this}else{f=g.getElementById(e[2]);if(f&&f.parentNode){this.length=1;this[0]=f}this.context=g;this.selector=a;return this}}else if(!c||c.jquery){return(c||d).find(a)}else{return this.constructor(c).find(a)}}else if(a.nodeType){this.context=this[0]=a;this.length=1;return this}else if(u.isFunction(a)){return d.ready(a)}if(a.selector!==b){this.selector=a.selector;this.context=a.context}return u.makeArray(a,this)},selector:"",length:0,toArray:function(){return p.call(this)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a){var b=u.merge(this.constructor(),a);b.prevObject=this;b.context=this.context;return b},each:function(a,b){return u.each(this,a,b)},ready:function(a){u.ready.promise().done(a);return this},slice:function(){return this.pushStack(p.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(a<0?b:0);return this.pushStack(c>=0&&c<b?[this[c]]:[])},map:function(a){return this.pushStack(u.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:o,sort:[].sort,splice:[].splice};u.fn.init.prototype=u.fn;u.extend=u.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=false;if(typeof h==="boolean"){k=h;h=arguments[1]||{};i=2}if(typeof h!=="object"&&!u.isFunction(h)){h={}}if(j===i){h=this;--i}for(;i<j;i++){if((a=arguments[i])!=null){for(c in a){d=h[c];e=a[c];if(h===e){continue}if(k&&e&&(u.isPlainObject(e)||(f=u.isArray(e)))){if(f){f=false;g=d&&u.isArray(d)?d:[]}else{g=d&&u.isPlainObject(d)?d:{}}h[c]=u.extend(k,g,e)}else if(e!==b){h[c]=e}}}}return h};u.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),noConflict:function(b){if(a.$===u){a.$=j}if(b&&a.jQuery===u){a.jQuery=i}return u},isReady:false,readyWait:1,holdReady:function(a){if(a){u.readyWait++}else{u.ready(true)}},ready:function(a){if(a===true?--u.readyWait:u.isReady){return}u.isReady=true;if(a!==true&&--u.readyWait>0){return}d.resolveWith(g,[u]);if(u.fn.trigger){u(g).trigger("ready").off("ready")}},isFunction:function(a){return u.type(a)==="function"},isArray:Array.isArray,isWindow:function(a){return a!=null&&a===a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){if(a==null){return String(a)}return typeof a==="object"||typeof a==="function"?k[r.call(a)]||"object":typeof a},isPlainObject:function(a){if(u.type(a)!=="object"||a.nodeType||u.isWindow(a)){return false}try{if(a.constructor&&!s.call(a.constructor.prototype,"isPrototypeOf")){return false}}catch(b){return false}return true},isEmptyObject:function(a){var b;for(b in a){return false}return true},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){if(!a||typeof a!=="string"){return null}if(typeof b==="boolean"){c=b;b=false}b=b||g;var d=y.exec(a),e=!c&&[];if(d){return[b.createElement(d[1])]}d=u.buildFragment([a],b,e);if(e){u(e).remove()}return u.merge([],d.childNodes)},parseJSON:JSON.parse,parseXML:function(a){var c,d;if(!a||typeof a!=="string"){return null}try{d=new DOMParser;c=d.parseFromString(a,"text/xml")}catch(e){c=b}if(!c||c.getElementsByTagName("parsererror").length){u.error("Invalid XML: "+a)}return c},noop:function(){},globalEval:function(a){var b,c=eval;a=u.trim(a);if(a){if(a.indexOf("use strict")===1){b=g.createElement("script");b.text=a;g.head.appendChild(b).parentNode.removeChild(b)}else{c(a)}}},camelCase:function(a){return a.replace(z,"ms-").replace(A,B)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=D(a);if(c){if(g){for(;e<f;e++){d=b.apply(a[e],c);if(d===false){break}}}else{for(e in a){d=b.apply(a[e],c);if(d===false){break}}}}else{if(g){for(;e<f;e++){d=b.call(a[e],e,a[e]);if(d===false){break}}}else{for(e in a){d=b.call(a[e],e,a[e]);if(d===false){break}}}}return a},trim:function(a){return a==null?"":t.call(a)},makeArray:function(a,b){var c=b||[];if(a!=null){if(D(Object(a))){u.merge(c,typeof a==="string"?[a]:a)}else{o.call(c,a)}}return c},inArray:function(a,b,c){return b==null?-1:q.call(b,a,c)},merge:function(a,c){var d=c.length,e=a.length,f=0;if(typeof d==="number"){for(;f<d;f++){a[e++]=c[f]}}else{while(c[f]!==b){a[e++]=c[f++]}}a.length=e;return a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;c=!!c;for(;f<g;f++){d=!!b(a[f],f);if(c!==d){e.push(a[f])}}return e},map:function(a,b,c){var d,e=0,f=a.length,g=D(a),h=[];if(g){for(;e<f;e++){d=b(a[e],e,c);if(d!=null){h[h.length]=d}}}else{for(e in a){d=b(a[e],e,c);if(d!=null){h[h.length]=d}}}return n.apply([],h)},guid:1,proxy:function(a,c){var d,e,f;if(typeof c==="string"){d=a[c];c=a;a=d}if(!u.isFunction(a)){return b}e=p.call(arguments,2);f=function(){return a.apply(c||this,e.concat(p.call(arguments)))};f.guid=a.guid=a.guid||u.guid++;return f},access:function(a,c,d,e,f,g,h){var i=0,j=a.length,k=d==null;if(u.type(d)==="object"){f=true;for(i in d){u.access(a,c,i,d[i],true,g,h)}}else if(e!==b){f=true;if(!u.isFunction(e)){h=true}if(k){if(h){c.call(a,e);c=null}else{k=c;c=function(a,b,c){return k.call(u(a),c)}}}if(c){for(;i<j;i++){c(a[i],d,h?e:e.call(a[i],i,c(a[i],d)))}}}return f?a:k?c.call(a):j?c(a[0],d):g},now:Date.now,swap:function(a,b,c,d){var e,f,g={};for(f in b){g[f]=a.style[f];a.style[f]=b[f]}e=c.apply(a,d||[]);for(f in b){a.style[f]=g[f]}return e}});u.ready.promise=function(b){if(!d){d=u.Deferred();if(g.readyState==="complete"){setTimeout(u.ready)}else{g.addEventListener("DOMContentLoaded",C,false);a.addEventListener("load",C,false)}}return d.promise(b)};u.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){k["[object "+b+"]"]=b.toLowerCase()});function D(a){var b=a.length,c=u.type(a);if(u.isWindow(a)){return false}if(a.nodeType===1&&b){return true}return c==="array"||c!=="function"&&(b===0||typeof b==="number"&&b>0&&b-1 in a)}c=u(g);!function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s="sizzle"+-new Date,t=a.document,v={},w=0,x=0,y=gb(),z=gb(),A=gb(),B=false,C=function(){return 0},D=typeof b,E=1<<31,F=[],G=F.pop,H=F.push,I=F.push,J=F.slice,K=F.indexOf||function(a){var b=0,c=this.length;for(;b<c;b++){if(this[b]===a){return b}}return-1},L="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",N="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=N.replace("w","w#"),P="\\["+M+"*("+N+")"+M+"*(?:([*^$|!~]?=)"+M+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+O+")|)|)"+M+"*\\]",Q=":("+N+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+P.replace(3,8)+")*)|.*)\\)|)",R=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),S=new RegExp("^"+M+"*,"+M+"*"),T=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"*[+~]"),V=new RegExp("="+M+"*([^\\]'\"]*)"+M+"*\\]","g"),W=new RegExp(Q),X=new RegExp("^"+O+"$"),Y={ID:new RegExp("^#("+N+")"),CLASS:new RegExp("^\\.("+N+")"),TAG:new RegExp("^("+N.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+Q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),"boolean":new RegExp("^(?:"+L+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Z=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,_=/^(?:input|select|textarea|button)$/i,ab=/^h\d$/i,bb=/'|\\/g,cb=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,db=function(a,b){var c="0x"+b-65536;return c!==c?b:c<0?String.fromCharCode(c+65536):String.fromCharCode(c>>10|55296,c&1023|56320)};try{I.apply(F=J.call(t.childNodes),t.childNodes);F[t.childNodes.length].nodeType}catch(eb){I={apply:F.length?function(a,b){H.apply(a,J.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]){}a.length=c-1}}}function fb(a){return Z.test(a+"")}function gb(){var a,b=[];return a=function(c,d){if(b.push(c+=" ")>e.cacheLength){delete a[b.shift()]}return a[c]=d}}function hb(a){a[s]=true;return a}function ib(a){var b=l.createElement("div");try{return!!a(b)}catch(c){return false}finally{if(b.parentNode){b.parentNode.removeChild(b)}b=null}}function jb(a,b,c,d){var e,f,g,h,i,j,m,p,q,u;if((b?b.ownerDocument||b:t)!==l){k(b)}b=b||l;c=c||[];if(!a||typeof a!=="string"){return c}if((h=b.nodeType)!==1&&h!==9){return[]}if(n&&!d){if(e=$.exec(a)){if(g=e[1]){if(h===9){f=b.getElementById(g);if(f&&f.parentNode){if(f.id===g){c.push(f);return c}}else{return c}}else{if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&r(b,f)&&f.id===g){c.push(f);return c}}}else if(e[2]){I.apply(c,b.getElementsByTagName(a));return c}else if((g=e[3])&&v.getElementsByClassName&&b.getElementsByClassName){I.apply(c,b.getElementsByClassName(g));return c}}if(v.qsa&&(!o||!o.test(a))){p=m=s;q=b;u=h===9&&a;if(h===1&&b.nodeName.toLowerCase()!=="object"){j=qb(a);if(m=b.getAttribute("id")){p=m.replace(bb,"\\$&")}else{b.setAttribute("id",p)}p="[id='"+p+"'] ";i=j.length;while(i--){j[i]=p+rb(j[i])}q=U.test(a)&&b.parentNode||b;u=j.join(",")}if(u){try{I.apply(c,q.querySelectorAll(u));return c}catch(w){}finally{if(!m){b.removeAttribute("id")}}}}}return zb(a.replace(R,"$1"),b,c,d)}g=jb.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?b.nodeName!=="HTML":false};k=jb.setDocument=function(a){var c=a?a.ownerDocument||a:t;if(c===l||c.nodeType!==9||!c.documentElement){return l}l=c;m=c.documentElement;n=!g(c);v.getElementsByTagName=ib(function(a){a.appendChild(c.createComment(""));return!a.getElementsByTagName("*").length});v.attributes=ib(function(a){a.className="i";return!a.getAttribute("className")});v.getElementsByClassName=ib(function(a){a.innerHTML="<div class='a'></div><div class='a i'></div>";a.firstChild.className="i";return a.getElementsByClassName("i").length===2});v.sortDetached=ib(function(a){return a.compareDocumentPosition(l.createElement("div"))&1});v.getById=ib(function(a){m.appendChild(a).id=s;return!c.getElementsByName||!c.getElementsByName(s).length});if(v.getById){e.find["ID"]=function(a,b){if(typeof b.getElementById!==D&&n){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}};e.filter["ID"]=function(a){var b=a.replace(cb,db);return function(a){return a.getAttribute("id")===b}}}else{e.find["ID"]=function(a,c){if(typeof c.getElementById!==D&&n){var d=c.getElementById(a);return d?d.id===a||typeof d.getAttributeNode!==D&&d.getAttributeNode("id").value===a?[d]:b:[]}};e.filter["ID"]=function(a){var b=a.replace(cb,db);return function(a){var c=typeof a.getAttributeNode!==D&&a.getAttributeNode("id");return c&&c.value===b}}}e.find["TAG"]=v.getElementsByTagName?function(a,b){if(typeof b.getElementsByTagName!==D){return b.getElementsByTagName(a)}}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if(a==="*"){while(c=f[e++]){if(c.nodeType===1){d.push(c)}}return d}return f};e.find["CLASS"]=v.getElementsByClassName&&function(a,b){if(typeof b.getElementsByClassName!==D&&n){return b.getElementsByClassName(a)}};p=[];o=[];if(v.qsa=fb(c.querySelectorAll)){ib(function(a){a.innerHTML="<select><option selected=''></option></select>";if(!a.querySelectorAll("[selected]").length){o.push("\\["+M+"*(?:value|"+L+")")}if(!a.querySelectorAll(":checked").length){o.push(":checked")}});ib(function(a){var b=l.createElement("input");b.setAttribute("type","hidden");a.appendChild(b).setAttribute("t","");if(a.querySelectorAll("[t^='']").length){o.push("[*^$]="+M+"*(?:''|\"\")")}if(!a.querySelectorAll(":enabled").length){o.push(":enabled",":disabled")}a.querySelectorAll("*,:x");o.push(",.*:")})}if(v.matchesSelector=fb(q=m.webkitMatchesSelector||m.mozMatchesSelector||m.oMatchesSelector||m.msMatchesSelector)){ib(function(a){v.disconnectedMatch=q.call(a,"div");q.call(a,"[s!='']:x");p.push("!=",Q)})}o=o.length&&new RegExp(o.join("|"));p=p.length&&new RegExp(p.join("|"));r=fb(m.contains)||m.compareDocumentPosition?function(a,b){var c=a.nodeType===9?a.documentElement:a,d=b&&b.parentNode;return a===d||!!(d&&d.nodeType===1&&(c.contains?c.contains(d):a.compareDocumentPosition&&a.compareDocumentPosition(d)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};C=m.compareDocumentPosition?function(a,b){if(a===b){B=true;return 0}var d=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b);if(d){if(d&1||!v.sortDetached&&b.compareDocumentPosition(a)===d){if(a===c||r(t,a)){return-1}if(b===c||r(t,b)){return 1}return j?K.call(j,a)-K.call(j,b):0}return d&4?-1:1}return a.compareDocumentPosition?-1:1}:function(a,b){var d,e=0,f=a.parentNode,g=b.parentNode,h=[a],i=[b];if(a===b){B=true;return 0}else if(!f||!g){return a===c?-1:b===c?1:f?-1:g?1:j?K.call(j,a)-K.call(j,b):0}else if(f===g){return kb(a,b)}d=a;while(d=d.parentNode){h.unshift(d)}d=b;while(d=d.parentNode){i.unshift(d)}while(h[e]===i[e]){e++}return e?kb(h[e],i[e]):h[e]===t?-1:i[e]===t?1:0};return l};jb.matches=function(a,b){return jb(a,null,null,b)};jb.matchesSelector=function(a,b){if((a.ownerDocument||a)!==l){k(a)}b=b.replace(V,"='$1']");if(v.matchesSelector&&n&&(!p||!p.test(b))&&(!o||!o.test(b))){try{var c=q.call(a,b);if(c||v.disconnectedMatch||a.document&&a.document.nodeType!==11){return c}}catch(d){}}return jb(b,l,null,[a]).length>0};jb.contains=function(a,b){if((a.ownerDocument||a)!==l){k(a)}return r(a,b)};jb.attr=function(a,c){if((a.ownerDocument||a)!==l){k(a)}var d=e.attrHandle[c.toLowerCase()],f=d&&d(a,c,!n);return f===b?v.attributes||!n?a.getAttribute(c):(f=a.getAttributeNode(c))&&f.specified?f.value:null:f};jb.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};jb.uniqueSort=function(a){var b,c=[],d=0,e=0;B=!v.detectDuplicates;j=!v.sortStable&&a.slice(0);a.sort(C);if(B){while(b=a[e++]){if(b===a[e]){d=c.push(e)}}while(d--){a.splice(c[d],1)}}return a};function kb(a,b){var c=b&&a,d=c&&(~b.sourceIndex||E)-(~a.sourceIndex||E);if(d){return d}if(c){while(c=c.nextSibling){if(c===b){return-1}}}return a?1:-1}function lb(a,c,d){var e;return d?b:(e=a.getAttributeNode(c))&&e.specified?e.value:a[c]===true?c.toLowerCase():null}function mb(a,c,d){var e;return d?b:e=a.getAttribute(c,c.toLowerCase()==="type"?1:2)}function nb(a){return function(b){var c=b.nodeName.toLowerCase();return c==="input"&&b.type===a}}function ob(a){return function(b){var c=b.nodeName.toLowerCase();return(c==="input"||c==="button")&&b.type===a}}function pb(a){return hb(function(b){b=+b;return hb(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--){if(c[e=f[g]]){c[e]=!(d[e]=c[e])}}})})}f=jb.getText=function(a){var b,c="",d=0,e=a.nodeType;if(!e){for(;b=a[d];d++){c+=f(b)}}else if(e===1||e===9||e===11){if(typeof a.textContent==="string"){return a.textContent}else{for(a=a.firstChild;a;a=a.nextSibling){c+=f(a)}}}else if(e===3||e===4){return a.nodeValue}return c};e=jb.selectors={cacheLength:50,createPseudo:hb,match:Y,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){a[1]=a[1].replace(cb,db);a[3]=(a[4]||a[5]||"").replace(cb,db);if(a[2]==="~="){a[3]=" "+a[3]+" "}return a.slice(0,4)},CHILD:function(a){a[1]=a[1].toLowerCase();if(a[1].slice(0,3)==="nth"){if(!a[3]){jb.error(a[0])}a[4]=+(a[4]?a[5]+(a[6]||1):2*(a[3]==="even"||a[3]==="odd"));a[5]=+(a[7]+a[8]||a[3]==="odd")}else if(a[3]){jb.error(a[0])}return a},PSEUDO:function(a){var b,c=!a[5]&&a[2];if(Y["CHILD"].test(a[0])){return null}if(a[4]){a[2]=a[4]}else if(c&&W.test(c)&&(b=qb(c,true))&&(b=c.indexOf(")",c.length-b)-c.length)){a[0]=a[0].slice(0,b);a[2]=c.slice(0,b)}return a.slice(0,3)}},filter:{TAG:function(a){var b=a.replace(cb,db).toLowerCase();return a==="*"?function(){return true}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+M+")"+a+"("+M+"|$)"))&&y(a,function(a){return b.test(typeof a.className==="string"&&a.className||typeof a.getAttribute!==D&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=jb.attr(d,a);if(e==null){return b==="!="}if(!b){return true}e+="";return b==="="?e===c:b==="!="?e!==c:b==="^="?c&&e.indexOf(c)===0:b==="*="?c&&e.indexOf(c)>-1:b==="$="?c&&e.slice(-c.length)===c:b==="~="?(" "+e+" ").indexOf(c)>-1:b==="|="?e===c||e.slice(0,c.length+1)===c+"-":false}},CHILD:function(a,b,c,d,e){var f=a.slice(0,3)!=="nth",g=a.slice(-4)!=="last",h=b==="of-type";return d===1&&e===0?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),t=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p]){if(h?l.nodeName.toLowerCase()===r:l.nodeType===1){return false}}o=p=a==="only"&&!o&&"nextSibling"}return true}o=[g?q.firstChild:q.lastChild];if(g&&t){k=q[s]||(q[s]={});j=k[a]||[];n=j[0]===w&&j[1];m=j[0]===w&&j[2];l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop()){if(l.nodeType===1&&++m&&l===b){k[a]=[w,n,m];break}}}else if(t&&(j=(b[s]||(b[s]={}))[a])&&j[0]===w){m=j[1]}else{while(l=++n&&l&&l[p]||(m=n=0)||o.pop()){if((h?l.nodeName.toLowerCase()===r:l.nodeType===1)&&++m){if(t){(l[s]||(l[s]={}))[a]=[w,m]}if(l===b){break}}}}m-=e;return m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,d=e.pseudos[a]||e.setFilters[a.toLowerCase()]||jb.error("unsupported pseudo: "+a);if(d[s]){return d(b)}if(d.length>1){c=[a,a,"",b];return e.setFilters.hasOwnProperty(a.toLowerCase())?hb(function(a,c){var e,f=d(a,b),g=f.length;while(g--){e=K.call(a,f[g]);a[e]=!(c[e]=f[g])}}):function(a){return d(a,0,c)}}return d}},pseudos:{not:hb(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[s]?hb(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--){if(f=g[h]){a[h]=!(b[h]=f)}}}):function(a,e,f){b[0]=a;d(b,null,f,c);return!c.pop()}}),has:hb(function(a){return function(b){return jb(a,b).length>0}}),contains:hb(function(a){return function(b){return(b.textContent||b.innerText||f(b)).indexOf(a)>-1}}),lang:hb(function(a){if(!X.test(a||"")){jb.error("unsupported lang: "+a)}a=a.replace(cb,db).toLowerCase();return function(b){var c;do{if(c=n?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang")){c=c.toLowerCase();return c===a||c.indexOf(a+"-")===0}}while((b=b.parentNode)&&b.nodeType===1);return false}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===m},focus:function(a){return a===l.activeElement&&(!l.hasFocus||l.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===false},disabled:function(a){return a.disabled===true},checked:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&!!a.checked||b==="option"&&!!a.selected},selected:function(a){if(a.parentNode){a.parentNode.selectedIndex}return a.selected===true},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling){if(a.nodeName>"@"||a.nodeType===3||a.nodeType===4){return false}}return true},parent:function(a){return!e.pseudos["empty"](a)},header:function(a){return ab.test(a.nodeName)},input:function(a){return _.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&a.type==="button"||b==="button"},text:function(a){var b;return a.nodeName.toLowerCase()==="input"&&a.type==="text"&&((b=a.getAttribute("type"))==null||b.toLowerCase()===a.type)},first:pb(function(){return[0]}),last:pb(function(a,b){return[b-1]}),eq:pb(function(a,b,c){return[c<0?c+b:c]}),even:pb(function(a,b){var c=0;for(;c<b;c+=2){a.push(c)}return a}),odd:pb(function(a,b){var c=1;for(;c<b;c+=2){a.push(c)}return a}),lt:pb(function(a,b,c){var d=c<0?c+b:c;for(;--d>=0;){a.push(d)}return a}),gt:pb(function(a,b,c){var d=c<0?c+b:c;for(;++d<b;){a.push(d)}return a})}};for(c in{radio:true,checkbox:true,file:true,password:true,image:true}){e.pseudos[c]=nb(c)}for(c in{submit:true,reset:true}){e.pseudos[c]=ob(c)}function qb(a,b){var c,d,f,g,h,i,j,k=z[a+" "];if(k){return b?0:k.slice(0)}h=a;i=[];j=e.preFilter;while(h){if(!c||(d=S.exec(h))){if(d){h=h.slice(d[0].length)||h}i.push(f=[])}c=false;if(d=T.exec(h)){c=d.shift();f.push({value:c,type:d[0].replace(R," ")});h=h.slice(c.length)}for(g in e.filter){if((d=Y[g].exec(h))&&(!j[g]||(d=j[g](d)))){c=d.shift();f.push({value:c,type:g,matches:d});h=h.slice(c.length)}}if(!c){break}}return b?h.length:h?jb.error(a):z(a,i).slice(0)}function rb(a){var b=0,c=a.length,d="";for(;b<c;b++){d+=a[b].value}return d}function sb(a,b,c){var e=b.dir,f=c&&e==="parentNode",g=x++;return b.first?function(b,c,d){while(b=b[e]){if(b.nodeType===1||f){return a(b,c,d)}}}:function(b,c,h){var i,j,k,l=w+" "+g;if(h){while(b=b[e]){if(b.nodeType===1||f){if(a(b,c,h)){return true}}}}else{while(b=b[e]){if(b.nodeType===1||f){k=b[s]||(b[s]={});if((j=k[e])&&j[0]===l){if((i=j[1])===true||i===d){return i===true}}else{j=k[e]=[l];j[1]=a(b,c,h)||d;if(j[1]===true){return true}}}}}}}function tb(a){return a.length>1?function(b,c,d){var e=a.length;while(e--){if(!a[e](b,c,d)){return false}}return true}:a[0]}function ub(a,b,c,d,e){var f,g=[],h=0,i=a.length,j=b!=null;for(;h<i;h++){if(f=a[h]){if(!c||c(f,d,e)){g.push(f);if(j){b.push(h)}}}}return g}function vb(a,b,c,d,e,f){if(d&&!d[s]){d=vb(d)}if(e&&!e[s]){e=vb(e,f)}return hb(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||yb(b||"*",h.nodeType?[h]:h,[]),q=a&&(f||!b)?ub(p,m,a,h,i):p,r=c?e||(f?a:o||d)?[]:g:q;if(c){c(q,r,h,i)}if(d){j=ub(r,n);d(j,[],h,i);k=j.length;while(k--){if(l=j[k]){r[n[k]]=!(q[n[k]]=l)}}}if(f){if(e||a){if(e){j=[];k=r.length;while(k--){if(l=r[k]){j.push(q[k]=l)}}e(null,r=[],j,i)}k=r.length;while(k--){if((l=r[k])&&(j=e?K.call(f,l):m[k])>-1){f[j]=!(g[j]=l)}}}}else{r=ub(r===g?r.splice(o,r.length):r);if(e){e(null,g,r,i)}else{I.apply(g,r)}}})}function wb(a){var b,c,d,f=a.length,g=e.relative[a[0].type],h=g||e.relative[" "],j=g?1:0,k=sb(function(a){return a===b},h,true),l=sb(function(a){return K.call(b,a)>-1},h,true),m=[function(a,c,d){return!g&&(d||c!==i)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];for(;j<f;j++){if(c=e.relative[a[j].type]){m=[sb(tb(m),c)]}else{c=e.filter[a[j].type].apply(null,a[j].matches);if(c[s]){d=++j;for(;d<f;d++){if(e.relative[a[d].type]){break}}return vb(j>1&&tb(m),j>1&&rb(a.slice(0,j-1)).replace(R,"$1"),c,j<d&&wb(a.slice(j,d)),d<f&&wb(a=a.slice(d)),d<f&&rb(a))}m.push(c)}}return tb(m)}function xb(a,b){var c=0,f=b.length>0,g=a.length>0,h=function(h,j,k,m,n){var o,p,q,r=[],s=0,t="0",u=h&&[],v=n!=null,x=i,y=h||g&&e.find["TAG"]("*",n&&j.parentNode||j),z=w+=x==null?1:Math.random()||.1;if(v){i=j!==l&&j;d=c}for(;(o=y[t])!=null;t++){if(g&&o){p=0;while(q=a[p++]){if(q(o,j,k)){m.push(o);break}}if(v){w=z;d=++c}}if(f){if(o=!q&&o){s--}if(h){u.push(o)}}}s+=t;if(f&&t!==s){p=0;while(q=b[p++]){q(u,r,j,k)}if(h){if(s>0){while(t--){if(!(u[t]||r[t])){r[t]=G.call(m)}}}r=ub(r)}I.apply(m,r);if(v&&!h&&r.length>0&&s+b.length>1){jb.uniqueSort(m)}}if(v){w=z;i=x}return u};return f?hb(h):h}h=jb.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){if(!b){b=qb(a)}c=b.length;while(c--){f=wb(b[c]);if(f[s]){d.push(f)}else{e.push(f)}}f=A(a,xb(e,d))}return f};function yb(a,b,c){var d=0,e=b.length;for(;d<e;d++){jb(a,b[d],c)}return c}function zb(a,b,c,d){var f,g,i,j,k,l=qb(a);if(!d){if(l.length===1){g=l[0]=l[0].slice(0);if(g.length>2&&(i=g[0]).type==="ID"&&b.nodeType===9&&n&&e.relative[g[1].type]){b=(e.find["ID"](i.matches[0].replace(cb,db),b)||[])[0];if(!b){return c}a=a.slice(g.shift().value.length)}f=Y["needsContext"].test(a)?0:g.length;while(f--){i=g[f];if(e.relative[j=i.type]){break}if(k=e.find[j]){if(d=k(i.matches[0].replace(cb,db),U.test(g[0].type)&&b.parentNode||b)){g.splice(f,1);a=d.length&&rb(g);if(!a){I.apply(c,d);return c}break}}}}}h(a,l)(d,b,!n,c,U.test(a));return c}e.pseudos["nth"]=e.pseudos["eq"];function Ab(){}Ab.prototype=e.filters=e.pseudos;e.setFilters=new Ab;v.sortStable=s.split("").sort(C).join("")===s;k();[0,0].sort(C);v.detectDuplicates=B;ib(function(a){a.innerHTML="<a href='#'></a>";if(a.firstChild.getAttribute("href")!=="#"){var b="type|href|height|width".split("|"),c=b.length;while(c--){e.attrHandle[b[c]]=mb}}});ib(function(a){if(a.getAttribute("disabled")!=null){var b=L.split("|"),c=b.length;while(c--){e.attrHandle[b[c]]=lb}}});u.find=jb;u.expr=jb.selectors;u.expr[":"]=u.expr.pseudos;u.unique=jb.uniqueSort;u.text=jb.getText;u.isXMLDoc=jb.isXML;u.contains=jb.contains}(a);var E={};function F(a){var b=E[a]={};u.each(a.match(w)||[],function(a,c){b[c]=true});return b}u.Callbacks=function(a){a=typeof a==="string"?E[a]||F(a):u.extend({},a);var c,d,e,f,g,h,i=[],j=!a.once&&[],k=function(b){c=a.memory&&b;d=true;h=f||0;f=0;g=i.length;e=true;for(;i&&h<g;h++){if(i[h].apply(b[0],b[1])===false&&a.stopOnFalse){c=false;break}}e=false;if(i){if(j){if(j.length){k(j.shift())}}else if(c){i=[]}else{l.disable()}}},l={add:function(){if(i){var b=i.length;!function d(b){u.each(b,function(b,c){var e=u.type(c);if(e==="function"){if(!a.unique||!l.has(c)){i.push(c)}}else if(c&&c.length&&e!=="string"){d(c)}})}(arguments);if(e){g=i.length}else if(c){f=b;k(c)}}return this},remove:function(){if(i){u.each(arguments,function(a,b){var c;while((c=u.inArray(b,i,c))>-1){i.splice(c,1);if(e){if(c<=g){g--}if(c<=h){h--}}}})}return this},has:function(a){return a?u.inArray(a,i)>-1:!!(i&&i.length)},empty:function(){i=[];g=0;return this},disable:function(){i=j=c=b;return this},disabled:function(){return!i},lock:function(){j=b;if(!c){l.disable()}return this},locked:function(){return!j},fireWith:function(a,b){b=b||[];b=[a,b.slice?b.slice():b];if(i&&(!d||j)){if(e){j.push(b)}else{k(b)}}return this},fire:function(){l.fireWith(this,arguments);return this},fired:function(){return!!d}};return l};u.extend({Deferred:function(a){var b=[["resolve","done",u.Callbacks("once memory"),"resolved"],["reject","fail",u.Callbacks("once memory"),"rejected"],["notify","progress",u.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){e.done(arguments).fail(arguments);return this},then:function(){var a=arguments;return u.Deferred(function(c){u.each(b,function(b,f){var g=f[0],h=u.isFunction(a[b])&&a[b];e[f[1]](function(){var a=h&&h.apply(this,arguments);if(a&&u.isFunction(a.promise)){a.promise().done(c.resolve).fail(c.reject).progress(c.notify)}else{c[g+"With"](this===d?c.promise():this,h?[a]:arguments)}})});a=null}).promise()},promise:function(a){return a!=null?u.extend(a,d):d}},e={};d.pipe=d.then;u.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add;if(h){g.add(function(){c=h},b[a^1][2].disable,b[2][2].lock)}e[f[0]]=function(){e[f[0]+"With"](this===e?d:this,arguments);return this};e[f[0]+"With"]=g.fireWith});d.promise(e);if(a){a.call(e,e)}return e},when:function(a){var b=0,c=p.call(arguments),d=c.length,e=d!==1||a&&u.isFunction(a.promise)?d:0,f=e===1?a:u.Deferred(),g=function(a,b,c){return function(d){b[a]=this;c[a]=arguments.length>1?p.call(arguments):d;if(c===h){f.notifyWith(b,c)}else if(!--e){f.resolveWith(b,c)}}},h,i,j;if(d>1){h=new Array(d);i=new Array(d);j=new Array(d);for(;b<d;b++){if(c[b]&&u.isFunction(c[b].promise)){c[b].promise().done(g(b,j,c)).fail(f.reject).progress(g(b,i,h))}else{--e}}}if(!e){f.resolveWith(j,c)}return f.promise()}});u.support=function(b){var c=g.createElement("input"),d=g.createDocumentFragment(),e=g.createElement("div"),f=g.createElement("select"),h=f.appendChild(g.createElement("option"));if(!c.type){return b}c.type="checkbox";b.checkOn=c.value!=="";b.optSelected=h.selected;b.reliableMarginRight=true;b.boxSizingReliable=true;b.pixelPosition=false;c.checked=true;b.noCloneChecked=c.cloneNode(true).checked;f.disabled=true;b.optDisabled=!h.disabled;c=g.createElement("input");c.value="t";c.type="radio";b.radioValue=c.value==="t";c.setAttribute("checked","t");c.setAttribute("name","t");d.appendChild(c);b.checkClone=d.cloneNode(true).cloneNode(true).lastChild.checked;b.focusinBubbles="onfocusin"in a;e.style.backgroundClip="content-box";e.cloneNode(true).style.backgroundClip="";b.clearCloneStyle=e.style.backgroundClip==="content-box";u(function(){var c,d,f="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",h=g.getElementsByTagName("body")[0];if(!h){return}c=g.createElement("div");c.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";h.appendChild(c).appendChild(e);e.innerHTML="";e.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%";u.swap(h,h.style.zoom!=null?{zoom:1}:{},function(){b.boxSizing=e.offsetWidth===4});if(a.getComputedStyle){b.pixelPosition=(a.getComputedStyle(e,null)||{}).top!=="1%";b.boxSizingReliable=(a.getComputedStyle(e,null)||{width:"4px"}).width==="4px";d=e.appendChild(g.createElement("div"));d.style.cssText=e.style.cssText=f;d.style.marginRight=d.style.width="0";e.style.width="1px";b.reliableMarginRight=!parseFloat((a.getComputedStyle(d,null)||{}).marginRight)}h.removeChild(c)});return b}({});var G,H,I=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,J=/([A-Z])/g;function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=u.expando+Math.random()}K.uid=1;K.accepts=function(a){return a.nodeType?a.nodeType===1||a.nodeType===9:true};K.prototype={key:function(a){if(!K.accepts(a)){return 0}var b={},c=a[this.expando];if(!c){c=K.uid++;try{b[this.expando]={value:c};Object.defineProperties(a,b)}catch(d){b[this.expando]=c;u.extend(a,b)}}if(!this.cache[c]){this.cache[c]={}}return c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if(typeof b==="string"){f[b]=c}else{if(u.isEmptyObject(f)){this.cache[e]=b}else{for(d in b){f[d]=b[d]}}}},get:function(a,c){var d=this.cache[this.key(a)];return c===b?d:d[c]},access:function(a,c,d){if(c===b||c&&typeof c==="string"&&d===b){return this.get(a,c)}this.set(a,c,d);return d!==b?d:c},remove:function(a,c){var d,e,f=this.key(a),g=this.cache[f];if(c===b){this.cache[f]={}}else{if(u.isArray(c)){e=c.concat(c.map(u.camelCase))}else{if(c in g){e=[c]}else{e=u.camelCase(c);e=e in g?[e]:e.match(w)||[]}}d=e.length;while(d--){delete g[e[d]]}}},hasData:function(a){return!u.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){delete this.cache[this.key(a)]}};G=new K;H=new K;u.extend({acceptData:K.accepts,hasData:function(a){return G.hasData(a)||H.hasData(a)},data:function(a,b,c){return G.access(a,b,c)},removeData:function(a,b){G.remove(a,b)},_data:function(a,b,c){return H.access(a,b,c)},_removeData:function(a,b){H.remove(a,b)}});u.fn.extend({data:function(a,c){var d,e,f=this[0],g=0,h=null;if(a===b){if(this.length){h=G.get(f);if(f.nodeType===1&&!H.get(f,"hasDataAttrs")){d=f.attributes;for(;g<d.length;g++){e=d[g].name;if(e.indexOf("data-")===0){e=u.camelCase(e.substring(5));L(f,e,h[e])}}H.set(f,"hasDataAttrs",true)}}return h}if(typeof a==="object"){return this.each(function(){G.set(this,a)})}return u.access(this,function(c){var d,e=u.camelCase(a);if(f&&c===b){d=G.get(f,a);if(d!==b){return d}d=G.get(f,e);if(d!==b){return d}d=L(f,e,b);if(d!==b){return d}return}this.each(function(){var d=G.get(this,e);G.set(this,e,c);if(a.indexOf("-")!==-1&&d!==b){G.set(this,a,c)
}})},null,c,arguments.length>1,null,true)},removeData:function(a){return this.each(function(){G.remove(this,a)})}});function L(a,c,d){var e;if(d===b&&a.nodeType===1){e="data-"+c.replace(J,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d==="string"){try{d=d==="true"?true:d==="false"?false:d==="null"?null:+d+""===d?+d:I.test(d)?JSON.parse(d):d}catch(f){}G.set(a,c,d)}else{d=b}}return d}u.extend({queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue";d=H.get(a,b);if(c){if(!d||u.isArray(c)){d=H.access(a,b,u.makeArray(c))}else{d.push(c)}}return d||[]}},dequeue:function(a,b){b=b||"fx";var c=u.queue(a,b),d=c.length,e=c.shift(),f=u._queueHooks(a,b),g=function(){u.dequeue(a,b)};if(e==="inprogress"){e=c.shift();d--}f.cur=e;if(e){if(b==="fx"){c.unshift("inprogress")}delete f.stop;e.call(a,g,f)}if(!d&&f){f.empty.fire()}},_queueHooks:function(a,b){var c=b+"queueHooks";return H.get(a,c)||H.access(a,c,{empty:u.Callbacks("once memory").add(function(){H.remove(a,[b+"queue",c])})})}});u.fn.extend({queue:function(a,c){var d=2;if(typeof a!=="string"){c=a;a="fx";d--}if(arguments.length<d){return u.queue(this[0],a)}return c===b?this:this.each(function(){var b=u.queue(this,a,c);u._queueHooks(this,a);if(a==="fx"&&b[0]!=="inprogress"){u.dequeue(this,a)}})},dequeue:function(a){return this.each(function(){u.dequeue(this,a)})},delay:function(a,b){a=u.fx?u.fx.speeds[a]||a:a;b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=u.Deferred(),g=this,h=this.length,i=function(){if(!--e){f.resolveWith(g,[g])}};if(typeof a!=="string"){c=a;a=b}a=a||"fx";while(h--){d=H.get(g[h],a+"queueHooks");if(d&&d.empty){e++;d.empty.add(i)}}i();return f.promise(c)}});var M,N,O=/[\t\r\n]/g,P=/\r/g,Q=/^(?:input|select|textarea|button)$/i;u.fn.extend({attr:function(a,b){return u.access(this,u.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){u.removeAttr(this,a)})},prop:function(a,b){return u.access(this,u.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[u.propFix[a]||a]})},addClass:function(a){var b,c,d,e,f,g=0,h=this.length,i=typeof a==="string"&&a;if(u.isFunction(a)){return this.each(function(b){u(this).addClass(a.call(this,b,this.className))})}if(i){b=(a||"").match(w)||[];for(;g<h;g++){c=this[g];d=c.nodeType===1&&(c.className?(" "+c.className+" ").replace(O," "):" ");if(d){f=0;while(e=b[f++]){if(d.indexOf(" "+e+" ")<0){d+=e+" "}}c.className=u.trim(d)}}}return this},removeClass:function(a){var b,c,d,e,f,g=0,h=this.length,i=arguments.length===0||typeof a==="string"&&a;if(u.isFunction(a)){return this.each(function(b){u(this).removeClass(a.call(this,b,this.className))})}if(i){b=(a||"").match(w)||[];for(;g<h;g++){c=this[g];d=c.nodeType===1&&(c.className?(" "+c.className+" ").replace(O," "):"");if(d){f=0;while(e=b[f++]){while(d.indexOf(" "+e+" ")>=0){d=d.replace(" "+e+" "," ")}}c.className=a?u.trim(d):""}}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b==="boolean";if(u.isFunction(a)){return this.each(function(c){u(this).toggleClass(a.call(this,c,this.className,b),b)})}return this.each(function(){if(c==="string"){var f,g=0,h=u(this),i=b,j=a.match(w)||[];while(f=j[g++]){i=d?i:!h.hasClass(f);h[i?"addClass":"removeClass"](f)}}else if(c===e||c==="boolean"){if(this.className){H.set(this,"__className__",this.className)}this.className=this.className||a===false?"":H.get(this,"__className__")||""}})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++){if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(O," ").indexOf(b)>=0){return true}}return false},val:function(a){var c,d,e,f=this[0];if(!arguments.length){if(f){c=u.valHooks[f.type]||u.valHooks[f.nodeName.toLowerCase()];if(c&&"get"in c&&(d=c.get(f,"value"))!==b){return d}d=f.value;return typeof d==="string"?d.replace(P,""):d==null?"":d}return}e=u.isFunction(a);return this.each(function(d){var f,g=u(this);if(this.nodeType!==1){return}if(e){f=a.call(this,d,g.val())}else{f=a}if(f==null){f=""}else if(typeof f==="number"){f+=""}else if(u.isArray(f)){f=u.map(f,function(a){return a==null?"":a+""})}c=u.valHooks[this.type]||u.valHooks[this.nodeName.toLowerCase()];if(!c||!("set"in c)||c.set(this,f,"value")===b){this.value=f}})}});u.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d=a.options,e=a.selectedIndex,f=a.type==="select-one"||e<0,g=f?null:[],h=f?e+1:d.length,i=e<0?h:f?e:0;for(;i<h;i++){c=d[i];if((c.selected||i===e)&&(u.support.optDisabled?!c.disabled:c.getAttribute("disabled")===null)&&(!c.parentNode.disabled||!u.nodeName(c.parentNode,"optgroup"))){b=u(c).val();if(f){return b}g.push(b)}}return g},set:function(a,b){var c,d,e=a.options,f=u.makeArray(b),g=e.length;while(g--){d=e[g];if(d.selected=u.inArray(u(d).val(),f)>=0){c=true}}if(!c){a.selectedIndex=-1}return f}}},attr:function(a,c,d){var f,g,h=a.nodeType;if(!a||h===3||h===8||h===2){return}if(typeof a.getAttribute===e){return u.prop(a,c,d)}if(h!==1||!u.isXMLDoc(a)){c=c.toLowerCase();f=u.attrHooks[c]||(u.expr.match.boolean.test(c)?N:M)}if(d!==b){if(d===null){u.removeAttr(a,c)}else if(f&&"set"in f&&(g=f.set(a,d,c))!==b){return g}else{a.setAttribute(c,d+"");return d}}else if(f&&"get"in f&&(g=f.get(a,c))!==null){return g}else{g=u.find.attr(a,c);return g==null?b:g}},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(w);if(f&&a.nodeType===1){while(c=f[e++]){d=u.propFix[c]||c;if(u.expr.match.boolean.test(c)){a[d]=false}a.removeAttribute(c)}}},attrHooks:{type:{set:function(a,b){if(!u.support.radioValue&&b==="radio"&&u.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b);if(c){a.value=c}return b}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(!a||h===3||h===8||h===2){return}g=h!==1||!u.isXMLDoc(a);if(g){c=u.propFix[c]||c;f=u.propHooks[c]}if(d!==b){return f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d}else{return f&&"get"in f&&(e=f.get(a,c))!==null?e:a[c]}},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||Q.test(a.nodeName)||a.href?a.tabIndex:-1}}}});N={set:function(a,b,c){if(b===false){u.removeAttr(a,c)}else{a.setAttribute(c,c)}return c}};u.each(u.expr.match.boolean.source.match(/\w+/g),function(a,c){var d=u.expr.attrHandle[c]||u.find.attr;u.expr.attrHandle[c]=function(a,c,e){var f=u.expr.attrHandle[c],g=e?b:(u.expr.attrHandle[c]=b)!=d(a,c,e)?c.toLowerCase():null;u.expr.attrHandle[c]=f;return g}});if(!u.support.optSelected){u.propHooks.selected={get:function(a){var b=a.parentNode;if(b&&b.parentNode){b.parentNode.selectedIndex}return null}}}u.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){u.propFix[this.toLowerCase()]=this});u.each(["radio","checkbox"],function(){u.valHooks[this]={set:function(a,b){if(u.isArray(b)){return a.checked=u.inArray(u(a).val(),b)>=0}}};if(!u.support.checkOn){u.valHooks[this].get=function(a){return a.getAttribute("value")===null?"on":a.value}}});var R=/^key/,S=/^(?:mouse|contextmenu)|click/,T=/^(?:focusinfocus|focusoutblur)$/,U=/^([^.]*)(?:\.(.+)|)$/;function V(){return true}function W(){return false}function X(){try{return g.activeElement}catch(a){}}u.event={global:{},add:function(a,c,d,f,g){var h,i,j,k,l,m,n,o,p,q,r,s=H.get(a);if(!s){return}if(d.handler){h=d;d=h.handler;g=h.selector}if(!d.guid){d.guid=u.guid++}if(!(k=s.events)){k=s.events={}}if(!(i=s.handle)){i=s.handle=function(a){return typeof u!==e&&(!a||u.event.triggered!==a.type)?u.event.dispatch.apply(i.elem,arguments):b};i.elem=a}c=(c||"").match(w)||[""];l=c.length;while(l--){j=U.exec(c[l])||[];p=r=j[1];q=(j[2]||"").split(".").sort();if(!p){continue}n=u.event.special[p]||{};p=(g?n.delegateType:n.bindType)||p;n=u.event.special[p]||{};m=u.extend({type:p,origType:r,data:f,handler:d,guid:d.guid,selector:g,needsContext:g&&u.expr.match.needsContext.test(g),namespace:q.join(".")},h);if(!(o=k[p])){o=k[p]=[];o.delegateCount=0;if(!n.setup||n.setup.call(a,f,q,i)===false){if(a.addEventListener){a.addEventListener(p,i,false)}}}if(n.add){n.add.call(a,m);if(!m.handler.guid){m.handler.guid=d.guid}}if(g){o.splice(o.delegateCount++,0,m)}else{o.push(m)}u.event.global[p]=true}a=null},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=H.hasData(a)&&H.get(a);if(!q||!(i=q.events)){return}b=(b||"").match(w)||[""];j=b.length;while(j--){h=U.exec(b[j])||[];n=p=h[1];o=(h[2]||"").split(".").sort();if(!n){for(n in i){u.event.remove(a,n+b[j],c,d,true)}continue}l=u.event.special[n]||{};n=(d?l.delegateType:l.bindType)||n;m=i[n]||[];h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)");g=f=m.length;while(f--){k=m[f];if((e||p===k.origType)&&(!c||c.guid===k.guid)&&(!h||h.test(k.namespace))&&(!d||d===k.selector||d==="**"&&k.selector)){m.splice(f,1);if(k.selector){m.delegateCount--}if(l.remove){l.remove.call(a,k)}}}if(g&&!m.length){if(!l.teardown||l.teardown.call(a,o,q.handle)===false){u.removeEvent(a,n,q.handle)}delete i[n]}}if(u.isEmptyObject(i)){delete q.handle;H.remove(a,"events")}},trigger:function(c,d,e,f){var h,i,j,k,l,m,n,o=[e||g],p=s.call(c,"type")?c.type:c,q=s.call(c,"namespace")?c.namespace.split("."):[];i=j=e=e||g;if(e.nodeType===3||e.nodeType===8){return}if(T.test(p+u.event.triggered)){return}if(p.indexOf(".")>=0){q=p.split(".");p=q.shift();q.sort()}l=p.indexOf(":")<0&&"on"+p;c=c[u.expando]?c:new u.Event(p,typeof c==="object"&&c);c.isTrigger=f?2:3;c.namespace=q.join(".");c.namespace_re=c.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;c.result=b;if(!c.target){c.target=e}d=d==null?[c]:u.makeArray(d,[c]);n=u.event.special[p]||{};if(!f&&n.trigger&&n.trigger.apply(e,d)===false){return}if(!f&&!n.noBubble&&!u.isWindow(e)){k=n.delegateType||p;if(!T.test(k+p)){i=i.parentNode}for(;i;i=i.parentNode){o.push(i);j=i}if(j===(e.ownerDocument||g)){o.push(j.defaultView||j.parentWindow||a)}}h=0;while((i=o[h++])&&!c.isPropagationStopped()){c.type=h>1?k:n.bindType||p;m=(H.get(i,"events")||{})[c.type]&&H.get(i,"handle");if(m){m.apply(i,d)}m=l&&i[l];if(m&&u.acceptData(i)&&m.apply&&m.apply(i,d)===false){c.preventDefault()}}c.type=p;if(!f&&!c.isDefaultPrevented()){if((!n._default||n._default.apply(o.pop(),d)===false)&&u.acceptData(e)){if(l&&u.isFunction(e[p])&&!u.isWindow(e)){j=e[l];if(j){e[l]=null}u.event.triggered=p;e[p]();u.event.triggered=b;if(j){e[l]=j}}}}return c.result},dispatch:function(a){a=u.event.fix(a);var c,d,e,f,g,h=[],i=p.call(arguments),j=(H.get(this,"events")||{})[a.type]||[],k=u.event.special[a.type]||{};i[0]=a;a.delegateTarget=this;if(k.preDispatch&&k.preDispatch.call(this,a)===false){return}h=u.event.handlers.call(this,a,j);c=0;while((f=h[c++])&&!a.isPropagationStopped()){a.currentTarget=f.elem;d=0;while((g=f.handlers[d++])&&!a.isImmediatePropagationStopped()){if(!a.namespace_re||a.namespace_re.test(g.namespace)){a.handleObj=g;a.data=g.data;e=((u.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i);if(e!==b){if((a.result=e)===false){a.preventDefault();a.stopPropagation()}}}}}if(k.postDispatch){k.postDispatch.call(this,a)}return a.result},handlers:function(a,c){var d,e,f,g,h=[],i=c.delegateCount,j=a.target;if(i&&j.nodeType&&(!a.button||a.type!=="click")){for(;j!==this;j=j.parentNode||this){if(j.disabled!==true||a.type!=="click"){e=[];for(d=0;d<i;d++){g=c[d];f=g.selector+" ";if(e[f]===b){e[f]=g.needsContext?u(f,this).index(j)>=0:u.find(f,this,null,[j]).length}if(e[f]){e.push(g)}}if(e.length){h.push({elem:j,handlers:e})}}}}if(i<c.length){h.push({elem:this,handlers:c.slice(i)})}return h},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){if(a.which==null){a.which=b.charCode!=null?b.charCode:b.keyCode}return a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,h=c.button;if(a.pageX==null&&c.clientX!=null){d=a.target.ownerDocument||g;e=d.documentElement;f=d.body;a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0);a.pageY=c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)}if(!a.which&&h!==b){a.which=h&1?1:h&2?3:h&4?2:0}return a}},fix:function(a){if(a[u.expando]){return a}var b,c,d,e=a.type,f=a,g=this.fixHooks[e];if(!g){this.fixHooks[e]=g=S.test(e)?this.mouseHooks:R.test(e)?this.keyHooks:{}}d=g.props?this.props.concat(g.props):this.props;a=new u.Event(f);b=d.length;while(b--){c=d[b];a[c]=f[c]}if(a.target.nodeType===3){a.target=a.target.parentNode}return g.filter?g.filter(a,f):a},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==X()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===X()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&u.nodeName(this,"input")){this.click();return false}},_default:function(a){return u.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){if(a.result!==b){a.originalEvent.returnValue=a.result}}}},simulate:function(a,b,c,d){var e=u.extend(new u.Event,c,{type:a,isSimulated:true,originalEvent:{}});if(d){u.event.trigger(e,null,b)}else{u.event.dispatch.call(b,e)}if(e.isDefaultPrevented()){c.preventDefault()}}};u.removeEvent=function(a,b,c){if(a.removeEventListener){a.removeEventListener(b,c,false)}};u.Event=function(a,b){if(!(this instanceof u.Event)){return new u.Event(a,b)}if(a&&a.type){this.originalEvent=a;this.type=a.type;this.isDefaultPrevented=a.defaultPrevented||a.getPreventDefault&&a.getPreventDefault()?V:W}else{this.type=a}if(b){u.extend(this,b)}this.timeStamp=a&&a.timeStamp||u.now();this[u.expando]=true};u.Event.prototype={isDefaultPrevented:W,isPropagationStopped:W,isImmediatePropagationStopped:W,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=V;if(a&&a.preventDefault){a.preventDefault()}},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=V;if(a&&a.stopPropagation){a.stopPropagation()}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=V;this.stopPropagation()}};u.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){u.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;if(!e||e!==d&&!u.contains(d,e)){a.type=f.origType;c=f.handler.apply(this,arguments);a.type=b}return c}}});if(!u.support.focusinBubbles){u.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){u.event.simulate(b,a.target,u.event.fix(a),true)};u.event.special[b]={setup:function(){if(c++===0){g.addEventListener(a,d,true)}},teardown:function(){if(--c===0){g.removeEventListener(a,d,true)}}}})}u.fn.extend({on:function(a,c,d,e,f){var g,h;if(typeof a==="object"){if(typeof c!=="string"){d=d||c;c=b}for(h in a){this.on(h,c,d,a[h],f)}return this}if(d==null&&e==null){e=c;d=c=b}else if(e==null){if(typeof c==="string"){e=d;d=b}else{e=d;d=c;c=b}}if(e===false){e=W}else if(!e){return this}if(f===1){g=e;e=function(a){u().off(a);return g.apply(this,arguments)};e.guid=g.guid||(g.guid=u.guid++)}return this.each(function(){u.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,f;if(a&&a.preventDefault&&a.handleObj){e=a.handleObj;u(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler);return this}if(typeof a==="object"){for(f in a){this.off(f,c,a[f])}return this}if(c===false||typeof c==="function"){d=c;c=b}if(d===false){d=W}return this.each(function(){u.event.remove(this,a,d,c)})},trigger:function(a,b){return this.each(function(){u.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];if(c){return u.event.trigger(a,b,c,true)}}});var Y=/^.[^:#\[\.,]*$/,Z=u.expr.match.needsContext,$={children:true,contents:true,next:true,prev:true};u.fn.extend({find:function(a){var b,c,d,e=this.length;if(typeof a!=="string"){b=this;return this.pushStack(u(a).filter(function(){for(d=0;d<e;d++){if(u.contains(b[d],this)){return true}}}))}c=[];for(d=0;d<e;d++){u.find(a,this[d],c)}c=this.pushStack(e>1?u.unique(c):c);c.selector=(this.selector?this.selector+" ":"")+a;return c},has:function(a){var b=u(a,this),c=b.length;return this.filter(function(){var a=0;for(;a<c;a++){if(u.contains(this,b[a])){return true}}})},not:function(a){return this.pushStack(ab(this,a||[],true))},filter:function(a){return this.pushStack(ab(this,a||[],false))},is:function(a){return!!a&&(typeof a==="string"?Z.test(a)?u(a,this.context).index(this[0])>=0:u.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c,d=0,e=this.length,f=[],g=Z.test(a)||typeof a!=="string"?u(a,b||this.context):0;for(;d<e;d++){for(c=this[d];c&&c!==b;c=c.parentNode){if(c.nodeType<11&&(g?g.index(c)>-1:c.nodeType===1&&u.find.matchesSelector(c,a))){c=f.push(c);break}}}return this.pushStack(f.length>1?u.unique(f):f)},index:function(a){if(!a){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof a==="string"){return q.call(u(a),this[0])}return q.call(this,a.jquery?a[0]:a)},add:function(a,b){var c=typeof a==="string"?u(a,b):u.makeArray(a&&a.nodeType?[a]:a),d=u.merge(this.get(),c);return this.pushStack(u.unique(d))},addBack:function(a){return this.add(a==null?this.prevObject:this.prevObject.filter(a))}});function _(a,b){while((a=a[b])&&a.nodeType!==1){}return a}u.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return u.dir(a,"parentNode")},parentsUntil:function(a,b,c){return u.dir(a,"parentNode",c)},next:function(a){return _(a,"nextSibling")},prev:function(a){return _(a,"previousSibling")},nextAll:function(a){return u.dir(a,"nextSibling")},prevAll:function(a){return u.dir(a,"previousSibling")},nextUntil:function(a,b,c){return u.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return u.dir(a,"previousSibling",c)},siblings:function(a){return u.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return u.sibling(a.firstChild)},contents:function(a){return u.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:u.merge([],a.childNodes)}},function(a,b){u.fn[a]=function(c,d){var e=u.map(this,b,c);if(a.slice(-5)!=="Until"){d=c}if(d&&typeof d==="string"){e=u.filter(d,e)}if(this.length>1){if(!$[a]){u.unique(e)}if(a[0]==="p"){e.reverse()}}return this.pushStack(e)}});u.extend({filter:function(a,b,c){var d=b[0];if(c){a=":not("+a+")"}return b.length===1&&d.nodeType===1?u.find.matchesSelector(d,a)?[d]:[]:u.find.matches(a,u.grep(b,function(a){return a.nodeType===1}))},dir:function(a,c,d){var e=[],f=d!==b;while((a=a[c])&&a.nodeType!==9){if(a.nodeType===1){if(f&&u(a).is(d)){break}e.push(a)}}return e},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling){if(a.nodeType===1&&a!==b){c.push(a)}}return c}});function ab(a,b,c){if(u.isFunction(b)){return u.grep(a,function(a,d){return!!b.call(a,d,a)!==c})}if(b.nodeType){return u.grep(a,function(a){return a===b!==c})}if(typeof b==="string"){if(Y.test(b)){return u.filter(b,a,c)}b=u.filter(b,a)}return u.grep(a,function(a){return q.call(b,a)>=0!==c})}var bb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,cb=/<([\w:]+)/,db=/<|&#?\w+;/,eb=/<(?:script|style|link)/i,fb=/^(?:checkbox|radio)$/i,gb=/checked\s*(?:[^=]|=\s*.checked.)/i,hb=/^$|\/(?:java|ecma)script/i,ib=/^true\/(.*)/,jb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,kb={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};kb.optgroup=kb.option;kb.tbody=kb.tfoot=kb.colgroup=kb.caption=kb.col=kb.thead;kb.th=kb.td;u.fn.extend({text:function(a){return u.access(this,function(a){return a===b?u.text(this):this.empty().append((this[0]&&this[0].ownerDocument||g).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var b=lb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var b=lb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){if(this.parentNode){this.parentNode.insertBefore(a,this)}})},after:function(){return this.domManip(arguments,function(a){if(this.parentNode){this.parentNode.insertBefore(a,this.nextSibling)}})},remove:function(a,b){var c,d=a?u.filter(a,this):this,e=0;for(;(c=d[e])!=null;e++){if(!b&&c.nodeType===1){u.cleanData(qb(c))}if(c.parentNode){if(b&&u.contains(c.ownerDocument,c)){ob(qb(c,"script"))}c.parentNode.removeChild(c)}}return this},empty:function(){var a,b=0;for(;(a=this[b])!=null;b++){if(a.nodeType===1){u.cleanData(qb(a,false));a.textContent=""}}return this},clone:function(a,b){a=a==null?false:a;b=b==null?a:b;return this.map(function(){return u.clone(this,a,b)})},html:function(a){return u.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b&&c.nodeType===1){return c.innerHTML}if(typeof a==="string"&&!eb.test(a)&&!kb[(cb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(bb,"<$1></$2>");try{for(;d<e;d++){c=this[d]||{};if(c.nodeType===1){u.cleanData(qb(c,false));c.innerHTML=a}}c=0}catch(f){}}if(c){this.empty().append(a)}},null,a,arguments.length)},replaceWith:function(){var a=u.map(this,function(a){return[a.nextSibling,a.parentNode]}),b=0;this.domManip(arguments,function(c){var d=a[b++],e=a[b++];if(e){u(this).remove();e.insertBefore(c,d)}},true);return b?this:this.remove()},detach:function(a){return this.remove(a,true)},domManip:function(a,b,c){a=n.apply([],a);var d,e,f,g,h,i,j=0,k=this.length,l=this,m=k-1,o=a[0],p=u.isFunction(o);if(p||!(k<=1||typeof o!=="string"||u.support.checkClone||!gb.test(o))){return this.each(function(d){var e=l.eq(d);if(p){a[0]=o.call(this,d,e.html())}e.domManip(a,b,c)})}if(k){d=u.buildFragment(a,this[0].ownerDocument,false,!c&&this);e=d.firstChild;if(d.childNodes.length===1){d=e}if(e){f=u.map(qb(d,"script"),mb);g=f.length;for(;j<k;j++){h=d;if(j!==m){h=u.clone(h,true,true);if(g){u.merge(f,qb(h,"script"))}}b.call(this[j],h,j)}if(g){i=f[f.length-1].ownerDocument;u.map(f,nb);for(j=0;j<g;j++){h=f[j];if(hb.test(h.type||"")&&!H.access(h,"globalEval")&&u.contains(i,h)){if(h.src){u._evalUrl(h.src)}else{u.globalEval(h.textContent.replace(jb,""))}}}}}}return this}});u.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){u.fn[a]=function(a){var c,d=[],e=u(a),f=e.length-1,g=0;for(;g<=f;g++){c=g===f?this:this.clone(true);u(e[g])[b](c);o.apply(d,c.get())}return this.pushStack(d)}});u.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(true),i=u.contains(a.ownerDocument,a);if(!u.support.noCloneChecked&&(a.nodeType===1||a.nodeType===11)&&!u.isXMLDoc(a)){g=qb(h);f=qb(a);for(d=0,e=f.length;d<e;d++){rb(f[d],g[d])}}if(b){if(c){f=f||qb(a);g=g||qb(h);for(d=0,e=f.length;d<e;d++){pb(f[d],g[d])}}else{pb(a,h)}}g=qb(h,"script");if(g.length>0){ob(g,!i&&qb(a,"script"))}return h},buildFragment:function(a,b,c,d){var e,f,g,h,i,j,k=0,l=a.length,m=b.createDocumentFragment(),n=[];for(;k<l;k++){e=a[k];if(e||e===0){if(u.type(e)==="object"){u.merge(n,e.nodeType?[e]:e)}else if(!db.test(e)){n.push(b.createTextNode(e))}else{f=f||m.appendChild(b.createElement("div"));g=(cb.exec(e)||["",""])[1].toLowerCase();h=kb[g]||kb._default;f.innerHTML=h[1]+e.replace(bb,"<$1></$2>")+h[2];j=h[0];while(j--){f=f.firstChild}u.merge(n,f.childNodes);f=m.firstChild;f.textContent=""}}}m.textContent="";k=0;while(e=n[k++]){if(d&&u.inArray(e,d)!==-1){continue}i=u.contains(e.ownerDocument,e);f=qb(m.appendChild(e),"script");if(i){ob(f)}if(c){j=0;while(e=f[j++]){if(hb.test(e.type||"")){c.push(e)}}}}return m},cleanData:function(a){var b,c,d,e=a.length,f=0,g=u.event.special;for(;f<e;f++){c=a[f];if(u.acceptData(c)){b=H.access(c);if(b){for(d in b.events){if(g[d]){u.event.remove(c,d)}else{u.removeEvent(c,d,b.handle)}}}}G.discard(c);H.discard(c)}},_evalUrl:function(a){return u.ajax({url:a,type:"GET",dataType:"text",async:false,global:false,success:u.globalEval})}});function lb(a,b){return u.nodeName(a,"table")&&u.nodeName(b.nodeType===1?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function mb(a){a.type=(a.getAttribute("type")!==null)+"/"+a.type;return a}function nb(a){var b=ib.exec(a.type);if(b){a.type=b[1]}else{a.removeAttribute("type")}return a}function ob(a,b){var c=a.length,d=0;for(;d<c;d++){H.set(a[d],"globalEval",!b||H.get(b[d],"globalEval"))}}function pb(a,b){var c,d,e,f,g,h,i,j;if(b.nodeType!==1){return}if(H.hasData(a)){f=H.access(a);g=u.extend({},f);j=f.events;H.set(b,g);if(j){delete g.handle;g.events={};for(e in j){for(c=0,d=j[e].length;c<d;c++){u.event.add(b,e,j[e][c])}}}}if(G.hasData(a)){h=G.access(a);i=u.extend({},h);G.set(b,i)}}function qb(a,c){var d=a.getElementsByTagName?a.getElementsByTagName(c||"*"):a.querySelectorAll?a.querySelectorAll(c||"*"):[];return c===b||c&&u.nodeName(a,c)?u.merge([a],d):d}function rb(a,b){var c=b.nodeName.toLowerCase();if(c==="input"&&fb.test(a.type)){b.checked=a.checked}else if(c==="input"||c==="textarea"){b.defaultValue=a.defaultValue}}u.fn.extend({wrapAll:function(a){var b;if(u.isFunction(a)){return this.each(function(b){u(this).wrapAll(a.call(this,b))})}if(this[0]){b=u(a,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){b.insertBefore(this[0])}b.map(function(){var a=this;while(a.firstElementChild){a=a.firstElementChild}return a}).append(this)}return this},wrapInner:function(a){if(u.isFunction(a)){return this.each(function(b){u(this).wrapInner(a.call(this,b))})}return this.each(function(){var b=u(this),c=b.contents();if(c.length){c.wrapAll(a)}else{b.append(a)}})},wrap:function(a){var b=u.isFunction(a);return this.each(function(c){u(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){if(!u.nodeName(this,"body")){u(this).replaceWith(this.childNodes)}}).end()}});var sb,tb,ub=/^(none|table(?!-c[ea]).+)/,vb=/^margin/,wb=new RegExp("^("+v+")(.*)$","i"),xb=new RegExp("^("+v+")(?!px)[a-z%]+$","i"),yb=new RegExp("^([+-])=("+v+")","i"),zb={BODY:"block"},Ab={position:"absolute",visibility:"hidden",display:"block"},Bb={letterSpacing:0,fontWeight:400},Cb=["Top","Right","Bottom","Left"],Db=["Webkit","O","Moz","ms"];function Eb(a,b){if(b in a){return b}var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=Db.length;while(e--){b=Db[e]+c;if(b in a){return b}}return d}function Fb(a,b){a=b||a;return u.css(a,"display")==="none"||!u.contains(a.ownerDocument,a)}function Gb(b){return a.getComputedStyle(b,null)}function Hb(a,b){var c,d,e,f=[],g=0,h=a.length;for(;g<h;g++){d=a[g];if(!d.style){continue}f[g]=H.get(d,"olddisplay");c=d.style.display;if(b){if(!f[g]&&c==="none"){d.style.display=""}if(d.style.display===""&&Fb(d)){f[g]=H.access(d,"olddisplay",Lb(d.nodeName))}}else{if(!f[g]){e=Fb(d);if(c&&c!=="none"||!e){H.set(d,"olddisplay",e?c:u.css(d,"display"))}}}}for(g=0;g<h;g++){d=a[g];if(!d.style){continue}if(!b||d.style.display==="none"||d.style.display===""){d.style.display=b?f[g]||"":"none"}}return a}u.fn.extend({css:function(a,c){return u.access(this,function(a,c,d){var e,f,g={},h=0;if(u.isArray(c)){e=Gb(a);f=c.length;for(;h<f;h++){g[c[h]]=u.css(a,c[h],false,e)}return g}return d!==b?u.style(a,c,d):u.css(a,c)},a,c,arguments.length>1)},show:function(){return Hb(this,true)},hide:function(){return Hb(this)},toggle:function(a){var b=typeof a==="boolean";return this.each(function(){if(b?a:Fb(this)){u(this).show()}else{u(this).hide()}})}});u.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=sb(a,"opacity");return c===""?"1":c}}}},cssNumber:{columnCount:true,fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":"cssFloat"},style:function(a,c,d,e){if(!a||a.nodeType===3||a.nodeType===8||!a.style){return}var f,g,h,i=u.camelCase(c),j=a.style;c=u.cssProps[i]||(u.cssProps[i]=Eb(j,i));h=u.cssHooks[c]||u.cssHooks[i];if(d!==b){g=typeof d;if(g==="string"&&(f=yb.exec(d))){d=(f[1]+1)*f[2]+parseFloat(u.css(a,c));g="number"}if(d==null||g==="number"&&isNaN(d)){return}if(g==="number"&&!u.cssNumber[i]){d+="px"}if(!u.support.clearCloneStyle&&d===""&&c.indexOf("background")===0){j[c]="inherit"}if(!h||!("set"in h)||(d=h.set(a,d,e))!==b){j[c]=d}}else{if(h&&"get"in h&&(f=h.get(a,false,e))!==b){return f}return j[c]}},css:function(a,c,d,e){var f,g,h,i=u.camelCase(c);c=u.cssProps[i]||(u.cssProps[i]=Eb(a.style,i));h=u.cssHooks[c]||u.cssHooks[i];if(h&&"get"in h){f=h.get(a,true,d)}if(f===b){f=sb(a,c,e)}if(f==="normal"&&c in Bb){f=Bb[c]}if(d===""||d){g=parseFloat(f);return d===true||u.isNumeric(g)?g||0:f}return f}});sb=function(a,c,d){var e,f,g,h=d||Gb(a),i=h?h.getPropertyValue(c)||h[c]:b,j=a.style;if(h){if(i===""&&!u.contains(a.ownerDocument,a)){i=u.style(a,c)}if(xb.test(i)&&vb.test(c)){e=j.width;f=j.minWidth;g=j.maxWidth;j.minWidth=j.maxWidth=j.width=i;i=h.width;j.width=e;j.minWidth=f;j.maxWidth=g}}return i};function Ib(a,b,c){var d=wb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Jb(a,b,c,d,e){var f=c===(d?"border":"content")?4:b==="width"?1:0,g=0;for(;f<4;f+=2){if(c==="margin"){g+=u.css(a,c+Cb[f],true,e)}if(d){if(c==="content"){g-=u.css(a,"padding"+Cb[f],true,e)}if(c!=="margin"){g-=u.css(a,"border"+Cb[f]+"Width",true,e)}}else{g+=u.css(a,"padding"+Cb[f],true,e);if(c!=="padding"){g+=u.css(a,"border"+Cb[f]+"Width",true,e)}}}return g}function Kb(a,b,c){var d=true,e=b==="width"?a.offsetWidth:a.offsetHeight,f=Gb(a),g=u.support.boxSizing&&u.css(a,"boxSizing",false,f)==="border-box";if(e<=0||e==null){e=sb(a,b,f);if(e<0||e==null){e=a.style[b]}if(xb.test(e)){return e}d=g&&(u.support.boxSizingReliable||e===a.style[b]);e=parseFloat(e)||0}return e+Jb(a,b,c||(g?"border":"content"),d,f)+"px"}function Lb(a){var b=g,c=zb[a];if(!c){c=Mb(a,b);if(c==="none"||!c){tb=(tb||u("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(b.documentElement);b=(tb[0].contentWindow||tb[0].contentDocument).document;b.write("<!doctype html><html><body>");b.close();c=Mb(a,b);tb.detach()}zb[a]=c}return c}function Mb(a,b){var c=u(b.createElement(a)).appendTo(b.body),d=u.css(c[0],"display");c.remove();return d}u.each(["height","width"],function(a,b){u.cssHooks[b]={get:function(a,c,d){if(c){return a.offsetWidth===0&&ub.test(u.css(a,"display"))?u.swap(a,Ab,function(){return Kb(a,b,d)}):Kb(a,b,d)}},set:function(a,c,d){var e=d&&Gb(a);return Ib(a,c,d?Jb(a,b,d,u.support.boxSizing&&u.css(a,"boxSizing",false,e)==="border-box",e):0)}}});u(function(){if(!u.support.reliableMarginRight){u.cssHooks.marginRight={get:function(a,b){if(b){return u.swap(a,{display:"inline-block"},sb,[a,"marginRight"])}}}}if(!u.support.pixelPosition&&u.fn.position){u.each(["top","left"],function(a,b){u.cssHooks[b]={get:function(a,c){if(c){c=sb(a,b);return xb.test(c)?u(a).position()[b]+"px":c}}}})}});if(u.expr&&u.expr.filters){u.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0};u.expr.filters.visible=function(a){return!u.expr.filters.hidden(a)}}u.each({margin:"",padding:"",border:"Width"},function(a,b){u.cssHooks[a+b]={expand:function(c){var d=0,e={},f=typeof c==="string"?c.split(" "):[c];for(;d<4;d++){e[a+Cb[d]+b]=f[d]||f[d-2]||f[0]}return e}};if(!vb.test(a)){u.cssHooks[a+b].set=Ib}});var Nb=/%20/g,Ob=/\[\]$/,Pb=/\r?\n/g,Qb=/^(?:submit|button|image|reset|file)$/i,Rb=/^(?:input|select|textarea|keygen)/i;u.fn.extend({serialize:function(){return u.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=u.prop(this,"elements");return a?u.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!u(this).is(":disabled")&&Rb.test(this.nodeName)&&!Qb.test(a)&&(this.checked||!fb.test(a))
}).map(function(a,b){var c=u(this).val();return c==null?null:u.isArray(c)?u.map(c,function(a){return{name:b.name,value:a.replace(Pb,"\r\n")}}):{name:b.name,value:c.replace(Pb,"\r\n")}}).get()}});u.param=function(a,c){var d,e=[],f=function(a,b){b=u.isFunction(b)?b():b==null?"":b;e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(c===b){c=u.ajaxSettings&&u.ajaxSettings.traditional}if(u.isArray(a)||a.jquery&&!u.isPlainObject(a)){u.each(a,function(){f(this.name,this.value)})}else{for(d in a){Sb(d,a[d],c,f)}}return e.join("&").replace(Nb,"+")};function Sb(a,b,c,d){var e;if(u.isArray(b)){u.each(b,function(b,e){if(c||Ob.test(a)){d(a,e)}else{Sb(a+"["+(typeof e==="object"?b:"")+"]",e,c,d)}})}else if(!c&&u.type(b)==="object"){for(e in b){Sb(a+"["+e+"]",b[e],c,d)}}else{d(a,b)}}u.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(a,b){u.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}});u.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length===1?this.off(a,"**"):this.off(b,a||"**",c)}});var Tb,Ub,Vb=u.now(),Wb=/\?/,Xb=/#.*$/,Yb=/([?&])_=[^&]*/,Zb=/^(.*?):[ \t]*([^\r\n]*)$/gm,$b=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,_b=/^(?:GET|HEAD)$/,ac=/^\/\//,bc=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,cc=u.fn.load,dc={},ec={},fc="*/".concat("*");try{Ub=f.href}catch(gc){Ub=g.createElement("a");Ub.href="";Ub=Ub.href}Tb=bc.exec(Ub.toLowerCase())||[];function hc(a){return function(b,c){if(typeof b!=="string"){c=b;b="*"}var d,e=0,f=b.toLowerCase().match(w)||[];if(u.isFunction(c)){while(d=f[e++]){if(d[0]==="+"){d=d.slice(1)||"*";(a[d]=a[d]||[]).unshift(c)}else{(a[d]=a[d]||[]).push(c)}}}}}function ic(a,b,c,d){var e={},f=a===ec;function g(h){var i;e[h]=true;u.each(a[h]||[],function(a,h){var j=h(b,c,d);if(typeof j==="string"&&!f&&!e[j]){b.dataTypes.unshift(j);g(j);return false}else if(f){return!(i=j)}});return i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function jc(a,c){var d,e,f=u.ajaxSettings.flatOptions||{};for(d in c){if(c[d]!==b){(f[d]?a:e||(e={}))[d]=c[d]}}if(e){u.extend(true,a,e)}return a}u.fn.load=function(a,c,d){if(typeof a!=="string"&&cc){return cc.apply(this,arguments)}var e,f,g,h=this,i=a.indexOf(" ");if(i>=0){e=a.slice(i);a=a.slice(0,i)}if(u.isFunction(c)){d=c;c=b}else if(c&&typeof c==="object"){f="POST"}if(h.length>0){u.ajax({url:a,type:f,dataType:"html",data:c}).done(function(a){g=arguments;h.html(e?u("<div>").append(u.parseHTML(a)).find(e):a)}).complete(d&&function(a,b){h.each(d,g||[a.responseText,b,a])})}return this};u.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){u.fn[b]=function(a){return this.on(b,a)}});u.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ub,type:"GET",isLocal:$b.test(Tb[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":fc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":u.parseJSON,"text xml":u.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(a,b){return b?jc(jc(a,u.ajaxSettings),b):jc(u.ajaxSettings,a)},ajaxPrefilter:hc(dc),ajaxTransport:hc(ec),ajax:function(a,c){if(typeof a==="object"){c=a;a=b}c=c||{};var d,e,f,g,h,i,j,k,l=u.ajaxSetup({},c),m=l.context||l,n=l.context&&(m.nodeType||m.jquery)?u(m):u.event,o=u.Deferred(),p=u.Callbacks("once memory"),q=l.statusCode||{},r={},s={},t=0,v="canceled",x={readyState:0,getResponseHeader:function(a){var b;if(t===2){if(!g){g={};while(b=Zb.exec(f)){g[b[1].toLowerCase()]=b[2]}}b=g[a.toLowerCase()]}return b==null?null:b},getAllResponseHeaders:function(){return t===2?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();if(!t){a=s[c]=s[c]||a;r[a]=b}return this},overrideMimeType:function(a){if(!t){l.mimeType=a}return this},statusCode:function(a){var b;if(a){if(t<2){for(b in a){q[b]=[q[b],a[b]]}}else{x.always(a[x.status])}}return this},abort:function(a){var b=a||v;if(d){d.abort(b)}z(0,b);return this}};o.promise(x).complete=p.add;x.success=x.done;x.error=x.fail;l.url=((a||l.url||Ub)+"").replace(Xb,"").replace(ac,Tb[1]+"//");l.type=c.method||c.type||l.method||l.type;l.dataTypes=u.trim(l.dataType||"*").toLowerCase().match(w)||[""];if(l.crossDomain==null){i=bc.exec(l.url.toLowerCase());l.crossDomain=!!(i&&(i[1]!==Tb[1]||i[2]!==Tb[2]||(i[3]||(i[1]==="http:"?"80":"443"))!==(Tb[3]||(Tb[1]==="http:"?"80":"443"))))}if(l.data&&l.processData&&typeof l.data!=="string"){l.data=u.param(l.data,l.traditional)}ic(dc,l,c,x);if(t===2){return x}j=l.global;if(j&&u.active++===0){u.event.trigger("ajaxStart")}l.type=l.type.toUpperCase();l.hasContent=!_b.test(l.type);e=l.url;if(!l.hasContent){if(l.data){e=l.url+=(Wb.test(e)?"&":"?")+l.data;delete l.data}if(l.cache===false){l.url=Yb.test(e)?e.replace(Yb,"$1_="+Vb++):e+(Wb.test(e)?"&":"?")+"_="+Vb++}}if(l.ifModified){if(u.lastModified[e]){x.setRequestHeader("If-Modified-Since",u.lastModified[e])}if(u.etag[e]){x.setRequestHeader("If-None-Match",u.etag[e])}}if(l.data&&l.hasContent&&l.contentType!==false||c.contentType){x.setRequestHeader("Content-Type",l.contentType)}x.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+fc+"; q=0.01":""):l.accepts["*"]);for(k in l.headers){x.setRequestHeader(k,l.headers[k])}if(l.beforeSend&&(l.beforeSend.call(m,x,l)===false||t===2)){return x.abort()}v="abort";for(k in{success:1,error:1,complete:1}){x[k](l[k])}d=ic(ec,l,c,x);if(!d){z(-1,"No Transport")}else{x.readyState=1;if(j){n.trigger("ajaxSend",[x,l])}if(l.async&&l.timeout>0){h=setTimeout(function(){x.abort("timeout")},l.timeout)}try{t=1;d.send(r,z)}catch(y){if(t<2){z(-1,y)}else{throw y}}}function z(a,c,g,i){var k,r,s,v,w,y=c;if(t===2){return}t=2;if(h){clearTimeout(h)}d=b;f=i||"";x.readyState=a>0?4:0;k=a>=200&&a<300||a===304;if(g){v=kc(l,x,g)}v=lc(l,v,x,k);if(k){if(l.ifModified){w=x.getResponseHeader("Last-Modified");if(w){u.lastModified[e]=w}w=x.getResponseHeader("etag");if(w){u.etag[e]=w}}if(a===204){y="nocontent"}else if(a===304){y="notmodified"}else{y=v.state;r=v.data;s=v.error;k=!s}}else{s=y;if(a||!y){y="error";if(a<0){a=0}}}x.status=a;x.statusText=(c||y)+"";if(k){o.resolveWith(m,[r,y,x])}else{o.rejectWith(m,[x,y,s])}x.statusCode(q);q=b;if(j){n.trigger(k?"ajaxSuccess":"ajaxError",[x,l,k?r:s])}p.fireWith(m,[x,y]);if(j){n.trigger("ajaxComplete",[x,l]);if(!--u.active){u.event.trigger("ajaxStop")}}}return x},getJSON:function(a,b,c){return u.get(a,b,c,"json")},getScript:function(a,c){return u.get(a,b,c,"script")}});u.each(["get","post"],function(a,c){u[c]=function(a,d,e,f){if(u.isFunction(d)){f=f||e;e=d;d=b}return u.ajax({url:a,type:c,dataType:f,data:d,success:e})}});function kc(a,c,d){var e,f,g,h,i=a.contents,j=a.dataTypes;while(j[0]==="*"){j.shift();if(e===b){e=a.mimeType||c.getResponseHeader("Content-Type")}}if(e){for(f in i){if(i[f]&&i[f].test(e)){j.unshift(f);break}}}if(j[0]in d){g=j[0]}else{for(f in d){if(!j[0]||a.converters[f+" "+j[0]]){g=f;break}if(!h){h=f}}g=g||h}if(g){if(g!==j[0]){j.unshift(g)}return d[g]}}function lc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1]){for(g in a.converters){j[g.toLowerCase()]=a.converters[g]}}f=k.shift();while(f){if(a.responseFields[f]){c[a.responseFields[f]]=b}if(!i&&d&&a.dataFilter){b=a.dataFilter(b,a.dataType)}i=f;f=k.shift();if(f){if(f==="*"){f=i}else if(i!=="*"&&i!==f){g=j[i+" "+f]||j["* "+f];if(!g){for(e in j){h=e.split(" ");if(h[1]===f){g=j[i+" "+h[0]]||j["* "+h[0]];if(g){if(g===true){g=j[e]}else if(j[e]!==true){f=h[0];k.unshift(h[1])}break}}}}if(g!==true){if(g&&a["throws"]){b=g(b)}else{try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}}}}}return{state:"success",data:b}}u.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){u.globalEval(a);return a}}});u.ajaxPrefilter("script",function(a){if(a.cache===b){a.cache=false}if(a.crossDomain){a.type="GET"}});u.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=u("<script>").prop({async:true,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove();c=null;if(a){e(a.type==="error"?404:200,a.type)}});g.head.appendChild(b[0])},abort:function(){if(c){c()}}}}});var mc=[],nc=/(=)\?(?=&|$)|\?\?/;u.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=mc.pop()||u.expando+"_"+Vb++;this[a]=true;return a}});u.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,i=c.jsonp!==false&&(nc.test(c.url)?"url":typeof c.data==="string"&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&nc.test(c.data)&&"data");if(i||c.dataTypes[0]==="jsonp"){f=c.jsonpCallback=u.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback;if(i){c[i]=c[i].replace(nc,"$1"+f)}else if(c.jsonp!==false){c.url+=(Wb.test(c.url)?"&":"?")+c.jsonp+"="+f}c.converters["script json"]=function(){if(!h){u.error(f+" was not called")}return h[0]};c.dataTypes[0]="json";g=a[f];a[f]=function(){h=arguments};e.always(function(){a[f]=g;if(c[f]){c.jsonpCallback=d.jsonpCallback;mc.push(f)}if(h&&u.isFunction(g)){g(h[0])}h=g=b});return"script"}});u.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var oc=u.ajaxSettings.xhr(),pc={0:200,1223:204},qc=0,rc={};if(a.ActiveXObject){u(a).on("unload",function(){for(var a in rc){rc[a]()}rc=b})}u.support.cors=!!oc&&"withCredentials"in oc;u.support.ajax=oc=!!oc;u.ajaxTransport(function(a){var c;if(u.support.cors||oc&&!a.crossDomain){return{send:function(d,e){var f,g,h=a.xhr();h.open(a.type,a.url,a.async,a.username,a.password);if(a.xhrFields){for(f in a.xhrFields){h[f]=a.xhrFields[f]}}if(a.mimeType&&h.overrideMimeType){h.overrideMimeType(a.mimeType)}if(!a.crossDomain&&!d["X-Requested-With"]){d["X-Requested-With"]="XMLHttpRequest"}for(f in d){h.setRequestHeader(f,d[f])}c=function(a){return function(){if(c){delete rc[g];c=h.onload=h.onerror=null;if(a==="abort"){h.abort()}else if(a==="error"){e(h.status||404,h.statusText)}else{e(pc[h.status]||h.status,h.statusText,typeof h.responseText==="string"?{text:h.responseText}:b,h.getAllResponseHeaders())}}}};h.onload=c();h.onerror=c("error");c=rc[g=qc++]=c("abort");h.send(a.hasContent&&a.data||null)},abort:function(){if(c){c()}}}}});var sc,tc,uc=/^(?:toggle|show|hide)$/,vc=new RegExp("^(?:([+-])=|)("+v+")([a-z%]*)$","i"),wc=/queueHooks$/,xc=[Dc],yc={"*":[function(a,b){var c,d,e=this.createTween(a,b),f=vc.exec(b),g=e.cur(),h=+g||0,i=1,j=20;if(f){c=+f[2];d=f[3]||(u.cssNumber[a]?"":"px");if(d!=="px"&&h){h=u.css(e.elem,a,true)||c||1;do{i=i||".5";h=h/i;u.style(e.elem,a,h+d)}while(i!==(i=e.cur()/g)&&i!==1&&--j)}e.unit=d;e.start=h;e.end=f[1]?h+(f[1]+1)*c:c}return e}]};function zc(){setTimeout(function(){sc=b});return sc=u.now()}function Ac(a,b){u.each(b,function(b,c){var d=(yc[b]||[]).concat(yc["*"]),e=0,f=d.length;for(;e<f;e++){if(d[e].call(a,b,c)){return}}})}function Bc(a,b,c){var d,e,f=0,g=xc.length,h=u.Deferred().always(function(){delete i.elem}),i=function(){if(e){return false}var b=sc||zc(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;for(;g<i;g++){j.tweens[g].run(f)}h.notifyWith(a,[j,f,c]);if(f<1&&i){return c}else{h.resolveWith(a,[j]);return false}},j=h.promise({elem:a,props:u.extend({},b),opts:u.extend(true,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:sc||zc(),duration:c.duration,tweens:[],createTween:function(b,c){var d=u.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);j.tweens.push(d);return d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e){return this}e=true;for(;c<d;c++){j.tweens[c].run(1)}if(b){h.resolveWith(a,[j,b])}else{h.rejectWith(a,[j,b])}return this}}),k=j.props;Cc(k,j.opts.specialEasing);for(;f<g;f++){d=xc[f].call(j,a,k,j.opts);if(d){return d}}Ac(j,k);if(u.isFunction(j.opts.start)){j.opts.start.call(a,j)}u.fx.timer(u.extend(i,{elem:a,anim:j,queue:j.opts.queue}));return j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function Cc(a,b){var c,d,e,f,g;for(c in a){d=u.camelCase(c);e=b[d];f=a[c];if(u.isArray(f)){e=f[1];f=a[c]=f[0]}if(c!==d){a[d]=f;delete a[c]}g=u.cssHooks[d];if(g&&"expand"in g){f=g.expand(f);delete a[d];for(c in f){if(!(c in a)){a[c]=f[c];b[c]=e}}}else{b[d]=e}}}u.Animation=u.extend(Bc,{tweener:function(a,b){if(u.isFunction(a)){b=a;a=["*"]}else{a=a.split(" ")}var c,d=0,e=a.length;for(;d<e;d++){c=a[d];yc[c]=yc[c]||[];yc[c].unshift(b)}},prefilter:function(a,b){if(b){xc.unshift(a)}else{xc.push(a)}}});function Dc(a,c,d){var e,f,g,h,i,j,k,l,m,n=this,o=a.style,p={},q=[],r=a.nodeType&&Fb(a);if(!d.queue){l=u._queueHooks(a,"fx");if(l.unqueued==null){l.unqueued=0;m=l.empty.fire;l.empty.fire=function(){if(!l.unqueued){m()}}}l.unqueued++;n.always(function(){n.always(function(){l.unqueued--;if(!u.queue(a,"fx").length){l.empty.fire()}})})}if(a.nodeType===1&&("height"in c||"width"in c)){d.overflow=[o.overflow,o.overflowX,o.overflowY];if(u.css(a,"display")==="inline"&&u.css(a,"float")==="none"){o.display="inline-block"}}if(d.overflow){o.overflow="hidden";n.always(function(){o.overflow=d.overflow[0];o.overflowX=d.overflow[1];o.overflowY=d.overflow[2]})}i=H.get(a,"fxshow");for(e in c){g=c[e];if(uc.exec(g)){delete c[e];j=j||g==="toggle";if(g===(r?"hide":"show")){if(g==="show"&&i!==b&&i[e]!==b){r=true}else{continue}}q.push(e)}}h=q.length;if(h){i=H.get(a,"fxshow")||H.access(a,"fxshow",{});if("hidden"in i){r=i.hidden}if(j){i.hidden=!r}if(r){u(a).show()}else{n.done(function(){u(a).hide()})}n.done(function(){var b;H.remove(a,"fxshow");for(b in p){u.style(a,b,p[b])}});for(e=0;e<h;e++){f=q[e];k=n.createTween(f,r?i[f]:0);p[f]=i[f]||u.style(a,f);if(!(f in i)){i[f]=k.start;if(r){k.end=k.start;k.start=f==="width"||f==="height"?1:0}}}}}function Ec(a,b,c,d,e){return new Ec.prototype.init(a,b,c,d,e)}u.Tween=Ec;Ec.prototype={constructor:Ec,init:function(a,b,c,d,e,f){this.elem=a;this.prop=c;this.easing=e||"swing";this.options=b;this.start=this.now=this.cur();this.end=d;this.unit=f||(u.cssNumber[c]?"":"px")},cur:function(){var a=Ec.propHooks[this.prop];return a&&a.get?a.get(this):Ec.propHooks._default.get(this)},run:function(a){var b,c=Ec.propHooks[this.prop];if(this.options.duration){this.pos=b=u.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration)}else{this.pos=b=a}this.now=(this.end-this.start)*b+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(c&&c.set){c.set(this)}else{Ec.propHooks._default.set(this)}return this}};Ec.prototype.init.prototype=Ec.prototype;Ec.propHooks={_default:{get:function(a){var b;if(a.elem[a.prop]!=null&&(!a.elem.style||a.elem.style[a.prop]==null)){return a.elem[a.prop]}b=u.css(a.elem,a.prop,"");return!b||b==="auto"?0:b},set:function(a){if(u.fx.step[a.prop]){u.fx.step[a.prop](a)}else if(a.elem.style&&(a.elem.style[u.cssProps[a.prop]]!=null||u.cssHooks[a.prop])){u.style(a.elem,a.prop,a.now+a.unit)}else{a.elem[a.prop]=a.now}}}};Ec.propHooks.scrollTop=Ec.propHooks.scrollLeft={set:function(a){if(a.elem.nodeType&&a.elem.parentNode){a.elem[a.prop]=a.now}}};u.each(["toggle","show","hide"],function(a,b){var c=u.fn[b];u.fn[b]=function(a,d,e){return a==null||typeof a==="boolean"?c.apply(this,arguments):this.animate(Fc(b,true),a,d,e)}});u.fn.extend({fadeTo:function(a,b,c,d){return this.filter(Fb).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=u.isEmptyObject(a),f=u.speed(b,c,d),g=function(){var b=Bc(this,u.extend({},a),f);g.finish=function(){b.stop(true)};if(e||H.get(this,"finish")){b.stop(true)}};g.finish=g;return e||f.queue===false?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop;b(d)};if(typeof a!=="string"){d=c;c=a;a=b}if(c&&a!==false){this.queue(a||"fx",[])}return this.each(function(){var b=true,c=a!=null&&a+"queueHooks",f=u.timers,g=H.get(this);if(c){if(g[c]&&g[c].stop){e(g[c])}}else{for(c in g){if(g[c]&&g[c].stop&&wc.test(c)){e(g[c])}}}for(c=f.length;c--;){if(f[c].elem===this&&(a==null||f[c].queue===a)){f[c].anim.stop(d);b=false;f.splice(c,1)}}if(b||!d){u.dequeue(this,a)}})},finish:function(a){if(a!==false){a=a||"fx"}return this.each(function(){var b,c=H.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=u.timers,g=d?d.length:0;c.finish=true;u.queue(this,a,[]);if(e&&e.cur&&e.cur.finish){e.cur.finish.call(this)}for(b=f.length;b--;){if(f[b].elem===this&&f[b].queue===a){f[b].anim.stop(true);f.splice(b,1)}}for(b=0;b<g;b++){if(d[b]&&d[b].finish){d[b].finish.call(this)}}delete c.finish})}});function Fc(a,b){var c,d={height:a},e=0;b=b?1:0;for(;e<4;e+=2-b){c=Cb[e];d["margin"+c]=d["padding"+c]=a}if(b){d.opacity=d.width=a}return d}u.each({slideDown:Fc("show"),slideUp:Fc("hide"),slideToggle:Fc("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){u.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}});u.speed=function(a,b,c){var d=a&&typeof a==="object"?u.extend({},a):{complete:c||!c&&b||u.isFunction(a)&&a,duration:a,easing:c&&b||b&&!u.isFunction(b)&&b};d.duration=u.fx.off?0:typeof d.duration==="number"?d.duration:d.duration in u.fx.speeds?u.fx.speeds[d.duration]:u.fx.speeds._default;if(d.queue==null||d.queue===true){d.queue="fx"}d.old=d.complete;d.complete=function(){if(u.isFunction(d.old)){d.old.call(this)}if(d.queue){u.dequeue(this,d.queue)}};return d};u.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}};u.timers=[];u.fx=Ec.prototype.init;u.fx.tick=function(){var a,c=u.timers,d=0;sc=u.now();for(;d<c.length;d++){a=c[d];if(!a()&&c[d]===a){c.splice(d--,1)}}if(!c.length){u.fx.stop()}sc=b};u.fx.timer=function(a){if(a()&&u.timers.push(a)){u.fx.start()}};u.fx.interval=13;u.fx.start=function(){if(!tc){tc=setInterval(u.fx.tick,u.fx.interval)}};u.fx.stop=function(){clearInterval(tc);tc=null};u.fx.speeds={slow:600,fast:200,_default:400};u.fx.step={};if(u.expr&&u.expr.filters){u.expr.filters.animated=function(a){return u.grep(u.timers,function(b){return a===b.elem}).length}}u.fn.offset=function(a){if(arguments.length){return a===b?this:this.each(function(b){u.offset.setOffset(this,a,b)})}var c,d,f=this[0],g={top:0,left:0},h=f&&f.ownerDocument;if(!h){return}c=h.documentElement;if(!u.contains(c,f)){return g}if(typeof f.getBoundingClientRect!==e){g=f.getBoundingClientRect()}d=Gc(h);return{top:g.top+d.pageYOffset-c.clientTop,left:g.left+d.pageXOffset-c.clientLeft}};u.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=u.css(a,"position"),l=u(a),m={};if(k==="static"){a.style.position="relative"}h=l.offset();f=u.css(a,"top");i=u.css(a,"left");j=(k==="absolute"||k==="fixed")&&(f+i).indexOf("auto")>-1;if(j){d=l.position();g=d.top;e=d.left}else{g=parseFloat(f)||0;e=parseFloat(i)||0}if(u.isFunction(b)){b=b.call(a,c,h)}if(b.top!=null){m.top=b.top-h.top+g}if(b.left!=null){m.left=b.left-h.left+e}if("using"in b){b.using.call(a,m)}else{l.css(m)}}};u.fn.extend({position:function(){if(!this[0]){return}var a,b,c=this[0],d={top:0,left:0};if(u.css(c,"position")==="fixed"){b=c.getBoundingClientRect()}else{a=this.offsetParent();b=this.offset();if(!u.nodeName(a[0],"html")){d=a.offset()}d.top+=u.css(a[0],"borderTopWidth",true);d.left+=u.css(a[0],"borderLeftWidth",true)}return{top:b.top-d.top-u.css(c,"marginTop",true),left:b.left-d.left-u.css(c,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||h;while(a&&!u.nodeName(a,"html")&&u.css(a,"position")==="static"){a=a.offsetParent}return a||h})}});u.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(c,d){var e="pageYOffset"===d;u.fn[c]=function(f){return u.access(this,function(c,f,g){var h=Gc(c);if(g===b){return h?h[d]:c[f]}if(h){h.scrollTo(!e?g:a.pageXOffset,e?g:a.pageYOffset)}else{c[f]=g}},c,f,arguments.length,null)}});function Gc(a){return u.isWindow(a)?a:a.nodeType===9&&a.defaultView}u.each({Height:"height",Width:"width"},function(a,c){u.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){u.fn[e]=function(e,f){var g=arguments.length&&(d||typeof e!=="boolean"),h=d||(e===true||f===true?"margin":"border");return u.access(this,function(c,d,e){var f;if(u.isWindow(c)){return c.document.documentElement["client"+a]}if(c.nodeType===9){f=c.documentElement;return Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])}return e===b?u.css(c,d,h):u.style(c,d,e,h)},c,g?e:b,g,null)}})});u.fn.size=function(){return this.length};u.fn.andSelf=u.fn.addBack;if(typeof module==="object"&&typeof module.exports==="object"){module.exports=u}else{if(typeof define==="function"&&define.amd){define("jquery",[],function(){return u})}}if(typeof a==="object"&&typeof a.document==="object"){a.jQuery=a.$=u}}(window);if(window.console===undefined){var noop=function(){};window.console={log:noop,warn:noop,error:noop}}if(!window.getComputedStyle){window.getComputedStyle=function(a,b){this.el=a;this.getPropertyValue=function(b){var c=/(\-([a-z]){1})/g;if(b=="float")b="styleFloat";if(c.test(b)){b=b.replace(c,function(){return arguments[2].toUpperCase()})}return a.currentStyle[b]?a.currentStyle[b]:null};return this}}if(typeof window.getMatchedCSSRules!=="function"){var ELEMENT_RE=/[\w-]+/g,ID_RE=/#[\w-]+/g,CLASS_RE=/\.[\w-]+/g,ATTR_RE=/\[[^\]]+\]/g,PSEUDO_CLASSES_RE=/\:(?!not)[\w-]+(\(.*\))?/g,PSEUDO_ELEMENTS_RE=/\:\:?(after|before|first-letter|first-line|selection)/g;function toArray(a){return[].slice.call(a)}function getSheetRules(a){var b=a.media&&a.media.mediaText;if(a.disabled)return[];if(b&&b.length&&!window.matchMedia(b).matches)return[];return toArray(a.cssRules)}function _find(a,b){var c=a.match(b);return b?b.length:0}function calculateScore(a){var b=[0,0,0],c=a.split(" "),d,e;while(d=c.shift(),typeof d=="string"){e=_find(d,PSEUDO_ELEMENTS_RE);b[2]=e;e&&(d=d.replace(PSEUDO_ELEMENTS_RE,""));e=_find(d,PSEUDO_CLASSES_RE);b[1]=e;e&&(d=d.replace(PSEUDO_CLASSES_RE,""));e=_find(d,ATTR_RE);b[1]+=e;e&&(d=d.replace(ATTR_RE,""));e=_find(d,ID_RE);b[0]=e;e&&(d=d.replace(ID_RE,""));e=_find(d,CLASS_RE);b[1]+=e;e&&(d=d.replace(CLASS_RE,""));b[2]+=_find(d,ELEMENT_RE)}return parseInt(b.join(""),10)}function getSpecificityScore(a,b){var c=b.split(","),d,e,f=0;while(d=c.shift()){if(a.mozMatchesSelector(d)){e=calculateScore(d);f=e>f?e:f}}return f}function sortBySpecificity(a,b){function c(b,c){return getSpecificityScore(a,c.selectorText)-getSpecificityScore(a,b.selectorText)}return b.sort(c)}window.getMatchedCSSRules=function(a){var b,c,d,e,f,g=[];b=toArray(window.document.styleSheets);while(c=b.shift()){e=getSheetRules(c);while(f=e.shift()){if(f.styleSheet){e=getSheetRules(f.styleSheet).concat(e);continue}else if(f.media){e=getSheetRules(f).concat(e);continue}if(a.mozMatchesSelector(f.selectorText)){g.push(f)}}}return sortBySpecificity(a,g)}}window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(function(){a((new Date).getTime())},1e3/60)}}();!function(){function a(a,b,c){c[a]=b[a];if(typeof b[a]==="function"){c[a].__name__=a}}var b=function(){this.events=$({})};b.prototype._extend=function(c,d){if(typeof c==="undefined"){return null}if(c===this._extend){return c}if(typeof d==="undefined"){d=c;c=b.PUBLIC}var e,f,g=this;switch(c){case b.PUBLIC:e=d._public&&d._public.construct?d._public.construct:function(){};break;case b.ABSTRACT:e=function(){if(!b.prototype.__extending__()){}if(d._public.construct){d._public.construct.apply(this,arguments)}};break;case b.SINGLETON:e=function(){if(!b.prototype.__singletonInstantiation__||!b.prototype.__singletonInstantiation__()){throw new Error("Illegal attempt to directly instantiate singleton class. Use getInstance() instead.")}if(d._public&&d._public.construct){d._public.construct.call(this)}};e.getInstance=function(){if(e.__instance__){return e.__instance__}else{b.prototype.__singletonInstantiation__=function(){return true};e.__instance__=new e;b.prototype.__singletonInstantiation__=function(){return false};return e.__instance__}};break}e.__constructor__=function(){return true};b.prototype.__extending__=function(){return true};try{e.prototype=new this}catch(h){console.log("Error providing inheritance. Class constructor has thrown an error:\n"+h.stack+"\nPlease make sure constructors can always run fine with no parameters specified.")}b.prototype.__extending__=function(){return false};e._extend=e.prototype._extend;e.prototype._super=function(){var a=arguments.callee.caller;if(a.__constructor__&&a.__constructor__()){b.prototype.__extending__=function(){return true};g.apply(this,arguments);b.prototype.__extending__=function(){return false}}else if(typeof g.prototype[a.__name__]==="function"){return g.prototype[a.__name__].apply(this,arguments)}else{throw new Error("No super method for "+a.__name__)}};e.prototype.events=$({});for(f in d._public){if(f!=="construct"){a(f,d._public,e.prototype)}}for(f in d._protected){a(f,d._protected,e.prototype)}for(f in d._private){a(f,d._private,e.prototype)}for(f in d._static){a(f,d._static,e)}return e};b._extend=b.prototype._extend;b.PUBLIC=1;b.ABSTRACT=2;b.SINGLETON=3;window.Class=b}();!function(){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(a){"use strict";if(this==null){throw new TypeError}var b=Object(this);var c=b.length>>>0;if(c===0){return-1}var d=0;if(arguments.length>0){d=Number(arguments[1]);if(d!=d){d=0}else if(d!=0&&d!=Infinity&&d!=-Infinity){d=(d>0||-1)*Math.floor(Math.abs(d))}}if(d>=c){return-1}var e=d>=0?d:Math.max(c-Math.abs(d),0);for(;e<c;e++){if(e in b&&b[e]===a){return e}}return-1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(a){"use strict";if(this==null){throw new TypeError}var b=Object(this);var c=b.length>>>0;if(c===0){return-1}var d=c;if(arguments.length>1){d=Number(arguments[1]);if(d!=d){d=0}else if(d!=0&&d!=1/0&&d!=-(1/0)){d=(d>0||-1)*Math.floor(Math.abs(d))}}var e=d>=0?Math.min(d,c-1):c-Math.abs(d);for(;e>=0;e--){if(e in b&&b[e]===a){return e}}return-1}}var a=this,b=a.jQuery||a.Zepto,c={},d={},e,f=0,g=[];if(typeof module!=="undefined"&&module.exports){module.exports=c}else{if(b){b.i18n=b.i18n||c}a.i18n=a.i18n||c}var h={lng:undefined,load:"all",preload:[],lowerCaseLng:false,returnObjectTrees:false,fallbackLng:"dev",fallbackNS:[],detectLngQS:"setLng",ns:"translation",fallbackOnNull:true,fallbackToDefaultNS:false,nsseparator:":",keyseparator:".",selectorAttr:"data-i18n",debug:false,resGetPath:"locales/__lng__/__ns__.json",resPostPath:"locales/add/__lng__/__ns__",getAsync:true,postAsync:true,resStore:undefined,useLocalStorage:false,localStorageExpirationTime:7*24*60*60*1e3,dynamicLoad:false,sendMissing:false,sendMissingTo:"fallback",sendType:"POST",interpolationPrefix:"__",interpolationSuffix:"__",reusePrefix:"$t(",reuseSuffix:")",pluralSuffix:"_plural",pluralNotFound:["plural_not_found",Math.random()].join(""),contextNotFound:["context_not_found",Math.random()].join(""),escapeInterpolation:false,setJqueryExt:true,defaultValueFromContent:true,useDataAttrOptions:false,cookieExpirationTime:undefined,useCookie:true,cookieName:"i18next",postProcess:undefined,parseMissingKey:undefined};function i(a,b){if(!b||typeof b==="function"){return a}for(var c in b){a[c]=b[c]}return a}function j(a,b,c){var d,e=0,f=a.length,g=f===undefined||typeof a==="function";if(c){if(g){for(d in a){if(b.apply(a[d],c)===false){break}}}else{for(;e<f;){if(b.apply(a[e++],c)===false){break}}}}else{if(g){for(d in a){if(b.call(a[d],d,a[d])===false){break}}}else{for(;e<f;){if(b.call(a[e],e,a[e++])===false){break}}}}return a}var k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function l(a){if(typeof a==="string"){return a.replace(/[&<>"'\/]/g,function(a){return k[a]})}else{return a}}function m(a){var b=function(a){if(window.XMLHttpRequest){return a(null,new XMLHttpRequest)}else if(window.ActiveXObject){try{return a(null,new ActiveXObject("Msxml2.XMLHTTP"))}catch(b){return a(null,new ActiveXObject("Microsoft.XMLHTTP"))}}return a(new Error)};var c=function(a){if(typeof a==="string"){return a}var b=[];for(var c in a){if(a.hasOwnProperty(c)){b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]))}}return b.join("&")};var d=function(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);if(d<128){b+=String.fromCharCode(d)}else if(d>127&&d<2048){b+=String.fromCharCode(d>>6|192);b+=String.fromCharCode(d&63|128)}else{b+=String.fromCharCode(d>>12|224);b+=String.fromCharCode(d>>6&63|128);b+=String.fromCharCode(d&63|128)}}return b};var e=function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a=d(a);var c="",e,f,g,h,i,j,k,l=0;do{e=a.charCodeAt(l++);f=a.charCodeAt(l++);g=a.charCodeAt(l++);h=e>>2;i=(e&3)<<4|f>>4;j=(f&15)<<2|g>>6;k=g&63;if(isNaN(f)){j=k=64}else if(isNaN(g)){k=64}c+=b.charAt(h)+b.charAt(i)+b.charAt(j)+b.charAt(k);e=f=g="";h=i=j=k=""}while(l<a.length);return c};var f=function(){var a=arguments[0];for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(c.hasOwnProperty(d)){a[d]=c[d]}}}return a};var g=function(a,d,e,h){if(typeof e==="function"){h=e;e={}}e.cache=e.cache||false;e.data=e.data||{};e.headers=e.headers||{};e.jsonp=e.jsonp||false;e.async=e.async===undefined?true:e.async;var i=f({accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},g.headers,e.headers);var j;if(i["content-type"]==="application/json"){j=JSON.stringify(e.data)}else{j=c(e.data)}if(a==="GET"){var k=[];if(j){k.push(j);j=null}if(!e.cache){k.push("_="+(new Date).getTime())}if(e.jsonp){k.push("callback="+e.jsonp);k.push("jsonp="+e.jsonp)}k=k.join("&");if(k.length>1){if(d.indexOf("?")>-1){d+="&"+k}else{d+="?"+k}}if(e.jsonp){var l=document.getElementsByTagName("head")[0];var m=document.createElement("script");m.type="text/javascript";m.src=d;l.appendChild(m);return}}b(function(b,c){if(b)return h(b);c.open(a,d,e.async);for(var f in i){if(i.hasOwnProperty(f)){c.setRequestHeader(f,i[f])}}c.onreadystatechange=function(){if(c.readyState===4){var a=c.responseText||"";if(!h){return}h(c.status,{text:function(){return a},json:function(){return JSON.parse(a)}})}};c.send(j)})};var h={authBasic:function(a,b){g.headers["Authorization"]="Basic "+e(a+":"+b)},connect:function(a,b,c){return g("CONNECT",a,b,c)},del:function(a,b,c){return g("DELETE",a,b,c)},get:function(a,b,c){return g("GET",a,b,c)},head:function(a,b,c){return g("HEAD",a,b,c)},headers:function(a){g.headers=a||{}},isAllowed:function(a,b,c){this.options(a,function(a,d){c(d.text().indexOf(b)!==-1)})},options:function(a,b,c){return g("OPTIONS",a,b,c)},patch:function(a,b,c){return g("PATCH",a,b,c)},post:function(a,b,c){return g("POST",a,b,c)},put:function(a,b,c){return g("PUT",a,b,c)},trace:function(a,b,c){return g("TRACE",a,b,c)}};var i=a.type?a.type.toLowerCase():"get";h[i](a.url,a,function(b,c){if(b===200){a.success(c.json(),b,null)}else{a.error(c.text(),b,null)}})}var n={create:function(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+c*60*1e3);d="; expires="+e.toGMTString()}else d="";document.cookie=a+"="+b+d+"; path=/"},read:function(a){var b=a+"=";var c=document.cookie.split(";");for(var d=0;d<c.length;d++){var e=c[d];while(e.charAt(0)==" ")e=e.substring(1,e.length);if(e.indexOf(b)===0)return e.substring(b.length,e.length)}return null},remove:function(a){this.create(a,"",-1)}};var o={create:function(a,b,c){},read:function(a){return null
},remove:function(a){}};var p={extend:b?b.extend:i,each:b?b.each:j,ajax:b?b.ajax:m,cookie:typeof document!=="undefined"?n:o,detectLanguage:I,escape:l,log:function(a){if(h.debug&&typeof console!=="undefined")console.log(a)},toLanguages:function(a){var b=[];if(typeof a==="string"&&a.indexOf("-")>-1){var c=a.split("-");a=h.lowerCaseLng?c[0].toLowerCase()+"-"+c[1].toLowerCase():c[0].toLowerCase()+"-"+c[1].toUpperCase();if(h.load!=="unspecific")b.push(a);if(h.load!=="current")b.push(c[0])}else{b.push(a)}if(b.indexOf(h.fallbackLng)===-1&&h.fallbackLng)b.push(h.fallbackLng);return b},regexEscape:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}};function q(a,f){if(typeof a==="function"){f=a;a={}}a=a||{};p.extend(h,a);if(typeof h.ns=="string"){h.ns={namespaces:[h.ns],defaultNs:h.ns}}if(typeof h.fallbackNS=="string"){h.fallbackNS=[h.fallbackNS]}h.interpolationPrefixEscaped=p.regexEscape(h.interpolationPrefix);h.interpolationSuffixEscaped=p.regexEscape(h.interpolationSuffix);if(!h.lng)h.lng=p.detectLanguage();if(h.lng){if(h.useCookie)p.cookie.create(h.cookieName,h.lng,h.cookieExpirationTime)}else{h.lng=h.fallbackLng;if(h.useCookie)p.cookie.remove(h.cookieName)}g=p.toLanguages(h.lng);e=g[0];p.log("currentLng set to: "+e);K.setCurrentLng(e);if(b&&h.setJqueryExt)y();var i;if(b&&b.Deferred){i=b.Deferred()}if(h.resStore){d=h.resStore;if(f)f(E);if(i)i.resolve();if(i)return i.promise();return}var j=p.toLanguages(h.lng);if(typeof h.preload==="string")h.preload=[h.preload];for(var k=0,l=h.preload.length;k<l;k++){var m=p.toLanguages(h.preload[k]);for(var n=0,o=m.length;n<o;n++){if(j.indexOf(m[n])<0){j.push(m[n])}}}c.sync.load(j,h,function(a,b){d=b;if(f)f(E);if(i)i.resolve()});if(i)return i.promise()}function r(a,b){if(typeof a==="string")a=[a];for(var c=0,d=a.length;c<d;c++){if(h.preload.indexOf(a[c])<0){h.preload.push(a[c])}}return q(b)}function s(a,b,c){if(typeof b!=="string"){c=b;b=h.ns.defaultNs}else if(h.ns.namespaces.indexOf(b)<0){h.ns.namespaces.push(b)}d[a]=d[a]||{};d[a][b]=d[a][b]||{};p.extend(d[a][b],c)}function t(a){h.ns.defaultNs=a}function u(a,b){v([a],b)}function v(a,b){var e={dynamicLoad:h.dynamicLoad,resGetPath:h.resGetPath,getAsync:h.getAsync,customLoad:h.customLoad,ns:{namespaces:a,defaultNs:""}};var f=p.toLanguages(h.lng);if(typeof h.preload==="string")h.preload=[h.preload];for(var g=0,i=h.preload.length;g<i;g++){var j=p.toLanguages(h.preload[g]);for(var k=0,l=j.length;k<l;k++){if(f.indexOf(j[k])<0){f.push(j[k])}}}var m=[];for(var n=0,o=f.length;n<o;n++){var q=false;var r=d[f[n]];if(r){for(var s=0,t=a.length;s<t;s++){if(!r[a[s]])q=true}}else{q=true}if(q)m.push(f[n])}if(m.length){c.sync._fetch(m,e,function(e,f){var g=a.length*m.length;p.each(a,function(a,e){if(h.ns.namespaces.indexOf(e)<0){h.ns.namespaces.push(e)}p.each(m,function(a,i){d[i]=d[i]||{};d[i][e]=f[i][e];g--;if(g===0&&b){if(h.useLocalStorage)c.sync._storeLocal(d);b()}})})})}else{if(b)b()}}function w(a,b){return q({lng:a},b)}function x(){return e}function y(){b.t=b.t||E;function a(a,c,d){if(c.length===0)return;var e="text";if(c.indexOf("[")===0){var f=c.split("]");c=f[1];e=f[0].substr(1,f[0].length-1)}if(c.indexOf(";")===c.length-1){c=c.substr(0,c.length-2)}var g;if(e==="html"){g=h.defaultValueFromContent?b.extend({defaultValue:a.html()},d):d;a.html(b.t(c,g))}else if(e==="text"){g=h.defaultValueFromContent?b.extend({defaultValue:a.text()},d):d;a.text(b.t(c,g))}else{g=h.defaultValueFromContent?b.extend({defaultValue:a.attr(e)},d):d;a.attr(e,b.t(c,g))}}function c(c,d){var e=c.attr(h.selectorAttr);if(!e)return;var f=c,g=c.data("i18n-target");if(g){f=c.find(g)||c}if(!d&&h.useDataAttrOptions===true){d=c.data("i18n-options")}d=d||{};if(e.indexOf(";")>=0){var i=e.split(";");b.each(i,function(b,c){if(c!=="")a(f,c,d)})}else{a(f,e,d)}if(h.useDataAttrOptions===true)c.data("i18n-options",d)}b.fn.i18n=function(a){return this.each(function(){c(b(this),a);var d=b(this).find("["+h.selectorAttr+"]");d.each(function(){c(b(this),a)})})}}function z(a,b,c,d){if(!a)return a;d=d||b;if(a.indexOf(d.interpolationPrefix||h.interpolationPrefix)<0)return a;var e=d.interpolationPrefix?p.regexEscape(d.interpolationPrefix):h.interpolationPrefixEscaped,f=d.interpolationSuffix?p.regexEscape(d.interpolationSuffix):h.interpolationSuffixEscaped,g="HTML"+f;p.each(b,function(b,i){var j=c?c+h.keyseparator+b:b;if(typeof i==="object"&&i!==null){a=z(a,i,j,d)}else{if(d.escapeInterpolation||h.escapeInterpolation){a=a.replace(new RegExp([e,j,g].join(""),"g"),i);a=a.replace(new RegExp([e,j,f].join(""),"g"),p.escape(i))}else{a=a.replace(new RegExp([e,j,f].join(""),"g"),i)}}});return a}p.applyReplacement=z;function A(a,b){var c=",";var d="{";var e="}";var g=p.extend({},b);delete g.postProcess;while(a.indexOf(h.reusePrefix)!=-1){f++;if(f>h.maxRecursion){break}var i=a.lastIndexOf(h.reusePrefix);var j=a.indexOf(h.reuseSuffix,i)+h.reuseSuffix.length;var k=a.substring(i,j);var l=k.replace(h.reusePrefix,"").replace(h.reuseSuffix,"");if(l.indexOf(c)!=-1){var m=l.indexOf(c);if(l.indexOf(d,m)!=-1&&l.indexOf(e,m)!=-1){var n=l.indexOf(d,m);var o=l.indexOf(e,n)+e.length;try{g=p.extend(g,JSON.parse(l.substring(n,o)));l=l.substring(0,m)}catch(q){}}}var r=G(l,g);a=a.replace(k,r)}return a}function B(a){return a.context&&typeof a.context=="string"}function C(a){return a.count!==undefined&&typeof a.count!="string"&&a.count!==1}function D(a,b){b=b||{};var c=b.defaultValue||a,d=H(a,b);return d!==undefined||d===c}function E(a,b){f=0;return G.apply(null,arguments)}function F(){var a=[];for(var b=1;b<arguments.length;b++){a.push(arguments[b])}return{postProcess:"sprintf",sprintf:a}}function G(a,b){if(typeof b=="string"){b=F.apply(null,arguments)}else{b=b||{}}var c=b.defaultValue||a,d=H(a,b),e=b.lng?p.toLanguages(b.lng):g,f=b.ns||h.ns.defaultNs,i;if(a.indexOf(h.nsseparator)>-1){i=a.split(h.nsseparator);f=i[0];a=i[1]}if(d===undefined&&h.sendMissing){if(b.lng){J.postMissing(e[0],f,a,c,e)}else{J.postMissing(h.lng,f,a,c,e)}}var j=b.postProcess||h.postProcess;if(d!==undefined&&j){if(L[j]){d=L[j](d,a,b)}}var k=c;if(c.indexOf(h.nsseparator)>-1){i=c.split(h.nsseparator);k=i[1]}if(k===a&&h.parseMissingKey){c=h.parseMissingKey(c)}if(d===undefined){c=z(c,b);c=A(c,b);if(j&&L[j]){var l=b.defaultValue||a;d=L[j](l,a,b)}}return d!==undefined?d:c}function H(a,b){b=b||{};var e,f,i=b.defaultValue||a,j=g;if(!d){return i}if(b.lng){j=p.toLanguages(b.lng);if(!d[j[0]]){var k=h.getAsync;h.getAsync=false;c.sync.load(j,h,function(a,b){p.extend(d,b);h.getAsync=k})}}var l=b.ns||h.ns.defaultNs;if(a.indexOf(h.nsseparator)>-1){var m=a.split(h.nsseparator);l=m[0];a=m[1]}if(B(b)){e=p.extend({},b);delete e.context;e.defaultValue=h.contextNotFound;var n=l+h.nsseparator+a+"_"+b.context;f=E(n,e);if(f!=h.contextNotFound){return z(f,{context:b.context})}}if(C(b)){e=p.extend({},b);delete e.count;e.defaultValue=h.pluralNotFound;var o=l+h.nsseparator+a+h.pluralSuffix;var q=K.get(j[0],b.count);if(q>=0){o=o+"_"+q}else if(q===1){o=l+h.nsseparator+a}f=E(o,e);if(f!=h.pluralNotFound){return z(f,{count:b.count,interpolationPrefix:b.interpolationPrefix,interpolationSuffix:b.interpolationSuffix})}}var r;var s=a.split(h.keyseparator);for(var t=0,u=j.length;t<u;t++){if(r!==undefined)break;var v=j[t];var w=0;var x=d[v]&&d[v][l];while(s[w]){x=x&&x[s[w]];w++}if(x!==undefined){if(typeof x==="string"){x=z(x,b);x=A(x,b)}else if(Object.prototype.toString.apply(x)==="[object Array]"&&!h.returnObjectTrees&&!b.returnObjectTrees){x=x.join("\n");x=z(x,b);x=A(x,b)}else if(x===null&&h.fallbackOnNull===true){x=undefined}else if(x!==null){if(!h.returnObjectTrees&&!b.returnObjectTrees){x="key '"+l+":"+a+" ("+v+")' "+"returned a object instead of string.";p.log(x)}else{var y={};for(var D in x){y[D]=G(l+h.nsseparator+a+h.keyseparator+D,b)}x=y}}r=x}}if(r===undefined&&!b.isFallbackLookup&&(h.fallbackToDefaultNS===true||h.fallbackNS&&h.fallbackNS.length>0)){b.isFallbackLookup=true;if(h.fallbackNS.length){for(var F=0,I=h.fallbackNS.length;F<I;F++){r=H(h.fallbackNS[F]+h.nsseparator+a,b);if(r){var J=r.indexOf(h.nsseparator)>-1?r.split(h.nsseparator)[1]:r,L=i.indexOf(h.nsseparator)>-1?i.split(h.nsseparator)[1]:i;if(J!==L)break}}}else{r=H(a,b)}}return r}function I(){var a;var b=[];if(typeof window!=="undefined"){!function(){var a=window.location.search.substring(1);var c=a.split("&");for(var d=0;d<c.length;d++){var e=c[d].indexOf("=");if(e>0){var f=c[d].substring(0,e);var g=c[d].substring(e+1);b[f]=g}}}();if(b[h.detectLngQS]){a=b[h.detectLngQS]}}if(!a&&typeof document!=="undefined"&&h.useCookie){var c=p.cookie.read(h.cookieName);if(c)a=c}if(!a&&typeof navigator!=="undefined"){a=navigator.language?navigator.language:navigator.userLanguage}return a}var J={load:function(a,b,c){if(b.useLocalStorage){J._loadLocal(a,b,function(d,e){var f=[];for(var g=0,h=a.length;g<h;g++){if(!e[a[g]])f.push(a[g])}if(f.length>0){J._fetch(f,b,function(a,b){p.extend(e,b);J._storeLocal(b);c(null,e)})}else{c(null,e)}})}else{J._fetch(a,b,function(a,b){c(null,b)})}},_loadLocal:function(a,b,c){var d={},e=(new Date).getTime();if(window.localStorage){var f=a.length;p.each(a,function(a,g){var h=window.localStorage.getItem("res_"+g);if(h){h=JSON.parse(h);if(h.i18nStamp&&h.i18nStamp+b.localStorageExpirationTime>e){d[g]=h}}f--;if(f===0)c(null,d)})}},_storeLocal:function(a){if(window.localStorage){for(var b in a){a[b].i18nStamp=(new Date).getTime();window.localStorage.setItem("res_"+b,JSON.stringify(a[b]))}}return},_fetch:function(a,b,c){var d=b.ns,e={};if(!b.dynamicLoad){var f=d.namespaces.length*a.length,g;p.each(d.namespaces,function(d,h){p.each(a,function(a,d){var i=function(a,b){if(a){g=g||[];g.push(a)}e[d]=e[d]||{};e[d][h]=b;f--;if(f===0)c(g,e)};if(typeof b.customLoad=="function"){b.customLoad(d,h,b,i)}else{J._fetchOne(d,h,b,i)}})})}else{var h=function(a,b){c(null,b)};if(typeof b.customLoad=="function"){b.customLoad(a,d.namespaces,b,h)}else{var i=z(b.resGetPath,{lng:a.join("+"),ns:d.namespaces.join("+")});p.ajax({url:i,success:function(a,b,c){p.log("loaded: "+i);h(null,a)},error:function(a,b,c){p.log("failed loading: "+i);h("failed loading resource.json error: "+c)},dataType:"json",async:b.getAsync})}}},_fetchOne:function(a,b,c,d){var e=z(c.resGetPath,{lng:a,ns:b});p.ajax({url:e,success:function(a,b,c){p.log("loaded: "+e);d(null,a)},error:function(a,b,c){p.log("failed loading: "+e);d(c,{})},dataType:"json",async:c.getAsync})},postMissing:function(a,b,c,e,f){var g={};g[c]=e;var i=[];if(h.sendMissingTo==="fallback"&&h.fallbackLng!==false){i.push({lng:h.fallbackLng,url:z(h.resPostPath,{lng:h.fallbackLng,ns:b})})}else if(h.sendMissingTo==="current"||h.sendMissingTo==="fallback"&&h.fallbackLng===false){i.push({lng:a,url:z(h.resPostPath,{lng:a,ns:b})})}else if(h.sendMissingTo==="all"){for(var j=0,k=f.length;j<k;j++){i.push({lng:f[j],url:z(h.resPostPath,{lng:f[j],ns:b})})}}for(var l=0,m=i.length;l<m;l++){var n=i[l];p.ajax({url:n.url,type:h.sendType,data:g,success:function(a,f,g){p.log("posted missing key '"+c+"' to: "+n.url);var h=c.split(".");var i=0;var j=d[n.lng][b];while(h[i]){if(i===h.length-1){j=j[h[i]]=e}else{j=j[h[i]]=j[h[i]]||{}}i++}},error:function(a,b,d){p.log("failed posting missing key '"+c+"' to: "+n.url)},dataType:"json",async:h.postAsync})}}};var K={rules:{ach:{name:"Acholi",numbers:[1,2],plurals:function(a){return Number(a>1)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(a){return Number(a!=1)}},ak:{name:"Akan",numbers:[1,2],plurals:function(a){return Number(a>1)}},am:{name:"Amharic",numbers:[1,2],plurals:function(a){return Number(a>1)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(a){return Number(a!=1)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(a){return Number(a===0?0:a==1?1:a==2?2:a%100>=3&&a%100<=10?3:a%100>=11?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(a){return Number(a>1)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(a){return Number(a!=1)}},ay:{name:"Aymará",numbers:[1],plurals:function(a){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(a){return Number(a!=1)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(a){return Number(a!=1)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(a){return Number(a!=1)}},bo:{name:"Tibetan",numbers:[1],plurals:function(a){return 0}},br:{name:"Breton",numbers:[1,2],plurals:function(a){return Number(a>1)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(a){return Number(a!=1)}},cgg:{name:"Chiga",numbers:[1],plurals:function(a){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(a){return Number(a==1?0:a>=2&&a<=4?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(a){return Number(a==1?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(a){return Number(a==1?0:a==2?1:a!=8&&a!=11?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(a){return Number(a!=1)}},de:{name:"German",numbers:[1,2],plurals:function(a){return Number(a!=1)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(a){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(a){return Number(a!=1)}},en:{name:"English",numbers:[1,2],plurals:function(a){return Number(a!=1)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(a){return Number(a!=1)}},es:{name:"Spanish",numbers:[1,2],plurals:function(a){return Number(a!=1)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(a){return Number(a!=1)}},et:{name:"Estonian",numbers:[1,2],plurals:function(a){return Number(a!=1)}},eu:{name:"Basque",numbers:[1,2],plurals:function(a){return Number(a!=1)}},fa:{name:"Persian",numbers:[1],plurals:function(a){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(a){return Number(a!=1)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(a){return Number(a>1)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(a){return Number(a!=1)}},fr:{name:"French",numbers:[1,2],plurals:function(a){return Number(a>1)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(a){return Number(a!=1)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(a){return Number(a!=1)}},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:function(a){return Number(a==1?0:a==2?1:a<7?2:a<11?3:4)}},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:function(a){return Number(a==1||a==11?0:a==2||a==12?1:a>2&&a<20?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(a){return Number(a!=1)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(a){return Number(a!=1)}},gun:{name:"Gun",numbers:[1,2],plurals:function(a){return Number(a>1)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(a){return Number(a!=1)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(a){return Number(a!=1)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(a){return Number(a!=1)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(a){return Number(a!=1)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(a){return Number(a!=1)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(a){return Number(a!=1)}},id:{name:"Indonesian",numbers:[1],plurals:function(a){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(a){return Number(a%10!=1||a%100==11)}},it:{name:"Italian",numbers:[1,2],plurals:function(a){return Number(a!=1)}},ja:{name:"Japanese",numbers:[1],plurals:function(a){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(a){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(a){return Number(a!==0)}},ka:{name:"Georgian",numbers:[1],plurals:function(a){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(a){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(a){return 0}},kn:{name:"Kannada",numbers:[1,2],plurals:function(a){return Number(a!=1)}},ko:{name:"Korean",numbers:[1],plurals:function(a){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(a){return Number(a!=1)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(a){return Number(a==1?0:a==2?1:a==3?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(a){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(a){return Number(a!=1)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(a){return Number(a>1)}},lo:{name:"Lao",numbers:[1],plurals:function(a){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&(a%100<10||a%100>=20)?1:2)}},lv:{name:"Latvian",numbers:[0,1,2],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a!==0?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(a){return Number(a!=1)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(a){return Number(a>1)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(a){return Number(a>1)}},mi:{name:"Maori",numbers:[1,2],plurals:function(a){return Number(a>1)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(a){return Number(a==1||a%10==1?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(a){return Number(a!=1)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(a){return Number(a!=1)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(a){return Number(0?0:a==1?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(a){return Number(a!=1)}},ms:{name:"Malay",numbers:[1],plurals:function(a){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(a){return Number(a==1?0:a===0||a%100>1&&a%100<11?1:a%100>10&&a%100<20?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(a){return Number(a!=1)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(a){return Number(a!=1)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(a){return Number(a!=1)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(a){return Number(a!=1)}},nl:{name:"Dutch",numbers:[1,2],plurals:function(a){return Number(a!=1)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(a){return Number(a!=1)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(a){return Number(a!=1)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(a){return Number(a!=1)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(a){return Number(a>1)}},or:{name:"Oriya",numbers:[2,1],plurals:function(a){return Number(a!=1)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(a){return Number(a!=1)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(a){return Number(a!=1)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(a){return Number(a==1?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(a){return Number(a!=1)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(a){return Number(a!=1)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(a){return Number(a!=1)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(a){return Number(a!=1)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(a){return Number(a!=1)}},ro:{name:"Romanian",numbers:[1,2,20],plurals:function(a){return Number(a==1?0:a===0||a%100>0&&a%100<20?1:2)}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},sah:{name:"Yakut",numbers:[1],plurals:function(a){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(a){return Number(a!=1)}},se:{name:"Northern Sami",numbers:[1,2],plurals:function(a){return Number(a!=1)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(a){return Number(a!=1)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(a){return Number(a==1?0:a>=2&&a<=4?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(a){return Number(a%100==1?1:a%100==2?2:a%100==3||a%100==4?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(a){return Number(a!=1)}},son:{name:"Songhay",numbers:[1,2],plurals:function(a){return Number(a!=1)}},sq:{name:"Albanian",numbers:[1,2],plurals:function(a){return Number(a!=1)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(a){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(a){return Number(a!=1)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(a){return Number(a!=1)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(a){return Number(a!=1)}},te:{name:"Telugu",numbers:[1,2],plurals:function(a){return Number(a!=1)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(a){return Number(a>1)}},th:{name:"Thai",numbers:[1],plurals:function(a){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(a){return Number(a>1)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(a){return Number(a!=1)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(a){return Number(a>1)}},tt:{name:"Tatar",numbers:[1],plurals:function(a){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(a){return 0}},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(a){return Number(a!=1)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(a){return Number(a>1)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(a){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(a){return Number(a>1)}},wo:{name:"Wolof",numbers:[1],plurals:function(a){return 0}},yo:{name:"Yoruba",numbers:[1,2],plurals:function(a){return Number(a!=1)}},zh:{name:"Chinese",numbers:[1],plurals:function(a){return 0}}},addRule:function(a,b){K.rules[a]=b},setCurrentLng:function(a){if(!K.currentRule||K.currentRule.lng!==a){var b=a.split("-");K.currentRule={lng:a,rule:K.rules[b[0]]}}},get:function(a,b){var c=a.split("-");function d(b,c){var d;if(K.currentRule&&K.currentRule.lng===a){d=K.currentRule.rule}else{d=K.rules[b]}if(d){var e=d.plurals(c);var f=d.numbers[e];if(d.numbers.length===2&&d.numbers[0]===1){if(f===2){f=-1}else if(f===1){f=1}}return f}else{return c===1?"1":"-1"}}return d(c[0],b)}};var L={};var M=function(a,b){L[a]=b};var N=function(){function a(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}function b(a,b){for(var c=[];b>0;c[--b]=a){}return c.join("")}var c=function(){if(!c.cache.hasOwnProperty(arguments[0])){c.cache[arguments[0]]=c.parse(arguments[0])}return c.format.call(null,c.cache[arguments[0]],arguments)};c.format=function(c,d){var e=1,f=c.length,g="",h,i=[],j,k,l,m,n,o;for(j=0;j<f;j++){g=a(c[j]);if(g==="string"){i.push(c[j])}else if(g==="array"){l=c[j];if(l[2]){h=d[e];for(k=0;k<l[2].length;k++){if(!h.hasOwnProperty(l[2][k])){throw N('[sprintf] property "%s" does not exist',l[2][k])}h=h[l[2][k]]}}else if(l[1]){h=d[l[1]]}else{h=d[e++]}if(/[^s]/.test(l[8])&&a(h)!="number"){throw N("[sprintf] expecting number but found %s",a(h))}switch(l[8]){case"b":h=h.toString(2);break;case"c":h=String.fromCharCode(h);break;case"d":h=parseInt(h,10);break;case"e":h=l[7]?h.toExponential(l[7]):h.toExponential();break;case"f":h=l[7]?parseFloat(h).toFixed(l[7]):parseFloat(h);break;case"o":h=h.toString(8);break;case"s":h=(h=String(h))&&l[7]?h.substring(0,l[7]):h;break;case"u":h=Math.abs(h);break;case"x":h=h.toString(16);break;case"X":h=h.toString(16).toUpperCase();break}h=/[def]/.test(l[8])&&l[3]&&h>=0?"+"+h:h;n=l[4]?l[4]=="0"?"0":l[4].charAt(1):" ";o=l[6]-String(h).length;m=l[6]?b(n,o):"";i.push(l[5]?h+m:m+h)}}return i.join("")};c.cache={};c.parse=function(a){var b=a,c=[],d=[],e=0;while(b){if((c=/^[^\x25]+/.exec(b))!==null){d.push(c[0])}else if((c=/^\x25{2}/.exec(b))!==null){d.push("%")}else if((c=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(b))!==null){if(c[2]){e|=1;var f=[],g=c[2],h=[];if((h=/^([a-z_][a-z_\d]*)/i.exec(g))!==null){f.push(h[1]);while((g=g.substring(h[0].length))!==""){if((h=/^\.([a-z_][a-z_\d]*)/i.exec(g))!==null){f.push(h[1])}else if((h=/^\[(\d+)\]/.exec(g))!==null){f.push(h[1])}else{throw"[sprintf] huh?"}}}else{throw"[sprintf] huh?"}c[2]=f}else{e|=2}if(e===3){throw"[sprintf] mixing positional and named placeholders is not (yet) supported"}d.push(c)}else{throw"[sprintf] huh?"}b=b.substring(c[0].length)}return d};return c}();var O=function(a,b){b.unshift(a);return N.apply(null,b)};M("sprintf",function(a,b,c){if(!c.sprintf)return a;if(Object.prototype.toString.apply(c.sprintf)==="[object Array]"){return O(a,c.sprintf)}else if(typeof c.sprintf==="object"){return N(a,c.sprintf)}return a});c.init=q;c.setLng=w;c.preload=r;c.addResourceBundle=s;c.loadNamespace=u;c.loadNamespaces=v;c.setDefaultNamespace=t;c.t=E;c.translate=E;c.exists=D;c.detectLanguage=p.detectLanguage;c.pluralExtensions=K;c.sync=J;c.functions=p;c.lng=x;c.addPostProcessor=M;c.options=h}();var Handlebars={};!function(a,b){a.VERSION="1.0.0";a.COMPILER_REVISION=4;a.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};a.helpers={};a.partials={};var c=Object.prototype.toString,d="[object Function]",e="[object Object]";a.registerHelper=function(b,d,f){if(c.call(b)===e){if(f||d){throw new a.Exception("Arg not supported with multiple helpers")}a.Utils.extend(this.helpers,b)}else{if(f){d.not=f}this.helpers[b]=d}};a.registerPartial=function(b,d){if(c.call(b)===e){a.Utils.extend(this.partials,b)}else{this.partials[b]=d}};a.registerHelper("helperMissing",function(a){if(arguments.length===2){return b}else{throw new Error("Missing helper: '"+a+"'")}});a.registerHelper("blockHelperMissing",function(b,e){var f=e.inverse||function(){},g=e.fn;var h=c.call(b);if(h===d){b=b.call(this)}if(b===true){return g(this)}else if(b===false||b==null){return f(this)}else if(h==="[object Array]"){if(b.length>0){return a.helpers.each(b,e)}else{return f(this)}}else{return g(b)}});a.K=function(){};a.createFrame=Object.create||function(b){a.K.prototype=b;var c=new a.K;a.K.prototype=null;return c};a.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(b,c){if(a.logger.level<=b){var d=a.logger.methodMap[b];if(typeof console!=="undefined"&&console[d]){console[d].call(console,c)}}}};a.log=function(b,c){a.logger.log(b,c)};a.registerHelper("each",function(b,e){var f=e.fn,g=e.inverse;var h=0,i="",j;var k=c.call(b);if(k===d){b=b.call(this)}if(e.data){j=a.createFrame(e.data)}if(b&&typeof b==="object"){if(b instanceof Array){for(var l=b.length;h<l;h++){if(j){j.index=h}i=i+f(b[h],{data:j})}}else{for(var m in b){if(b.hasOwnProperty(m)){if(j){j.key=m}i=i+f(b[m],{data:j});h++}}}}if(h===0){i=g(this)}return i});a.registerHelper("if",function(b,e){var f=c.call(b);if(f===d){b=b.call(this)}if(!b||a.Utils.isEmpty(b)){return e.inverse(this)}else{return e.fn(this)}});a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn})});a.registerHelper("with",function(b,e){var f=c.call(b);if(f===d){b=b.call(this)}if(!a.Utils.isEmpty(b))return e.fn(b)});a.registerHelper("log",function(b,c){var d=c.data&&c.data.level!=null?parseInt(c.data.level,10):1;a.log(d,b)});var f=["description","fileName","lineNumber","message","name","number","stack"];a.Exception=function(a){var b=Error.prototype.constructor.apply(this,arguments);for(var c=0;c<f.length;c++){this[f[c]]=b[f[c]]}};a.Exception.prototype=new Error;a.SafeString=function(a){this.string=a};a.SafeString.prototype.toString=function(){return this.string.toString()};var g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var h=/[&<>"'`]/g;var i=/[&<>"'`]/;var j=function(a){return g[a]||"&amp;"};a.Utils={extend:function(a,b){for(var c in b){if(b.hasOwnProperty(c)){a[c]=b[c]}}},escapeExpression:function(b){if(b instanceof a.SafeString){return b.toString()}else if(b==null||b===false){return""}b=b.toString();if(!i.test(b)){return b}return b.replace(h,j)},isEmpty:function(a){if(!a&&a!==0){return true}else if(c.call(a)==="[object Array]"&&a.length===0){return true}else{return false}}};a.VM={template:function(b){var c={escapeExpression:a.Utils.escapeExpression,invokePartial:a.VM.invokePartial,programs:[],program:function(b,c,d){var e=this.programs[b];if(d){e=a.VM.program(b,c,d)}else if(!e){e=this.programs[b]=a.VM.program(b,c)}return e},merge:function(b,c){var d=b||c;if(b&&c){d={};a.Utils.extend(d,c);a.Utils.extend(d,b)}return d},programWithDepth:a.VM.programWithDepth,noop:a.VM.noop,compilerInfo:null};return function(d,e){e=e||{};var f=b.call(c,a,d,e.helpers,e.partials,e.data);var g=c.compilerInfo||[],h=g[0]||1,i=a.COMPILER_REVISION;if(h!==i){if(h<i){var j=a.REVISION_CHANGES[i],k=a.REVISION_CHANGES[h];throw"Template was precompiled with an older version of Handlebars than the current runtime. "+"Please update your precompiler to a newer version ("+j+") or downgrade your runtime to an older version ("+k+")."}else{throw"Template was precompiled with a newer version of Handlebars than the current runtime. "+"Please update your runtime to a newer version ("+g[1]+")."}}return f}},programWithDepth:function(a,b,c){var d=Array.prototype.slice.call(arguments,3);var e=function(a,e){e=e||{};return b.apply(this,[a,e.data||c].concat(d))};e.program=a;e.depth=d.length;return e},program:function(a,b,c){var d=function(a,d){d=d||{};return b(a,d.data||c)};d.program=a;d.depth=0;return d},noop:function(){return""},invokePartial:function(c,d,e,f,g,h){var i={helpers:f,partials:g,data:h};if(c===b){throw new a.Exception("The partial "+d+" could not be found")}else if(c instanceof Function){return c(e,i)}else if(!a.compile){throw new a.Exception("The partial "+d+" could not be compiled when running in runtime-only mode")}else{g[d]=a.compile(c,{data:h!==b});return g[d](e,i)}}};a.template=a.VM.template}(Handlebars);!function(a){"use strict";var b=a.GreenSockGlobals||a,c=function(a){var c=a.split("."),d=b,e;for(e=0;e<c.length;e++){d[c[e]]=d=d[c[e]]||{}}return d},d=c("com.greensock"),e=[].slice,f=function(){},g,h,i,j,k,l={},m=function(d,e,f,g){this.sc=l[d]?l[d].sc:[];l[d]=this;this.gsClass=null;this.func=f;var h=[];this.check=function(i){var j=e.length,k=j,n,o,p,q;while(--j>-1){if((n=l[e[j]]||new m(e[j],[])).gsClass){h[j]=n.gsClass;k--}else if(i){n.sc.push(this)}}if(k===0&&f){o=("com.greensock."+d).split(".");p=o.pop();q=c(o.join("."))[p]=this.gsClass=f.apply(f,h);if(g){b[p]=q;if(typeof define==="function"&&define.amd){define((a.GreenSockAMDPath?a.GreenSockAMDPath+"/":"")+d.split(".").join("/"),[],function(){return q})}else if(typeof module!=="undefined"&&module.exports){module.exports=q}}for(j=0;j<this.sc.length;j++){this.sc[j].check()}}};this.check(true)},n=a._gsDefine=function(a,b,c,d){return new m(a,b,c,d)},o=d._class=function(a,b,c){b=b||function(){};n(a,[],function(){return b},c);return b};n.globals=b;var p=[0,0,1,1],q=[],r=o("easing.Ease",function(a,b,c,d){this._func=a;this._type=c||0;this._power=d||0;this._params=b?p.concat(b):p},true),s=r.map={},t=r.register=function(a,b,c,e){var f=b.split(","),g=f.length,h=(c||"easeIn,easeOut,easeInOut").split(","),i,j,k,l;while(--g>-1){j=f[g];i=e?o("easing."+j,null,true):d.easing[j]||{};k=h.length;while(--k>-1){l=h[k];s[j+"."+l]=s[l+j]=i[l]=a.getRatio?a:a[l]||new a}}};i=r.prototype;i._calcEnd=false;i.getRatio=function(a){if(this._func){this._params[0]=a;return this._func.apply(null,this._params)}var b=this._type,c=this._power,d=b===1?1-a:b===2?a:a<.5?a*2:(1-a)*2;if(c===1){d*=d}else if(c===2){d*=d*d}else if(c===3){d*=d*d*d}else if(c===4){d*=d*d*d*d}return b===1?1-d:b===2?d:a<.5?d/2:1-d/2};g=["Linear","Quad","Cubic","Quart","Quint,Strong"];h=g.length;while(--h>-1){i=g[h]+",Power"+h;t(new r(null,null,1,h),i,"easeOut",true);t(new r(null,null,2,h),i,"easeIn"+(h===0?",easeNone":""));t(new r(null,null,3,h),i,"easeInOut")}s.linear=d.easing.Linear.easeIn;s.swing=d.easing.Quad.easeInOut;var u=o("events.EventDispatcher",function(a){this._listeners={};this._eventTarget=a||this});i=u.prototype;i.addEventListener=function(a,b,c,d,e){e=e||0;var f=this._listeners[a],g=0,h,i;if(f==null){this._listeners[a]=f=[]
}i=f.length;while(--i>-1){h=f[i];if(h.c===b&&h.s===c){f.splice(i,1)}else if(g===0&&h.pr<e){g=i+1}}f.splice(g,0,{c:b,s:c,up:d,pr:e});if(this===j&&!k){j.wake()}};i.removeEventListener=function(a,b){var c=this._listeners[a],d;if(c){d=c.length;while(--d>-1){if(c[d].c===b){c.splice(d,1);return}}}};i.dispatchEvent=function(a){var b=this._listeners[a],c,d,e;if(b){c=b.length;d=this._eventTarget;while(--c>-1){e=b[c];if(e.up){e.c.call(e.s||d,{type:a,target:d})}else{e.c.call(e.s||d)}}}};var v=a.requestAnimationFrame,w=a.cancelAnimationFrame,x=Date.now||function(){return(new Date).getTime()};g=["ms","moz","webkit","o"];h=g.length;while(--h>-1&&!v){v=a[g[h]+"RequestAnimationFrame"];w=a[g[h]+"CancelAnimationFrame"]||a[g[h]+"CancelRequestAnimationFrame"]}o("Ticker",function(a,b){var c=this,d=x(),e=b!==false&&v,g,h,i,l,m,n=function(a){c.time=(x()-d)/1e3;var b=i,e=c.time-m;if(!g||e>0||a===true){c.frame++;m+=e+(e>=l?.004:l-e);c.dispatchEvent("tick")}if(a!==true&&b===i){i=h(n)}};u.call(c);this.time=this.frame=0;this.tick=function(){n(true)};this.sleep=function(){if(i==null){return}if(!e||!w){clearTimeout(i)}else{w(i)}h=f;i=null;if(c===j){k=false}};this.wake=function(){if(i!==null){c.sleep()}h=g===0?f:!e||!v?function(a){return setTimeout(a,(m-c.time)*1e3+1|0)}:v;if(c===j){k=true}n(2)};this.fps=function(a){if(!arguments.length){return g}g=a;l=1/(g||60);m=this.time+l;c.wake()};this.useRAF=function(a){if(!arguments.length){return e}c.sleep();e=a;c.fps(g)};c.fps(a);setTimeout(function(){if(e&&(!i||c.frame<5)){c.useRAF(false)}},1500)});i=d.Ticker.prototype=new d.events.EventDispatcher;i.constructor=d.Ticker;var y=o("core.Animation",function(a,b){this.vars=b||{};this._duration=this._totalDuration=a||0;this._delay=Number(this.vars.delay)||0;this._timeScale=1;this._active=this.vars.immediateRender===true;this.data=this.vars.data;this._reversed=this.vars.reversed===true;if(!K){return}if(!k){j.wake()}var c=this.vars.useFrames?J:K;c.add(this,c._time);if(this.vars.paused){this.paused(true)}});j=y.ticker=new d.Ticker;i=y.prototype;i._dirty=i._gc=i._initted=i._paused=false;i._totalTime=i._time=0;i._rawPrevTime=-1;i._next=i._last=i._onUpdate=i._timeline=i.timeline=null;i._paused=false;i.play=function(a,b){if(arguments.length){this.seek(a,b)}return this.reversed(false).paused(false)};i.pause=function(a,b){if(arguments.length){this.seek(a,b)}return this.paused(true)};i.resume=function(a,b){if(arguments.length){this.seek(a,b)}return this.paused(false)};i.seek=function(a,b){return this.totalTime(Number(a),b!==false)};i.restart=function(a,b){return this.reversed(false).paused(false).totalTime(a?-this._delay:0,b!==false,true)};i.reverse=function(a,b){if(arguments.length){this.seek(a||this.totalDuration(),b)}return this.reversed(true).paused(false)};i.render=function(){};i.invalidate=function(){return this};i._enabled=function(a,b){if(!k){j.wake()}this._gc=!a;this._active=a&&!this._paused&&this._totalTime>0&&this._totalTime<this._totalDuration;if(b!==true){if(a&&!this.timeline){this._timeline.add(this,this._startTime-this._delay)}else if(!a&&this.timeline){this._timeline._remove(this,true)}}return false};i._kill=function(a,b){return this._enabled(false,false)};i.kill=function(a,b){this._kill(a,b);return this};i._uncache=function(a){var b=a?this:this.timeline;while(b){b._dirty=true;b=b.timeline}return this};i.eventCallback=function(a,b,c,d){if(a==null){return null}else if(a.substr(0,2)==="on"){var e=this.vars,f;if(arguments.length===1){return e[a]}if(b==null){delete e[a]}else{e[a]=b;e[a+"Params"]=c;e[a+"Scope"]=d;if(c){f=c.length;while(--f>-1){if(c[f]==="{self}"){c=e[a+"Params"]=c.concat();c[f]=this}}}}if(a==="onUpdate"){this._onUpdate=b}}return this};i.delay=function(a){if(!arguments.length){return this._delay}if(this._timeline.smoothChildTiming){this.startTime(this._startTime+a-this._delay)}this._delay=a;return this};i.duration=function(a){if(!arguments.length){this._dirty=false;return this._duration}this._duration=this._totalDuration=a;this._uncache(true);if(this._timeline.smoothChildTiming)if(this._time>0)if(this._time<this._duration)if(a!==0){this.totalTime(this._totalTime*(a/this._duration),true)}return this};i.totalDuration=function(a){this._dirty=false;return!arguments.length?this._totalDuration:this.duration(a)};i.time=function(a,b){if(!arguments.length){return this._time}if(this._dirty){this.totalDuration()}return this.totalTime(a>this._duration?this._duration:a,b)};i.totalTime=function(a,b,c){if(!k){j.wake()}if(!arguments.length){return this._totalTime}if(this._timeline){if(a<0&&!c){a+=this.totalDuration()}if(this._timeline.smoothChildTiming){if(this._dirty){this.totalDuration()}var d=this._totalDuration,e=this._timeline;if(a>d&&!c){a=d}this._startTime=(this._paused?this._pauseTime:e._time)-(!this._reversed?a:d-a)/this._timeScale;if(!e._dirty){this._uncache(false)}if(!e._active){while(e._timeline){e.totalTime(e._totalTime,true);e=e._timeline}}}if(this._gc){this._enabled(true,false)}if(this._totalTime!==a){this.render(a,b,false)}}return this};i.startTime=function(a){if(!arguments.length){return this._startTime}if(a!==this._startTime){this._startTime=a;if(this.timeline)if(this.timeline._sortChildren){this.timeline.add(this,a-this._delay)}}return this};i.timeScale=function(a){if(!arguments.length){return this._timeScale}a=a||1e-6;if(this._timeline&&this._timeline.smoothChildTiming){var b=this._pauseTime,c=b||b===0?b:this._timeline.totalTime();this._startTime=c-(c-this._startTime)*this._timeScale/a}this._timeScale=a;return this._uncache(false)};i.reversed=function(a){if(!arguments.length){return this._reversed}if(a!=this._reversed){this._reversed=a;this.totalTime(this._totalTime,true)}return this};i.paused=function(a){if(!arguments.length){return this._paused}if(a!=this._paused)if(this._timeline){if(!k&&!a){j.wake()}var b=this._timeline.rawTime(),c=b-this._pauseTime;if(!a&&this._timeline.smoothChildTiming){this._startTime+=c;this._uncache(false)}this._pauseTime=a?b:null;this._paused=a;this._active=!a&&this._totalTime>0&&this._totalTime<this._totalDuration;if(!a&&c!==0&&this._duration!==0){this.render(this._totalTime,true,true)}}if(this._gc&&!a){this._enabled(true,false)}return this};var z=o("core.SimpleTimeline",function(a){y.call(this,0,a);this.autoRemoveChildren=this.smoothChildTiming=true});i=z.prototype=new y;i.constructor=z;i.kill()._gc=false;i._first=i._last=null;i._sortChildren=false;i.add=i.insert=function(a,b,c,d){var e,f;a._startTime=Number(b||0)+a._delay;if(a._paused)if(this!==a._timeline){a._pauseTime=a._startTime+(this.rawTime()-a._startTime)/a._timeScale}if(a.timeline){a.timeline._remove(a,true)}a.timeline=a._timeline=this;if(a._gc){a._enabled(true,true)}e=this._last;if(this._sortChildren){f=a._startTime;while(e&&e._startTime>f){e=e._prev}}if(e){a._next=e._next;e._next=a}else{a._next=this._first;this._first=a}if(a._next){a._next._prev=a}else{this._last=a}a._prev=e;if(this._timeline){this._uncache(true)}return this};i._remove=function(a,b){if(a.timeline===this){if(!b){a._enabled(false,true)}a.timeline=null;if(a._prev){a._prev._next=a._next}else if(this._first===a){this._first=a._next}if(a._next){a._next._prev=a._prev}else if(this._last===a){this._last=a._prev}if(this._timeline){this._uncache(true)}}return this};i.render=function(a,b,c){var d=this._first,e;this._totalTime=this._time=this._rawPrevTime=a;while(d){e=d._next;if(d._active||a>=d._startTime&&!d._paused){if(!d._reversed){d.render((a-d._startTime)*d._timeScale,b,c)}else{d.render((!d._dirty?d._totalDuration:d.totalDuration())-(a-d._startTime)*d._timeScale,b,c)}}d=e}};i.rawTime=function(){if(!k){j.wake()}return this._totalTime};var A=o("TweenLite",function(a,b,c){y.call(this,b,c);if(a==null){throw"Cannot tween a null target."}this.target=a=typeof a!=="string"?a:A.selector(a)||a;var d=a.jquery||a.length&&a[0]&&a[0].nodeType&&a[0].style,f=this.vars.overwrite,g,h,i;this._overwrite=f=f==null?I[A.defaultOverwrite]:typeof f==="number"?f>>0:I[f];if((d||a instanceof Array)&&typeof a[0]!=="number"){this._targets=i=e.call(a,0);this._propLookup=[];this._siblings=[];for(g=0;g<i.length;g++){h=i[g];if(!h){i.splice(g--,1);continue}else if(typeof h==="string"){h=i[g--]=A.selector(h);if(typeof h==="string"){i.splice(g+1,1)}continue}else if(h.length&&h[0]&&h[0].nodeType&&h[0].style){i.splice(g--,1);this._targets=i=i.concat(e.call(h,0));continue}this._siblings[g]=L(h,this,false);if(f===1)if(this._siblings[g].length>1){M(h,this,null,1,this._siblings[g])}}}else{this._propLookup={};this._siblings=L(a,this,false);if(f===1)if(this._siblings.length>1){M(a,this,null,1,this._siblings)}}if(this.vars.immediateRender||b===0&&this._delay===0&&this.vars.immediateRender!==false){this.render(-this._delay,false,true)}},true),B=function(a){return a.length&&a[0]&&a[0].nodeType&&a[0].style},C=function(a,b){var c={},d;for(d in a){if(!H[d]&&(!(d in b)||d==="x"||d==="y"||d==="width"||d==="height"||d==="className")&&(!E[d]||E[d]&&E[d]._autoCSS)){c[d]=a[d];delete a[d]}}a.css=c};i=A.prototype=new y;i.constructor=A;i.kill()._gc=false;i.ratio=0;i._firstPT=i._targets=i._overwrittenProps=i._startAt=null;i._notifyPluginsOfEnabled=false;A.version="1.9.7";A.defaultEase=i._ease=new r(null,null,1,1);A.defaultOverwrite="auto";A.ticker=j;A.autoSleep=true;A.selector=a.$||a.jQuery||function(b){if(a.$){A.selector=a.$;return a.$(b)}return a.document?a.document.getElementById(b.charAt(0)==="#"?b.substr(1):b):b};var D=A._internals={},E=A._plugins={},F=A._tweenLookup={},G=0,H=D.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1},I={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},J=y._rootFramesTimeline=new z,K=y._rootTimeline=new z;K._startTime=j.time;J._startTime=j.frame;K._active=J._active=true;y._updateRoot=function(){K.render((j.time-K._startTime)*K._timeScale,false,false);J.render((j.frame-J._startTime)*J._timeScale,false,false);if(!(j.frame%120)){var a,b,c;for(c in F){b=F[c].tweens;a=b.length;while(--a>-1){if(b[a]._gc){b.splice(a,1)}}if(b.length===0){delete F[c]}}c=K._first;if(!c||c._paused)if(A.autoSleep&&!J._first&&j._listeners.tick.length===1){while(c&&c._paused){c=c._next}if(!c){j.sleep()}}}};j.addEventListener("tick",y._updateRoot);var L=function(a,b,c){var d=a._gsTweenID,e,f;if(!F[d||(a._gsTweenID=d="t"+G++)]){F[d]={target:a,tweens:[]}}if(b){e=F[d].tweens;e[f=e.length]=b;if(c){while(--f>-1){if(e[f]===b){e.splice(f,1)}}}}return F[d].tweens},M=function(a,b,c,d,e){var f,g,h,i;if(d===1||d>=4){i=e.length;for(f=0;f<i;f++){if((h=e[f])!==b){if(!h._gc)if(h._enabled(false,false)){g=true}}else if(d===5){break}}return g}var j=b._startTime+1e-10,k=[],l=0,m=b._duration===0,n;f=e.length;while(--f>-1){if((h=e[f])===b||h._gc||h._paused){}else if(h._timeline!==b._timeline){n=n||N(b,0,m);if(N(h,n,m)===0){k[l++]=h}}else if(h._startTime<=j)if(h._startTime+h.totalDuration()/h._timeScale+1e-10>j)if(!((m||!h._initted)&&j-h._startTime<=2e-10)){k[l++]=h}}f=l;while(--f>-1){h=k[f];if(d===2)if(h._kill(c,a)){g=true}if(d!==2||!h._firstPT&&h._initted){if(h._enabled(false,false)){g=true}}}return g},N=function(a,b,c){var d=a._timeline,e=d._timeScale,f=a._startTime,g=1e-10;while(d._timeline){f+=d._startTime;e*=d._timeScale;if(d._paused){return-100}d=d._timeline}f/=e;return f>b?f-b:c&&f===b||!a._initted&&f-b<2*g?g:(f+=a.totalDuration()/a._timeScale/e)>b+g?0:f-b-g};i._init=function(){var a=this.vars,b=this._overwrittenProps,c=this._duration,d=a.ease,e,f,g,h;if(a.startAt){a.startAt.overwrite=0;a.startAt.immediateRender=true;this._startAt=A.to(this.target,0,a.startAt);if(a.immediateRender){this._startAt=null;if(this._time===0&&c!==0){return}}}else if(a.runBackwards&&a.immediateRender&&c!==0){if(this._startAt){this._startAt.render(-1,true);this._startAt=null}else if(this._time===0){g={};for(h in a){if(!H[h]||h==="autoCSS"){g[h]=a[h]}}g.overwrite=0;this._startAt=A.to(this.target,0,g);return}}if(!d){this._ease=A.defaultEase}else if(d instanceof r){this._ease=a.easeParams instanceof Array?d.config.apply(d,a.easeParams):d}else{this._ease=typeof d==="function"?new r(d,a.easeParams):s[d]||A.defaultEase}this._easeType=this._ease._type;this._easePower=this._ease._power;this._firstPT=null;if(this._targets){e=this._targets.length;while(--e>-1){if(this._initProps(this._targets[e],this._propLookup[e]={},this._siblings[e],b?b[e]:null)){f=true}}}else{f=this._initProps(this.target,this._propLookup,this._siblings,b)}if(f){A._onPluginEvent("_onInitAllProps",this)}if(b)if(!this._firstPT)if(typeof this.target!=="function"){this._enabled(false,false)}if(a.runBackwards){g=this._firstPT;while(g){g.s+=g.c;g.c=-g.c;g=g._next}}this._onUpdate=a.onUpdate;this._initted=true};i._initProps=function(a,b,c,d){var e,f,g,h,i,j,k;if(a==null){return false}if(!this.vars.css)if(a.style)if(a.nodeType)if(E.css)if(this.vars.autoCSS!==false){C(this.vars,a)}for(e in this.vars){if(H[e]){if(e==="onStartParams"||e==="onUpdateParams"||e==="onCompleteParams"||e==="onReverseCompleteParams"||e==="onRepeatParams")if(i=this.vars[e]){f=i.length;while(--f>-1){if(i[f]==="{self}"){i=this.vars[e]=i.concat();i[f]=this}}}}else if(E[e]&&(h=new E[e])._onInitTween(a,this.vars[e],this)){this._firstPT=j={_next:this._firstPT,t:h,p:"setRatio",s:0,c:1,f:true,n:e,pg:true,pr:h._priority};f=h._overwriteProps.length;while(--f>-1){b[h._overwriteProps[f]]=this._firstPT}if(h._priority||h._onInitAllProps){g=true}if(h._onDisable||h._onEnable){this._notifyPluginsOfEnabled=true}}else{this._firstPT=b[e]=j={_next:this._firstPT,t:a,p:e,f:typeof a[e]==="function",n:e,pg:false,pr:0};j.s=!j.f?parseFloat(a[e]):a[e.indexOf("set")||typeof a["get"+e.substr(3)]!=="function"?e:"get"+e.substr(3)]();k=this.vars[e];j.c=typeof k==="string"&&k.charAt(1)==="="?parseInt(k.charAt(0)+"1",10)*Number(k.substr(2)):Number(k)-j.s||0}if(j)if(j._next){j._next._prev=j}}if(d)if(this._kill(d,a)){return this._initProps(a,b,c,d)}if(this._overwrite>1)if(this._firstPT)if(c.length>1)if(M(a,this,b,this._overwrite,c)){this._kill(b,a);return this._initProps(a,b,c,d)}return g};i.render=function(a,b,c){var d=this._time,e,f,g;if(a>=this._duration){this._totalTime=this._time=this._duration;this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1;if(!this._reversed){e=true;f="onComplete"}if(this._duration===0){if(a===0||this._rawPrevTime<0)if(this._rawPrevTime!==a){c=true;if(this._rawPrevTime>0){f="onReverseComplete";if(b){a=-1}}}this._rawPrevTime=a}}else if(a<1e-7){this._totalTime=this._time=0;this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0;if(d!==0||this._duration===0&&this._rawPrevTime>0){f="onReverseComplete";e=this._reversed}if(a<0){this._active=false;if(this._duration===0){if(this._rawPrevTime>=0){c=true}this._rawPrevTime=a}}else if(!this._initted){c=true}}else{this._totalTime=this._time=a;if(this._easeType){var h=a/this._duration,i=this._easeType,j=this._easePower;if(i===1||i===3&&h>=.5){h=1-h}if(i===3){h*=2}if(j===1){h*=h}else if(j===2){h*=h*h}else if(j===3){h*=h*h*h}else if(j===4){h*=h*h*h*h}if(i===1){this.ratio=1-h}else if(i===2){this.ratio=h}else if(a/this._duration<.5){this.ratio=h/2}else{this.ratio=1-h/2}}else{this.ratio=this._ease.getRatio(a/this._duration)}}if(this._time===d&&!c){return}else if(!this._initted){this._init();if(!this._initted){return}if(this._time&&!e){this.ratio=this._ease.getRatio(this._time/this._duration)}else if(e&&this._ease._calcEnd){this.ratio=this._ease.getRatio(this._time===0?0:1)}}if(!this._active)if(!this._paused){this._active=true}if(d===0){if(this._startAt){if(a>=0){this._startAt.render(a,b,c)}else if(!f){f="_dummyGS"}}if(this.vars.onStart)if(this._time!==0||this._duration===0)if(!b){this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||q)}}g=this._firstPT;while(g){if(g.f){g.t[g.p](g.c*this.ratio+g.s)}else{g.t[g.p]=g.c*this.ratio+g.s}g=g._next}if(this._onUpdate){if(a<0)if(this._startAt){this._startAt.render(a,b,c)}if(!b){this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||q)}}if(f)if(!this._gc){if(a<0&&this._startAt&&!this._onUpdate){this._startAt.render(a,b,c)}if(e){if(this._timeline.autoRemoveChildren){this._enabled(false,false)}this._active=false}if(!b&&this.vars[f]){this.vars[f].apply(this.vars[f+"Scope"]||this,this.vars[f+"Params"]||q)}}};i._kill=function(a,b){if(a==="all"){a=null}if(a==null)if(b==null||b===this.target){return this._enabled(false,false)}b=typeof b!=="string"?b||this._targets||this.target:A.selector(b)||b;var c,d,e,f,g,h,i,j;if((b instanceof Array||B(b))&&typeof b[0]!=="number"){c=b.length;while(--c>-1){if(this._kill(a,b[c])){h=true}}}else{if(this._targets){c=this._targets.length;while(--c>-1){if(b===this._targets[c]){g=this._propLookup[c]||{};this._overwrittenProps=this._overwrittenProps||[];d=this._overwrittenProps[c]=a?this._overwrittenProps[c]||{}:"all";break}}}else if(b!==this.target){return false}else{g=this._propLookup;d=this._overwrittenProps=a?this._overwrittenProps||{}:"all"}if(g){i=a||g;j=a!==d&&d!=="all"&&a!==g&&(a==null||a._tempKill!==true);for(e in i){if(f=g[e]){if(f.pg&&f.t._kill(i)){h=true}if(!f.pg||f.t._overwriteProps.length===0){if(f._prev){f._prev._next=f._next}else if(f===this._firstPT){this._firstPT=f._next}if(f._next){f._next._prev=f._prev}f._next=f._prev=null}delete g[e]}if(j){d[e]=1}}if(!this._firstPT&&this._initted){this._enabled(false,false)}}}return h};i.invalidate=function(){if(this._notifyPluginsOfEnabled){A._onPluginEvent("_onDisable",this)}this._firstPT=null;this._overwrittenProps=null;this._onUpdate=null;this._startAt=null;this._initted=this._active=this._notifyPluginsOfEnabled=false;this._propLookup=this._targets?{}:[];return this};i._enabled=function(a,b){if(!k){j.wake()}if(a&&this._gc){var c=this._targets,d;if(c){d=c.length;while(--d>-1){this._siblings[d]=L(c[d],this,true)}}else{this._siblings=L(this.target,this,true)}}y.prototype._enabled.call(this,a,b);if(this._notifyPluginsOfEnabled)if(this._firstPT){return A._onPluginEvent(a?"_onEnable":"_onDisable",this)}return false};A.to=function(a,b,c){return new A(a,b,c)};A.from=function(a,b,c){c.runBackwards=true;c.immediateRender=c.immediateRender!=false;return new A(a,b,c)};A.fromTo=function(a,b,c,d){d.startAt=c;d.immediateRender=d.immediateRender!=false&&c.immediateRender!=false;return new A(a,b,d)};A.delayedCall=function(a,b,c,d,e){return new A(b,0,{delay:a,onComplete:b,onCompleteParams:c,onCompleteScope:d,onReverseComplete:b,onReverseCompleteParams:c,onReverseCompleteScope:d,immediateRender:false,useFrames:e,overwrite:0})};A.set=function(a,b){return new A(a,0,b)};A.killTweensOf=A.killDelayedCallsTo=function(a,b){var c=A.getTweensOf(a),d=c.length;while(--d>-1){c[d]._kill(b,a)}};A.getTweensOf=function(a){if(a==null){return[]}a=typeof a!=="string"?a:A.selector(a)||a;var b,c,d,e;if((a instanceof Array||B(a))&&typeof a[0]!=="number"){b=a.length;c=[];while(--b>-1){c=c.concat(A.getTweensOf(a[b]))}b=c.length;while(--b>-1){e=c[b];d=b;while(--d>-1){if(e===c[d]){c.splice(b,1)}}}}else{c=L(a).concat();b=c.length;while(--b>-1){if(c[b]._gc){c.splice(b,1)}}}return c};var O=o("plugins.TweenPlugin",function(a,b){this._overwriteProps=(a||"").split(",");this._propName=this._overwriteProps[0];this._priority=b||0;this._super=O.prototype},true);i=O.prototype;O.version="1.9.1";O.API=2;i._firstPT=null;i._addTween=function(a,b,c,d,e,f){var g,h;if(d!=null&&(g=typeof d==="number"||d.charAt(1)!=="="?Number(d)-c:parseInt(d.charAt(0)+"1",10)*Number(d.substr(2)))){this._firstPT=h={_next:this._firstPT,t:a,p:b,s:c,c:g,f:typeof a[b]==="function",n:e||b,r:f};if(h._next){h._next._prev=h}}};i.setRatio=function(a){var b=this._firstPT,c=1e-6,d;while(b){d=b.c*a+b.s;if(b.r){d=d+(d>0?.5:-.5)>>0}else if(d<c)if(d>-c){d=0}if(b.f){b.t[b.p](d)}else{b.t[b.p]=d}b=b._next}};i._kill=function(a){var b=this._overwriteProps,c=this._firstPT,d;if(a[this._propName]!=null){this._overwriteProps=[]}else{d=b.length;while(--d>-1){if(a[b[d]]!=null){b.splice(d,1)}}}while(c){if(a[c.n]!=null){if(c._next){c._next._prev=c._prev}if(c._prev){c._prev._next=c._next;c._prev=null}else if(this._firstPT===c){this._firstPT=c._next}}c=c._next}return false};i._roundProps=function(a,b){var c=this._firstPT;while(c){if(a[this._propName]||c.n!=null&&a[c.n.split(this._propName+"_").join("")]){c.r=b}c=c._next}};A._onPluginEvent=function(a,b){var c=b._firstPT,d,e,f,g,h;if(a==="_onInitAllProps"){while(c){h=c._next;e=f;while(e&&e.pr>c.pr){e=e._next}if(c._prev=e?e._prev:g){c._prev._next=c}else{f=c}if(c._next=e){e._prev=c}else{g=c}c=h}c=b._firstPT=f}while(c){if(c.pg)if(typeof c.t[a]==="function")if(c.t[a]()){d=true}c=c._next}return d};O.activate=function(a){var b=a.length;while(--b>-1){if(a[b].API===O.API){E[(new a[b])._propName]=a[b]}}return true};n.plugin=function(a){if(!a||!a.propName||!a.init||!a.API){throw"illegal plugin definition."}var b=a.propName,c=a.priority||0,d=a.overwriteProps,e={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_roundProps",initAll:"_onInitAllProps"},f=o("plugins."+b.charAt(0).toUpperCase()+b.substr(1)+"Plugin",function(){O.call(this,b,c);this._overwriteProps=d||[]},a.global===true),g=f.prototype=new O(b),h;g.constructor=f;f.API=a.API;for(h in e){if(typeof a[h]==="function"){g[e[h]]=a[h]}}f.version=a.version;O.activate([f]);return f};g=a._gsQueue;if(g){for(h=0;h<g.length;h++){g[h]()}for(i in l){if(!l[i].func){a.console.log("GSAP encountered missing dependency: com.greensock."+i)}}}k=false}(window);(window._gsQueue||(window._gsQueue=[])).push(function(){"use strict";window._gsDefine("easing.Back",["easing.Ease"],function(a){var b,c,d,e=window.GreenSockGlobals||window,f=e.com.greensock,g=2*Math.PI,h=Math.PI/2,i=f._class,j=function(b,c){var d=i("easing."+b,function(){},!0),e=d.prototype=new a;return e.constructor=d,e.getRatio=c,d},k=a.register||function(){},l=function(a,b,c,d){var e=i("easing."+a,{easeOut:new b,easeIn:new c,easeInOut:new d},!0);return k(e,a),e},m=function(a,b,c){this.t=a,this.v=b,c&&(this.next=c,c.prev=this,this.c=c.v-b,this.gap=c.t-a)},n=function(b,c){var d=i("easing."+b,function(a){this._p1=a||0===a?a:1.70158,this._p2=1.525*this._p1},!0),e=d.prototype=new a;return e.constructor=d,e.getRatio=c,e.config=function(a){return new d(a)},d},o=l("Back",n("BackOut",function(a){return(a-=1)*a*((this._p1+1)*a+this._p1)+1}),n("BackIn",function(a){return a*a*((this._p1+1)*a-this._p1)}),n("BackInOut",function(a){return 1>(a*=2)?.5*a*a*((this._p2+1)*a-this._p2):.5*((a-=2)*a*((this._p2+1)*a+this._p2)+2)})),p=i("easing.SlowMo",function(a,b,c){b=b||0===b?b:.7,null==a?a=.7:a>1&&(a=1),this._p=1!==a?b:0,this._p1=(1-a)/2,this._p2=a,this._p3=this._p1+this._p2,this._calcEnd=c===!0},!0),q=p.prototype=new a;return q.constructor=p,q.getRatio=function(a){var b=a+(.5-a)*this._p;return this._p1>a?this._calcEnd?1-(a=1-a/this._p1)*a:b-(a=1-a/this._p1)*a*a*a*b:a>this._p3?this._calcEnd?1-(a=(a-this._p3)/this._p1)*a:b+(a-b)*(a=(a-this._p3)/this._p1)*a*a*a:this._calcEnd?1:b},p.ease=new p(.7,.7),q.config=p.config=function(a,b,c){return new p(a,b,c)},b=i("easing.SteppedEase",function(a){a=a||1,this._p1=1/a,this._p2=a+1},!0),q=b.prototype=new a,q.constructor=b,q.getRatio=function(a){return 0>a?a=0:a>=1&&(a=.999999999),(this._p2*a>>0)*this._p1},q.config=b.config=function(a){return new b(a)},c=i("easing.RoughEase",function(b){b=b||{};for(var c,d,e,f,g,h,i=b.taper||"none",j=[],k=0,l=0|(b.points||20),n=l,o=b.randomize!==!1,p=b.clamp===!0,q=b.template instanceof a?b.template:null,r="number"==typeof b.strength?.4*b.strength:.4;--n>-1;)c=o?Math.random():1/l*n,d=q?q.getRatio(c):c,"none"===i?e=r:"out"===i?(f=1-c,e=f*f*r):"in"===i?e=c*c*r:.5>c?(f=2*c,e=.5*f*f*r):(f=2*(1-c),e=.5*f*f*r),o?d+=Math.random()*e-.5*e:n%2?d+=.5*e:d-=.5*e,p&&(d>1?d=1:0>d&&(d=0)),j[k++]={x:c,y:d};for(j.sort(function(a,b){return a.x-b.x}),h=new m(1,1,null),n=l;--n>-1;)g=j[n],h=new m(g.x,g.y,h);this._prev=new m(0,0,0!==h.t?h:h.next)},!0),q=c.prototype=new a,q.constructor=c,q.getRatio=function(a){var b=this._prev;if(a>b.t){for(;b.next&&a>=b.t;)b=b.next;b=b.prev}else for(;b.prev&&b.t>=a;)b=b.prev;return this._prev=b,b.v+(a-b.t)/b.gap*b.c},q.config=function(a){return new c(a)},c.ease=new c,l("Bounce",j("BounceOut",function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}),j("BounceIn",function(a){return 1/2.75>(a=1-a)?1-7.5625*a*a:2/2.75>a?1-(7.5625*(a-=1.5/2.75)*a+.75):2.5/2.75>a?1-(7.5625*(a-=2.25/2.75)*a+.9375):1-(7.5625*(a-=2.625/2.75)*a+.984375)}),j("BounceInOut",function(a){var b=.5>a;return a=b?1-2*a:2*a-1,a=1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375,b?.5*(1-a):.5*a+.5})),l("Circ",j("CircOut",function(a){return Math.sqrt(1-(a-=1)*a)}),j("CircIn",function(a){return-(Math.sqrt(1-a*a)-1)}),j("CircInOut",function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)})),d=function(b,c,d){var e=i("easing."+b,function(a,b){this._p1=a||1,this._p2=b||d,this._p3=this._p2/g*(Math.asin(1/this._p1)||0)},!0),f=e.prototype=new a;return f.constructor=e,f.getRatio=c,f.config=function(a,b){return new e(a,b)},e},l("Elastic",d("ElasticOut",function(a){return this._p1*Math.pow(2,-10*a)*Math.sin((a-this._p3)*g/this._p2)+1},.3),d("ElasticIn",function(a){return-(this._p1*Math.pow(2,10*(a-=1))*Math.sin((a-this._p3)*g/this._p2))},.3),d("ElasticInOut",function(a){return 1>(a*=2)?-.5*this._p1*Math.pow(2,10*(a-=1))*Math.sin((a-this._p3)*g/this._p2):.5*this._p1*Math.pow(2,-10*(a-=1))*Math.sin((a-this._p3)*g/this._p2)+1},.45)),l("Expo",j("ExpoOut",function(a){return 1-Math.pow(2,-10*a)}),j("ExpoIn",function(a){return Math.pow(2,10*(a-1))-.001}),j("ExpoInOut",function(a){return 1>(a*=2)?.5*Math.pow(2,10*(a-1)):.5*(2-Math.pow(2,-10*(a-1)))})),l("Sine",j("SineOut",function(a){return Math.sin(a*h)}),j("SineIn",function(a){return-Math.cos(a*h)+1}),j("SineInOut",function(a){return-.5*(Math.cos(Math.PI*a)-1)})),i("easing.EaseLookup",{find:function(b){return a.map[b]}},!0),k(e.SlowMo,"SlowMo","ease,"),k(c,"RoughEase","ease,"),k(b,"SteppedEase","ease,"),o},!0)}),window._gsDefine&&window._gsQueue.pop()();(window._gsQueue||(window._gsQueue=[])).push(function(){"use strict";window._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(a,b){var c=function(){a.call(this,"css");this._overwriteProps.length=0},d,e,f,g,h={},i=c.prototype=new a("css");i.constructor=c;c.version="1.9.7";c.API=2;c.defaultTransformPerspective=0;i="px";c.suffixMap={top:i,right:i,bottom:i,left:i,width:i,height:i,fontSize:i,padding:i,margin:i,perspective:i};var j=/(?:\d|\-\d|\.\d|\-\.\d)+/g,k=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,l=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,m=/[^\d\-\.]/g,n=/(?:\d|\-|\+|=|#|\.)*/g,o=/opacity *= *([^)]*)/,p=/opacity:([^;]*)/,q=/alpha\(opacity *=.+?\)/i,r=/^(rgb|hsl)/,s=/([A-Z])/g,t=/-([a-z])/gi,u=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,v=function(a,b){return b.toUpperCase()},w=/(?:Left|Right|Width)/i,x=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,y=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,z=/,(?=[^\)]*(?:\(|$))/gi,A=Math.PI/180,B=180/Math.PI,C={},D=document,E=D.createElement("div"),F=D.createElement("img"),G=c._internals={_specialProps:h},H=navigator.userAgent,I,J,K,L,M,N,O=function(){var a=H.indexOf("Android"),b=D.createElement("div"),c;K=H.indexOf("Safari")!==-1&&H.indexOf("Chrome")===-1&&(a===-1||Number(H.substr(a+8,1))>3);M=K&&Number(H.substr(H.indexOf("Version/")+8,1))<6;L=H.indexOf("Firefox")!==-1;/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(H);N=parseFloat(RegExp.$1);b.innerHTML="<a style='top:1px;opacity:.55;'>a</a>";c=b.getElementsByTagName("a")[0];return c?/^0.55/.test(c.style.opacity):false}(),P=function(a){return o.test(typeof a==="string"?a:(a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100:1},Q=function(a){if(window.console){console.log(a)}},R="",S="",T=function(a,b){b=b||E;var c=b.style,d,e;if(c[a]!==undefined){return a}a=a.charAt(0).toUpperCase()+a.substr(1);d=["O","Moz","ms","Ms","Webkit"];e=5;while(--e>-1&&c[d[e]+a]===undefined){}if(e>=0){S=e===3?"ms":d[e];R="-"+S.toLowerCase()+"-";return S+a}return null},U=D.defaultView?D.defaultView.getComputedStyle:function(){},V=c.getStyle=function(a,b,c,d,e){var f;if(!O)if(b==="opacity"){return P(a)}if(!d&&a.style[b]){f=a.style[b]}else if(c=c||U(a,null)){a=c.getPropertyValue(b.replace(s,"-$1").toLowerCase());f=a||c.length?a:c[b]}else if(a.currentStyle){c=a.currentStyle;f=c[b]}return e!=null&&(!f||f==="none"||f==="auto"||f==="auto auto")?e:f},W=function(a,b,c,d,e){if(d==="px"||!d){return c}if(d==="auto"||!c){return 0}var f=w.test(b),g=a,h=E.style,i=c<0,j;if(i){c=-c}if(d==="%"&&b.indexOf("border")!==-1){j=c/100*(f?a.clientWidth:a.clientHeight)}else{h.cssText="border-style:solid; border-width:0; position:absolute; line-height:0;";if(d==="%"||!g.appendChild){g=a.parentNode||D.body;h[f?"width":"height"]=c+d}else{h[f?"borderLeftWidth":"borderTopWidth"]=c+d}g.appendChild(E);j=parseFloat(E[f?"offsetWidth":"offsetHeight"]);g.removeChild(E);if(j===0&&!e){j=W(a,b,c,d,true)}}return i?-j:j},X=function(a,b,c){if(V(a,"position",c)!=="absolute"){return 0}var d=b==="left"?"Left":"Top",e=V(a,"margin"+d,c);return a["offset"+d]-(W(a,b,parseFloat(e),e.replace(n,""))||0)},Y=function(a,b){var c={},d,e;if(b=b||U(a,null)){if(d=b.length){while(--d>-1){c[b[d].replace(t,v)]=b.getPropertyValue(b[d])}}else{for(d in b){c[d]=b[d]}}}else if(b=a.currentStyle||a.style){for(d in b){c[d.replace(t,v)]=b[d]}}if(!O){c.opacity=P(a)}e=zb(a,b,false);c.rotation=e.rotation*B;c.skewX=e.skewX*B;c.scaleX=e.scaleX;c.scaleY=e.scaleY;c.x=e.x;c.y=e.y;if(yb){c.z=e.z;c.rotationX=e.rotationX*B;c.rotationY=e.rotationY*B;c.scaleZ=e.scaleZ}if(c.filters){delete c.filters}return c},Z=function(a,b,c,d,e){var f={},g=a.style,h,i,j;for(i in c){if(i!=="cssText")if(i!=="length")if(isNaN(i))if(b[i]!==(h=c[i])||e&&e[i])if(i.indexOf("Origin")===-1)if(typeof h==="number"||typeof h==="string"){f[i]=h==="auto"&&(i==="left"||i==="top")?X(a,i):(h===""||h==="auto"||h==="none")&&typeof b[i]==="string"&&b[i].replace(m,"")!==""?0:h;if(g[i]!==undefined){j=new mb(g,i,g[i],j)}}}if(d){for(i in d){if(i!=="className"){f[i]=d[i]}}}return{difs:f,firstMPT:j}},$={width:["Left","Right"],height:["Top","Bottom"]},_=["marginLeft","marginRight","marginTop","marginBottom"],ab=function(a,b,c){var d=parseFloat(b==="width"?a.offsetWidth:a.offsetHeight),e=$[b],f=e.length;c=c||U(a,null);while(--f>-1){d-=parseFloat(V(a,"padding"+e[f],c,true))||0;d-=parseFloat(V(a,"border"+e[f]+"Width",c,true))||0}return d},bb=function(a,b){if(a==null||a===""||a==="auto"||a==="auto auto"){a="0 0"}var c=a.split(" "),d=a.indexOf("left")!==-1?"0%":a.indexOf("right")!==-1?"100%":c[0],e=a.indexOf("top")!==-1?"0%":a.indexOf("bottom")!==-1?"100%":c[1];if(e==null){e="0"}else if(e==="center"){e="50%"}if(d==="center"||isNaN(parseFloat(d))){d="50%"}if(b){b.oxp=d.indexOf("%")!==-1;b.oyp=e.indexOf("%")!==-1;b.oxr=d.charAt(1)==="=";b.oyr=e.charAt(1)==="=";b.ox=parseFloat(d.replace(m,""));b.oy=parseFloat(e.replace(m,""))}return d+" "+e+(c.length>2?" "+c[2]:"")},cb=function(a,b){return typeof a==="string"&&a.charAt(1)==="="?parseInt(a.charAt(0)+"1",10)*parseFloat(a.substr(2)):parseFloat(a)-parseFloat(b)},db=function(a,b){return a==null?b:typeof a==="string"&&a.charAt(1)==="="?parseInt(a.charAt(0)+"1",10)*Number(a.substr(2))+b:parseFloat(a)},eb=function(a,b,c,d){var e=1e-6,f,g,h,i;if(a==null){i=b}else if(typeof a==="number"){i=a*A}else{f=Math.PI*2;g=a.split("_");h=Number(g[0].replace(m,""))*(a.indexOf("rad")===-1?A:1)-(a.charAt(1)==="="?0:b);if(g.length){if(d){d[c]=b+h}if(a.indexOf("short")!==-1){h=h%f;if(h!==h%(f/2)){h=h<0?h+f:h-f}}if(a.indexOf("_cw")!==-1&&h<0){h=(h+f*9999999999)%f-(h/f|0)*f}else if(a.indexOf("ccw")!==-1&&h>0){h=(h-f*9999999999)%f-(h/f|0)*f}}i=b+h}if(i<e&&i>-e){i=0}return i},fb={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},gb=function(a,b,c){a=a<0?a+1:a>1?a-1:a;
return(a*6<1?b+(c-b)*a*6:a<.5?c:a*3<2?b+(c-b)*(2/3-a)*6:b)*255+.5|0},hb=function(a){var b,c,d,e,f,g;if(!a||a===""){return fb.black}if(typeof a==="number"){return[a>>16,a>>8&255,a&255]}if(a.charAt(a.length-1)===","){a=a.substr(0,a.length-1)}if(fb[a]){return fb[a]}if(a.charAt(0)==="#"){if(a.length===4){b=a.charAt(1),c=a.charAt(2),d=a.charAt(3);a="#"+b+b+c+c+d+d}a=parseInt(a.substr(1),16);return[a>>16,a>>8&255,a&255]}if(a.substr(0,3)==="hsl"){a=a.match(j);e=Number(a[0])%360/360;f=Number(a[1])/100;g=Number(a[2])/100;c=g<=.5?g*(f+1):g+f-g*f;b=g*2-c;if(a.length>3){a[3]=Number(a[3])}a[0]=gb(e+1/3,b,c);a[1]=gb(e,b,c);a[2]=gb(e-1/3,b,c);return a}a=a.match(j)||fb.transparent;a[0]=Number(a[0]);a[1]=Number(a[1]);a[2]=Number(a[2]);if(a.length>3){a[3]=Number(a[3])}return a},ib="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#.+?\\b";for(i in fb){ib+="|"+i+"\\b"}ib=new RegExp(ib+")","gi");var jb=function(a,b,c,d){if(a==null){return function(a){return a}}var e=b?(a.match(ib)||[""])[0]:"",f=a.split(e).join("").match(l)||[],g=a.substr(0,a.indexOf(f[0])),h=a.charAt(a.length-1)===")"?")":"",i=a.indexOf(" ")!==-1?" ":",",k=f.length,m=k>0?f[0].replace(j,""):"",n;if(!k){return function(a){return a}}if(b){n=function(a){var b,j,o,p;if(typeof a==="number"){a+=m}else if(d&&z.test(a)){p=a.replace(z,"|").split("|");for(o=0;o<p.length;o++){p[o]=n(p[o])}return p.join(",")}b=(a.match(ib)||[e])[0];j=a.split(b).join("").match(l)||[];o=j.length;if(k>o--){while(++o<k){j[o]=c?j[(o-1)/2|0]:f[o]}}return g+j.join(i)+i+b+h+(a.indexOf("inset")!==-1?" inset":"")};return n}n=function(a){var b,e,j;if(typeof a==="number"){a+=m}else if(d&&z.test(a)){e=a.replace(z,"|").split("|");for(j=0;j<e.length;j++){e[j]=n(e[j])}return e.join(",")}b=a.match(l)||[];j=b.length;if(k>j--){while(++j<k){b[j]=c?b[(j-1)/2|0]:f[j]}}return g+b.join(i)+h};return n},kb=function(a){a=a.split(",");return function(b,c,d,e,f,g,h){var i=(c+"").split(" "),j;h={};for(j=0;j<4;j++){h[a[j]]=i[j]=i[j]||i[(j-1)/2>>0]}return e.parse(b,h,f,g)}},lb=G._setPluginRatio=function(a){this.plugin.setRatio(a);var b=this.data,c=b.proxy,d=b.firstMPT,e=1e-6,f,g,h,i;while(d){f=c[d.v];if(d.r){f=f>0?f+.5|0:f-.5|0}else if(f<e&&f>-e){f=0}d.t[d.p]=f;d=d._next}if(b.autoRotate){b.autoRotate.rotation=c.rotation}if(a===1){d=b.firstMPT;while(d){g=d.t;if(!g.type){g.e=g.s+g.xs0}else if(g.type===1){i=g.xs0+g.s+g.xs1;for(h=1;h<g.l;h++){i+=g["xn"+h]+g["xs"+(h+1)]}g.e=i}d=d._next}}},mb=function(a,b,c,d,e){this.t=a;this.p=b;this.v=c;this.r=e;if(d){d._prev=this;this._next=d}},nb=G._parseToProxy=function(a,b,c,d,e,f){var g=d,h={},i={},j=c._transform,k=C,l,m,n,o,p;c._transform=null;C=b;d=p=c.parse(a,b,d,e);C=k;if(f){c._transform=j;if(g){g._prev=null;if(g._prev){g._prev._next=null}}}while(d&&d!==g){if(d.type<=1){m=d.p;i[m]=d.s+d.c;h[m]=d.s;if(!f){o=new mb(d,"s",m,o,d.r);d.c=0}if(d.type===1){l=d.l;while(--l>0){n="xn"+l;m=d.p+"_"+n;i[m]=d.data[n];h[m]=d[n];if(!f){o=new mb(d,n,m,o,d.rxp[n])}}}}d=d._next}return{proxy:h,end:i,firstMPT:o,pt:p}},ob=G.CSSPropTween=function(a,b,c,e,f,h,i,j,k,l,m){this.t=a;this.p=b;this.s=c;this.c=e;this.n=i||"css_"+b;if(!(a instanceof ob)){g.push(this.n)}this.r=j;this.type=h||0;if(k){this.pr=k;d=true}this.b=l===undefined?c:l;this.e=m===undefined?c+e:m;if(f){this._next=f;f._prev=this}},pb=c.parseComplex=function(a,b,c,d,e,f,g,h,i,l){c=c||f||"";g=new ob(a,b,0,0,g,l?2:1,null,false,h,c,d);d+="";var m=c.split(", ").join(",").split(" "),n=d.split(", ").join(",").split(" "),o=m.length,p=I!==false,q,s,t,u,v,w,x,y,A,B,C,D;if(d.indexOf(",")!==-1||c.indexOf(",")!==-1){m=m.join(" ").replace(z,", ").split(" ");n=n.join(" ").replace(z,", ").split(" ");o=m.length}if(o!==n.length){m=(f||"").split(" ");o=m.length}g.plugin=i;g.setRatio=l;for(q=0;q<o;q++){u=m[q];v=n[q];y=parseFloat(u);if(y||y===0){g.appendXtra("",y,cb(v,y),v.replace(k,""),p&&v.indexOf("px")!==-1,true)}else if(e&&(u.charAt(0)==="#"||fb[u]||r.test(u))){D=v.charAt(v.length-1)===","?"),":")";u=hb(u);v=hb(v);A=u.length+v.length>6;if(A&&!O&&v[3]===0){g["xs"+g.l]+=g.l?" transparent":"transparent";g.e=g.e.split(n[q]).join("transparent")}else{if(!O){A=false}g.appendXtra(A?"rgba(":"rgb(",u[0],v[0]-u[0],",",true,true).appendXtra("",u[1],v[1]-u[1],",",true).appendXtra("",u[2],v[2]-u[2],A?",":D,true);if(A){u=u.length<4?1:u[3];g.appendXtra("",u,(v.length<4?1:v[3])-u,D,false)}}}else{w=u.match(j);if(!w){g["xs"+g.l]+=g.l?" "+u:u}else{x=v.match(k);if(!x||x.length!==w.length){return g}t=0;for(s=0;s<w.length;s++){C=w[s];B=u.indexOf(C,t);g.appendXtra(u.substr(t,B-t),Number(C),cb(x[s],C),"",p&&u.substr(B+C.length,2)==="px",s===0);t=B+C.length}g["xs"+g.l]+=u.substr(t)}}}if(d.indexOf("=")!==-1)if(g.data){D=g.xs0+g.data.s;for(q=1;q<g.l;q++){D+=g["xs"+q]+g.data["xn"+q]}g.e=D+g["xs"+q]}if(!g.l){g.type=-1;g.xs0=g.e}return g.xfirst||g},qb=9;i=ob.prototype;i.l=i.pr=0;while(--qb>0){i["xn"+qb]=0;i["xs"+qb]=""}i.xs0="";i._next=i._prev=i.xfirst=i.data=i.plugin=i.setRatio=i.rxp=null;i.appendXtra=function(a,b,c,d,e,f){var g=this,h=g.l;g["xs"+h]+=f&&h?" "+a:a||"";if(!c)if(h!==0&&!g.plugin){g["xs"+h]+=b+(d||"");return g}g.l++;g.type=g.setRatio?2:1;g["xs"+g.l]=d||"";if(h>0){g.data["xn"+h]=b+c;g.rxp["xn"+h]=e;g["xn"+h]=b;if(!g.plugin){g.xfirst=new ob(g,"xn"+h,b,c,g.xfirst||g,0,g.n,e,g.pr);g.xfirst.xs0=0}return g}g.data={s:b+c};g.rxp={};g.s=b;g.c=c;g.r=e;return g};var rb=function(a,b){b=b||{};this.p=b.prefix?T(a)||a:a;h[a]=h[this.p]=this;this.format=b.formatter||jb(b.defaultValue,b.color,b.collapsible,b.multi);if(b.parser){this.parse=b.parser}this.clrs=b.color;this.multi=b.multi;this.keyword=b.keyword;this.dflt=b.defaultValue;this.pr=b.priority||0},sb=G._registerComplexSpecialProp=function(a,b,c){if(typeof b!=="object"){b={parser:c}}var d=a.split(","),e=b.defaultValue,f,g;c=c||[e];for(f=0;f<d.length;f++){b.prefix=f===0&&b.prefix;b.defaultValue=c[f]||e;g=new rb(d[f],b)}},tb=function(a){if(!h[a]){var b=a.charAt(0).toUpperCase()+a.substr(1)+"Plugin";sb(a,{parser:function(a,c,d,e,f,g,i){var j=(window.GreenSockGlobals||window).com.greensock.plugins[b];if(!j){Q("Error: "+b+" js file not loaded.");return f}j._cssRegister();return h[d].parse(a,c,d,e,f,g,i)}})}};i=rb.prototype;i.parseComplex=function(a,b,c,d,e,f){var g=this.keyword,h,i,j,k,l,m;if(this.multi)if(z.test(c)||z.test(b)){i=b.replace(z,"|").split("|");j=c.replace(z,"|").split("|")}else if(g){i=[b];j=[c]}if(j){k=j.length>i.length?j.length:i.length;for(h=0;h<k;h++){b=i[h]=i[h]||this.dflt;c=j[h]=j[h]||this.dflt;if(g){l=b.indexOf(g);m=c.indexOf(g);if(l!==m){c=m===-1?j:i;c[h]+=" "+g}}}b=i.join(", ");c=j.join(", ")}return pb(a,this.p,b,c,this.clrs,this.dflt,d,this.pr,e,f)};i.parse=function(a,b,c,d,e,g,h){return this.parseComplex(a.style,this.format(V(a,this.p,f,false,this.dflt)),this.format(b),e,g)};c.registerSpecialProp=function(a,b,c){sb(a,{parser:function(a,d,e,f,g,h,i){var j=new ob(a,e,0,0,g,2,e,false,c);j.plugin=h;j.setRatio=b(a,d,f._tween,e);return j},priority:c})};var ub="scaleX,scaleY,scaleZ,x,y,z,skewX,rotation,rotationX,rotationY,perspective".split(","),vb=T("transform"),wb=R+"transform",xb=T("transformOrigin"),yb=T("perspective")!==null,zb=function(a,b,d){var e=d?a._gsTransform||{skewY:0}:{skewY:0},f=e.scaleX<0,g=2e-5,h=1e5,i=-Math.PI+1e-4,j=Math.PI-1e-4,k=yb?parseFloat(V(a,xb,b,false,"0 0 0").split(" ")[2])||e.zOrigin||0:0,l,m,n,o,p,q,r,s,t,u,v,w,y;if(vb){l=V(a,wb,b,true)}else if(a.currentStyle){l=a.currentStyle.filter.match(x);if(l&&l.length===4){l=[l[0].substr(4),Number(l[2].substr(4)),Number(l[1].substr(4)),l[3].substr(4),e.x||0,e.y||0].join(",")}else if(e.x!=null){return e}else{l=""}}m=(l||"").match(/(?:\-|\b)[\d\-\.e]+\b/gi)||[];n=m.length;while(--n>-1){o=Number(m[n]);m[n]=(p=o-(o|=0))?(p*h+(p<0?-.5:.5)|0)/h+o:o}if(m.length===16){var z=m[8],A=m[9],B=m[10],C=m[12],D=m[13],E=m[14];if(e.zOrigin){E=-e.zOrigin;C=z*E-m[12];D=A*E-m[13];E=B*E+e.zOrigin-m[14]}if(!d||e.rotationX==null){var F=m[0],G=m[1],H=m[2],I=m[3],J=m[4],K=m[5],L=m[6],M=m[7],N=m[11],O=e.rotationX=Math.atan2(L,B),P=O<i||O>j,Q,R,S,T,U,W,X;if(O){T=Math.cos(-O);U=Math.sin(-O);Q=J*T+z*U;R=K*T+A*U;S=L*T+B*U;z=J*-U+z*T;A=K*-U+A*T;B=L*-U+B*T;N=M*-U+N*T;J=Q;K=R;L=S}O=e.rotationY=Math.atan2(z,F);if(O){W=O<i||O>j;T=Math.cos(-O);U=Math.sin(-O);Q=F*T-z*U;R=G*T-A*U;S=H*T-B*U;A=G*U+A*T;B=H*U+B*T;N=I*U+N*T;F=Q;G=R;H=S}O=e.rotation=Math.atan2(G,K);if(O){X=O<i||O>j;T=Math.cos(-O);U=Math.sin(-O);F=F*T+J*U;R=G*T+K*U;K=G*-U+K*T;L=H*-U+L*T;G=R}if(X&&P){e.rotation=e.rotationX=0}else if(X&&W){e.rotation=e.rotationY=0}else if(W&&P){e.rotationY=e.rotationX=0}e.scaleX=(Math.sqrt(F*F+G*G)*h+.5|0)/h;e.scaleY=(Math.sqrt(K*K+A*A)*h+.5|0)/h;e.scaleZ=(Math.sqrt(L*L+B*B)*h+.5|0)/h;e.skewX=0;e.perspective=N?1/(N<0?-N:N):0;e.x=C;e.y=D;e.z=E}}else if((!yb||m.length===0||e.x!==m[4]||e.y!==m[5]||!e.rotationX&&!e.rotationY)&&!(e.x!==undefined&&V(a,"display",b)==="none")){var Y=m.length>=6,Z=Y?m[0]:1,$=m[1]||0,_=m[2]||0,ab=Y?m[3]:1;e.x=m[4]||0;e.y=m[5]||0;q=Math.sqrt(Z*Z+$*$);r=Math.sqrt(ab*ab+_*_);s=Z||$?Math.atan2($,Z):e.rotation||0;t=_||ab?Math.atan2(_,ab)+s:e.skewX||0;u=q-Math.abs(e.scaleX||0);v=r-Math.abs(e.scaleY||0);if(Math.abs(t)>Math.PI/2&&Math.abs(t)<Math.PI*1.5){if(f){q*=-1;t+=s<=0?Math.PI:-Math.PI;s+=s<=0?Math.PI:-Math.PI}else{r*=-1;t+=t<=0?Math.PI:-Math.PI}}w=(s-e.rotation)%Math.PI;y=(t-e.skewX)%Math.PI;if(e.skewX===undefined||u>g||u<-g||v>g||v<-g||w>i&&w<j&&w*h|0!==0||y>i&&y<j&&y*h|0!==0){e.scaleX=q;e.scaleY=r;e.rotation=s;e.skewX=t}if(yb){e.rotationX=e.rotationY=e.z=0;e.perspective=parseFloat(c.defaultTransformPerspective)||0;e.scaleZ=1}}e.zOrigin=k;for(n in e){if(e[n]<g)if(e[n]>-g){e[n]=0}}if(d){a._gsTransform=e}return e},Ab=function(a){var b=this.data,c=-b.rotation,d=c+b.skewX,e=1e5,f=(Math.cos(c)*b.scaleX*e|0)/e,g=(Math.sin(c)*b.scaleX*e|0)/e,h=(Math.sin(d)*-b.scaleY*e|0)/e,i=(Math.cos(d)*b.scaleY*e|0)/e,j=this.t.style,k=this.t.currentStyle,l,m;if(!k){return}m=g;g=-h;h=-m;l=k.filter;j.filter="";var p=this.t.offsetWidth,q=this.t.offsetHeight,r=k.position!=="absolute",s="progid:DXImageTransform.Microsoft.Matrix(M11="+f+", M12="+g+", M21="+h+", M22="+i,t=b.x,u=b.y,v,w;if(b.ox!=null){v=(b.oxp?p*b.ox*.01:b.ox)-p/2;w=(b.oyp?q*b.oy*.01:b.oy)-q/2;t+=v-(v*f+w*g);u+=w-(v*h+w*i)}if(!r){var x=N<8?1:-1,z,A,B;v=b.ieOffsetX||0;w=b.ieOffsetY||0;b.ieOffsetX=Math.round((p-((f<0?-f:f)*p+(g<0?-g:g)*q))/2+t);b.ieOffsetY=Math.round((q-((i<0?-i:i)*q+(h<0?-h:h)*p))/2+u);for(qb=0;qb<4;qb++){A=_[qb];z=k[A];m=z.indexOf("px")!==-1?parseFloat(z):W(this.t,A,parseFloat(z),z.replace(n,""))||0;if(m!==b[A]){B=qb<2?-b.ieOffsetX:-b.ieOffsetY}else{B=qb<2?v-b.ieOffsetX:w-b.ieOffsetY}j[A]=(b[A]=Math.round(m-B*(qb===0||qb===2?1:x)))+"px"}s+=", sizingMethod='auto expand')"}else{v=p/2;w=q/2;s+=", Dx="+(v-(v*f+w*g)+t)+", Dy="+(w-(v*h+w*i)+u)+")"}if(l.indexOf("DXImageTransform.Microsoft.Matrix(")!==-1){j.filter=l.replace(y,s)}else{j.filter=s+" "+l}if(a===0||a===1)if(f===1)if(g===0)if(h===0)if(i===1)if(!r||s.indexOf("Dx=0, Dy=0")!==-1)if(!o.test(l)||parseFloat(RegExp.$1)===100)if(l.indexOf("gradient(")===-1){j.removeAttribute("filter")}},Bb=function(a){var b=this.data,c=this.t.style,d=b.perspective,e=b.scaleX,f=0,g=0,h=0,i=0,j=b.scaleY,k=0,l=0,m=0,n=0,o=b.scaleZ,p=0,q=0,r=0,s=d?-1/d:0,t=b.rotation,u=b.zOrigin,v=1e5,w,x,y,z,A,B,C,D,E;if(L){C=c.top?"top":c.bottom?"bottom":parseFloat(V(this.t,"top",null,false))?"bottom":"top";y=V(this.t,C,null,false);D=parseFloat(y)||0;E=y.substr((D+"").length)||"px";b._ffFix=!b._ffFix;c[C]=(b._ffFix?D+.05:D-.05)+E}if(t||b.skewX){y=e*Math.cos(t);z=j*Math.sin(t);t-=b.skewX;f=e*-Math.sin(t);j=j*Math.cos(t);e=y;i=z}t=b.rotationY;if(t){w=Math.cos(t);x=Math.sin(t);y=e*w;z=i*w;A=o*-x;B=s*-x;g=e*x;k=i*x;o=o*w;s*=w;e=y;i=z;m=A;q=B}t=b.rotationX;if(t){w=Math.cos(t);x=Math.sin(t);y=f*w+g*x;z=j*w+k*x;A=n*w+o*x;B=r*w+s*x;g=f*-x+g*w;k=j*-x+k*w;o=n*-x+o*w;s=r*-x+s*w;f=y;j=z;n=A;r=B}if(u){p-=u;h=g*p;l=k*p;p=o*p+u}h=(y=(h+=b.x)-(h|=0))?(y*v+(y<0?-.5:.5)|0)/v+h:h;l=(y=(l+=b.y)-(l|=0))?(y*v+(y<0?-.5:.5)|0)/v+l:l;p=(y=(p+=b.z)-(p|=0))?(y*v+(y<0?-.5:.5)|0)/v+p:p;c[vb]="matrix3d("+[(e*v|0)/v,(i*v|0)/v,(m*v|0)/v,(q*v|0)/v,(f*v|0)/v,(j*v|0)/v,(n*v|0)/v,(r*v|0)/v,(g*v|0)/v,(k*v|0)/v,(o*v|0)/v,(s*v|0)/v,h,l,p,d?1+-p/d:1].join(",")+")"},Cb=function(a){var b=this.data,c=this.t,d=c.style,e,f,g,h,i,j,k,l,m;if(L){e=d.top?"top":d.bottom?"bottom":parseFloat(V(c,"top",null,false))?"bottom":"top";f=V(c,e,null,false);g=parseFloat(f)||0;h=f.substr((g+"").length)||"px";b._ffFix=!b._ffFix;d[e]=(b._ffFix?g+.05:g-.05)+h}if(!b.rotation&&!b.skewX){d[vb]="matrix("+b.scaleX+",0,0,"+b.scaleY+","+b.x+","+b.y+")"}else{i=b.rotation;j=i-b.skewX;k=1e5;l=b.scaleX*k;m=b.scaleY*k;d[vb]="matrix("+(Math.cos(i)*l|0)/k+","+(Math.sin(i)*l|0)/k+","+(Math.sin(j)*-m|0)/k+","+(Math.cos(j)*m|0)/k+","+b.x+","+b.y+")"}};sb("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,transformPerspective,directionalRotation",{parser:function(a,b,c,d,e,g,h){if(d._transform){return e}var i=d._transform=zb(a,f,true),j=a.style,k=1e-6,l=ub.length,m=h,n={},o,p,q,r,s,t,u;if(typeof m.transform==="string"&&vb){q=j.cssText;j[vb]=m.transform;j.display="block";o=zb(a,null,false);j.cssText=q}else if(typeof m==="object"){o={scaleX:db(m.scaleX!=null?m.scaleX:m.scale,i.scaleX),scaleY:db(m.scaleY!=null?m.scaleY:m.scale,i.scaleY),scaleZ:db(m.scaleZ!=null?m.scaleZ:m.scale,i.scaleZ),x:db(m.x,i.x),y:db(m.y,i.y),z:db(m.z,i.z),perspective:db(m.transformPerspective,i.perspective)};u=m.directionalRotation;if(u!=null){if(typeof u==="object"){for(q in u){m[q]=u[q]}}else{m.rotation=u}}o.rotation=eb("rotation"in m?m.rotation:"shortRotation"in m?m.shortRotation+"_short":"rotationZ"in m?m.rotationZ:i.rotation*B,i.rotation,"rotation",n);if(yb){o.rotationX=eb("rotationX"in m?m.rotationX:"shortRotationX"in m?m.shortRotationX+"_short":i.rotationX*B||0,i.rotationX,"rotationX",n);o.rotationY=eb("rotationY"in m?m.rotationY:"shortRotationY"in m?m.shortRotationY+"_short":i.rotationY*B||0,i.rotationY,"rotationY",n)}o.skewX=m.skewX==null?i.skewX:eb(m.skewX,i.skewX);o.skewY=m.skewY==null?i.skewY:eb(m.skewY,i.skewY);if(p=o.skewY-i.skewY){o.skewX+=p;o.rotation+=p}}s=i.z||i.rotationX||i.rotationY||o.z||o.rotationX||o.rotationY||o.perspective;if(!s&&m.scale!=null){o.scaleZ=1}while(--l>-1){c=ub[l];r=o[c]-i[c];if(r>k||r<-k||C[c]!=null){t=true;e=new ob(i,c,i[c],r,e);if(c in n){e.e=n[c]}e.xs0=0;e.plugin=g;d._overwriteProps.push(e.n)}}r=m.transformOrigin;if(r||yb&&s&&i.zOrigin){if(vb){t=true;r=(r||V(a,c,f,false,"50% 50%"))+"";c=xb;e=new ob(j,c,0,0,e,-1,"css_transformOrigin");e.b=j[c];e.plugin=g;if(yb){q=i.zOrigin;r=r.split(" ");i.zOrigin=(r.length>2?parseFloat(r[2]):q)||0;e.xs0=e.e=j[c]=r[0]+" "+(r[1]||"50%")+" 0px";e=new ob(i,"zOrigin",0,0,e,-1,e.n);e.b=q;e.xs0=e.e=i.zOrigin}else{e.xs0=e.e=j[c]=r}}else{bb(r+"",i)}}if(t){d._transformType=s||this._transformType===3?3:2}return e},prefix:true});sb("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:true,color:true,multi:true,keyword:"inset"});sb("borderRadius",{defaultValue:"0px",parser:function(a,b,c,d,g,h){b=this.format(b);var i=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],j=a.style,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;s=parseFloat(a.offsetWidth);t=parseFloat(a.offsetHeight);k=b.split(" ");for(l=0;l<i.length;l++){if(this.p.indexOf("border")){i[l]=T(i[l])}o=n=V(a,i[l],f,false,"0px");if(o.indexOf(" ")!==-1){n=o.split(" ");o=n[0];n=n[1]}p=m=k[l];q=parseFloat(o);v=o.substr((q+"").length);w=p.charAt(1)==="=";if(w){r=parseInt(p.charAt(0)+"1",10);p=p.substr(2);r*=parseFloat(p);u=p.substr((r+"").length-(r<0?1:0))||""}else{r=parseFloat(p);u=p.substr((r+"").length)}if(u===""){u=e[c]||v}if(u!==v){x=W(a,"borderLeft",q,v);y=W(a,"borderTop",q,v);if(u==="%"){o=x/s*100+"%";n=y/t*100+"%"}else if(u==="em"){z=W(a,"borderLeft",1,"em");o=x/z+"em";n=y/z+"em"}else{o=x+"px";n=y+"px"}if(w){p=parseFloat(o)+r+u;m=parseFloat(n)+r+u}}g=pb(j,i[l],o+" "+n,p+" "+m,false,"0px",g)}return g},prefix:true,formatter:jb("0px 0px 0px 0px",false,true)});sb("backgroundPosition",{defaultValue:"0 0",parser:function(a,b,c,d,e,g){var h="background-position",i=f||U(a,null),j=this.format((i?N?i.getPropertyValue(h+"-x")+" "+i.getPropertyValue(h+"-y"):i.getPropertyValue(h):a.currentStyle.backgroundPositionX+" "+a.currentStyle.backgroundPositionY)||"0 0"),k=this.format(b),l,m,n,o,p,q;if(j.indexOf("%")!==-1!==(k.indexOf("%")!==-1)){q=V(a,"backgroundImage").replace(u,"");if(q&&q!=="none"){l=j.split(" ");m=k.split(" ");F.setAttribute("src",q);n=2;while(--n>-1){j=l[n];o=j.indexOf("%")!==-1;if(o!==(m[n].indexOf("%")!==-1)){p=n===0?a.offsetWidth-F.width:a.offsetHeight-F.height;l[n]=o?parseFloat(j)/100*p+"px":parseFloat(j)/p*100+"%"}}j=l.join(" ")}}return this.parseComplex(a.style,j,k,e,g)},formatter:bb});sb("backgroundSize",{defaultValue:"0 0",formatter:bb});sb("perspective",{defaultValue:"0px",prefix:true});sb("perspectiveOrigin",{defaultValue:"50% 50%",prefix:true});sb("transformStyle",{prefix:true});sb("backfaceVisibility",{prefix:true});sb("margin",{parser:kb("marginTop,marginRight,marginBottom,marginLeft")});sb("padding",{parser:kb("paddingTop,paddingRight,paddingBottom,paddingLeft")});sb("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(a,b,c,d,e,g){var h,i,j;if(N<9){i=a.currentStyle;j=N<8?" ":",";h="rect("+i.clipTop+j+i.clipRight+j+i.clipBottom+j+i.clipLeft+")";b=this.format(b).split(",").join(j)}else{h=this.format(V(a,this.p,f,false,this.dflt));b=this.format(b)}return this.parseComplex(a.style,h,b,e,g)}});sb("textShadow",{defaultValue:"0px 0px 0px #999",color:true,multi:true});sb("autoRound,strictUnits",{parser:function(a,b,c,d,e){return e}});sb("border",{defaultValue:"0px solid #000",parser:function(a,b,c,d,e,g){return this.parseComplex(a.style,this.format(V(a,"borderTopWidth",f,false,"0px")+" "+V(a,"borderTopStyle",f,false,"solid")+" "+V(a,"borderTopColor",f,false,"#000")),this.format(b),e,g)},color:true,formatter:function(a){var b=a.split(" ");return b[0]+" "+(b[1]||"solid")+" "+(a.match(ib)||["#000"])[0]}});sb("float,cssFloat,styleFloat",{parser:function(a,b,c,d,e,f){var g=a.style,h="cssFloat"in g?"cssFloat":"styleFloat";return new ob(g,h,0,0,e,-1,c,false,0,g[h],b)}});var Db=function(a){var b=this.t,c=b.filter,d=this.s+this.c*a|0,e;if(d===100){if(c.indexOf("atrix(")===-1&&c.indexOf("radient(")===-1){b.removeAttribute("filter");e=!V(this.data,"filter")}else{b.filter=c.replace(q,"");e=true}}if(!e){if(this.xn1){b.filter=c=c||"alpha(opacity=100)"}if(c.indexOf("opacity")===-1){b.filter+=" alpha(opacity="+d+")"}else{b.filter=c.replace(o,"opacity="+d)}}};sb("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(a,b,c,d,e,g){var h=parseFloat(V(a,"opacity",f,false,"1")),i=a.style,j;b=parseFloat(b);if(c==="autoAlpha"){j=V(a,"visibility",f);if(h===1&&j==="hidden"&&b!==0){h=0}e=new ob(i,"visibility",0,0,e,-1,null,false,0,h!==0?"visible":"hidden",b===0?"hidden":"visible");e.xs0="visible";d._overwriteProps.push(e.n)}if(O){e=new ob(i,"opacity",h,b-h,e)}else{e=new ob(i,"opacity",h*100,(b-h)*100,e);e.xn1=c==="autoAlpha"?1:0;i.zoom=1;e.type=2;e.b="alpha(opacity="+e.s+")";e.e="alpha(opacity="+(e.s+e.c)+")";e.data=a;e.plugin=g;e.setRatio=Db}return e}});var Eb=function(a,b){if(b){if(a.removeProperty){a.removeProperty(b.replace(s,"-$1").toLowerCase())}else{a.removeAttribute(b)}}},Fb=function(a){this.t._gsClassPT=this;if(a===1||a===0){this.t.className=a===0?this.b:this.e;var b=this.data,c=this.t.style;while(b){if(!b.v){Eb(c,b.p)}else{c[b.p]=b.v}b=b._next}if(a===1&&this.t._gsClassPT===this){this.t._gsClassPT=null}}else if(this.t.className!==this.e){this.t.className=this.e}};sb("className",{parser:function(a,b,c,e,g,h,i){var j=a.className,k=a.style.cssText,l,m,n,o,p;g=e._classNamePT=new ob(a,c,0,0,g,2);g.setRatio=Fb;g.pr=-11;d=true;g.b=j;m=Y(a,f);n=a._gsClassPT;if(n){o={};p=n.data;while(p){o[p.p]=1;p=p._next}n.setRatio(1)}a._gsClassPT=g;g.e=b.charAt(1)!=="="?b:j.replace(new RegExp("\\s*\\b"+b.substr(2)+"\\b"),"")+(b.charAt(0)==="+"?" "+b.substr(2):"");if(e._tween._duration){a.className=g.e;l=Z(a,m,Y(a),i,o);a.className=j;g.data=l.firstMPT;a.style.cssText=k;g=g.xfirst=e.parse(a,l.difs,g,h)}return g}});var Gb=function(a){if(a===1||a===0)if(this.data._totalTime===this.data._totalDuration){var b=this.e==="all",c=this.t.style,d=b?c.cssText.split(";"):this.e.split(","),e=d.length,f=h.transform.parse,g;while(--e>-1){g=d[e];if(b){g=g.substr(0,g.indexOf(":")).split(" ").join("")}if(h[g]){g=h[g].parse===f?vb:h[g].p}Eb(c,g)}}};sb("clearProps",{parser:function(a,b,c,e,f){f=new ob(a,c,0,0,f,2);f.setRatio=Gb;f.e=b;f.pr=-10;f.data=e._tween;d=true;return f}});i="bezier,throwProps,physicsProps,physics2D".split(",");qb=i.length;while(qb--){tb(i[qb])}i=c.prototype;i._firstPT=null;i._onInitTween=function(a,b,h){if(!a.nodeType){return false}this._target=a;this._tween=h;this._vars=b;I=b.autoRound;d=false;e=b.suffixMap||c.suffixMap;f=U(a,"");g=this._overwriteProps;var i=a.style,j,k,l,m,n,o,q,r,s;if(J)if(i.zIndex===""){j=V(a,"zIndex",f);if(j==="auto"||j===""){i.zIndex=0}}if(typeof b==="string"){m=i.cssText;j=Y(a,f);i.cssText=m+";"+b;j=Z(a,j,Y(a)).difs;if(!O&&p.test(b)){j.opacity=parseFloat(RegExp.$1)}b=j;i.cssText=m}this._firstPT=k=this.parse(a,b,null);if(this._transformType){s=this._transformType===3;if(!vb){i.zoom=1}else if(K){J=true;if(i.zIndex===""){q=V(a,"zIndex",f);if(q==="auto"||q===""){i.zIndex=0}}if(M){i.WebkitBackfaceVisibility=this._vars.WebkitBackfaceVisibility||(s?"visible":"hidden")}}l=k;while(l&&l._next){l=l._next}r=new ob(a,"transform",0,0,null,2);this._linkCSSP(r,null,l);r.setRatio=s&&yb?Bb:vb?Cb:Ab;r.data=this._transform||zb(a,f,true);g.pop()}if(d){while(k){o=k._next;l=m;while(l&&l.pr>k.pr){l=l._next}if(k._prev=l?l._prev:n){k._prev._next=k}else{m=k}if(k._next=l){l._prev=k}else{n=k}k=o}this._firstPT=m}return true};i.parse=function(a,b,c,d){var g=a.style,i,j,k,l,m,o,p,q,s,t;for(i in b){o=b[i];j=h[i];if(j){c=j.parse(a,o,i,this,c,d,b)}else{m=V(a,i,f)+"";s=typeof o==="string";if(i==="color"||i==="fill"||i==="stroke"||i.indexOf("Color")!==-1||s&&r.test(o)){if(!s){o=hb(o);o=(o.length>3?"rgba(":"rgb(")+o.join(",")+")"}c=pb(g,i,m,o,true,"transparent",c,0,d)}else if(s&&(o.indexOf(" ")!==-1||o.indexOf(",")!==-1)){c=pb(g,i,m,o,true,null,c,0,d)}else{k=parseFloat(m);p=k||k===0?m.substr((k+"").length):"";if(m===""||m==="auto"){if(i==="width"||i==="height"){k=ab(a,i,f);p="px"}else if(i==="left"||i==="top"){k=X(a,i,f);p="px"}else{k=i!=="opacity"?0:1;p=""}}t=s&&o.charAt(1)==="=";if(t){l=parseInt(o.charAt(0)+"1",10);o=o.substr(2);l*=parseFloat(o);q=o.replace(n,"")}else{l=parseFloat(o);q=s?o.substr((l+"").length)||"":""}if(q===""){q=e[i]||p}o=l||l===0?(t?l+k:l)+q:b[i];if(p!==q)if(q!=="")if(l||l===0)if(k||k===0){k=W(a,i,k,p);if(q==="%"){k/=W(a,i,100,"%")/100;if(k>100){k=100}if(b.strictUnits!==true){m=k+"%"}}else if(q==="em"){k/=W(a,i,1,"em")}else{l=W(a,i,l,q);q="px"}if(t)if(l||l===0){o=l+k+q}}if(t){l+=k}if((k||k===0)&&(l||l===0)){c=new ob(g,i,k,l-k,c,0,"css_"+i,I!==false&&(q==="px"||i==="zIndex"),0,m,o);c.xs0=q}else if(g[i]===undefined||!o&&(o+""==="NaN"||o==null)){Q("invalid "+i+" tween value: "+b[i])}else{c=new ob(g,i,l||k||0,0,c,-1,"css_"+i,false,0,m,o);c.xs0=o==="none"&&(i==="display"||i.indexOf("Style")!==-1)?m:o}}}if(d)if(c&&!c.plugin){c.plugin=d}}return c};i.setRatio=function(a){var b=this._firstPT,c=1e-6,d,e,f;if(a===1&&(this._tween._time===this._tween._duration||this._tween._time===0)){while(b){if(b.type!==2){b.t[b.p]=b.e}else{b.setRatio(a)}b=b._next}}else if(a||!(this._tween._time===this._tween._duration||this._tween._time===0)||this._tween._rawPrevTime===-1e-6){while(b){d=b.c*a+b.s;if(b.r){d=d>0?d+.5|0:d-.5|0}else if(d<c)if(d>-c){d=0}if(!b.type){b.t[b.p]=d+b.xs0}else if(b.type===1){f=b.l;if(f===2){b.t[b.p]=b.xs0+d+b.xs1+b.xn1+b.xs2}else if(f===3){b.t[b.p]=b.xs0+d+b.xs1+b.xn1+b.xs2+b.xn2+b.xs3}else if(f===4){b.t[b.p]=b.xs0+d+b.xs1+b.xn1+b.xs2+b.xn2+b.xs3+b.xn3+b.xs4}else if(f===5){b.t[b.p]=b.xs0+d+b.xs1+b.xn1+b.xs2+b.xn2+b.xs3+b.xn3+b.xs4+b.xn4+b.xs5}else{e=b.xs0+d+b.xs1;for(f=1;f<b.l;f++){e+=b["xn"+f]+b["xs"+(f+1)]}b.t[b.p]=e}}else if(b.type===-1){b.t[b.p]=b.xs0}else if(b.setRatio){b.setRatio(a)}b=b._next}}else{while(b){if(b.type!==2){b.t[b.p]=b.b}else{b.setRatio(a)}b=b._next}}};i._enableTransforms=function(a){this._transformType=a||this._transformType===3?3:2};i._linkCSSP=function(a,b,c,d){if(a){if(b){b._prev=a}if(a._next){a._next._prev=a._prev}if(c){c._next=a}else if(!d&&this._firstPT===null){this._firstPT=a}if(a._prev){a._prev._next=a._next}else if(this._firstPT===a){this._firstPT=a._next}a._next=b;a._prev=c}return a};i._kill=function(b){var c=b,d,e,f;if(b.css_autoAlpha||b.css_alpha){c={};for(e in b){c[e]=b[e]}c.css_opacity=1;if(c.css_autoAlpha){c.css_visibility=1}}if(b.css_className&&(d=this._classNamePT)){f=d.xfirst;if(f&&f._prev){this._linkCSSP(f._prev,d._next,f._prev._prev)}else if(f===this._firstPT){this._firstPT=d._next}if(d._next){this._linkCSSP(d._next,d._next._next,f._prev)}this._classNamePT=null}return a.prototype._kill.call(this,c)};var Hb=function(a,b,c){var d,e,f,g;if(a.slice){e=a.length;while(--e>-1){Hb(a[e],b,c)}return}d=a.childNodes;e=d.length;while(--e>-1){f=d[e];g=f.type;if(f.style){b.push(Y(f));if(c){c.push(f)}}if((g===1||g===9||g===11)&&f.childNodes.length){Hb(f,b,c)}}};c.cascadeTo=function(a,c,d){var e=b.to(a,c,d),f=[e],g=[],h=[],i=[],j=b._internals.reservedProps,k,l,m;a=e._targets||e.target;Hb(a,g,i);e.render(c,true);Hb(a,h);e.render(0,true);e._enabled(true);k=i.length;while(--k>-1){l=Z(i[k],g[k],h[k]);if(l.firstMPT){l=l.difs;for(m in d){if(j[m]){l[m]=d[m]}}f.push(b.to(i[k],c,l))}}return f};a.activate([c]);return c},true)});if(window._gsDefine){window._gsQueue.pop()()}var THREE=THREE||{REVISION:"58"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}};self.Int32Array=self.Int32Array||Array;self.Float32Array=self.Float32Array||Array;String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};THREE.extend=function(a,b){if(Object.keys){var c=Object.keys(b);for(var d=0,e=c.length;d<e;d++){var f=c[d];Object.defineProperty(a,f,Object.getOwnPropertyDescriptor(b,f))}}else{var g={}.hasOwnProperty;for(var f in b){if(g.call(b,f)){a[f]=b[f]}}}return a};!function(){var a=0;var b=["ms","moz","webkit","o"];for(var c=0;c<b.length&&!window.requestAnimationFrame;++c){window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"]}if(window.requestAnimationFrame===undefined){window.requestAnimationFrame=function(b){var c=Date.now(),d=Math.max(0,16-(c-a));var e=window.setTimeout(function(){b(c+d)},d);a=c+d;return e}}window.cancelAnimationFrame=window.cancelAnimationFrame||function(a){window.clearTimeout(a)}}();THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=function(){};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.RepeatWrapping=1e3;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.Color=function(a){if(a!==undefined)this.set(a);return this};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){if(a instanceof THREE.Color){this.copy(a)}else if(typeof a==="number"){this.setHex(a)}else if(typeof a==="string"){this.setStyle(a)}return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(a,b,c){if(b===0){this.r=this.g=this.b=c}else{var d=function(a,b,c){if(c<0)c+=1;if(c>1)c-=1;if(c<1/6)return a+(b-a)*6*c;if(c<1/2)return b;if(c<2/3)return a+(b-a)*6*(2/3-c);return a};var e=c<=.5?c*(1+b):c+b-c*b;var f=2*c-e;this.r=d(f,e,a+1/3);this.g=d(f,e,a);this.b=d(f,e,a-1/3)}return this},setStyle:function(a){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(a)){var b=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(a);this.r=Math.min(255,parseInt(b[1],10))/255;this.g=Math.min(255,parseInt(b[2],10))/255;this.b=Math.min(255,parseInt(b[3],10))/255;return this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(a)){var b=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(a);this.r=Math.min(100,parseInt(b[1],10))/100;this.g=Math.min(100,parseInt(b[2],10))/100;this.b=Math.min(100,parseInt(b[3],10))/100;return this}if(/^\#([0-9a-f]{6})$/i.test(a)){var b=/^\#([0-9a-f]{6})$/i.exec(a);this.setHex(parseInt(b[1],16));return this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a)){var b=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a);this.setHex(parseInt(b[1]+b[1]+b[2]+b[2]+b[3]+b[3],16));return this}if(/^(\w+)$/i.test(a)){this.setHex(THREE.ColorKeywords[a]);return this}},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a){this.r=a.r*a.r;this.g=a.g*a.g;this.b=a.b*a.b;return this},copyLinearToGamma:function(a){this.r=Math.sqrt(a.r);this.g=Math.sqrt(a.g);this.b=Math.sqrt(a.b);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(){var a={h:0,s:0,l:0};return function(){var b=this.r,c=this.g,d=this.b;var e=Math.max(b,c,d);var f=Math.min(b,c,d);var g,h;var i=(f+e)/2;if(f===e){g=0;h=0}else{var j=e-f;h=i<=.5?j/(e+f):j/(2-e-f);switch(e){case b:g=(c-d)/j+(c<d?6:0);break;case c:g=(d-b)/j+2;break;case d:g=(b-c)/j+4;break}g/=6}a.h=g;a.s=h;a.l=i;return a}}(),getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(a,b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)
}};THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=d!==undefined?d:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this},setFromEuler:function(a,b){var c=Math.cos(a.x/2);var d=Math.cos(a.y/2);var e=Math.cos(a.z/2);var f=Math.sin(a.x/2);var g=Math.sin(a.y/2);var h=Math.sin(a.z/2);if(b===undefined||b==="XYZ"){this.x=f*d*e+c*g*h;this.y=c*g*e-f*d*h;this.z=c*d*h+f*g*e;this.w=c*d*e-f*g*h}else if(b==="YXZ"){this.x=f*d*e+c*g*h;this.y=c*g*e-f*d*h;this.z=c*d*h-f*g*e;this.w=c*d*e+f*g*h}else if(b==="ZXY"){this.x=f*d*e-c*g*h;this.y=c*g*e+f*d*h;this.z=c*d*h+f*g*e;this.w=c*d*e-f*g*h}else if(b==="ZYX"){this.x=f*d*e-c*g*h;this.y=c*g*e+f*d*h;this.z=c*d*h-f*g*e;this.w=c*d*e+f*g*h}else if(b==="YZX"){this.x=f*d*e+c*g*h;this.y=c*g*e+f*d*h;this.z=c*d*h-f*g*e;this.w=c*d*e-f*g*h}else if(b==="XZY"){this.x=f*d*e-c*g*h;this.y=c*g*e-f*d*h;this.z=c*d*h+f*g*e;this.w=c*d*e+f*g*h}return this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);this.x=a.x*d;this.y=a.y*d;this.z=a.z*d;this.w=Math.cos(c);return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0],d=b[4],e=b[8],f=b[1],g=b[5],h=b[9],i=b[2],j=b[6],k=b[10],l=c+g+k,m;if(l>0){m=.5/Math.sqrt(l+1);this.w=.25/m;this.x=(j-h)*m;this.y=(e-i)*m;this.z=(f-d)*m}else if(c>g&&c>k){m=2*Math.sqrt(1+c-g-k);this.w=(j-h)/m;this.x=.25*m;this.y=(d+f)/m;this.z=(e+i)/m}else if(g>k){m=2*Math.sqrt(1+g-c-k);this.w=(e-i)/m;this.x=(d+f)/m;this.y=.25*m;this.z=(h+j)/m}else{m=2*Math.sqrt(1+k-c-g);this.w=(f-d)/m;this.x=(e+i)/m;this.y=(h+j)/m;this.z=.25*m}return this},inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var a=this.length();if(a===0){this.x=0;this.y=0;this.z=0;this.w=1}else{a=1/a;this.x=this.x*a;this.y=this.y*a;this.z=this.z*a;this.w=this.w*a}return this},multiply:function(a,b){if(b!==undefined){console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(a,b)}return this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a.x,d=a.y,e=a.z,f=a.w;var g=b.x,h=b.y,i=b.z,j=b.w;this.x=c*j+f*g+d*i-e*h;this.y=d*j+f*h+e*g-c*i;this.z=e*j+f*i+c*h-d*g;this.w=f*j-c*g-d*h-e*i;return this},multiplyVector3:function(a){console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return a.applyQuaternion(this)},slerp:function(a,b){var c=this.x,d=this.y,e=this.z,f=this.w;var g=f*a.w+c*a.x+d*a.y+e*a.z;if(g<0){this.w=-a.w;this.x=-a.x;this.y=-a.y;this.z=-a.z;g=-g}else{this.copy(a)}if(g>=1){this.w=f;this.x=c;this.y=d;this.z=e;return this}var h=Math.acos(g);var i=Math.sqrt(1-g*g);if(Math.abs(i)<.001){this.w=.5*(f+this.w);this.x=.5*(c+this.x);this.y=.5*(d+this.y);this.z=.5*(e+this.z);return this}var j=Math.sin((1-b)*h)/i,k=Math.sin(b*h)/i;this.w=f*j+this.w*k;this.x=c*j+this.x*k;this.y=d*j+this.y*k;this.z=e*j+this.z*k;return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a){this.x=a[0];this.y=a[1];this.z=a[2];this.w=a[3];return this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)}};THREE.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(a,b){this.x=a;this.y=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a)}},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(b!==undefined){console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(a,b)}this.x+=a.x;this.y+=a.y;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},sub:function(a,b){if(b!==undefined){console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(a,b)}this.x-=a.x;this.y-=a.y;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divideScalar:function(a){if(a!==0){this.x/=a;this.y/=a}else{this.set(0,0)}return this},min:function(a){if(this.x>a.x){this.x=a.x}if(this.y>a.y){this.y=a.y}return this},max:function(a){if(this.x<a.x){this.x=a.x}if(this.y<a.y){this.y=a.y}return this},clamp:function(a,b){if(this.x<a.x){this.x=a.x}else if(this.x>b.x){this.x=b.x}if(this.y<a.y){this.y=a.y}else if(this.y>b.y){this.y=b.y}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c},setLength:function(a){var b=this.length();if(b!==0&&a!==b){this.multiplyScalar(a/b)}return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a){this.x=a[0];this.y=a[1];return this},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(b!==undefined){console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(a,b)}this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},sub:function(a,b){if(b!==undefined){console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(a,b)}this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(b!==undefined){console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(a,b)}this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyMatrix3:function(a){var b=this.x;var c=this.y;var d=this.z;var e=a.elements;this.x=e[0]*b+e[3]*c+e[6]*d;this.y=e[1]*b+e[4]*c+e[7]*d;this.z=e[2]*b+e[5]*c+e[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;var e=a.elements;this.x=e[0]*b+e[4]*c+e[8]*d+e[12];this.y=e[1]*b+e[5]*c+e[9]*d+e[13];this.z=e[2]*b+e[6]*c+e[10]*d+e[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;var e=a.elements;var f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f;this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f;this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f;return this},applyQuaternion:function(a){var b=this.x;var c=this.y;var d=this.z;var e=a.x;var f=a.y;var g=a.z;var h=a.w;var i=h*b+f*d-g*c;var j=h*c+g*b-e*d;var k=h*d+e*c-f*b;var l=-e*b-f*c-g*d;this.x=i*h+l*-e+j*-g-k*-f;this.y=j*h+l*-f+k*-e-i*-g;this.z=k*h+l*-g+i*-f-j*-e;return this},transformDirection:function(a){var b=this.x,c=this.y,d=this.z;var e=a.elements;this.x=e[0]*b+e[4]*c+e[8]*d;this.y=e[1]*b+e[5]*c+e[9]*d;this.z=e[2]*b+e[6]*c+e[10]*d;this.normalize();return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){if(a!==0){this.x/=a;this.y/=a;this.z/=a}else{this.x=0;this.y=0;this.z=0}return this},min:function(a){if(this.x>a.x){this.x=a.x}if(this.y>a.y){this.y=a.y}if(this.z>a.z){this.z=a.z}return this},max:function(a){if(this.x<a.x){this.x=a.x}if(this.y<a.y){this.y=a.y}if(this.z<a.z){this.z=a.z}return this},clamp:function(a,b){if(this.x<a.x){this.x=a.x}else if(this.x>b.x){this.x=b.x}if(this.y<a.y){this.y=a.y}else if(this.y>b.y){this.y=b.y}if(this.z<a.z){this.z=a.z}else if(this.z>b.z){this.z=b.z}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();if(b!==0&&a!==b){this.multiplyScalar(a/b)}return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},cross:function(a,b){if(b!==undefined){console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(a,b)}var c=this.x,d=this.y,e=this.z;this.x=d*a.z-e*a.y;this.y=e*a.x-c*a.z;this.z=c*a.y-d*a.x;return this},crossVectors:function(a,b){this.x=a.y*b.z-a.z*b.y;this.y=a.z*b.x-a.x*b.z;this.z=a.x*b.y-a.y*b.x;return this},angleTo:function(a){var b=this.dot(a)/(this.length()*a.length());return Math.acos(THREE.Math.clamp(b,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;var c=this.y-a.y;var d=this.z-a.z;return b*b+c*c+d*d},setEulerFromRotationMatrix:function(a,b){function c(a){return Math.min(Math.max(a,-1),1)}var d=a.elements;var e=d[0],f=d[4],g=d[8];var h=d[1],i=d[5],j=d[9];var k=d[2],l=d[6],m=d[10];if(b===undefined||b==="XYZ"){this.y=Math.asin(c(g));if(Math.abs(g)<.99999){this.x=Math.atan2(-j,m);this.z=Math.atan2(-f,e)}else{this.x=Math.atan2(l,i);this.z=0}}else if(b==="YXZ"){this.x=Math.asin(-c(j));if(Math.abs(j)<.99999){this.y=Math.atan2(g,m);this.z=Math.atan2(h,i)}else{this.y=Math.atan2(-k,e);this.z=0}}else if(b==="ZXY"){this.x=Math.asin(c(l));if(Math.abs(l)<.99999){this.y=Math.atan2(-k,m);this.z=Math.atan2(-f,i)}else{this.y=0;this.z=Math.atan2(h,e)}}else if(b==="ZYX"){this.y=Math.asin(-c(k));if(Math.abs(k)<.99999){this.x=Math.atan2(l,m);this.z=Math.atan2(h,e)}else{this.x=0;this.z=Math.atan2(-f,i)}}else if(b==="YZX"){this.z=Math.asin(c(h));if(Math.abs(h)<.99999){this.x=Math.atan2(-j,i);this.y=Math.atan2(-k,e)}else{this.x=0;this.y=Math.atan2(g,m)}}else if(b==="XZY"){this.z=Math.asin(-c(f));if(Math.abs(f)<.99999){this.x=Math.atan2(l,i);this.y=Math.atan2(g,e)}else{this.x=Math.atan2(-j,m);this.y=0}}return this},setEulerFromQuaternion:function(a,b){function c(a){return Math.min(Math.max(a,-1),1)}var d=a.x*a.x;var e=a.y*a.y;var f=a.z*a.z;var g=a.w*a.w;if(b===undefined||b==="XYZ"){this.x=Math.atan2(2*(a.x*a.w-a.y*a.z),g-d-e+f);this.y=Math.asin(c(2*(a.x*a.z+a.y*a.w)));this.z=Math.atan2(2*(a.z*a.w-a.x*a.y),g+d-e-f)}else if(b==="YXZ"){this.x=Math.asin(c(2*(a.x*a.w-a.y*a.z)));this.y=Math.atan2(2*(a.x*a.z+a.y*a.w),g-d-e+f);this.z=Math.atan2(2*(a.x*a.y+a.z*a.w),g-d+e-f)}else if(b==="ZXY"){this.x=Math.asin(c(2*(a.x*a.w+a.y*a.z)));this.y=Math.atan2(2*(a.y*a.w-a.z*a.x),g-d-e+f);this.z=Math.atan2(2*(a.z*a.w-a.x*a.y),g-d+e-f)}else if(b==="ZYX"){this.x=Math.atan2(2*(a.x*a.w+a.z*a.y),g-d-e+f);this.y=Math.asin(c(2*(a.y*a.w-a.x*a.z)));this.z=Math.atan2(2*(a.x*a.y+a.z*a.w),g+d-e-f)}else if(b==="YZX"){this.x=Math.atan2(2*(a.x*a.w-a.z*a.y),g-d+e-f);this.y=Math.atan2(2*(a.y*a.w-a.x*a.z),g+d-e-f);this.z=Math.asin(c(2*(a.x*a.y+a.z*a.w)))}else if(b==="XZY"){this.x=Math.atan2(2*(a.x*a.w+a.y*a.z),g-d+e-f);this.y=Math.atan2(2*(a.x*a.z+a.y*a.w),g+d-e-f);this.z=Math.asin(c(2*(a.z*a.w-a.x*a.y)))}return this},getPositionFromMatrix:function(a){this.x=a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},getScaleFromMatrix:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length();var c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();var d=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=b;this.y=c;this.z=d;return this},getColumnFromMatrix:function(a,b){var c=a*4;var d=b.elements;this.x=d[c];this.y=d[c+1];this.z=d[c+2];return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a){this.x=a[0];this.y=a[1];this.z=a[2];return this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.extend(THREE.Vector3.prototype,{applyEuler:function(){var a=new THREE.Quaternion;return function(b,c){var d=a.setFromEuler(b,c);this.applyQuaternion(d);return this}}(),applyAxisAngle:function(){var a=new THREE.Quaternion;return function(b,c){var d=a.setFromAxisAngle(b,c);this.applyQuaternion(d);return this}}(),projectOnVector:function(){var a=new THREE.Vector3;return function(b){a.copy(b).normalize();var c=this.dot(a);return this.copy(a).multiplyScalar(c)}}(),projectOnPlane:function(){var a=new THREE.Vector3;return function(b){a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a=new THREE.Vector3;return function(b){a.copy(this).projectOnVector(b).multiplyScalar(2);return this.subVectors(a,this)}}()});THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=d!==undefined?d:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+a)}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w!==undefined?a.w:1;return this},add:function(a,b){if(b!==undefined){console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(a,b)}this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(a,b){if(b!==undefined){console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(a,b)}this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},applyMatrix4:function(a){var b=this.x;var c=this.y;var d=this.z;var e=this.w;var f=a.elements;this.x=f[0]*b+f[4]*c+f[8]*d+f[12]*e;this.y=f[1]*b+f[5]*c+f[9]*d+f[13]*e;this.z=f[2]*b+f[6]*c+f[10]*d+f[14]*e;this.w=f[3]*b+f[7]*c+f[11]*d+f[15]*e;return this},divideScalar:function(a){if(a!==0){this.x/=a;this.y/=a;this.z/=a;this.w/=a}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);if(b<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=a.x/b;this.y=a.y/b;this.z=a.z/b}return this},setAxisAngleFromRotationMatrix:function(a){var b,c,d,e,f=.01,g=.1,h=a.elements,i=h[0],j=h[4],k=h[8],l=h[1],m=h[5],n=h[9],o=h[2],p=h[6],q=h[10];if(Math.abs(j-l)<f&&Math.abs(k-o)<f&&Math.abs(n-p)<f){if(Math.abs(j+l)<g&&Math.abs(k+o)<g&&Math.abs(n+p)<g&&Math.abs(i+m+q-3)<g){this.set(1,0,0,0);return this}b=Math.PI;var r=(i+1)/2;var s=(m+1)/2;var t=(q+1)/2;var u=(j+l)/4;var v=(k+o)/4;var w=(n+p)/4;if(r>s&&r>t){if(r<f){c=0;d=.707106781;e=.707106781}else{c=Math.sqrt(r);d=u/c;e=v/c}}else if(s>t){if(s<f){c=.707106781;d=0;e=.707106781}else{d=Math.sqrt(s);c=u/d;e=w/d}}else{if(t<f){c=.707106781;d=.707106781;e=0}else{e=Math.sqrt(t);c=v/e;d=w/e}}this.set(c,d,e,b);return this}var x=Math.sqrt((p-n)*(p-n)+(k-o)*(k-o)+(l-j)*(l-j));if(Math.abs(x)<.001)x=1;this.x=(p-n)/x;this.y=(k-o)/x;this.z=(l-j)/x;this.w=Math.acos((i+m+q-1)/2);return this},min:function(a){if(this.x>a.x){this.x=a.x}if(this.y>a.y){this.y=a.y}if(this.z>a.z){this.z=a.z}if(this.w>a.w){this.w=a.w}return this},max:function(a){if(this.x<a.x){this.x=a.x}if(this.y<a.y){this.y=a.y}if(this.z<a.z){this.z=a.z}if(this.w<a.w){this.w=a.w}return this},clamp:function(a,b){if(this.x<a.x){this.x=a.x}else if(this.x>b.x){this.x=b.x}if(this.y<a.y){this.y=a.y}else if(this.y>b.y){this.y=b.y}if(this.z<a.z){this.z=a.z}else if(this.z>b.z){this.z=b.z}if(this.w<a.w){this.w=a.w}else if(this.w>b.w){this.w=b.w}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();if(b!==0&&a!==b){this.multiplyScalar(a/b)}return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a){this.x=a[0];this.y=a[1];this.z=a[2];this.w=a[3];return this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Line3=function(a,b){this.start=a!==undefined?a:new THREE.Vector3;this.end=b!==undefined?b:new THREE.Vector3};THREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){var b=a||new THREE.Vector3;return b.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){var b=a||new THREE.Vector3;return b.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,b){var c=b||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3;var b=new THREE.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);var e=b.dot(b);var f=b.dot(a);var g=f/e;if(d){g=THREE.Math.clamp(g,0,1)}return g}}(),closestPointToPoint:function(a,b,c){var d=this.closestPointToPointParameter(a,b);var e=c||new THREE.Vector3;return this.delta(e).multiplyScalar(d).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(a,b){this.min=a!==undefined?a:new THREE.Vector2(Infinity,Infinity);this.max=b!==undefined?b:new THREE.Vector2(-Infinity,-Infinity)};THREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){if(a.length>0){var b=a[0];this.min.copy(b);this.max.copy(b);for(var c=1,d=a.length;c<d;c++){b=a[c];if(b.x<this.min.x){this.min.x=b.x}else if(b.x>this.max.x){this.max.x=b.x}if(b.y<this.min.y){this.min.y=b.y}else if(b.y>this.max.y){this.max.y=b.y}}}else{this.makeEmpty()}return this},setFromCenterAndSize:function(){var a=new THREE.Vector2;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){var b=a||new THREE.Vector2;return b.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){var b=a||new THREE.Vector2;return b.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){if(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y){return false}return true},containsBox:function(a){if(this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y){return true}return false},getParameter:function(a){return new THREE.Vector2((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(a){if(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y){return false}return true},clampPoint:function(a,b){var c=b||new THREE.Vector2;return c.copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){var c=a.copy(b).clamp(this.min,this.max);return c.sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};THREE.Box3=function(a,b){this.min=a!==undefined?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=b!==undefined?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};THREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){if(a.length>0){var b=a[0];this.min.copy(b);this.max.copy(b);for(var c=1,d=a.length;c<d;c++){b=a[c];if(b.x<this.min.x){this.min.x=b.x}else if(b.x>this.max.x){this.max.x=b.x}if(b.y<this.min.y){this.min.y=b.y}else if(b.y>this.max.y){this.max.y=b.y}if(b.z<this.min.z){this.min.z=b.z}else if(b.z>this.max.z){this.max.z=b.z}}}else{this.makeEmpty()}return this},setFromCenterAndSize:function(){var a=new THREE.Vector3;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){var b=a||new THREE.Vector3;return b.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){var b=a||new THREE.Vector3;return b.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){if(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z){return false}return true},containsBox:function(a){if(this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z){return true}return false},getParameter:function(a){return new THREE.Vector3((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){if(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z){return false}return true},clampPoint:function(a,b){var c=b||new THREE.Vector3;return c.copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.copy(b).clamp(this.min,this.max);return c.sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){var c=b||new THREE.Sphere;c.center=this.center();c.radius=this.size(a).length()*.5;return c}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.makeEmpty();this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};THREE.Matrix3=function(a,b,c,d,e,f,g,h,i){this.elements=new Float32Array(9);this.set(a!==undefined?a:1,b||0,c||0,d||0,e!==undefined?e:1,f||0,g||0,h||0,i!==undefined?i:1)};THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,d,e,f,g,h,i){var j=this.elements;j[0]=a;j[3]=b;j[6]=c;j[1]=d;j[4]=e;j[7]=f;j[2]=g;j[5]=h;j[8]=i;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(a){var b=a.elements;this.set(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]);return this},multiplyVector3:function(a){console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},multiplyVector3Array:function(){var a=new THREE.Vector3;return function(b){for(var c=0,d=b.length;c<d;c+=3){a.x=b[c];a.y=b[c+1];a.z=b[c+2];a.applyMatrix3(this);b[c]=a.x;b[c+1]=a.y;b[c+2]=a.z}return b}}(),multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements;var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*f*j-b*g*i-c*e*j+c*g*h+d*e*i-d*f*h},getInverse:function(a,b){var c=a.elements;var d=this.elements;d[0]=c[10]*c[5]-c[6]*c[9];d[1]=-c[10]*c[1]+c[2]*c[9];d[2]=c[6]*c[1]-c[2]*c[5];d[3]=-c[10]*c[4]+c[6]*c[8];d[4]=c[10]*c[0]-c[2]*c[8];d[5]=-c[6]*c[0]+c[2]*c[4];d[6]=c[9]*c[4]-c[5]*c[8];d[7]=-c[9]*c[0]+c[1]*c[8];d[8]=c[5]*c[0]-c[1]*c[4];var e=c[0]*d[0]+c[1]*d[3]+c[2]*d[6];if(e===0){var f="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(b||false){throw new Error(f)}else{console.warn(f)}this.identity();return this}this.multiplyScalar(1/e);return this},transpose:function(){var a,b=this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this},getNormalMatrix:function(a){this.getInverse(a).transpose();return this},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},clone:function(){var a=this.elements;return new THREE.Matrix3(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8])}};THREE.Matrix4=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements=new Float32Array(16);q[0]=a!==undefined?a:1;q[4]=b||0;q[8]=c||0;q[12]=d||0;q[1]=e||0;q[5]=f!==undefined?f:1;q[9]=g||0;q[13]=h||0;q[2]=i||0;q[6]=j||0;q[10]=k!==undefined?k:1;q[14]=l||0;q[3]=m||0;q[7]=n||0;q[11]=o||0;q[15]=p!==undefined?p:1};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;q[0]=a;q[4]=b;q[8]=c;q[12]=d;q[1]=e;q[5]=f;q[9]=g;q[13]=h;q[2]=i;q[6]=j;q[10]=k;q[14]=l;q[3]=m;q[7]=n;
q[11]=o;q[15]=p;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){var b=a.elements;this.set(b[0],b[4],b[8],b[12],b[1],b[5],b[9],b[13],b[2],b[6],b[10],b[14],b[3],b[7],b[11],b[15]);return this},extractPosition:function(a){console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},copyPosition:function(a){var b=this.elements;var c=a.elements;b[12]=c[12];b[13]=c[13];b[14]=c[14];return this},extractRotation:function(){var a=new THREE.Vector3;return function(b){var c=this.elements;var d=b.elements;var e=1/a.set(d[0],d[1],d[2]).length();var f=1/a.set(d[4],d[5],d[6]).length();var g=1/a.set(d[8],d[9],d[10]).length();c[0]=d[0]*e;c[1]=d[1]*e;c[2]=d[2]*e;c[4]=d[4]*f;c[5]=d[5]*f;c[6]=d[6]*f;c[8]=d[8]*g;c[9]=d[9]*g;c[10]=d[10]*g;return this}}(),setRotationFromEuler:function(a,b){console.warn("DEPRECATED: Matrix4's .setRotationFromEuler() has been deprecated in favor of makeRotationFromEuler.  Please update your code.");return this.makeRotationFromEuler(a,b)},makeRotationFromEuler:function(a,b){var c=this.elements;var d=a.x,e=a.y,f=a.z;var g=Math.cos(d),h=Math.sin(d);var i=Math.cos(e),j=Math.sin(e);var k=Math.cos(f),l=Math.sin(f);if(b===undefined||b==="XYZ"){var m=g*k,n=g*l,o=h*k,p=h*l;c[0]=i*k;c[4]=-i*l;c[8]=j;c[1]=n+o*j;c[5]=m-p*j;c[9]=-h*i;c[2]=p-m*j;c[6]=o+n*j;c[10]=g*i}else if(b==="YXZ"){var q=i*k,r=i*l,s=j*k,t=j*l;c[0]=q+t*h;c[4]=s*h-r;c[8]=g*j;c[1]=g*l;c[5]=g*k;c[9]=-h;c[2]=r*h-s;c[6]=t+q*h;c[10]=g*i}else if(b==="ZXY"){var q=i*k,r=i*l,s=j*k,t=j*l;c[0]=q-t*h;c[4]=-g*l;c[8]=s+r*h;c[1]=r+s*h;c[5]=g*k;c[9]=t-q*h;c[2]=-g*j;c[6]=h;c[10]=g*i}else if(b==="ZYX"){var m=g*k,n=g*l,o=h*k,p=h*l;c[0]=i*k;c[4]=o*j-n;c[8]=m*j+p;c[1]=i*l;c[5]=p*j+m;c[9]=n*j-o;c[2]=-j;c[6]=h*i;c[10]=g*i}else if(b==="YZX"){var u=g*i,v=g*j,w=h*i,x=h*j;c[0]=i*k;c[4]=x-u*l;c[8]=w*l+v;c[1]=l;c[5]=g*k;c[9]=-h*k;c[2]=-j*k;c[6]=v*l+w;c[10]=u-x*l}else if(b==="XZY"){var u=g*i,v=g*j,w=h*i,x=h*j;c[0]=i*k;c[4]=-l;c[8]=j*k;c[1]=u*l+x;c[5]=g*k;c[9]=v*l-w;c[2]=w*l-v;c[6]=h*k;c[10]=x*l+u}c[3]=0;c[7]=0;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return this},setRotationFromQuaternion:function(a){console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code.");return this.makeRotationFromQuaternion(a)},makeRotationFromQuaternion:function(a){var b=this.elements;var c=a.x,d=a.y,e=a.z,f=a.w;var g=c+c,h=d+d,i=e+e;var j=c*g,k=c*h,l=c*i;var m=d*h,n=d*i,o=e*i;var p=f*g,q=f*h,r=f*i;b[0]=1-(m+o);b[4]=k-r;b[8]=l+q;b[1]=k+r;b[5]=1-(j+o);b[9]=n-p;b[2]=l-q;b[6]=n+p;b[10]=1-(j+m);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a=new THREE.Vector3;var b=new THREE.Vector3;var c=new THREE.Vector3;return function(d,e,f){var g=this.elements;c.subVectors(d,e).normalize();if(c.length()===0){c.z=1}a.crossVectors(f,c).normalize();if(a.length()===0){c.x+=1e-4;a.crossVectors(f,c).normalize()}b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;g[6]=b.z;g[10]=c.z;return this}}(),multiply:function(a,b){if(b!==undefined){console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(a,b)}return this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements;var d=b.elements;var e=this.elements;var f=c[0],g=c[4],h=c[8],i=c[12];var j=c[1],k=c[5],l=c[9],m=c[13];var n=c[2],o=c[6],p=c[10],q=c[14];var r=c[3],s=c[7],t=c[11],u=c[15];var v=d[0],w=d[4],x=d[8],y=d[12];var z=d[1],A=d[5],B=d[9],C=d[13];var D=d[2],E=d[6],F=d[10],G=d[14];var H=d[3],I=d[7],J=d[11],K=d[15];e[0]=f*v+g*z+h*D+i*H;e[4]=f*w+g*A+h*E+i*I;e[8]=f*x+g*B+h*F+i*J;e[12]=f*y+g*C+h*G+i*K;e[1]=j*v+k*z+l*D+m*H;e[5]=j*w+k*A+l*E+m*I;e[9]=j*x+k*B+l*F+m*J;e[13]=j*y+k*C+l*G+m*K;e[2]=n*v+o*z+p*D+q*H;e[6]=n*w+o*A+p*E+q*I;e[10]=n*x+o*B+p*F+q*J;e[14]=n*y+o*C+p*G+q*K;e[3]=r*v+s*z+t*D+u*H;e[7]=r*w+s*A+t*E+u*I;e[11]=r*x+s*B+t*F+u*J;e[15]=r*y+s*C+t*G+u*K;return this},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},multiplyVector3:function(a){console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(){var a=new THREE.Vector3;return function(b){for(var c=0,d=b.length;c<d;c+=3){a.x=b[c];a.y=b[c+1];a.z=b[c+2];a.applyProjection(this);b[c]=a.x;b[c+1]=a.y;b[c+2]=a.z}return b}}(),rotateAxis:function(a){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},determinant:function(){var a=this.elements;var b=a[0],c=a[4],d=a[8],e=a[12];var f=a[1],g=a[5],h=a[9],i=a[13];var j=a[2],k=a[6],l=a[10],m=a[14];var n=a[3],o=a[7],p=a[11],q=a[15];return n*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+o*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+p*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+q*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)},transpose:function(){var a=this.elements;var b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a},getPosition:function(){var a=new THREE.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var b=this.elements;return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements;var d=a.elements;var e=d[0],f=d[4],g=d[8],h=d[12];var i=d[1],j=d[5],k=d[9],l=d[13];var m=d[2],n=d[6],o=d[10],p=d[14];var q=d[3],r=d[7],s=d[11],t=d[15];c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*t+j*o*t;c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*t-f*o*t;c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*t+f*k*t;c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p;c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*t-i*o*t;c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*t+e*o*t;c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*t-e*k*t;c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p;c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*t+i*n*t;c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*t-e*n*t;c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*t+e*j*t;c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p;c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s;c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s;c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s;c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o;var u=d[0]*c[0]+d[1]*c[4]+d[2]*c[8]+d[3]*c[12];if(u==0){var v="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b||false){throw new Error(v)}else{console.warn(v)}this.identity();return this}this.multiplyScalar(1/u);return this},translate:function(a){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(a){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(a){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(a){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(a,b){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(a){var b=this.elements;var c=a.x,d=a.y,e=a.z;b[0]*=c;b[4]*=d;b[8]*=e;b[1]*=c;b[5]*=d;b[9]*=e;b[2]*=c;b[6]*=d;b[10]*=e;b[3]*=c;b[7]*=d;b[11]*=e;return this},getMaxScaleOnAxis:function(){var a=this.elements;var b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];var c=a[4]*a[4]+a[5]*a[5]+a[6]*a[6];var d=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(b,Math.max(c,d)))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a),c=Math.sin(a);this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a),c=Math.sin(a);this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a),c=Math.sin(a);this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b);var d=Math.sin(b);var e=1-c;var f=a.x,g=a.y,h=a.z;var i=e*f,j=e*g;this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){console.warn("DEPRECATED: Matrix4's .compose() has been deprecated in favor of makeFromPositionQuaternionScale. Please update your code.");return this.makeFromPositionQuaternionScale(a,b,c)},makeFromPositionQuaternionScale:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},makeFromPositionEulerScale:function(a,b,c,d){this.makeRotationFromEuler(b,c);this.scale(d);this.setPosition(a);return this},makeFrustum:function(a,b,c,d,e,f){var g=this.elements;var h=2*e/(b-a);var i=2*e/(d-c);var j=(b+a)/(b-a);var k=(d+c)/(d-c);var l=-(f+e)/(f-e);var m=-2*f*e/(f-e);g[0]=h;g[4]=0;g[8]=j;g[12]=0;g[1]=0;g[5]=i;g[9]=k;g[13]=0;g[2]=0;g[6]=0;g[10]=l;g[14]=m;g[3]=0;g[7]=0;g[11]=-1;g[15]=0;return this},makePerspective:function(a,b,c,d){var e=c*Math.tan(THREE.Math.degToRad(a*.5));var f=-e;var g=f*b;var h=e*b;return this.makeFrustum(g,h,f,e,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements;var h=b-a;var i=c-d;var j=f-e;var k=(b+a)/h;var l=(c+d)/i;var m=(f+e)/j;g[0]=2/h;g[4]=0;g[8]=0;g[12]=-k;g[1]=0;g[5]=2/i;g[9]=0;g[13]=-l;g[2]=0;g[6]=0;g[10]=-2/j;g[14]=-m;g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},clone:function(){var a=this.elements;return new THREE.Matrix4(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])}};THREE.extend(THREE.Matrix4.prototype,{decompose:function(){var a=new THREE.Vector3;var b=new THREE.Vector3;var c=new THREE.Vector3;var d=new THREE.Matrix4;return function(e,f,g){var h=this.elements;a.set(h[0],h[1],h[2]);b.set(h[4],h[5],h[6]);c.set(h[8],h[9],h[10]);e=e instanceof THREE.Vector3?e:new THREE.Vector3;f=f instanceof THREE.Quaternion?f:new THREE.Quaternion;g=g instanceof THREE.Vector3?g:new THREE.Vector3;g.x=a.length();g.y=b.length();g.z=c.length();e.x=h[12];e.y=h[13];e.z=h[14];d.copy(this);d.elements[0]/=g.x;d.elements[1]/=g.x;d.elements[2]/=g.x;d.elements[4]/=g.y;d.elements[5]/=g.y;d.elements[6]/=g.y;d.elements[8]/=g.z;d.elements[9]/=g.z;d.elements[10]/=g.z;f.setFromRotationMatrix(d);return[e,f,g]}}()});THREE.Ray=function(a,b){this.origin=a!==undefined?a:new THREE.Vector3;this.direction=b!==undefined?b:new THREE.Vector3};THREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){var c=b||new THREE.Vector3;return c.copy(this.direction).multiplyScalar(a).add(this.origin)},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){var c=b||new THREE.Vector3;c.subVectors(a,this.origin);var d=c.dot(this.direction);return c.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceTo(b)}}(),isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},isIntersectionPlane:function(a){var b=a.normal.dot(this.direction);if(b!=0){return true}if(a.distanceToPoint(this.origin)==0){return true}return false},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(b==0){if(a.distanceToPoint(this.origin)==0){return 0}return undefined}var c=-(this.origin.dot(a.normal)+a.constant)/b;return c},intersectPlane:function(a,b){var c=this.distanceToPlane(a);if(c===undefined){return undefined}return this.at(c,b)},applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}};THREE.Sphere=function(a,b){this.center=a!==undefined?a:new THREE.Vector3;this.radius=b!==undefined?b:0};THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromCenterAndPoints:function(a,b){var c=0;for(var d=0,e=b.length;d<e;d++){var f=a.distanceToSquared(b[d]);c=Math.max(c,f)}this.center=a;this.radius=Math.sqrt(c);return this},copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return this.radius<=0},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},clampPoint:function(a,b){var c=this.center.distanceToSquared(a);var d=b||new THREE.Vector3;d.copy(a);if(c>this.radius*this.radius){d.sub(this.center).normalize();d.multiplyScalar(this.radius).add(this.center)}return d},getBoundingBox:function(a){var b=a||new THREE.Box3;b.set(this.center,this.center);b.expandByScalar(this.radius);return b},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius=this.radius*a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};THREE.Frustum=function(a,b,c,d,e,f){this.planes=[a!==undefined?a:new THREE.Plane,b!==undefined?b:new THREE.Plane,c!==undefined?c:new THREE.Plane,d!==undefined?d:new THREE.Plane,e!==undefined?e:new THREE.Plane,f!==undefined?f:new THREE.Plane]};THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(a,b,c,d,e,f){var g=this.planes;g[0].copy(a);g[1].copy(b);g[2].copy(c);g[3].copy(d);g[4].copy(e);g[5].copy(f);return this},copy:function(a){var b=this.planes;for(var c=0;c<6;c++){b[c].copy(a.planes[c])}return this},setFromMatrix:function(a){var b=this.planes;var c=a.elements;var d=c[0],e=c[1],f=c[2],g=c[3];var h=c[4],i=c[5],j=c[6],k=c[7];var l=c[8],m=c[9],n=c[10],o=c[11];var p=c[12],q=c[13],r=c[14],s=c[15];b[0].setComponents(g-d,k-h,o-l,s-p).normalize();b[1].setComponents(g+d,k+h,o+l,s+p).normalize();b[2].setComponents(g+e,k+i,o+m,s+q).normalize();b[3].setComponents(g-e,k-i,o-m,s-q).normalize();b[4].setComponents(g-f,k-j,o-n,s-r).normalize();b[5].setComponents(g+f,k+j,o+n,s+r).normalize();return this},intersectsObject:function(){var a=new THREE.Vector3;return function(b){var c=b.matrixWorld;var d=this.planes;var e=-b.geometry.boundingSphere.radius*c.getMaxScaleOnAxis();a.getPositionFromMatrix(c);for(var f=0;f<6;f++){var g=d[f].distanceToPoint(a);if(g<e){return false}}return true}}(),intersectsSphere:function(a){var b=this.planes;var c=a.center;var d=-a.radius;for(var e=0;e<6;e++){var f=b[e].distanceToPoint(c);if(f<d){return false}}return true},containsPoint:function(a){var b=this.planes;for(var c=0;c<6;c++){if(b[c].distanceToPoint(a)<0){return false}}return true},clone:function(){return(new THREE.Frustum).copy(this)}};THREE.Plane=function(a,b){this.normal=a!==undefined?a:new THREE.Vector3(1,0,0);this.constant=b!==undefined?b:0};THREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3;var b=new THREE.Vector3;return function(c,d,e){var f=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(f,c);return this}}(),copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var c=this.distanceToPoint(a);var d=b||new THREE.Vector3;return d.copy(this.normal).multiplyScalar(c)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start);var c=this.distanceToPoint(a.end);return b<0&&c>0||c<0&&b>0},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){var d=c||new THREE.Vector3;var e=b.delta(a);var f=this.normal.dot(e);if(f==0){if(this.distanceToPoint(b.start)==0){return d.copy(b.start)}return undefined}var g=-(b.start.dot(this.normal)+this.constant)/f;if(g<0||g>1){return undefined}return d.copy(e).multiplyScalar(g).add(b.start)}}(),coplanarPoint:function(a){var b=a||new THREE.Vector3;return b.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new THREE.Vector3;var b=new THREE.Vector3;return function(c,d){d=d||(new THREE.Matrix3).getNormalMatrix(c);var e=a.copy(this.normal).applyMatrix3(d);var f=this.coplanarPoint(b);f.applyMatrix4(c);this.setFromNormalAndCoplanarPoint(e,f);return this}}(),translate:function(a){this.constant=this.constant-a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};THREE.Math={clamp:function(a,b,c){return a<b?b:a>c?c:a},clampBottom:function(a,b){return a<b?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(a*6-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},sign:function(a){return a<0?-1:a>0?1:0},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=180/Math.PI;return function(b){return b*a}}()};THREE.Spline=function(a){this.points=a;var b=[],c={x:0,y:0,z:0},d,e,f,g,h,i,j,k,l;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++){this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}}};this.getPoint=function(a){d=(this.points.length-1)*a;e=Math.floor(d);f=d-e;b[0]=e===0?e:e-1;b[1]=e;b[2]=e>this.points.length-2?this.points.length-1:e+1;b[3]=e>this.points.length-3?this.points.length-1:e+2;i=this.points[b[0]];j=this.points[b[1]];k=this.points[b[2]];l=this.points[b[3]];g=f*f;h=f*g;c.x=m(i.x,j.x,k.x,l.x,f,g,h);c.y=m(i.y,j.y,k.y,l.y,f,g,h);c.z=m(i.z,j.z,k.z,l.z,f,g,h);return c};this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++){b=this.points[a];d[a]=[b.x,b.y,b.z]}return d};this.getLength=function(a){var b,c,d,e,f=0,g=0,h=0,i=new THREE.Vector3,j=new THREE.Vector3,k=[],l=0;k[0]=0;if(!a)a=100;d=this.points.length*a;i.copy(this.points[0]);for(b=1;b<d;b++){c=b/d;e=this.getPoint(c);j.copy(e);l+=j.distanceTo(i);i.copy(e);f=(this.points.length-1)*c;g=Math.floor(f);if(g!=h){k[g]=l;h=g}}k[k.length]=l;return{chunks:k,total:l}};this.reparametrizeByArcLength=function(a){var b,c,d,e,f,g,h,i,j,k=[],l=new THREE.Vector3,m=this.getLength();k.push(l.copy(this.points[0]).clone());for(b=1;b<this.points.length;b++){h=m.chunks[b]-m.chunks[b-1];i=Math.ceil(a*h/m.total);e=(b-1)/(this.points.length-1);f=b/(this.points.length-1);for(c=1;c<i-1;c++){d=e+c*(1/i)*(f-e);j=this.getPoint(d);k.push(l.copy(j).clone())}k.push(l.copy(this.points[b]).clone())}this.points=k};function m(a,b,c,d,e,f,g){var h=(c-a)*.5,i=(d-b)*.5;return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b}};THREE.Triangle=function(a,b,c){this.a=a!==undefined?a:new THREE.Vector3;this.b=b!==undefined?b:new THREE.Vector3;this.c=c!==undefined?c:new THREE.Vector3};THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(b,c,d,e){var f=e||new THREE.Vector3;f.subVectors(d,c);a.subVectors(b,c);f.cross(a);var g=f.lengthSq();if(g>0){return f.multiplyScalar(1/Math.sqrt(g))}return f.set(0,0,0)}}();THREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3;var b=new THREE.Vector3;var c=new THREE.Vector3;return function(d,e,f,g,h){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);var i=a.dot(a);var j=a.dot(b);var k=a.dot(c);var l=b.dot(b);var m=b.dot(c);var n=i*l-j*j;var o=h||new THREE.Vector3;if(n==0){return o.set(-2,-1,-1)}var p=1/n;var q=(l*k-j*m)*p;var r=(i*m-j*k)*p;return o.set(1-q-r,r,q)}}();THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(b,c,d,e){var f=THREE.Triangle.barycoordFromPoint(b,c,d,e,a);return f.x>=0&&f.y>=0&&f.x+f.y<=1}}();THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3;var b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return a.cross(b).length()*.5}}(),midpoint:function(a){var b=a||new THREE.Vector3;return b.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){var b=a||new THREE.Plane;return b.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Vertex=function(a){console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.");return a};THREE.UV=function(a,b){console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead.");return new THREE.Vector2(a,b)};THREE.Clock=function(a){this.autoStart=a!==undefined?a:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now();this.oldTime=this.startTime;this.running=true},stop:function(){this.getElapsedTime();this.running=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var b=window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now();a=.001*(b-this.oldTime);this.oldTime=b;this.elapsedTime+=a}return a}};THREE.EventDispatcher=function(){};THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,addEventListener:function(a,b){if(this._listeners===undefined)this._listeners={};var c=this._listeners;if(c[a]===undefined){c[a]=[]}if(c[a].indexOf(b)===-1){c[a].push(b)}},hasEventListener:function(a,b){if(this._listeners===undefined)return false;var c=this._listeners;if(c[a]!==undefined&&c[a].indexOf(b)!==-1){return true}return false},removeEventListener:function(a,b){if(this._listeners===undefined)return;var c=this._listeners;var d=c[a].indexOf(b);if(d!==-1){c[a].splice(d,1)}},dispatchEvent:function(a){if(this._listeners===undefined)return;var b=this._listeners;var c=b[a.type];if(c!==undefined){a.target=this;for(var d=0,e=c.length;d<e;d++){c[d].call(this,a)}}}};!function(a){a.Raycaster=function(b,c,d,e){this.ray=new a.Ray(b,c);if(this.ray.direction.lengthSq()>0){this.ray.direction.normalize()}this.near=d||0;this.far=e||Infinity};var b=new a.Sphere;var c=new a.Ray;var d=new a.Plane;var e=new a.Vector3;var f=new a.Vector3;var g=new a.Matrix4;var h=function(a,b){return a.distance-b.distance};var i=function(h,j,k){if(h instanceof a.Particle){f.getPositionFromMatrix(h.matrixWorld);var l=j.ray.distanceToPoint(f);if(l>h.scale.x){return k}k.push({distance:l,point:h.position,face:null,object:h})}else if(h instanceof a.LOD){f.getPositionFromMatrix(h.matrixWorld);var l=j.ray.origin.distanceTo(f);i(h.getObjectForDistance(l),j,k)}else if(h instanceof a.Mesh){f.getPositionFromMatrix(h.matrixWorld);b.set(f,h.geometry.boundingSphere.radius*h.matrixWorld.getMaxScaleOnAxis());if(!j.ray.isIntersectionSphere(b)){return k}var m=h.geometry;var n=m.vertices;var o=h.material instanceof a.MeshFaceMaterial;var p=o===true?h.material.materials:null;var q=h.material.side;var r,s,t,u;var v=j.precision;g.getInverse(h.matrixWorld);c.copy(j.ray).applyMatrix4(g);for(var w=0,x=m.faces.length;w<x;w++){var y=m.faces[w];var z=o===true?p[y.materialIndex]:h.material;if(z===undefined)continue;d.setFromNormalAndCoplanarPoint(y.normal,n[y.a]);var A=c.distanceToPlane(d);if(Math.abs(A)<v)continue;if(A<0)continue;q=z.side;if(q!==a.DoubleSide){var B=c.direction.dot(d.normal);if(!(q===a.FrontSide?B<0:B>0))continue}if(A<j.near||A>j.far)continue;e=c.at(A,e);if(y instanceof a.Face3){r=n[y.a];s=n[y.b];t=n[y.c];if(!a.Triangle.containsPoint(e,r,s,t))continue}else if(y instanceof a.Face4){r=n[y.a];s=n[y.b];t=n[y.c];u=n[y.d];if(!a.Triangle.containsPoint(e,r,s,u)&&!a.Triangle.containsPoint(e,s,t,u))continue}else{throw Error("face type not supported")}k.push({distance:A,point:j.ray.at(A),face:y,faceIndex:w,object:h})}}};var j=function(a,b,c){var d=a.getDescendants();for(var e=0,f=d.length;e<f;e++){i(d[e],b,c)}};a.Raycaster.prototype.precision=1e-4;a.Raycaster.prototype.set=function(a,b){this.ray.set(a,b);if(this.ray.direction.length()>0){this.ray.direction.normalize()}};a.Raycaster.prototype.intersectObject=function(a,b){var c=[];if(b===true){j(a,this,c)}i(a,this,c);c.sort(h);return c};a.Raycaster.prototype.intersectObjects=function(a,b){var c=[];for(var d=0,e=a.length;d<e;d++){i(a[d],this,c);if(b===true){j(a[d],this,c)}}c.sort(h);return c}}(THREE);THREE.Object3D=function(){this.id=THREE.Object3DIdCount++;this.name="";this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.eulerOrder=THREE.Object3D.defaultEulerOrder;this.scale=new THREE.Vector3(1,1,1);this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=true;this.quaternion=new THREE.Quaternion;this.useQuaternion=false;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.userData={}};THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(){var a=new THREE.Matrix4;return function(b){this.matrix.multiplyMatrices(b,this.matrix);this.position.getPositionFromMatrix(this.matrix);this.scale.getScaleFromMatrix(this.matrix);a.extractRotation(this.matrix);if(this.useQuaternion===true){this.quaternion.setFromRotationMatrix(a)}else{this.rotation.setEulerFromRotationMatrix(a,this.eulerOrder)}}}(),rotateOnAxis:function(){var a=new THREE.Quaternion;var b=new THREE.Quaternion;return function(c,d){a.setFromAxisAngle(c,d);if(this.useQuaternion===true){this.quaternion.multiply(a)}else{b.setFromEuler(this.rotation,this.eulerOrder);b.multiply(a);this.rotation.setEulerFromQuaternion(b,this.eulerOrder)}return this}}(),translateOnAxis:function(){var a=new THREE.Vector3;return function(b,c){a.copy(b);if(this.useQuaternion===true){a.applyQuaternion(this.quaternion)}else{a.applyEuler(this.rotation,this.eulerOrder)}this.position.add(a.multiplyScalar(c));return this}}(),translate:function(a,b){console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed.");return this.translateOnAxis(b,a)},translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new THREE.Matrix4;return function(b){a.lookAt(b,this.position,this.up);if(this.useQuaternion===true){this.quaternion.setFromRotationMatrix(a)}else{this.rotation.setEulerFromRotationMatrix(a,this.eulerOrder)}}}(),add:function(a){if(a===this){console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");return}if(a instanceof THREE.Object3D){if(a.parent!==undefined){a.parent.remove(a)}a.parent=this;this.children.push(a);var b=this;while(b.parent!==undefined){b=b.parent}if(b!==undefined&&b instanceof THREE.Scene){b.__addObject(a)}}},remove:function(a){var b=this.children.indexOf(a);if(b!==-1){a.parent=undefined;this.children.splice(b,1);var c=this;while(c.parent!==undefined){c=c.parent}if(c!==undefined&&c instanceof THREE.Scene){c.__removeObject(a)}}},traverse:function(a){a(this);for(var b=0,c=this.children.length;b<c;b++){this.children[b].traverse(a)}},getObjectById:function(a,b){for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c];if(e.id===a){return e}if(b===true){e=e.getObjectById(a,b);if(e!==undefined){return e}}}return undefined},getObjectByName:function(a,b){for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c];if(e.name===a){return e}if(b===true){e=e.getObjectByName(a,b);if(e!==undefined){return e}}}return undefined},getChildByName:function(a,b){console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a,b)},getDescendants:function(a){if(a===undefined)a=[];Array.prototype.push.apply(a,this.children);for(var b=0,c=this.children.length;b<c;b++){this.children[b].getDescendants(a)}return a},updateMatrix:function(){if(this.useQuaternion===false){this.matrix.makeFromPositionEulerScale(this.position,this.rotation,this.eulerOrder,this.scale)}else{this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale)}this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(a){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||a===true){if(this.parent===undefined){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;
a=true}for(var b=0,c=this.children.length;b<c;b++){this.children[b].updateMatrixWorld(a)}},clone:function(a){if(a===undefined)a=new THREE.Object3D;a.name=this.name;a.up.copy(this.up);a.position.copy(this.position);if(a.rotation instanceof THREE.Vector3)a.rotation.copy(this.rotation);a.eulerOrder=this.eulerOrder;a.scale.copy(this.scale);a.renderDepth=this.renderDepth;a.rotationAutoUpdate=this.rotationAutoUpdate;a.matrix.copy(this.matrix);a.matrixWorld.copy(this.matrixWorld);a.matrixAutoUpdate=this.matrixAutoUpdate;a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;a.quaternion.copy(this.quaternion);a.useQuaternion=this.useQuaternion;a.visible=this.visible;a.castShadow=this.castShadow;a.receiveShadow=this.receiveShadow;a.frustumCulled=this.frustumCulled;a.userData=JSON.parse(JSON.stringify(this.userData));for(var b=0;b<this.children.length;b++){var c=this.children[b];a.add(c.clone())}return a}};THREE.Object3D.defaultEulerOrder="XYZ",THREE.Object3DIdCount=0;THREE.Projector=function(){var a,b,c=[],d=0,e,f,g=[],h=0,i,j,k=[],l=0,m,n=[],o=0,p,q,r=[],s=0,t,u,v=[],w=0,x={objects:[],sprites:[],lights:[],elements:[]},y=new THREE.Vector3,z=new THREE.Vector4,A=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),B=new THREE.Box3,C=new Array(3),D=new Array(4),E=new THREE.Matrix4,F=new THREE.Matrix4,G,H=new THREE.Matrix4,I=new THREE.Matrix3,J=new THREE.Matrix3,K=new THREE.Vector3,L=new THREE.Frustum,M=new THREE.Vector4,N=new THREE.Vector4;this.projectVector=function(a,b){b.matrixWorldInverse.getInverse(b.matrixWorld);F.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);return a.applyProjection(F)};this.unprojectVector=function(a,b){b.projectionMatrixInverse.getInverse(b.projectionMatrix);F.multiplyMatrices(b.matrixWorld,b.projectionMatrixInverse);return a.applyProjection(F)};this.pickingRay=function(a,b){a.z=-1;var c=new THREE.Vector3(a.x,a.y,1);this.unprojectVector(a,b);this.unprojectVector(c,b);c.sub(a).normalize();return new THREE.Raycaster(a,c)};var O=function(c,d){b=0;x.objects.length=0;x.sprites.length=0;x.lights.length=0;var e=function(b){for(var c=0,d=b.children.length;c<d;c++){var f=b.children[c];if(f.visible===false)continue;if(f instanceof THREE.Light){x.lights.push(f)}else if(f instanceof THREE.Mesh||f instanceof THREE.Line){if(f.frustumCulled===false||L.intersectsObject(f)===true){a=P();a.object=f;if(f.renderDepth!==null){a.z=f.renderDepth}else{y.getPositionFromMatrix(f.matrixWorld);y.applyProjection(F);a.z=y.z}x.objects.push(a)}}else if(f instanceof THREE.Sprite||f instanceof THREE.Particle){a=P();a.object=f;if(f.renderDepth!==null){a.z=f.renderDepth}else{y.getPositionFromMatrix(f.matrixWorld);y.applyProjection(F);a.z=y.z}x.sprites.push(a)}else{a=P();a.object=f;if(f.renderDepth!==null){a.z=f.renderDepth}else{y.getPositionFromMatrix(f.matrixWorld);y.applyProjection(F);a.z=y.z}x.objects.push(a)}e(f)}};e(c);if(d===true)x.objects.sort(V);return x};this.projectScene=function(a,b,c,d){var h=false,k,l,n,o,r,s,v,w,y,P,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb;j=0;m=0;q=0;u=0;x.elements.length=0;if(a.autoUpdate===true)a.updateMatrixWorld();if(b.parent===undefined)b.updateMatrixWorld();E.copy(b.matrixWorldInverse.getInverse(b.matrixWorld));F.multiplyMatrices(b.projectionMatrix,E);J.getNormalMatrix(E);L.setFromMatrix(F);x=O(a,c);for(k=0,l=x.objects.length;k<l;k++){Z=x.objects[k].object;G=Z.matrixWorld;f=0;if(Z instanceof THREE.Mesh){$=Z.geometry;_=$.vertices;ab=$.faces;db=$.faceVertexUvs;I.getNormalMatrix(G);jb=Z.material instanceof THREE.MeshFaceMaterial;kb=jb===true?Z.material:null;for(n=0,o=_.length;n<o;n++){e=Q();e.positionWorld.copy(_[n]).applyMatrix4(G);e.positionScreen.copy(e.positionWorld).applyMatrix4(F);e.positionScreen.x/=e.positionScreen.w;e.positionScreen.y/=e.positionScreen.w;e.positionScreen.z/=e.positionScreen.w;e.visible=!(e.positionScreen.x<-1||e.positionScreen.x>1||e.positionScreen.y<-1||e.positionScreen.y>1||e.positionScreen.z<-1||e.positionScreen.z>1)}for(r=0,s=ab.length;r<s;r++){bb=ab[r];var lb=jb===true?kb.materials[bb.materialIndex]:Z.material;if(lb===undefined)continue;var mb=lb.side;if(bb instanceof THREE.Face3){fb=g[bb.a];gb=g[bb.b];hb=g[bb.c];C[0]=fb.positionScreen;C[1]=gb.positionScreen;C[2]=hb.positionScreen;if(fb.visible===true||gb.visible===true||hb.visible===true||A.isIntersectionBox(B.setFromPoints(C))){h=(hb.positionScreen.x-fb.positionScreen.x)*(gb.positionScreen.y-fb.positionScreen.y)-(hb.positionScreen.y-fb.positionScreen.y)*(gb.positionScreen.x-fb.positionScreen.x)<0;if(mb===THREE.DoubleSide||h===(mb===THREE.FrontSide)){i=R();i.v1.copy(fb);i.v2.copy(gb);i.v3.copy(hb)}else{continue}}else{continue}}else if(bb instanceof THREE.Face4){fb=g[bb.a];gb=g[bb.b];hb=g[bb.c];ib=g[bb.d];D[0]=fb.positionScreen;D[1]=gb.positionScreen;D[2]=hb.positionScreen;D[3]=ib.positionScreen;if(fb.visible===true||gb.visible===true||hb.visible===true||ib.visible===true||A.isIntersectionBox(B.setFromPoints(D))){h=(ib.positionScreen.x-fb.positionScreen.x)*(gb.positionScreen.y-fb.positionScreen.y)-(ib.positionScreen.y-fb.positionScreen.y)*(gb.positionScreen.x-fb.positionScreen.x)<0||(gb.positionScreen.x-hb.positionScreen.x)*(ib.positionScreen.y-hb.positionScreen.y)-(gb.positionScreen.y-hb.positionScreen.y)*(ib.positionScreen.x-hb.positionScreen.x)<0;if(mb===THREE.DoubleSide||h===(mb===THREE.FrontSide)){i=S();i.v1.copy(fb);i.v2.copy(gb);i.v3.copy(hb);i.v4.copy(ib)}else{continue}}else{continue}}i.normalModel.copy(bb.normal);if(h===false&&(mb===THREE.BackSide||mb===THREE.DoubleSide)){i.normalModel.negate()}i.normalModel.applyMatrix3(I).normalize();i.normalModelView.copy(i.normalModel).applyMatrix3(J);i.centroidModel.copy(bb.centroid).applyMatrix4(G);cb=bb.vertexNormals;for(v=0,w=cb.length;v<w;v++){var nb=i.vertexNormalsModel[v];nb.copy(cb[v]);if(h===false&&(mb===THREE.BackSide||mb===THREE.DoubleSide)){nb.negate()}nb.applyMatrix3(I).normalize();var ob=i.vertexNormalsModelView[v];ob.copy(nb).applyMatrix3(J)}i.vertexNormalsLength=cb.length;for(y=0,P=db.length;y<P;y++){eb=db[y][r];if(eb===undefined)continue;for(X=0,Y=eb.length;X<Y;X++){i.uvs[y][X]=eb[X]}}i.color=bb.color;i.material=lb;K.copy(i.centroidModel).applyProjection(F);i.z=K.z;x.elements.push(i)}}else if(Z instanceof THREE.Line){H.multiplyMatrices(F,G);_=Z.geometry.vertices;fb=Q();fb.positionScreen.copy(_[0]).applyMatrix4(H);var pb=Z.type===THREE.LinePieces?2:1;for(n=1,o=_.length;n<o;n++){fb=Q();fb.positionScreen.copy(_[n]).applyMatrix4(H);if((n+1)%pb>0)continue;gb=g[f-2];M.copy(fb.positionScreen);N.copy(gb.positionScreen);if(W(M,N)===true){M.multiplyScalar(1/M.w);N.multiplyScalar(1/N.w);p=T();p.v1.positionScreen.copy(M);p.v2.positionScreen.copy(N);p.z=Math.max(M.z,N.z);p.material=Z.material;if(Z.material.vertexColors===THREE.VertexColors){p.vertexColors[0].copy(Z.geometry.colors[n]);p.vertexColors[1].copy(Z.geometry.colors[n-1])}x.elements.push(p)}}}}for(k=0,l=x.sprites.length;k<l;k++){Z=x.sprites[k].object;G=Z.matrixWorld;if(Z instanceof THREE.Particle){z.set(G.elements[12],G.elements[13],G.elements[14],1);z.applyMatrix4(F);z.z/=z.w;if(z.z>0&&z.z<1){t=U();t.object=Z;t.x=z.x/z.w;t.y=z.y/z.w;t.z=z.z;t.rotation=Z.rotation.z;t.scale.x=Z.scale.x*Math.abs(t.x-(z.x+b.projectionMatrix.elements[0])/(z.w+b.projectionMatrix.elements[12]));t.scale.y=Z.scale.y*Math.abs(t.y-(z.y+b.projectionMatrix.elements[5])/(z.w+b.projectionMatrix.elements[13]));t.material=Z.material;x.elements.push(t)}}}if(d===true)x.elements.sort(V);return x};function P(){if(b===d){var a=new THREE.RenderableObject;c.push(a);d++;b++;return a}return c[b++]}function Q(){if(f===h){var a=new THREE.RenderableVertex;g.push(a);h++;f++;return a}return g[f++]}function R(){if(j===l){var a=new THREE.RenderableFace3;k.push(a);l++;j++;return a}return k[j++]}function S(){if(m===o){var a=new THREE.RenderableFace4;n.push(a);o++;m++;return a}return n[m++]}function T(){if(q===s){var a=new THREE.RenderableLine;r.push(a);s++;q++;return a}return r[q++]}function U(){if(u===w){var a=new THREE.RenderableParticle;v.push(a);w++;u++;return a}return v[u++]}function V(a,b){return b.z-a.z}function W(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;if(e>=0&&f>=0&&g>=0&&h>=0){return true}else if(e<0&&f<0||g<0&&h<0){return false}else{if(e<0){c=Math.max(c,e/(e-f))}else if(f<0){d=Math.min(d,e/(e-f))}if(g<0){c=Math.max(c,g/(g-h))}else if(h<0){d=Math.min(d,g/(g-h))}if(d<c){return false}else{a.lerp(b,c);b.lerp(a,1-d);return true}}}};THREE.Face3=function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=e instanceof THREE.Color?e:new THREE.Color;this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=f!==undefined?f:0;this.centroid=new THREE.Vector3};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var a=new THREE.Face3(this.a,this.b,this.c);a.normal.copy(this.normal);a.color.copy(this.color);a.centroid.copy(this.centroid);a.materialIndex=this.materialIndex;var b,c;for(b=0,c=this.vertexNormals.length;b<c;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();for(b=0,c=this.vertexColors.length;b<c;b++)a.vertexColors[b]=this.vertexColors[b].clone();for(b=0,c=this.vertexTangents.length;b<c;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}};THREE.Face4=function(a,b,c,d,e,f,g){this.a=a;this.b=b;this.c=c;this.d=d;this.normal=e instanceof THREE.Vector3?e:new THREE.Vector3;this.vertexNormals=e instanceof Array?e:[];this.color=f instanceof THREE.Color?f:new THREE.Color;this.vertexColors=f instanceof Array?f:[];this.vertexTangents=[];this.materialIndex=g!==undefined?g:0;this.centroid=new THREE.Vector3};THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var a=new THREE.Face4(this.a,this.b,this.c,this.d);a.normal.copy(this.normal);a.color.copy(this.color);a.centroid.copy(this.centroid);a.materialIndex=this.materialIndex;var b,c;for(b=0,c=this.vertexNormals.length;b<c;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();for(b=0,c=this.vertexColors.length;b<c;b++)a.vertexColors[b]=this.vertexColors[b].clone();for(b=0,c=this.vertexTangents.length;b<c;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}};THREE.Geometry=function(){this.id=THREE.GeometryIdCount++;this.name="";this.vertices=[];this.colors=[];this.normals=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=true;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.tangentsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.buffersNeedUpdate=false};THREE.Geometry.prototype={constructor:THREE.Geometry,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,applyMatrix:function(a){var b=(new THREE.Matrix3).getNormalMatrix(a);for(var c=0,d=this.vertices.length;c<d;c++){var e=this.vertices[c];e.applyMatrix4(a)}for(var c=0,d=this.faces.length;c<d;c++){var f=this.faces[c];f.normal.applyMatrix3(b).normalize();for(var g=0,h=f.vertexNormals.length;g<h;g++){f.vertexNormals[g].applyMatrix3(b).normalize()}f.centroid.applyMatrix4(a)}},computeCentroids:function(){var a,b,c;for(a=0,b=this.faces.length;a<b;a++){c=this.faces[a];c.centroid.set(0,0,0);if(c instanceof THREE.Face3){c.centroid.add(this.vertices[c.a]);c.centroid.add(this.vertices[c.b]);c.centroid.add(this.vertices[c.c]);c.centroid.divideScalar(3)}else if(c instanceof THREE.Face4){c.centroid.add(this.vertices[c.a]);c.centroid.add(this.vertices[c.b]);c.centroid.add(this.vertices[c.c]);c.centroid.add(this.vertices[c.d]);c.centroid.divideScalar(4)}}},computeFaceNormals:function(){var a=new THREE.Vector3,b=new THREE.Vector3;for(var c=0,d=this.faces.length;c<d;c++){var e=this.faces[c];var f=this.vertices[e.a];var g=this.vertices[e.b];var h=this.vertices[e.c];a.subVectors(h,g);b.subVectors(f,g);a.cross(b);a.normalize();e.normal.copy(a)}},computeVertexNormals:function(a){var b,c,d,e,f,g;if(this.__tmpVertices===undefined){this.__tmpVertices=new Array(this.vertices.length);g=this.__tmpVertices;for(b=0,c=this.vertices.length;b<c;b++){g[b]=new THREE.Vector3}for(d=0,e=this.faces.length;d<e;d++){f=this.faces[d];if(f instanceof THREE.Face3){f.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}else if(f instanceof THREE.Face4){f.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}}else{g=this.__tmpVertices;for(b=0,c=this.vertices.length;b<c;b++){g[b].set(0,0,0)}}if(a){var h,i,j,k;var l=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,p=new THREE.Vector3;for(d=0,e=this.faces.length;d<e;d++){f=this.faces[d];if(f instanceof THREE.Face3){h=this.vertices[f.a];i=this.vertices[f.b];j=this.vertices[f.c];l.subVectors(j,i);m.subVectors(h,i);l.cross(m);g[f.a].add(l);g[f.b].add(l);g[f.c].add(l)}else if(f instanceof THREE.Face4){h=this.vertices[f.a];i=this.vertices[f.b];j=this.vertices[f.c];k=this.vertices[f.d];n.subVectors(k,i);m.subVectors(h,i);n.cross(m);g[f.a].add(n);g[f.b].add(n);g[f.d].add(n);o.subVectors(k,j);p.subVectors(i,j);o.cross(p);g[f.b].add(o);g[f.c].add(o);g[f.d].add(o)}}}else{for(d=0,e=this.faces.length;d<e;d++){f=this.faces[d];if(f instanceof THREE.Face3){g[f.a].add(f.normal);g[f.b].add(f.normal);g[f.c].add(f.normal)}else if(f instanceof THREE.Face4){g[f.a].add(f.normal);g[f.b].add(f.normal);g[f.c].add(f.normal);g[f.d].add(f.normal)}}}for(b=0,c=this.vertices.length;b<c;b++){g[b].normalize()}for(d=0,e=this.faces.length;d<e;d++){f=this.faces[d];if(f instanceof THREE.Face3){f.vertexNormals[0].copy(g[f.a]);f.vertexNormals[1].copy(g[f.b]);f.vertexNormals[2].copy(g[f.c])}else if(f instanceof THREE.Face4){f.vertexNormals[0].copy(g[f.a]);f.vertexNormals[1].copy(g[f.b]);f.vertexNormals[2].copy(g[f.c]);f.vertexNormals[3].copy(g[f.d])}}},computeMorphNormals:function(){var a,b,c,d,e;for(c=0,d=this.faces.length;c<d;c++){e=this.faces[c];if(!e.__originalFaceNormal){e.__originalFaceNormal=e.normal.clone()}else{e.__originalFaceNormal.copy(e.normal)}if(!e.__originalVertexNormals)e.__originalVertexNormals=[];for(a=0,b=e.vertexNormals.length;a<b;a++){if(!e.__originalVertexNormals[a]){e.__originalVertexNormals[a]=e.vertexNormals[a].clone()}else{e.__originalVertexNormals[a].copy(e.vertexNormals[a])}}}var f=new THREE.Geometry;f.faces=this.faces;for(a=0,b=this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=[];var g=this.morphNormals[a].faceNormals;var h=this.morphNormals[a].vertexNormals;var i,j;for(c=0,d=this.faces.length;c<d;c++){e=this.faces[c];i=new THREE.Vector3;if(e instanceof THREE.Face3){j={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3}}else{j={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3}}g.push(i);h.push(j)}}var k=this.morphNormals[a];f.vertices=this.morphTargets[a].vertices;f.computeFaceNormals();f.computeVertexNormals();var i,j;for(c=0,d=this.faces.length;c<d;c++){e=this.faces[c];i=k.faceNormals[c];j=k.vertexNormals[c];i.copy(e.normal);if(e instanceof THREE.Face3){j.a.copy(e.vertexNormals[0]);j.b.copy(e.vertexNormals[1]);j.c.copy(e.vertexNormals[2])}else{j.a.copy(e.vertexNormals[0]);j.b.copy(e.vertexNormals[1]);j.c.copy(e.vertexNormals[2]);j.d.copy(e.vertexNormals[3])}}}for(c=0,d=this.faces.length;c<d;c++){e=this.faces[c];e.normal=e.__originalFaceNormal;e.vertexNormals=e.__originalVertexNormals}},computeTangents:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=[],D=[],E=new THREE.Vector3,F=new THREE.Vector3,G=new THREE.Vector3,H=new THREE.Vector3,I=new THREE.Vector3,J;for(c=0,d=this.vertices.length;c<d;c++){C[c]=new THREE.Vector3;D[c]=new THREE.Vector3}function K(a,b,c,d,e,f,g){j=a.vertices[b];k=a.vertices[c];l=a.vertices[d];m=i[e];n=i[f];o=i[g];p=k.x-j.x;q=l.x-j.x;r=k.y-j.y;s=l.y-j.y;t=k.z-j.z;u=l.z-j.z;v=n.x-m.x;w=o.x-m.x;x=n.y-m.y;y=o.y-m.y;z=1/(v*y-w*x);E.set((y*p-x*q)*z,(y*r-x*s)*z,(y*t-x*u)*z);F.set((v*q-w*p)*z,(v*s-w*r)*z,(v*u-w*t)*z);C[b].add(E);C[c].add(E);C[d].add(E);D[b].add(F);D[c].add(F);D[d].add(F)}for(a=0,b=this.faces.length;a<b;a++){h=this.faces[a];i=this.faceVertexUvs[0][a];if(h instanceof THREE.Face3){K(this,h.a,h.b,h.c,0,1,2)}else if(h instanceof THREE.Face4){K(this,h.a,h.b,h.d,0,1,3);K(this,h.b,h.c,h.d,1,2,3)}}var L=["a","b","c","d"];for(a=0,b=this.faces.length;a<b;a++){h=this.faces[a];for(e=0;e<h.vertexNormals.length;e++){I.copy(h.vertexNormals[e]);g=h[L[e]];A=C[g];G.copy(A);G.sub(I.multiplyScalar(I.dot(A))).normalize();H.crossVectors(h.vertexNormals[e],A);B=H.dot(D[g]);J=B<0?-1:1;h.vertexTangents[e]=new THREE.Vector4(G.x,G.y,G.z,J)}}this.hasTangents=true},computeLineDistances:function(){var a=0;var b=this.vertices;for(var c=0,d=b.length;c<d;c++){if(c>0){a+=b[c].distanceTo(b[c-1])}this.lineDistances[c]=a}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},mergeVertices:function(){var a={};var b=[],c=[];var d,e;var f=4;var g=Math.pow(10,f);var h,i,j;var k,l,m,n,o;this.__tmpVertices=undefined;for(h=0,i=this.vertices.length;h<i;h++){d=this.vertices[h];e=[Math.round(d.x*g),Math.round(d.y*g),Math.round(d.z*g)].join("_");if(a[e]===undefined){a[e]=h;b.push(this.vertices[h]);c[h]=b.length-1}else{c[h]=c[a[e]]}}var p=[];for(h=0,i=this.faces.length;h<i;h++){j=this.faces[h];if(j instanceof THREE.Face3){j.a=c[j.a];j.b=c[j.b];j.c=c[j.c];k=[j.a,j.b,j.c];var q=-1;for(var r=0;r<3;r++){if(k[r]==k[(r+1)%3]){q=r;p.push(h);break}}}else if(j instanceof THREE.Face4){j.a=c[j.a];j.b=c[j.b];j.c=c[j.c];j.d=c[j.d];k=[j.a,j.b,j.c,j.d];var q=-1;for(var r=0;r<4;r++){if(k[r]==k[(r+1)%4]){if(q>=0){p.push(h)}q=r}}if(q>=0){k.splice(q,1);var s=new THREE.Face3(k[0],k[1],k[2],j.normal,j.color,j.materialIndex);for(m=0,n=this.faceVertexUvs.length;m<n;m++){o=this.faceVertexUvs[m][h];if(o){o.splice(q,1)}}if(j.vertexNormals&&j.vertexNormals.length>0){s.vertexNormals=j.vertexNormals;s.vertexNormals.splice(q,1)}if(j.vertexColors&&j.vertexColors.length>0){s.vertexColors=j.vertexColors;s.vertexColors.splice(q,1)}this.faces[h]=s}}}for(h=p.length-1;h>=0;h--){this.faces.splice(h,1);for(m=0,n=this.faceVertexUvs.length;m<n;m++){this.faceVertexUvs[m].splice(h,1)}}var t=this.vertices.length-b.length;this.vertices=b;return t},clone:function(){var a=new THREE.Geometry;var b=this.vertices;for(var c=0,d=b.length;c<d;c++){a.vertices.push(b[c].clone())}var e=this.faces;for(var c=0,d=e.length;c<d;c++){a.faces.push(e[c].clone())}var f=this.faceVertexUvs[0];for(var c=0,d=f.length;c<d;c++){var g=f[c],h=[];for(var i=0,j=g.length;i<j;i++){h.push(new THREE.Vector2(g[i].x,g[i].y))}a.faceVertexUvs[0].push(h)}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.GeometryIdCount=0;THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++;this.attributes={};this.dynamic=false;this.offsets=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.morphTargets=[]};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,applyMatrix:function(a){var b;var c;if(this.attributes["position"])b=this.attributes["position"].array;if(this.attributes["normal"])c=this.attributes["normal"].array;if(b!==undefined){a.multiplyVector3Array(b);this.verticesNeedUpdate=true}if(c!==undefined){var d=(new THREE.Matrix3).getNormalMatrix(a);d.multiplyVector3Array(c);this.normalizeNormals();this.normalsNeedUpdate=true}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}var a=this.attributes["position"].array;if(a){var b=this.boundingBox;var c,d,e;if(a.length>=3){b.min.x=b.max.x=a[0];b.min.y=b.max.y=a[1];b.min.z=b.max.z=a[2]}for(var f=3,g=a.length;f<g;f+=3){c=a[f];d=a[f+1];e=a[f+2];if(c<b.min.x){b.min.x=c}else if(c>b.max.x){b.max.x=c}if(d<b.min.y){b.min.y=d}else if(d>b.max.y){b.max.y=d}if(e<b.min.z){b.min.z=e}else if(e>b.max.z){b.max.z=e}}}if(a===undefined||a.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}var a=this.attributes["position"].array;if(a){var b,c=0;var d,e,f;for(var g=0,h=a.length;g<h;g+=3){d=a[g];e=a[g+1];f=a[g+2];b=d*d+e*e+f*f;if(b>c)c=b}this.boundingSphere.radius=Math.sqrt(c)}},computeVertexNormals:function(){if(this.attributes["position"]){var a,b;var c,d;var e=this.attributes["position"].array.length;if(this.attributes["normal"]===undefined){this.attributes["normal"]={itemSize:3,array:new Float32Array(e),numItems:e}}else{for(a=0,b=this.attributes["normal"].array.length;a<b;a++){this.attributes["normal"].array[a]=0}}var f=this.attributes["position"].array;var g=this.attributes["normal"].array;var h,i,j,k,l,m,n=new THREE.Vector3,o=new THREE.Vector3,p=new THREE.Vector3,q=new THREE.Vector3,r=new THREE.Vector3;if(this.attributes["index"]){var s=this.attributes["index"].array;var t=this.offsets;for(c=0,d=t.length;c<d;++c){var u=t[c].start;var v=t[c].count;var w=t[c].index;for(a=u,b=u+v;a<b;a+=3){h=w+s[a];i=w+s[a+1];j=w+s[a+2];k=f[h*3];l=f[h*3+1];m=f[h*3+2];n.set(k,l,m);k=f[i*3];l=f[i*3+1];m=f[i*3+2];o.set(k,l,m);k=f[j*3];l=f[j*3+1];m=f[j*3+2];p.set(k,l,m);q.subVectors(p,o);r.subVectors(n,o);q.cross(r);g[h*3]+=q.x;g[h*3+1]+=q.y;g[h*3+2]+=q.z;g[i*3]+=q.x;g[i*3+1]+=q.y;g[i*3+2]+=q.z;g[j*3]+=q.x;g[j*3+1]+=q.y;g[j*3+2]+=q.z}}}else{for(a=0,b=f.length;a<b;a+=9){k=f[a];l=f[a+1];m=f[a+2];n.set(k,l,m);k=f[a+3];l=f[a+4];m=f[a+5];o.set(k,l,m);k=f[a+6];l=f[a+7];m=f[a+8];p.set(k,l,m);q.subVectors(p,o);r.subVectors(n,o);q.cross(r);g[a]=q.x;g[a+1]=q.y;g[a+2]=q.z;g[a+3]=q.x;g[a+4]=q.y;g[a+5]=q.z;g[a+6]=q.x;g[a+7]=q.y;g[a+8]=q.z}}this.normalizeNormals();this.normalsNeedUpdate=true}},normalizeNormals:function(){var a=this.attributes["normal"].array;var b,c,d,e;for(var f=0,g=a.length;f<g;f+=3){b=a[f];c=a[f+1];d=a[f+2];e=1/Math.sqrt(b*b+c*c+d*d);a[f]*=e;a[f+1]*=e;a[f+2]*=e}},computeTangents:function(){if(this.attributes["index"]===undefined||this.attributes["position"]===undefined||this.attributes["normal"]===undefined||this.attributes["uv"]===undefined){console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var a=this.attributes["index"].array;var b=this.attributes["position"].array;var c=this.attributes["normal"].array;var d=this.attributes["uv"].array;var e=b.length/3;if(this.attributes["tangent"]===undefined){var f=4*e;this.attributes["tangent"]={itemSize:4,array:new Float32Array(f),numItems:f}}var g=this.attributes["tangent"].array;var h=[],i=[];for(var j=0;j<e;j++){h[j]=new THREE.Vector3;i[j]=new THREE.Vector3}var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;var K=new THREE.Vector3,L=new THREE.Vector3;function M(a,c,e){k=b[a*3];l=b[a*3+1];m=b[a*3+2];n=b[c*3];o=b[c*3+1];p=b[c*3+2];q=b[e*3];r=b[e*3+1];s=b[e*3+2];t=d[a*2];u=d[a*2+1];v=d[c*2];w=d[c*2+1];x=d[e*2];y=d[e*2+1];z=n-k;A=q-k;B=o-l;C=r-l;D=p-m;E=s-m;F=v-t;G=x-t;H=w-u;I=y-u;J=1/(F*I-G*H);K.set((I*z-H*A)*J,(I*B-H*C)*J,(I*D-H*E)*J);L.set((F*A-G*z)*J,(F*C-G*B)*J,(F*E-G*D)*J);h[a].add(K);h[c].add(K);h[e].add(K);i[a].add(L);i[c].add(L);i[e].add(L)}var N,O;var P,Q;var R,S,T;var U=this.offsets;for(P=0,Q=U.length;P<Q;++P){var V=U[P].start;var W=U[P].count;var X=U[P].index;for(N=V,O=V+W;N<O;N+=3){R=X+a[N];S=X+a[N+1];T=X+a[N+2];M(R,S,T)}}var Y=new THREE.Vector3,Z=new THREE.Vector3;var $=new THREE.Vector3,_=new THREE.Vector3;var ab,bb,cb;function db(a){$.x=c[a*3];$.y=c[a*3+1];$.z=c[a*3+2];_.copy($);bb=h[a];Y.copy(bb);Y.sub($.multiplyScalar($.dot(bb))).normalize();Z.crossVectors(_,bb);cb=Z.dot(i[a]);ab=cb<0?-1:1;g[a*4]=Y.x;g[a*4+1]=Y.y;g[a*4+2]=Y.z;g[a*4+3]=ab}for(P=0,Q=U.length;P<Q;++P){var V=U[P].start;var W=U[P].count;var X=U[P].index;for(N=V,O=V+W;N<O;N+=3){R=X+a[N];S=X+a[N+1];T=X+a[N+2];db(R);db(S);db(T)}}this.hasTangents=true;this.tangentsNeedUpdate=true},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4;this.projectionMatrixInverse=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4;return function(b){a.lookAt(this.position,b,this.up);if(this.useQuaternion===true){this.quaternion.setFromRotationMatrix(a)}else{this.rotation.setEulerFromRotationMatrix(a,this.eulerOrder)}}}();THREE.OrthographicCamera=function(a,b,c,d,e,f){THREE.Camera.call(this);this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=e!==undefined?e:.1;this.far=f!==undefined?f:2e3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)};THREE.PerspectiveCamera=function(a,b,c,d){THREE.Camera.call(this);this.fov=a!==undefined?a:50;this.aspect=b!==undefined?b:1;this.near=c!==undefined?c:.1;this.far=d!==undefined?d:2e3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.setLens=function(a,b){if(b===undefined)b=24;this.fov=2*THREE.Math.radToDeg(Math.atan(b/(a*2)));this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,f){this.fullWidth=a;this.fullHeight=b;this.x=c;this.y=d;this.width=e;this.height=f;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var a=this.fullWidth/this.fullHeight;var b=Math.tan(THREE.Math.degToRad(this.fov*.5))*this.near;var c=-b;var d=a*c;var e=a*b;var f=Math.abs(e-d);var g=Math.abs(b-c);this.projectionMatrix.makeFrustum(d+this.x*f/this.fullWidth,d+(this.x+this.width)*f/this.fullWidth,b-(this.y+this.height)*g/this.fullHeight,b-this.y*g/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)}};THREE.Light=function(a){THREE.Object3D.call(this);this.color=new THREE.Color(a)};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.Light.prototype.clone=function(a){if(a===undefined)a=new THREE.Light;THREE.Object3D.prototype.clone.call(this,a);a.color.copy(this.color);return a};THREE.AmbientLight=function(a){THREE.Light.call(this,a)};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.clone=function(){var a=new THREE.AmbientLight;THREE.Light.prototype.clone.call(this,a);return a};THREE.AreaLight=function(a,b){THREE.Light.call(this,a);this.normal=new THREE.Vector3(0,-1,0);this.right=new THREE.Vector3(1,0,0);this.intensity=b!==undefined?b:1;this.width=1;this.height=1;this.constantAttenuation=1.5;this.linearAttenuation=.5;this.quadraticAttenuation=.1};THREE.AreaLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight=function(a,b){THREE.Light.call(this,a);this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=b!==undefined?b:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowCascade=false;this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight.prototype.clone=function(){var a=new THREE.DirectionalLight;THREE.Light.prototype.clone.call(this,a);a.target=this.target.clone();a.intensity=this.intensity;a.castShadow=this.castShadow;a.onlyShadow=this.onlyShadow;return a};THREE.HemisphereLight=function(a,b,c){THREE.Light.call(this,a);this.position.set(0,100,0);this.groundColor=new THREE.Color(b);this.intensity=c!==undefined?c:1};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight.prototype.clone=function(){var a=new THREE.PointLight;THREE.Light.prototype.clone.call(this,a);a.groundColor.copy(this.groundColor);a.intensity=this.intensity;return a};THREE.PointLight=function(a,b,c){THREE.Light.call(this,a);this.intensity=b!==undefined?b:1;this.distance=c!==undefined?c:0};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight.prototype.clone=function(){var a=new THREE.PointLight;THREE.Light.prototype.clone.call(this,a);a.intensity=this.intensity;a.distance=this.distance;return a};THREE.SpotLight=function(a,b,c,d,e){THREE.Light.call(this,a);this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=b!==undefined?b:1;this.distance=c!==undefined?c:0;this.angle=d!==undefined?d:Math.PI/3;this.exponent=e!==undefined?e:10;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight.prototype.clone=function(){var a=new THREE.SpotLight;THREE.Light.prototype.clone.call(this,a);a.target=this.target.clone();a.intensity=this.intensity;a.distance=this.distance;a.angle=this.angle;a.exponent=this.exponent;a.castShadow=this.castShadow;a.onlyShadow=this.onlyShadow;return a};THREE.Loader=function(a){this.showStatus=a;this.statusDomElement=a?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var a=document.createElement("div");a.style.position="absolute";a.style.right="0px";a.style.top="0px";a.style.fontSize="0.8em";a.style.textAlign="left";a.style.background="rgba(0,0,0,0.25)";a.style.color="#fff";a.style.width="120px";a.style.padding="0.5em 0.5em 0.5em 0.5em";a.style.zIndex=1e3;a.innerHTML="Loading ...";return a},updateProgress:function(a){var b="Loaded ";if(a.total){b+=(100*a.loaded/a.total).toFixed(0)+"%"}else{b+=(a.loaded/1e3).toFixed(2)+" KB"}this.statusDomElement.innerHTML=b},extractUrlBase:function(a){var b=a.split("/");b.pop();return(b.length<1?".":b.join("/"))+"/"},initMaterials:function(a,b){var c=[];for(var d=0;d<a.length;++d){c[d]=THREE.Loader.prototype.createMaterial(a[d],b)}return c},needsTangents:function(a){for(var b=0,c=a.length;b<c;b++){var d=a[b];if(d instanceof THREE.ShaderMaterial)return true}return false},createMaterial:function(a,b){var c=this;function d(a){var b=Math.log(a)/Math.LN2;return Math.floor(b)==b}function e(a){var b=Math.log(a)/Math.LN2;return Math.pow(2,Math.round(b))}function f(a,b){var f=new Image;f.onload=function(){if(!d(this.width)||!d(this.height)){var b=e(this.width);
var c=e(this.height);a.image.width=b;a.image.height=c;a.image.getContext("2d").drawImage(this,0,0,b,c)}else{a.image=this}a.needsUpdate=true};f.crossOrigin=c.crossOrigin;f.src=b}function g(a,c,d,e,g,h,i){var j=/\.dds$/i.test(d);var k=b+"/"+d;if(j){var l=THREE.ImageUtils.loadCompressedTexture(k);a[c]=l}else{var l=document.createElement("canvas");a[c]=new THREE.Texture(l)}a[c].sourceFile=d;if(e){a[c].repeat.set(e[0],e[1]);if(e[0]!==1)a[c].wrapS=THREE.RepeatWrapping;if(e[1]!==1)a[c].wrapT=THREE.RepeatWrapping}if(g){a[c].offset.set(g[0],g[1])}if(h){var m={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(m[h[0]]!==undefined)a[c].wrapS=m[h[0]];if(m[h[1]]!==undefined)a[c].wrapT=m[h[1]]}if(i){a[c].anisotropy=i}if(!j){f(a[c],k)}}function h(a){return(a[0]*255<<16)+(a[1]*255<<8)+a[2]*255}var i="MeshLambertMaterial";var j={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(a.shading){var k=a.shading.toLowerCase();if(k==="phong")i="MeshPhongMaterial";else if(k==="basic")i="MeshBasicMaterial"}if(a.blending!==undefined&&THREE[a.blending]!==undefined){j.blending=THREE[a.blending]}if(a.transparent!==undefined||a.opacity<1){j.transparent=a.transparent}if(a.depthTest!==undefined){j.depthTest=a.depthTest}if(a.depthWrite!==undefined){j.depthWrite=a.depthWrite}if(a.visible!==undefined){j.visible=a.visible}if(a.flipSided!==undefined){j.side=THREE.BackSide}if(a.doubleSided!==undefined){j.side=THREE.DoubleSide}if(a.wireframe!==undefined){j.wireframe=a.wireframe}if(a.vertexColors!==undefined){if(a.vertexColors==="face"){j.vertexColors=THREE.FaceColors}else if(a.vertexColors){j.vertexColors=THREE.VertexColors}}if(a.colorDiffuse){j.color=h(a.colorDiffuse)}else if(a.DbgColor){j.color=a.DbgColor}if(a.colorSpecular){j.specular=h(a.colorSpecular)}if(a.colorAmbient){j.ambient=h(a.colorAmbient)}if(a.transparency){j.opacity=a.transparency}if(a.specularCoef){j.shininess=a.specularCoef}if(a.mapDiffuse&&b){g(j,"map",a.mapDiffuse,a.mapDiffuseRepeat,a.mapDiffuseOffset,a.mapDiffuseWrap,a.mapDiffuseAnisotropy)}if(a.mapLight&&b){g(j,"lightMap",a.mapLight,a.mapLightRepeat,a.mapLightOffset,a.mapLightWrap,a.mapLightAnisotropy)}if(a.mapBump&&b){g(j,"bumpMap",a.mapBump,a.mapBumpRepeat,a.mapBumpOffset,a.mapBumpWrap,a.mapBumpAnisotropy)}if(a.mapNormal&&b){g(j,"normalMap",a.mapNormal,a.mapNormalRepeat,a.mapNormalOffset,a.mapNormalWrap,a.mapNormalAnisotropy)}if(a.mapSpecular&&b){g(j,"specularMap",a.mapSpecular,a.mapSpecularRepeat,a.mapSpecularOffset,a.mapSpecularWrap,a.mapSpecularAnisotropy)}if(a.mapBumpScale){j.bumpScale=a.mapBumpScale}if(a.mapNormal){var l=THREE.ShaderLib["normalmap"];var m=THREE.UniformsUtils.clone(l.uniforms);m["tNormal"].value=j.normalMap;if(a.mapNormalFactor){m["uNormalScale"].value.set(a.mapNormalFactor,a.mapNormalFactor)}if(j.map){m["tDiffuse"].value=j.map;m["enableDiffuse"].value=true}if(j.specularMap){m["tSpecular"].value=j.specularMap;m["enableSpecular"].value=true}if(j.lightMap){m["tAO"].value=j.lightMap;m["enableAO"].value=true}m["uDiffuseColor"].value.setHex(j.color);m["uSpecularColor"].value.setHex(j.specular);m["uAmbientColor"].value.setHex(j.ambient);m["uShininess"].value=j.shininess;if(j.opacity!==undefined){m["uOpacity"].value=j.opacity}var n={fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:m,lights:true,fog:true};var o=new THREE.ShaderMaterial(n);if(j.transparent){o.transparent=true}}else{var o=new THREE[i](j)}if(a.DbgName!==undefined)o.name=a.DbgName;return o}};THREE.ImageLoader=function(){this.crossOrigin=null};THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,load:function(a,b){var c=this;if(b===undefined)b=new Image;b.addEventListener("load",function(){c.dispatchEvent({type:"load",content:b})},false);b.addEventListener("error",function(){c.dispatchEvent({type:"error",message:"Couldn't load URL ["+a+"]"})},false);if(c.crossOrigin)b.crossOrigin=c.crossOrigin;b.src=a}};THREE.JSONLoader=function(a){THREE.Loader.call(this,a);this.withCredentials=false};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.load=function(a,b,c){var d=this;c=c&&typeof c==="string"?c:this.extractUrlBase(a);this.onLoadStart();this.loadAjaxJSON(this,a,b,c)};THREE.JSONLoader.prototype.loadAjaxJSON=function(a,b,c,d,e){var f=new XMLHttpRequest;var g=0;f.onreadystatechange=function(){if(f.readyState===f.DONE){if(f.status===200||f.status===0){if(f.responseText){var h=JSON.parse(f.responseText);var i=a.parse(h,d);c(i.geometry,i.materials)}else{console.warn("THREE.JSONLoader: ["+b+"] seems to be unreachable or file there is empty")}a.onLoadComplete()}else{console.error("THREE.JSONLoader: Couldn't load ["+b+"] ["+f.status+"]")}}else if(f.readyState===f.LOADING){if(e){if(g===0){g=f.getResponseHeader("Content-Length")}e({total:g,loaded:f.responseText.length})}}else if(f.readyState===f.HEADERS_RECEIVED){if(e!==undefined){g=f.getResponseHeader("Content-Length")}}};f.open("GET",b,true);f.withCredentials=this.withCredentials;f.send(null)};THREE.JSONLoader.prototype.parse=function(a,b){var c=this,d=new THREE.Geometry,e=a.scale!==undefined?1/a.scale:1;f(e);g();h(e);d.computeCentroids();d.computeFaceNormals();function f(b){function c(a,b){return a&1<<b}var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=a.faces,G=a.vertices,H=a.normals,I=a.colors,J=0;for(e=0;e<a.uvs.length;e++){if(a.uvs[e].length)J++}for(e=0;e<J;e++){d.faceUvs[e]=[];d.faceVertexUvs[e]=[]}h=0;i=G.length;while(h<i){x=new THREE.Vector3;x.x=G[h++]*b;x.y=G[h++]*b;x.z=G[h++]*b;d.vertices.push(x)}h=0;i=F.length;while(h<i){o=F[h++];p=c(o,0);q=c(o,1);r=c(o,2);s=c(o,3);t=c(o,4);u=c(o,5);v=c(o,6);w=c(o,7);if(p){y=new THREE.Face4;y.a=F[h++];y.b=F[h++];y.c=F[h++];y.d=F[h++];j=4}else{y=new THREE.Face3;y.a=F[h++];y.b=F[h++];y.c=F[h++];j=3}if(q){n=F[h++];y.materialIndex=n}g=d.faces.length;if(r){for(e=0;e<J;e++){B=a.uvs[e];m=F[h++];D=B[m*2];E=B[m*2+1];d.faceUvs[e][g]=new THREE.Vector2(D,E)}}if(s){for(e=0;e<J;e++){B=a.uvs[e];C=[];for(f=0;f<j;f++){m=F[h++];D=B[m*2];E=B[m*2+1];C[f]=new THREE.Vector2(D,E)}d.faceVertexUvs[e][g]=C}}if(t){l=F[h++]*3;A=new THREE.Vector3;A.x=H[l++];A.y=H[l++];A.z=H[l];y.normal=A}if(u){for(e=0;e<j;e++){l=F[h++]*3;A=new THREE.Vector3;A.x=H[l++];A.y=H[l++];A.z=H[l];y.vertexNormals.push(A)}}if(v){k=F[h++];z=new THREE.Color(I[k]);y.color=z}if(w){for(e=0;e<j;e++){k=F[h++];z=new THREE.Color(I[k]);y.vertexColors.push(z)}}d.faces.push(y)}}function g(){var b,c,e,f,g,h,i,j,k,l;if(a.skinWeights){for(b=0,c=a.skinWeights.length;b<c;b+=2){e=a.skinWeights[b];f=a.skinWeights[b+1];g=0;h=0;d.skinWeights.push(new THREE.Vector4(e,f,g,h))}}if(a.skinIndices){for(b=0,c=a.skinIndices.length;b<c;b+=2){i=a.skinIndices[b];j=a.skinIndices[b+1];k=0;l=0;d.skinIndices.push(new THREE.Vector4(i,j,k,l))}}d.bones=a.bones;d.animation=a.animation}function h(b){if(a.morphTargets!==undefined){var c,e,f,g,h,i;for(c=0,e=a.morphTargets.length;c<e;c++){d.morphTargets[c]={};d.morphTargets[c].name=a.morphTargets[c].name;d.morphTargets[c].vertices=[];h=d.morphTargets[c].vertices;i=a.morphTargets[c].vertices;for(f=0,g=i.length;f<g;f+=3){var j=new THREE.Vector3;j.x=i[f]*b;j.y=i[f+1]*b;j.z=i[f+2]*b;h.push(j)}}}if(a.morphColors!==undefined){var c,e,k,l,m,n,o;for(c=0,e=a.morphColors.length;c<e;c++){d.morphColors[c]={};d.morphColors[c].name=a.morphColors[c].name;d.morphColors[c].colors=[];m=d.morphColors[c].colors;n=a.morphColors[c].colors;for(k=0,l=n.length;k<l;k+=3){o=new THREE.Color(16755200);o.setRGB(n[k],n[k+1],n[k+2]);m.push(o)}}}}if(a.materials===undefined){return{geometry:d}}else{var i=this.initMaterials(a.materials,b);if(this.needsTangents(i)){d.computeTangents()}return{geometry:d,materials:i}}};THREE.LoadingMonitor=function(){var a=this;var b=0;var c=0;var d=function(d){b++;a.dispatchEvent({type:"progress",loaded:b,total:c});if(b===c){a.dispatchEvent({type:"load"})}};this.add=function(a){c++;a.addEventListener("load",d,false)}};THREE.LoadingMonitor.prototype={constructor:THREE.LoadingMonitor,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent};THREE.GeometryLoader=function(){};THREE.GeometryLoader.prototype={constructor:THREE.GeometryLoader,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,load:function(a){var b=this;var c=new XMLHttpRequest;c.addEventListener("load",function(a){var c=b.parse(JSON.parse(a.target.responseText));b.dispatchEvent({type:"load",content:c})},false);c.addEventListener("progress",function(a){b.dispatchEvent({type:"progress",loaded:a.loaded,total:a.total})},false);c.addEventListener("error",function(){b.dispatchEvent({type:"error",message:"Couldn't load URL ["+a+"]"})},false);c.open("GET",a,true);c.send(null)},parse:function(a){}};THREE.MaterialLoader=function(){};THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,load:function(a){var b=this;var c=new XMLHttpRequest;c.addEventListener("load",function(a){var c=b.parse(JSON.parse(a.target.responseText));b.dispatchEvent({type:"load",content:c})},false);c.addEventListener("progress",function(a){b.dispatchEvent({type:"progress",loaded:a.loaded,total:a.total})},false);c.addEventListener("error",function(){b.dispatchEvent({type:"error",message:"Couldn't load URL ["+a+"]"})},false);c.open("GET",a,true);c.send(null)},parse:function(a){var b;switch(a.type){case"MeshBasicMaterial":b=new THREE.MeshBasicMaterial({color:a.color,opacity:a.opacity,transparent:a.transparent,wireframe:a.wireframe});break;case"MeshLambertMaterial":b=new THREE.MeshLambertMaterial({color:a.color,ambient:a.ambient,emissive:a.emissive,opacity:a.opacity,transparent:a.transparent,wireframe:a.wireframe});break;case"MeshPhongMaterial":b=new THREE.MeshPhongMaterial({color:a.color,ambient:a.ambient,emissive:a.emissive,specular:a.specular,shininess:a.shininess,opacity:a.opacity,transparent:a.transparent,wireframe:a.wireframe});break;case"MeshNormalMaterial":b=new THREE.MeshNormalMaterial({opacity:a.opacity,transparent:a.transparent,wireframe:a.wireframe});break;case"MeshDepthMaterial":b=new THREE.MeshDepthMaterial({opacity:a.opacity,transparent:a.transparent,wireframe:a.wireframe});break}return b}};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){};this.geometryHandlerMap={};this.hierarchyHandlerMap={};this.addGeometryHandler("ascii",THREE.JSONLoader)};THREE.SceneLoader.prototype.constructor=THREE.SceneLoader;THREE.SceneLoader.prototype.load=function(a,b){var c=this;var d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState===4){if(d.status===200||d.status===0){var e=JSON.parse(d.responseText);c.parse(e,b,a)}else{console.error("THREE.SceneLoader: Couldn't load ["+a+"] ["+d.status+"]")}}};d.open("GET",a,true);d.send(null)};THREE.SceneLoader.prototype.addGeometryHandler=function(a,b){this.geometryHandlerMap[a]={loaderClass:b}};THREE.SceneLoader.prototype.addHierarchyHandler=function(a,b){this.hierarchyHandlerMap[a]={loaderClass:b}};THREE.SceneLoader.prototype.parse=function(a,b,c){var d=this;var e=THREE.Loader.prototype.extractUrlBase(c);var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;var u=[];var v=a;for(var w in this.geometryHandlerMap){var x=this.geometryHandlerMap[w]["loaderClass"];this.geometryHandlerMap[w]["loaderObject"]=new x}for(var w in this.hierarchyHandlerMap){var x=this.hierarchyHandlerMap[w]["loaderClass"];this.hierarchyHandlerMap[w]["loaderObject"]=new x}p=0;q=0;t={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}};if(v.transform){var y=v.transform.position,z=v.transform.rotation,A=v.transform.scale;if(y)t.scene.position.set(y[0],y[1],y[2]);if(z)t.scene.rotation.set(z[0],z[1],z[2]);if(A)t.scene.scale.set(A[0],A[1],A[2]);if(y||z||A){t.scene.updateMatrix();t.scene.updateMatrixWorld()}}function B(a,b){if(b=="relativeToHTML"){return a}else{return e+"/"+a}}function C(){D(t.scene,v.objects)}function D(a,b){var c,e,i,j,k,l;for(var p in b){if(t.objects[p]===undefined){var q=b[p];var r=null;if(q.type&&q.type in d.hierarchyHandlerMap){if(q.loading===undefined){var s={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1};var w={};for(var x in q){if(!(x in s)){w[x]=q[x]}}g=t.materials[q.material];q.loading=true;var y=d.hierarchyHandlerMap[q.type]["loaderObject"];if(y.options){y.load(B(q.url,v.urlBaseType),H(p,a,g,q))}else{y.load(B(q.url,v.urlBaseType),H(p,a,g,q),w)}}}else if(q.geometry!==undefined){f=t.geometries[q.geometry];if(f){var z=false;g=t.materials[q.material];z=g instanceof THREE.ShaderMaterial;i=q.position;j=q.rotation;k=q.scale;c=q.matrix;l=q.quaternion;if(!q.material){g=new THREE.MeshFaceMaterial(t.face_materials[q.geometry])}if(g instanceof THREE.MeshFaceMaterial&&g.materials.length===0){g=new THREE.MeshFaceMaterial(t.face_materials[q.geometry])}if(g instanceof THREE.MeshFaceMaterial){for(var A=0;A<g.materials.length;A++){z=z||g.materials[A]instanceof THREE.ShaderMaterial}}if(z){f.computeTangents()}if(q.skin){r=new THREE.SkinnedMesh(f,g)}else if(q.morph){r=new THREE.MorphAnimMesh(f,g);if(q.duration!==undefined){r.duration=q.duration}if(q.time!==undefined){r.time=q.time}if(q.mirroredLoop!==undefined){r.mirroredLoop=q.mirroredLoop}if(g.morphNormals){f.computeMorphNormals()}}else{r=new THREE.Mesh(f,g)}r.name=p;if(c){r.matrixAutoUpdate=false;r.matrix.set(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15])}else{r.position.set(i[0],i[1],i[2]);if(l){r.quaternion.set(l[0],l[1],l[2],l[3]);r.useQuaternion=true}else{r.rotation.set(j[0],j[1],j[2])}r.scale.set(k[0],k[1],k[2])}r.visible=q.visible;r.castShadow=q.castShadow;r.receiveShadow=q.receiveShadow;a.add(r);t.objects[p]=r}}else if(q.type==="DirectionalLight"||q.type==="PointLight"||q.type==="AmbientLight"){n=q.color!==undefined?q.color:16777215;o=q.intensity!==undefined?q.intensity:1;if(q.type==="DirectionalLight"){i=q.direction;m=new THREE.DirectionalLight(n,o);m.position.set(i[0],i[1],i[2]);if(q.target){u.push({object:m,targetName:q.target});m.target=null}}else if(q.type==="PointLight"){i=q.position;e=q.distance;m=new THREE.PointLight(n,o,e);m.position.set(i[0],i[1],i[2])}else if(q.type==="AmbientLight"){m=new THREE.AmbientLight(n)}a.add(m);m.name=p;t.lights[p]=m;t.objects[p]=m}else if(q.type==="PerspectiveCamera"||q.type==="OrthographicCamera"){i=q.position;j=q.rotation;l=q.quaternion;if(q.type==="PerspectiveCamera"){h=new THREE.PerspectiveCamera(q.fov,q.aspect,q.near,q.far)}else if(q.type==="OrthographicCamera"){h=new THREE.OrthographicCamera(q.left,q.right,q.top,q.bottom,q.near,q.far)}h.name=p;h.position.set(i[0],i[1],i[2]);if(l!==undefined){h.quaternion.set(l[0],l[1],l[2],l[3]);h.useQuaternion=true}else if(j!==undefined){h.rotation.set(j[0],j[1],j[2])}a.add(h);t.cameras[p]=h;t.objects[p]=h}else{i=q.position;j=q.rotation;k=q.scale;l=q.quaternion;r=new THREE.Object3D;r.name=p;r.position.set(i[0],i[1],i[2]);if(l){r.quaternion.set(l[0],l[1],l[2],l[3]);r.useQuaternion=true}else{r.rotation.set(j[0],j[1],j[2])}r.scale.set(k[0],k[1],k[2]);r.visible=q.visible!==undefined?q.visible:false;a.add(r);t.objects[p]=r;t.empties[p]=r}if(r){if(q.userData!==undefined){for(var C in q.userData){var E=q.userData[C];r.userData[C]=E}}if(q.groups!==undefined){for(var A=0;A<q.groups.length;A++){var F=q.groups[A];if(t.groups[F]===undefined){t.groups[F]=[]}t.groups[F].push(p)}}if(q.children!==undefined){D(r,q.children)}}}}}function E(a,b,c){t.geometries[c]=a;t.face_materials[c]=b;C()}function F(a,b,c,d,e){var f=e.position;var g=e.rotation;var h=e.quaternion;var i=e.scale;a.position.set(f[0],f[1],f[2]);if(h){a.quaternion.set(h[0],h[1],h[2],h[3]);a.useQuaternion=true}else{a.rotation.set(g[0],g[1],g[2])}a.scale.set(i[0],i[1],i[2]);if(d){a.traverse(function(a){a.material=d})}var j=e.visible!==undefined?e.visible:true;a.traverse(function(a){a.visible=j});c.add(a);a.name=b;t.objects[b]=a;C()}function G(a){return function(b,c){b.name=a;E(b,c,a);p-=1;d.onLoadComplete();J()}}function H(a,b,c,e){return function(f){var g;if(f.content){g=f.content}else if(f.dae){g=f.scene}else{g=f}F(g,a,b,c,e);p-=1;d.onLoadComplete();J()}}function I(a){return function(b,c){b.name=a;t.geometries[a]=b;t.face_materials[a]=c}}function J(){var a={totalModels:r,totalTextures:s,loadedModels:r-p,loadedTextures:s-q};d.callbackProgress(a,t);d.onLoadProgress();if(p===0&&q===0){K();b(t)}}function K(){for(var a=0;a<u.length;a++){var b=u[a];var c=t.objects[b.targetName];if(c){b.object.target=c}else{b.object.target=new THREE.Object3D;t.scene.add(b.object.target)}b.object.target.userData.targetInverse=b.object}}var L=function(a){q-=a;J();d.onLoadComplete()};var M=function(a){return function(){L(a)}};var N,O;for(N in v.fogs){O=v.fogs[N];if(O.type==="linear"){i=new THREE.Fog(0,O.near,O.far)}else if(O.type==="exp2"){i=new THREE.FogExp2(0,O.density)}l=O.color;i.color.setRGB(l[0],l[1],l[2]);t.fogs[N]=i}var P,Q;for(P in v.geometries){Q=v.geometries[P];if(Q.type in this.geometryHandlerMap){p+=1;d.onLoadStart()}}var R,S;for(R in v.objects){S=v.objects[R];if(S.type&&S.type in this.hierarchyHandlerMap){p+=1;d.onLoadStart()}}r=p;for(P in v.geometries){Q=v.geometries[P];if(Q.type==="cube"){f=new THREE.CubeGeometry(Q.width,Q.height,Q.depth,Q.widthSegments,Q.heightSegments,Q.depthSegments);f.name=P;t.geometries[P]=f}else if(Q.type==="plane"){f=new THREE.PlaneGeometry(Q.width,Q.height,Q.widthSegments,Q.heightSegments);f.name=P;t.geometries[P]=f}else if(Q.type==="sphere"){f=new THREE.SphereGeometry(Q.radius,Q.widthSegments,Q.heightSegments);f.name=P;t.geometries[P]=f}else if(Q.type==="cylinder"){f=new THREE.CylinderGeometry(Q.topRad,Q.botRad,Q.height,Q.radSegs,Q.heightSegs);f.name=P;t.geometries[P]=f}else if(Q.type==="torus"){f=new THREE.TorusGeometry(Q.radius,Q.tube,Q.segmentsR,Q.segmentsT);f.name=P;t.geometries[P]=f}else if(Q.type==="icosahedron"){f=new THREE.IcosahedronGeometry(Q.radius,Q.subdivisions);f.name=P;t.geometries[P]=f}else if(Q.type in this.geometryHandlerMap){var T={};for(var U in Q){if(U!=="type"&&U!=="url"){T[U]=Q[U]}}var V=this.geometryHandlerMap[Q.type]["loaderObject"];V.load(B(Q.url,v.urlBaseType),G(P),T)}else if(Q.type==="embedded"){var W=v.embeds[Q.id],X="";W.metadata=v.metadata;if(W){var Y=this.geometryHandlerMap["ascii"]["loaderObject"];var Z=Y.parse(W,X);I(P)(Z.geometry,Z.materials)}}}var $,_;for($ in v.textures){_=v.textures[$];if(_.url instanceof Array){q+=_.url.length;for(var ab=0;ab<_.url.length;ab++){d.onLoadStart()}}else{q+=1;d.onLoadStart()}}s=q;for($ in v.textures){_=v.textures[$];if(_.mapping!==undefined&&THREE[_.mapping]!==undefined){_.mapping=new THREE[_.mapping]}if(_.url instanceof Array){var bb=_.url.length;var cb=[];for(var db=0;db<bb;db++){cb[db]=B(_.url[db],v.urlBaseType)}var eb=/\.dds$/i.test(cb[0]);if(eb){j=THREE.ImageUtils.loadCompressedTextureCube(cb,_.mapping,M(bb))}else{j=THREE.ImageUtils.loadTextureCube(cb,_.mapping,M(bb))}}else{var eb=/\.dds$/i.test(_.url);var fb=B(_.url,v.urlBaseType);var gb=M(1);if(eb){j=THREE.ImageUtils.loadCompressedTexture(fb,_.mapping,gb)}else{j=THREE.ImageUtils.loadTexture(fb,_.mapping,gb)}if(THREE[_.minFilter]!==undefined)j.minFilter=THREE[_.minFilter];if(THREE[_.magFilter]!==undefined)j.magFilter=THREE[_.magFilter];if(_.anisotropy)j.anisotropy=_.anisotropy;if(_.repeat){j.repeat.set(_.repeat[0],_.repeat[1]);if(_.repeat[0]!==1)j.wrapS=THREE.RepeatWrapping;if(_.repeat[1]!==1)j.wrapT=THREE.RepeatWrapping}if(_.offset){j.offset.set(_.offset[0],_.offset[1])}if(_.wrap){var hb={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(hb[_.wrap[0]]!==undefined)j.wrapS=hb[_.wrap[0]];if(hb[_.wrap[1]]!==undefined)j.wrapT=hb[_.wrap[1]]}}t.textures[$]=j}var ib,jb;var kb;for(ib in v.materials){jb=v.materials[ib];for(kb in jb.parameters){if(kb==="envMap"||kb==="map"||kb==="lightMap"||kb==="bumpMap"){jb.parameters[kb]=t.textures[jb.parameters[kb]]}else if(kb==="shading"){jb.parameters[kb]=jb.parameters[kb]==="flat"?THREE.FlatShading:THREE.SmoothShading}else if(kb==="side"){if(jb.parameters[kb]=="double"){jb.parameters[kb]=THREE.DoubleSide}else if(jb.parameters[kb]=="back"){jb.parameters[kb]=THREE.BackSide}else{jb.parameters[kb]=THREE.FrontSide}}else if(kb==="blending"){jb.parameters[kb]=jb.parameters[kb]in THREE?THREE[jb.parameters[kb]]:THREE.NormalBlending}else if(kb==="combine"){jb.parameters[kb]=jb.parameters[kb]in THREE?THREE[jb.parameters[kb]]:THREE.MultiplyOperation}else if(kb==="vertexColors"){if(jb.parameters[kb]=="face"){jb.parameters[kb]=THREE.FaceColors}else if(jb.parameters[kb]){jb.parameters[kb]=THREE.VertexColors}}else if(kb==="wrapRGB"){var lb=jb.parameters[kb];jb.parameters[kb]=new THREE.Vector3(lb[0],lb[1],lb[2])}}if(jb.parameters.opacity!==undefined&&jb.parameters.opacity<1){jb.parameters.transparent=true}if(jb.parameters.normalMap){var mb=THREE.ShaderLib["normalmap"];var nb=THREE.UniformsUtils.clone(mb.uniforms);var ob=jb.parameters.color;var pb=jb.parameters.specular;var qb=jb.parameters.ambient;var rb=jb.parameters.shininess;nb["tNormal"].value=t.textures[jb.parameters.normalMap];if(jb.parameters.normalScale){nb["uNormalScale"].value.set(jb.parameters.normalScale[0],jb.parameters.normalScale[1])}if(jb.parameters.map){nb["tDiffuse"].value=jb.parameters.map;nb["enableDiffuse"].value=true}if(jb.parameters.envMap){nb["tCube"].value=jb.parameters.envMap;nb["enableReflection"].value=true;nb["uReflectivity"].value=jb.parameters.reflectivity}if(jb.parameters.lightMap){nb["tAO"].value=jb.parameters.lightMap;nb["enableAO"].value=true}if(jb.parameters.specularMap){nb["tSpecular"].value=t.textures[jb.parameters.specularMap];nb["enableSpecular"].value=true}if(jb.parameters.displacementMap){nb["tDisplacement"].value=t.textures[jb.parameters.displacementMap];nb["enableDisplacement"].value=true;nb["uDisplacementBias"].value=jb.parameters.displacementBias;nb["uDisplacementScale"].value=jb.parameters.displacementScale}nb["uDiffuseColor"].value.setHex(ob);nb["uSpecularColor"].value.setHex(pb);nb["uAmbientColor"].value.setHex(qb);nb["uShininess"].value=rb;if(jb.parameters.opacity){nb["uOpacity"].value=jb.parameters.opacity}var sb={fragmentShader:mb.fragmentShader,vertexShader:mb.vertexShader,uniforms:nb,lights:true,fog:true};g=new THREE.ShaderMaterial(sb)}else{g=new THREE[jb.type](jb.parameters)}g.name=ib;t.materials[ib]=g}for(ib in v.materials){jb=v.materials[ib];if(jb.parameters.materials){var tb=[];for(var db=0;db<jb.parameters.materials.length;db++){var ub=jb.parameters.materials[db];tb.push(t.materials[ub])}t.materials[ib].materials=tb}}C();if(t.cameras&&v.defaults.camera){t.currentCamera=t.cameras[v.defaults.camera]}if(t.fogs&&v.defaults.fog){t.scene.fog=t.fogs[v.defaults.fog]}d.callbackSync(t);J()};THREE.TextureLoader=function(){this.crossOrigin=null};THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,load:function(a){var b=this;var c=new Image;c.addEventListener("load",function(){var a=new THREE.Texture(c);a.needsUpdate=true;b.dispatchEvent({type:"load",content:a})},false);c.addEventListener("error",function(){b.dispatchEvent({type:"error",message:"Couldn't load URL ["+a+"]"})},false);if(b.crossOrigin)c.crossOrigin=b.crossOrigin;c.src=a}};THREE.Material=function(){this.id=THREE.MaterialIdCount++;this.name="";this.side=THREE.FrontSide;this.opacity=1;this.transparent=false;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.depthTest=true;this.depthWrite=true;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=false;this.visible=true;this.needsUpdate=true};THREE.Material.prototype={constructor:THREE.Material,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,setValues:function(a){if(a===undefined)return;for(var b in a){var c=a[b];if(c===undefined){console.warn("THREE.Material: '"+b+"' parameter is undefined.");continue}if(b in this){var d=this[b];if(d instanceof THREE.Color){d.set(c)}else if(d instanceof THREE.Vector3&&c instanceof THREE.Vector3){d.copy(c)}else{this[b]=c}}}},clone:function(a){if(a===undefined)a=new THREE.Material;a.name=this.name;a.side=this.side;a.opacity=this.opacity;a.transparent=this.transparent;a.blending=this.blending;a.blendSrc=this.blendSrc;a.blendDst=this.blendDst;a.blendEquation=this.blendEquation;a.depthTest=this.depthTest;a.depthWrite=this.depthWrite;a.polygonOffset=this.polygonOffset;a.polygonOffsetFactor=this.polygonOffsetFactor;a.polygonOffsetUnits=this.polygonOffsetUnits;a.alphaTest=this.alphaTest;a.overdraw=this.overdraw;a.visible=this.visible;return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.MaterialIdCount=0;THREE.LineBasicMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=false;this.fog=true;this.setValues(a)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.clone=function(){var a=new THREE.LineBasicMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.linewidth=this.linewidth;a.linecap=this.linecap;a.linejoin=this.linejoin;a.vertexColors=this.vertexColors;a.fog=this.fog;return a};THREE.LineDashedMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(a)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.clone=function(){var a=new THREE.LineDashedMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.linewidth=this.linewidth;a.scale=this.scale;a.dashSize=this.dashSize;a.gapSize=this.gapSize;a.vertexColors=this.vertexColors;a.fog=this.fog;return a};THREE.MeshBasicMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.map=null;this.lightMap=null;this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(a)};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.clone=function(){var a=new THREE.MeshBasicMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.lightMap=this.lightMap;a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;return a};THREE.MeshLambertMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(a)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.clone=function(){var a=new THREE.MeshLambertMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.ambient.copy(this.ambient);a.emissive.copy(this.emissive);a.wrapAround=this.wrapAround;a.wrapRGB.copy(this.wrapRGB);a.map=this.map;a.lightMap=this.lightMap;a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a};THREE.MeshPhongMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.metal=false;this.perPixel=true;this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(a)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.clone=function(){var a=new THREE.MeshPhongMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.ambient.copy(this.ambient);a.emissive.copy(this.emissive);a.specular.copy(this.specular);a.shininess=this.shininess;a.metal=this.metal;a.perPixel=this.perPixel;a.wrapAround=this.wrapAround;a.wrapRGB.copy(this.wrapRGB);a.map=this.map;a.lightMap=this.lightMap;a.bumpMap=this.bumpMap;a.bumpScale=this.bumpScale;a.normalMap=this.normalMap;a.normalScale.copy(this.normalScale);a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a};THREE.MeshDepthMaterial=function(a){THREE.Material.call(this);this.wireframe=false;
this.wireframeLinewidth=1;this.setValues(a)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.clone=function(){var a=new THREE.MeshDepthMaterial;THREE.Material.prototype.clone.call(this,a);a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;return a};THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a);this.shading=THREE.FlatShading;this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(a)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.clone=function(){var a=new THREE.MeshNormalMaterial;THREE.Material.prototype.clone.call(this,a);a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;return a};THREE.MeshFaceMaterial=function(a){this.materials=a instanceof Array?a:[]};THREE.MeshFaceMaterial.prototype.clone=function(){return new THREE.MeshFaceMaterial(this.materials.slice(0))};THREE.ParticleBasicMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=false;this.fog=true;this.setValues(a)};THREE.ParticleBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ParticleBasicMaterial.prototype.clone=function(){var a=new THREE.ParticleBasicMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.size=this.size;a.sizeAttenuation=this.sizeAttenuation;a.vertexColors=this.vertexColors;a.fog=this.fog;return a};THREE.ParticleCanvasMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.program=function(a,b){};this.setValues(a)};THREE.ParticleCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ParticleCanvasMaterial.prototype.clone=function(){var a=new THREE.ParticleCanvasMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.program=this.program;return a};THREE.ShaderMaterial=function(a){THREE.Material.call(this);this.fragmentShader="void main() {}";this.vertexShader="void main() {}";this.uniforms={};this.defines={};this.attributes=null;this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(a)};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.clone=function(){var a=new THREE.ShaderMaterial;THREE.Material.prototype.clone.call(this,a);a.fragmentShader=this.fragmentShader;a.vertexShader=this.vertexShader;a.uniforms=THREE.UniformsUtils.clone(this.uniforms);a.attributes=this.attributes;a.defines=this.defines;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.fog=this.fog;a.lights=this.lights;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a};THREE.SpriteMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.map=new THREE.Texture;this.useScreenCoordinates=true;this.depthTest=!this.useScreenCoordinates;this.sizeAttenuation=!this.useScreenCoordinates;this.scaleByViewport=!this.sizeAttenuation;this.alignment=THREE.SpriteAlignment.center.clone();this.fog=false;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1);this.setValues(a);a=a||{};if(a.depthTest===undefined)this.depthTest=!this.useScreenCoordinates;if(a.sizeAttenuation===undefined)this.sizeAttenuation=!this.useScreenCoordinates;if(a.scaleByViewport===undefined)this.scaleByViewport=!this.sizeAttenuation};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.clone=function(){var a=new THREE.SpriteMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.useScreenCoordinates=this.useScreenCoordinates;a.sizeAttenuation=this.sizeAttenuation;a.scaleByViewport=this.scaleByViewport;a.alignment.copy(this.alignment);a.uvOffset.copy(this.uvOffset);a.uvScale.copy(this.uvScale);a.fog=this.fog;return a};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);THREE.Texture=function(a,b,c,d,e,f,g,h,i){this.id=THREE.TextureIdCount++;this.name="";this.image=a;this.mipmaps=[];this.mapping=b!==undefined?b:new THREE.UVMapping;this.wrapS=c!==undefined?c:THREE.ClampToEdgeWrapping;this.wrapT=d!==undefined?d:THREE.ClampToEdgeWrapping;this.magFilter=e!==undefined?e:THREE.LinearFilter;this.minFilter=f!==undefined?f:THREE.LinearMipMapLinearFilter;this.anisotropy=i!==undefined?i:1;this.format=g!==undefined?g:THREE.RGBAFormat;this.type=h!==undefined?h:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this.needsUpdate=false;this.onUpdate=null};THREE.Texture.prototype={constructor:THREE.Texture,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,clone:function(a){if(a===undefined)a=new THREE.Texture;a.image=this.image;a.mipmaps=this.mipmaps.slice(0);a.mapping=this.mapping;a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.format=this.format;a.type=this.type;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.generateMipmaps=this.generateMipmaps;a.premultiplyAlpha=this.premultiplyAlpha;a.flipY=this.flipY;a.unpackAlignment=this.unpackAlignment;return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.TextureIdCount=0;THREE.CompressedTexture=function(a,b,c,d,e,f,g,h,i,j,k){THREE.Texture.call(this,null,f,g,h,i,j,d,e,k);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=false};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.clone=function(){var a=new THREE.CompressedTexture;THREE.Texture.prototype.clone.call(this,a);return a};THREE.DataTexture=function(a,b,c,d,e,f,g,h,i,j,k){THREE.Texture.call(this,null,f,g,h,i,j,d,e,k);this.image={data:a,width:b,height:c}};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.clone=function(){var a=new THREE.DataTexture;THREE.Texture.prototype.clone.call(this,a);return a};THREE.Particle=function(a){THREE.Object3D.call(this);this.material=a};THREE.Particle.prototype=Object.create(THREE.Object3D.prototype);THREE.Particle.prototype.clone=function(a){if(a===undefined)a=new THREE.Particle(this.material);THREE.Object3D.prototype.clone.call(this,a);return a};THREE.ParticleSystem=function(a,b){THREE.Object3D.call(this);this.geometry=a;this.material=b!==undefined?b:new THREE.ParticleBasicMaterial({color:Math.random()*16777215});this.sortParticles=false;if(this.geometry){if(this.geometry.boundingSphere===null){this.geometry.computeBoundingSphere()}}this.frustumCulled=false};THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype);THREE.ParticleSystem.prototype.clone=function(a){if(a===undefined)a=new THREE.ParticleSystem(this.geometry,this.material);a.sortParticles=this.sortParticles;THREE.Object3D.prototype.clone.call(this,a);return a};THREE.Line=function(a,b,c){THREE.Object3D.call(this);this.geometry=a;this.material=b!==undefined?b:new THREE.LineBasicMaterial({color:Math.random()*16777215});this.type=c!==undefined?c:THREE.LineStrip;if(this.geometry){if(!this.geometry.boundingSphere){this.geometry.computeBoundingSphere()}}};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);THREE.Line.prototype.clone=function(a){if(a===undefined)a=new THREE.Line(this.geometry,this.material,this.type);THREE.Object3D.prototype.clone.call(this,a);return a};THREE.Mesh=function(a,b){THREE.Object3D.call(this);this.geometry=null;this.material=null;this.setGeometry(a);this.setMaterial(b)};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.setGeometry=function(a){if(a!==undefined){this.geometry=a;if(this.geometry.boundingSphere===null){this.geometry.computeBoundingSphere()}this.updateMorphTargets()}};THREE.Mesh.prototype.setMaterial=function(a){if(a!==undefined){this.material=a}else{this.material=new THREE.MeshBasicMaterial({color:Math.random()*16777215,wireframe:true})}};THREE.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}}};THREE.Mesh.prototype.getMorphTargetIndexByName=function(a){if(this.morphTargetDictionary[a]!==undefined){return this.morphTargetDictionary[a]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.clone=function(a){if(a===undefined)a=new THREE.Mesh(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,a);return a};THREE.Bone=function(a){THREE.Object3D.call(this);this.skin=a;this.skinMatrix=new THREE.Matrix4};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Bone.prototype.update=function(a,b){if(this.matrixAutoUpdate){b|=this.updateMatrix()}if(b||this.matrixWorldNeedsUpdate){if(a){this.skinMatrix.multiplyMatrices(a,this.matrix)}else{this.skinMatrix.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;b=true}var c,d,e=this.children.length;for(d=0;d<e;d++){this.children[d].update(this.skinMatrix,b)}};THREE.SkinnedMesh=function(a,b,c){THREE.Mesh.call(this,a,b);this.useVertexTexture=c!==undefined?c:true;this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var d,e,f,g,h,i;if(this.geometry&&this.geometry.bones!==undefined){for(d=0;d<this.geometry.bones.length;d++){f=this.geometry.bones[d];g=f.pos;h=f.rotq;i=f.scl;e=this.addBone();e.name=f.name;e.position.set(g[0],g[1],g[2]);e.quaternion.set(h[0],h[1],h[2],h[3]);e.useQuaternion=true;if(i!==undefined){e.scale.set(i[0],i[1],i[2])}else{e.scale.set(1,1,1)}}for(d=0;d<this.bones.length;d++){f=this.geometry.bones[d];e=this.bones[d];if(f.parent===-1){this.add(e)}else{this.bones[f.parent].add(e)}}var j=this.bones.length;if(this.useVertexTexture){var k;if(j>256)k=64;else if(j>64)k=32;else if(j>16)k=16;else k=8;this.boneTextureWidth=k;this.boneTextureHeight=k;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType);this.boneTexture.minFilter=THREE.NearestFilter;this.boneTexture.magFilter=THREE.NearestFilter;this.boneTexture.generateMipmaps=false;this.boneTexture.flipY=false}else{this.boneMatrices=new Float32Array(16*j)}this.pose()}};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.addBone=function(a){if(a===undefined){a=new THREE.Bone(this)}this.bones.push(a);return a};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;a=true}for(var b=0,c=this.children.length;b<c;b++){var d=this.children[b];if(d instanceof THREE.Bone){d.update(this.identityMatrix,false)}else{d.updateMatrixWorld(true)}}if(this.boneInverses==undefined){this.boneInverses=[];for(var e=0,f=this.bones.length;e<f;e++){var g=new THREE.Matrix4;g.getInverse(this.bones[e].skinMatrix);this.boneInverses.push(g)}}for(var e=0,f=this.bones.length;e<f;e++){THREE.SkinnedMesh.offsetMatrix.multiplyMatrices(this.bones[e].skinMatrix,this.boneInverses[e]);THREE.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,e*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}};THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(true);for(var a=0;a<this.geometry.skinIndices.length;a++){var b=this.geometry.skinWeights[a];var c=1/b.lengthManhattan();if(c!==Infinity){b.multiplyScalar(c)}else{b.set(1)}}};THREE.SkinnedMesh.prototype.clone=function(a){if(a===undefined)a=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture);THREE.Mesh.prototype.clone.call(this,a);return a};THREE.SkinnedMesh.offsetMatrix=new THREE.Matrix4;THREE.MorphAnimMesh=function(a,b){THREE.Mesh.call(this,a,b);this.duration=1e3;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.setFrameRange=function(a,b){this.startKeyframe=a;this.endKeyframe=b;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var a=this.geometry;if(!a.animations)a.animations={};var b,c=a.animations;var d=/([a-z]+)(\d+)/;for(var e=0,f=a.morphTargets.length;e<f;e++){var g=a.morphTargets[e];var h=g.name.match(d);if(h&&h.length>1){var i=h[1];var j=h[2];if(!c[i])c[i]={start:Infinity,end:-Infinity};var k=c[i];if(e<k.start)k.start=e;if(e>k.end)k.end=e;if(!b)b=i}}a.firstAnimation=b};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(a,b,c){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[a]={start:b,end:c}};THREE.MorphAnimMesh.prototype.playAnimation=function(a,b){var c=this.geometry.animations[a];if(c){this.setFrameRange(c.start,c.end);this.duration=1e3*((c.end-c.start)/b);this.time=0}else{console.warn("animation["+a+"] undefined")}};THREE.MorphAnimMesh.prototype.updateAnimation=function(a){var b=this.duration/this.length;this.time+=this.direction*a;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time+=this.duration}var c=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/b),0,this.length-1);if(c!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[c]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=c}var d=this.time%b/b;if(this.directionBackwards){d=1-d}this.morphTargetInfluences[this.currentKeyframe]=d;this.morphTargetInfluences[this.lastKeyframe]=1-d};THREE.MorphAnimMesh.prototype.clone=function(a){if(a===undefined)a=new THREE.MorphAnimMesh(this.geometry,this.material);a.duration=this.duration;a.mirroredLoop=this.mirroredLoop;a.time=this.time;a.lastKeyframe=this.lastKeyframe;a.currentKeyframe=this.currentKeyframe;a.direction=this.direction;a.directionBackwards=this.directionBackwards;THREE.Mesh.prototype.clone.call(this,a);return a};THREE.Ribbon=function(a,b){THREE.Object3D.call(this);this.geometry=a;this.material=b};THREE.Ribbon.prototype=Object.create(THREE.Object3D.prototype);THREE.Ribbon.prototype.clone=function(a){if(a===undefined)a=new THREE.Ribbon(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,a);return a};THREE.LOD=function(){THREE.Object3D.call(this);this.objects=[]};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD.prototype.addLevel=function(a,b){if(b===undefined)b=0;b=Math.abs(b);for(var c=0;c<this.objects.length;c++){if(b<this.objects[c].distance){break}}this.objects.splice(c,0,{distance:b,object:a});this.add(a)};THREE.LOD.prototype.getObjectForDistance=function(a){for(var b=1,c=this.objects.length;b<c;b++){if(a<this.objects[b].distance){break}}return this.objects[b-1].object};THREE.LOD.prototype.update=function(){var a=new THREE.Vector3;var b=new THREE.Vector3;return function(c){if(this.objects.length>1){a.getPositionFromMatrix(c.matrixWorld);b.getPositionFromMatrix(this.matrixWorld);var d=a.distanceTo(b);this.objects[0].object.visible=true;for(var e=1,f=this.objects.length;e<f;e++){if(d>=this.objects[e].distance){this.objects[e-1].object.visible=false;this.objects[e].object.visible=true}else{break}}for(;e<f;e++){this.objects[e].object.visible=false}}}}();THREE.LOD.prototype.clone=function(){};THREE.Sprite=function(a){THREE.Object3D.call(this);this.material=a!==undefined?a:new THREE.SpriteMaterial;this.rotation3d=this.rotation;this.rotation=0};THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.updateMatrix=function(){this.rotation3d.set(0,0,this.rotation);this.quaternion.setFromEuler(this.rotation3d,this.eulerOrder);this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true};THREE.Sprite.prototype.clone=function(a){if(a===undefined)a=new THREE.Sprite(this.material);THREE.Object3D.prototype.clone.call(this,a);return a};THREE.Scene=function(){THREE.Object3D.call(this);this.fog=null;this.overrideMaterial=null;this.autoUpdate=true;this.matrixAutoUpdate=false;this.__objects=[];this.__lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.__addObject=function(a){if(a instanceof THREE.Light){if(this.__lights.indexOf(a)===-1){this.__lights.push(a)}if(a.target&&a.target.parent===undefined){this.add(a.target)}}else if(!(a instanceof THREE.Camera||a instanceof THREE.Bone)){if(this.__objects.indexOf(a)===-1){this.__objects.push(a);this.__objectsAdded.push(a);var b=this.__objectsRemoved.indexOf(a);if(b!==-1){this.__objectsRemoved.splice(b,1)}}}for(var c=0;c<a.children.length;c++){this.__addObject(a.children[c])}};THREE.Scene.prototype.__removeObject=function(a){if(a instanceof THREE.Light){var b=this.__lights.indexOf(a);if(b!==-1){this.__lights.splice(b,1)}}else if(!(a instanceof THREE.Camera)){var b=this.__objects.indexOf(a);if(b!==-1){this.__objects.splice(b,1);this.__objectsRemoved.push(a);var c=this.__objectsAdded.indexOf(a);if(c!==-1){this.__objectsAdded.splice(c,1)}}}for(var d=0;d<a.children.length;d++){this.__removeObject(a.children[d])}};THREE.Fog=function(a,b,c){this.name="";this.color=new THREE.Color(a);this.near=b!==undefined?b:1;this.far=c!==undefined?c:1e3};THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(a,b){this.name="";this.color=new THREE.Color(a);this.density=b!==undefined?b:25e-5};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.CanvasRenderer=function(a){console.log("THREE.CanvasRenderer",THREE.REVISION);var b=THREE.Math.smoothstep;a=a||{};var c=this,d,e,f,g=new THREE.Projector,h=a.canvas!==undefined?a.canvas:document.createElement("canvas"),i,j,k,l,m=h.getContext("2d"),n=new THREE.Color(0),o=0,p=1,q=0,r=null,s=null,t=null,u=null,v=null,w=null,x=0,y,z,A,B,C=new THREE.RenderableVertex,D=new THREE.RenderableVertex,E,F,G,H,I,J,K,L,M,N,O,P,Q=new THREE.Color,R=new THREE.Color,S=new THREE.Color,T=new THREE.Color,U=new THREE.Color,V=new THREE.Color,W=new THREE.Color,X=new THREE.Color,Y={},Z={},$,_,ab,bb,cb,db,eb,fb,gb,hb,ib=new THREE.Box2,jb=new THREE.Box2,kb=new THREE.Box2,lb=new THREE.Color,mb=new THREE.Color,nb=new THREE.Color,ob=new THREE.Vector3,pb,qb,rb,sb,tb,ub,vb=16;pb=document.createElement("canvas");pb.width=pb.height=2;qb=pb.getContext("2d");qb.fillStyle="rgba(0,0,0,1)";qb.fillRect(0,0,2,2);rb=qb.getImageData(0,0,2,2);sb=rb.data;tb=document.createElement("canvas");tb.width=tb.height=vb;ub=tb.getContext("2d");ub.translate(-vb/2,-vb/2);ub.scale(vb,vb);vb--;if(m.setLineDash===undefined){if(m.mozDash!==undefined){m.setLineDash=function(a){m.mozDash=a[0]!==null?a:null}}else{m.setLineDash=function(){}}}this.domElement=h;this.devicePixelRatio=a.devicePixelRatio!==undefined?a.devicePixelRatio:window.devicePixelRatio!==undefined?window.devicePixelRatio:1;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.setSize=function(a,b,c){i=a*this.devicePixelRatio;j=b*this.devicePixelRatio;k=Math.floor(i/2);l=Math.floor(j/2);h.width=i;h.height=j;if(this.devicePixelRatio!==1&&c!==false){h.style.width=a+"px";h.style.height=b+"px"}ib.set(new THREE.Vector2(-k,-l),new THREE.Vector2(k,l));jb.set(new THREE.Vector2(-k,-l),new THREE.Vector2(k,l));p=1;q=0;r=null;s=null;t=null;u=null;v=null};this.setClearColor=function(a,b){n.set(a);o=b!==undefined?b:1;jb.set(new THREE.Vector2(-k,-l),new THREE.Vector2(k,l))};this.setClearColorHex=function(a,b){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(a,b)};this.getMaxAnisotropy=function(){return 0};this.clear=function(){m.setTransform(1,0,0,-1,k,l);if(jb.empty()===false){jb.intersect(ib);jb.expandByScalar(2);if(o<1){m.clearRect(jb.min.x|0,jb.min.y|0,jb.max.x-jb.min.x|0,jb.max.y-jb.min.y|0)}if(o>0){xb(THREE.NormalBlending);wb(1);Cb("rgba("+Math.floor(n.r*255)+","+Math.floor(n.g*255)+","+Math.floor(n.b*255)+","+o+")");m.fillRect(jb.min.x|0,jb.min.y|0,jb.max.x-jb.min.x|0,jb.max.y-jb.min.y|0)}jb.makeEmpty()}};this.render=function(a,h){if(h instanceof THREE.Camera===false){console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");return}if(this.autoClear===true)this.clear();m.setTransform(1,0,0,-1,k,l);c.info.render.vertices=0;c.info.render.faces=0;d=g.projectScene(a,h,this.sortObjects,this.sortElements);e=d.elements;f=d.lights;p();for(var i=0,j=e.length;i<j;i++){var n=e[i];var o=n.material;if(o===undefined||o.visible===false)continue;kb.makeEmpty();if(n instanceof THREE.RenderableParticle){y=n;y.x*=k;y.y*=l;r(y,n,o)}else if(n instanceof THREE.RenderableLine){y=n.v1;z=n.v2;y.positionScreen.x*=k;y.positionScreen.y*=l;z.positionScreen.x*=k;z.positionScreen.y*=l;kb.setFromPoints([y.positionScreen,z.positionScreen]);if(ib.isIntersectionBox(kb)===true){s(y,z,n,o)}}else if(n instanceof THREE.RenderableFace3){y=n.v1;z=n.v2;A=n.v3;if(y.positionScreen.z<-1||y.positionScreen.z>1)continue;if(z.positionScreen.z<-1||z.positionScreen.z>1)continue;if(A.positionScreen.z<-1||A.positionScreen.z>1)continue;y.positionScreen.x*=k;y.positionScreen.y*=l;z.positionScreen.x*=k;z.positionScreen.y*=l;A.positionScreen.x*=k;A.positionScreen.y*=l;if(o.overdraw===true){Hb(y.positionScreen,z.positionScreen);Hb(z.positionScreen,A.positionScreen);Hb(A.positionScreen,y.positionScreen)}kb.setFromPoints([y.positionScreen,z.positionScreen,A.positionScreen]);if(ib.isIntersectionBox(kb)===true){t(y,z,A,0,1,2,n,o)}}else if(n instanceof THREE.RenderableFace4){y=n.v1;z=n.v2;A=n.v3;B=n.v4;if(y.positionScreen.z<-1||y.positionScreen.z>1)continue;if(z.positionScreen.z<-1||z.positionScreen.z>1)continue;if(A.positionScreen.z<-1||A.positionScreen.z>1)continue;if(B.positionScreen.z<-1||B.positionScreen.z>1)continue;y.positionScreen.x*=k;y.positionScreen.y*=l;z.positionScreen.x*=k;z.positionScreen.y*=l;A.positionScreen.x*=k;A.positionScreen.y*=l;B.positionScreen.x*=k;B.positionScreen.y*=l;C.positionScreen.copy(z.positionScreen);D.positionScreen.copy(B.positionScreen);if(o.overdraw===true){Hb(y.positionScreen,z.positionScreen);Hb(z.positionScreen,B.positionScreen);Hb(B.positionScreen,y.positionScreen);Hb(A.positionScreen,C.positionScreen);Hb(A.positionScreen,D.positionScreen)}kb.setFromPoints([y.positionScreen,z.positionScreen,A.positionScreen,B.positionScreen]);if(ib.isIntersectionBox(kb)===true){u(y,z,A,B,C,D,n,o)}}jb.union(kb)}m.setTransform(1,0,0,1,0,0);function p(){lb.setRGB(0,0,0);mb.setRGB(0,0,0);nb.setRGB(0,0,0);for(var a=0,b=f.length;a<b;a++){var c=f[a];var d=c.color;if(c instanceof THREE.AmbientLight){lb.add(d)}else if(c instanceof THREE.DirectionalLight){mb.add(d)}else if(c instanceof THREE.PointLight){nb.add(d)}}}function q(a,b,c){for(var d=0,e=f.length;d<e;d++){var g=f[d];X.copy(g.color);if(g instanceof THREE.DirectionalLight){var h=ob.getPositionFromMatrix(g.matrixWorld).normalize();var i=b.dot(h);if(i<=0)continue;i*=g.intensity;c.add(X.multiplyScalar(i))}else if(g instanceof THREE.PointLight){var h=ob.getPositionFromMatrix(g.matrixWorld);var i=b.dot(ob.subVectors(h,a).normalize());if(i<=0)continue;i*=g.distance==0?1:1-Math.min(a.distanceTo(h)/g.distance,1);if(i==0)continue;i*=g.intensity;c.add(X.multiplyScalar(i))}}}function r(a,b,c){wb(c.opacity);xb(c.blending);var d,e,f,g,h,i,j;if(c instanceof THREE.ParticleBasicMaterial){if(c.map===null){f=b.object.scale.x;g=b.object.scale.y;f*=b.scale.x*k;g*=b.scale.y*l;kb.min.set(a.x-f,a.y-g);kb.max.set(a.x+f,a.y+g);if(ib.isIntersectionBox(kb)===false){kb.makeEmpty();return}Cb(c.color.getStyle());m.save();m.translate(a.x,a.y);m.rotate(-b.rotation);m.scale(f,g);m.fillRect(-1,-1,2,2);m.restore()}else{h=c.map.image;i=h.width>>1;j=h.height>>1;f=b.scale.x*k;g=b.scale.y*l;d=f*i;e=g*j;kb.min.set(a.x-d,a.y-e);kb.max.set(a.x+d,a.y+e);if(ib.isIntersectionBox(kb)===false){kb.makeEmpty();return}m.save();m.translate(a.x,a.y);m.rotate(-b.rotation);m.scale(f,-g);m.translate(-i,-j);m.drawImage(h,0,0);m.restore()}}else if(c instanceof THREE.ParticleCanvasMaterial){d=b.scale.x*k;e=b.scale.y*l;kb.min.set(a.x-d,a.y-e);kb.max.set(a.x+d,a.y+e);if(ib.isIntersectionBox(kb)===false){kb.makeEmpty();return}Bb(c.color.getStyle());Cb(c.color.getStyle());m.save();m.translate(a.x,a.y);m.rotate(-b.rotation);m.scale(d,e);c.program(m);m.restore()}}function s(a,b,c,d){wb(d.opacity);xb(d.blending);m.beginPath();m.moveTo(a.positionScreen.x,a.positionScreen.y);m.lineTo(b.positionScreen.x,b.positionScreen.y);if(d instanceof THREE.LineBasicMaterial){yb(d.linewidth);zb(d.linecap);Ab(d.linejoin);if(d.vertexColors!==THREE.VertexColors){Bb(d.color.getStyle())}else{var e=c.vertexColors[0].getStyle();var f=c.vertexColors[1].getStyle();if(e===f){Bb(e)}else{try{var g=m.createLinearGradient(a.positionScreen.x,a.positionScreen.y,b.positionScreen.x,b.positionScreen.y);g.addColorStop(0,e);g.addColorStop(1,f)}catch(h){g=e}Bb(g)}}m.stroke();kb.expandByScalar(d.linewidth*2)}else if(d instanceof THREE.LineDashedMaterial){yb(d.linewidth);zb(d.linecap);Ab(d.linejoin);Bb(d.color.getStyle());Db(d.dashSize,d.gapSize);m.stroke();kb.expandByScalar(d.linewidth*2);Db(null,null)}}function t(a,d,e,f,g,i,j,k){c.info.render.vertices+=3;c.info.render.faces++;wb(k.opacity);xb(k.blending);E=a.positionScreen.x;F=a.positionScreen.y;G=d.positionScreen.x;H=d.positionScreen.y;I=e.positionScreen.x;J=e.positionScreen.y;v(E,F,G,H,I,J);if((k instanceof THREE.MeshLambertMaterial||k instanceof THREE.MeshPhongMaterial)&&k.map===null){V.copy(k.color);W.copy(k.emissive);if(k.vertexColors===THREE.FaceColors){V.multiply(j.color)}if(k.wireframe===false&&k.shading==THREE.SmoothShading&&j.vertexNormalsLength==3){R.copy(lb);S.copy(lb);T.copy(lb);q(j.v1.positionWorld,j.vertexNormalsModel[0],R);q(j.v2.positionWorld,j.vertexNormalsModel[1],S);q(j.v3.positionWorld,j.vertexNormalsModel[2],T);R.multiply(V).add(W);S.multiply(V).add(W);T.multiply(V).add(W);U.addColors(S,T).multiplyScalar(.5);ab=Gb(R,S,T,U);Fb(E,F,G,H,I,J,0,0,1,0,0,1,ab)}else{Q.copy(lb);q(j.centroidModel,j.normalModel,Q);Q.multiply(V).add(W);k.wireframe===true?x(Q,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):vb(Q)}}else if(k instanceof THREE.MeshBasicMaterial||k instanceof THREE.MeshLambertMaterial||k instanceof THREE.MeshPhongMaterial){if(k.map!==null){if(k.map.mapping instanceof THREE.UVMapping){bb=j.uvs[0];Eb(E,F,G,H,I,J,bb[f].x,bb[f].y,bb[g].x,bb[g].y,bb[i].x,bb[i].y,k.map)}}else if(k.envMap!==null){if(k.envMap.mapping instanceof THREE.SphericalReflectionMapping){ob.copy(j.vertexNormalsModelView[f]);cb=.5*ob.x+.5;db=.5*ob.y+.5;ob.copy(j.vertexNormalsModelView[g]);eb=.5*ob.x+.5;fb=.5*ob.y+.5;ob.copy(j.vertexNormalsModelView[i]);gb=.5*ob.x+.5;hb=.5*ob.y+.5;Eb(E,F,G,H,I,J,cb,db,eb,fb,gb,hb,k.envMap)}}else{Q.copy(k.color);if(k.vertexColors===THREE.FaceColors){Q.multiply(j.color)}k.wireframe===true?x(Q,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):vb(Q)}}else if(k instanceof THREE.MeshDepthMaterial){$=h.near;_=h.far;R.r=R.g=R.b=1-b(a.positionScreen.z*a.positionScreen.w,$,_);S.r=S.g=S.b=1-b(d.positionScreen.z*d.positionScreen.w,$,_);T.r=T.g=T.b=1-b(e.positionScreen.z*e.positionScreen.w,$,_);U.addColors(S,T).multiplyScalar(.5);ab=Gb(R,S,T,U);Fb(E,F,G,H,I,J,0,0,1,0,0,1,ab)}else if(k instanceof THREE.MeshNormalMaterial){var l;if(k.shading==THREE.FlatShading){l=j.normalModelView;Q.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5);k.wireframe===true?x(Q,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):vb(Q)}else if(k.shading==THREE.SmoothShading){l=j.vertexNormalsModelView[f];R.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5);l=j.vertexNormalsModelView[g];S.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5);l=j.vertexNormalsModelView[i];T.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5);U.addColors(S,T).multiplyScalar(.5);ab=Gb(R,S,T,U);Fb(E,F,G,H,I,J,0,0,1,0,0,1,ab)}}}function u(a,d,e,f,g,i,j,k){c.info.render.vertices+=4;c.info.render.faces++;wb(k.opacity);xb(k.blending);if(k.map!==undefined&&k.map!==null||k.envMap!==undefined&&k.envMap!==null){t(a,d,f,0,1,3,j,k);t(g,e,i,1,2,3,j,k);return}E=a.positionScreen.x;F=a.positionScreen.y;G=d.positionScreen.x;H=d.positionScreen.y;I=e.positionScreen.x;J=e.positionScreen.y;K=f.positionScreen.x;L=f.positionScreen.y;M=g.positionScreen.x;N=g.positionScreen.y;O=i.positionScreen.x;P=i.positionScreen.y;if(k instanceof THREE.MeshLambertMaterial||k instanceof THREE.MeshPhongMaterial){V.copy(k.color);W.copy(k.emissive);if(k.vertexColors===THREE.FaceColors){V.multiply(j.color)}if(k.wireframe===false&&k.shading==THREE.SmoothShading&&j.vertexNormalsLength==4){R.copy(lb);S.copy(lb);T.copy(lb);U.copy(lb);q(j.v1.positionWorld,j.vertexNormalsModel[0],R);q(j.v2.positionWorld,j.vertexNormalsModel[1],S);q(j.v4.positionWorld,j.vertexNormalsModel[3],T);q(j.v3.positionWorld,j.vertexNormalsModel[2],U);R.multiply(V).add(W);S.multiply(V).add(W);T.multiply(V).add(W);U.multiply(V).add(W);ab=Gb(R,S,T,U);v(E,F,G,H,K,L);Fb(E,F,G,H,K,L,0,0,1,0,0,1,ab);v(M,N,I,J,O,P);Fb(M,N,I,J,O,P,1,0,1,1,0,1,ab)}else{Q.copy(lb);q(j.centroidModel,j.normalModel,Q);Q.multiply(V).add(W);w(E,F,G,H,I,J,K,L);k.wireframe===true?x(Q,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):vb(Q)}}else if(k instanceof THREE.MeshBasicMaterial){Q.copy(k.color);if(k.vertexColors===THREE.FaceColors){Q.multiply(j.color)}w(E,F,G,H,I,J,K,L);k.wireframe===true?x(Q,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):vb(Q)}else if(k instanceof THREE.MeshNormalMaterial){var l;if(k.shading==THREE.FlatShading){l=j.normalModelView;Q.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5);w(E,F,G,H,I,J,K,L);k.wireframe===true?x(Q,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):vb(Q)}else if(k.shading==THREE.SmoothShading){l=j.vertexNormalsModelView[0];R.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5);
l=j.vertexNormalsModelView[1];S.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5);l=j.vertexNormalsModelView[3];T.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5);l=j.vertexNormalsModelView[2];U.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5);ab=Gb(R,S,T,U);v(E,F,G,H,K,L);Fb(E,F,G,H,K,L,0,0,1,0,0,1,ab);v(M,N,I,J,O,P);Fb(M,N,I,J,O,P,1,0,1,1,0,1,ab)}}else if(k instanceof THREE.MeshDepthMaterial){$=h.near;_=h.far;R.r=R.g=R.b=1-b(a.positionScreen.z*a.positionScreen.w,$,_);S.r=S.g=S.b=1-b(d.positionScreen.z*d.positionScreen.w,$,_);T.r=T.g=T.b=1-b(f.positionScreen.z*f.positionScreen.w,$,_);U.r=U.g=U.b=1-b(e.positionScreen.z*e.positionScreen.w,$,_);ab=Gb(R,S,T,U);v(E,F,G,H,K,L);Fb(E,F,G,H,K,L,0,0,1,0,0,1,ab);v(M,N,I,J,O,P);Fb(M,N,I,J,O,P,1,0,1,1,0,1,ab)}}function v(a,b,c,d,e,f){m.beginPath();m.moveTo(a,b);m.lineTo(c,d);m.lineTo(e,f);m.closePath()}function w(a,b,c,d,e,f,g,h){m.beginPath();m.moveTo(a,b);m.lineTo(c,d);m.lineTo(e,f);m.lineTo(g,h);m.closePath()}function x(a,b,c,d){yb(b);zb(c);Ab(d);Bb(a.getStyle());m.stroke();kb.expandByScalar(b*2)}function vb(a){Cb(a.getStyle());m.fill()}function Eb(a,b,c,d,e,f,g,h,i,j,k,l,n){if(n instanceof THREE.DataTexture||n.image===undefined||n.image.width==0)return;if(n.needsUpdate===true){var o=n.wrapS==THREE.RepeatWrapping;var p=n.wrapT==THREE.RepeatWrapping;Y[n.id]=m.createPattern(n.image,o===true&&p===true?"repeat":o===true&&p===false?"repeat-x":o===false&&p===true?"repeat-y":"no-repeat");n.needsUpdate=false}Y[n.id]===undefined?Cb("rgba(0,0,0,1)"):Cb(Y[n.id]);var q,r,s,t,u,v,w,x,y=n.offset.x/n.repeat.x,z=n.offset.y/n.repeat.y,A=n.image.width*n.repeat.x,B=n.image.height*n.repeat.y;g=(g+y)*A;h=(1-h+z)*B;i=(i+y)*A;j=(1-j+z)*B;k=(k+y)*A;l=(1-l+z)*B;c-=a;d-=b;e-=a;f-=b;i-=g;j-=h;k-=g;l-=h;w=i*l-k*j;if(w===0){if(Z[n.id]===undefined){var C=document.createElement("canvas");C.width=n.image.width;C.height=n.image.height;var D=C.getContext("2d");D.drawImage(n.image,0,0);Z[n.id]=D.getImageData(0,0,n.image.width,n.image.height).data}var E=Z[n.id];var F=(Math.floor(g)+Math.floor(h)*n.image.width)*4;Q.setRGB(E[F]/255,E[F+1]/255,E[F+2]/255);vb(Q);return}x=1/w;q=(l*c-j*e)*x;r=(l*d-j*f)*x;s=(i*e-k*c)*x;t=(i*f-k*d)*x;u=a-q*g-s*h;v=b-r*g-t*h;m.save();m.transform(q,r,s,t,u,v);m.fill();m.restore()}function Fb(a,b,c,d,e,f,g,h,i,j,k,l,n){var o,p,q,r,s,t,u,v,w=n.width-1,x=n.height-1;g*=w;h*=x;i*=w;j*=x;k*=w;l*=x;c-=a;d-=b;e-=a;f-=b;i-=g;j-=h;k-=g;l-=h;u=i*l-k*j;v=1/u;o=(l*c-j*e)*v;p=(l*d-j*f)*v;q=(i*e-k*c)*v;r=(i*f-k*d)*v;s=a-o*g-q*h;t=b-p*g-r*h;m.save();m.transform(o,p,q,r,s,t);m.clip();m.drawImage(n,0,0);m.restore()}function Gb(a,b,c,d){sb[0]=a.r*255|0;sb[1]=a.g*255|0;sb[2]=a.b*255|0;sb[4]=b.r*255|0;sb[5]=b.g*255|0;sb[6]=b.b*255|0;sb[8]=c.r*255|0;sb[9]=c.g*255|0;sb[10]=c.b*255|0;sb[12]=d.r*255|0;sb[13]=d.g*255|0;sb[14]=d.b*255|0;qb.putImageData(rb,0,0);ub.drawImage(pb,0,0);return tb}function Hb(a,b){var c=b.x-a.x,d=b.y-a.y,e=c*c+d*d,f;if(e===0)return;f=1/Math.sqrt(e);c*=f;d*=f;b.x+=c;b.y+=d;a.x-=c;a.y-=d}};function wb(a){if(p!==a){m.globalAlpha=a;p=a}}function xb(a){if(q!==a){if(a===THREE.NormalBlending){m.globalCompositeOperation="source-over"}else if(a===THREE.AdditiveBlending){m.globalCompositeOperation="lighter"}else if(a===THREE.SubtractiveBlending){m.globalCompositeOperation="darker"}q=a}}function yb(a){if(t!==a){m.lineWidth=a;t=a}}function zb(a){if(u!==a){m.lineCap=a;u=a}}function Ab(a){if(v!==a){m.lineJoin=a;v=a}}function Bb(a){if(r!==a){m.strokeStyle=a;r=a}}function Cb(a){if(s!==a){m.fillStyle=a;s=a}}function Db(a,b){if(w!==a||x!==b){m.setLineDash([a,b]);w=a;x=b}}};THREE.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix 	+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","vec3 shadowZ = vec3( shadowCoord.z );","shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));","shadowKernel[0] *= vec3(0.25);","shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));","shadowKernel[1] *= vec3(0.25);","shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));","shadowKernel[2] *= vec3(0.25);","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")};
THREE.UniformsUtils={merge:function(a){var b,c,d,e={};for(b=0;b<a.length;b++){d=this.clone(a[b]);for(c in d){e[c]=d[c]}}return e},clone:function(a){var b,c,d,e,f={};for(b in a){f[b]={};for(c in a[b]){e=a[b][c];if(e instanceof THREE.Color||e instanceof THREE.Vector2||e instanceof THREE.Vector3||e instanceof THREE.Vector4||e instanceof THREE.Matrix4||e instanceof THREE.Texture){f[b][c]=e.clone()}else if(e instanceof Array){f[b][c]=e.slice()}else{f[b][c]=e}}}return f}};THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["shadowmap"]]),vertexShader:[THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["skinbase_vertex"],"#ifdef USE_ENVMAP",THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"#endif",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],"void main() {","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_lambert_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_lambert_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["bump"],THREE.UniformsLib["normalmap"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_phong_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"vNormal = normalize( transformedNormal );",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_phong_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["lights_phong_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["bumpmap_pars_fragment"],THREE.ShaderChunk["normalmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],THREE.ShaderChunk["lights_phong_fragment"],THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["particle"],THREE.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_particle_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],"void main() {","gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk["map_particle_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk["color_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk["morphtarget_pars_vertex"],"void main() {","vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["default_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],"void main() {",THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],"void main() {",THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}};THREE.WebGLRenderer=function(a){console.log("THREE.WebGLRenderer",THREE.REVISION);a=a||{};var b=a.canvas!==undefined?a.canvas:document.createElement("canvas"),c=a.precision!==undefined?a.precision:"highp",d=a.alpha!==undefined?a.alpha:true,e=a.premultipliedAlpha!==undefined?a.premultipliedAlpha:true,f=a.antialias!==undefined?a.antialias:false,g=a.stencil!==undefined?a.stencil:true,h=a.preserveDrawingBuffer!==undefined?a.preserveDrawingBuffer:false,i=new THREE.Color(0),j=0;if(a.clearColor!==undefined){console.warn("DEPRECATED: clearColor in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead.");i.setHex(a.clearColor)}if(a.clearAlpha!==undefined){console.warn("DEPRECATED: clearAlpha in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead.");j=a.clearAlpha}this.domElement=b;this.context=null;this.devicePixelRatio=a.devicePixelRatio!==undefined?a.devicePixelRatio:window.devicePixelRatio!==undefined?window.devicePixelRatio:1;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.autoUpdateObjects=true;this.gammaInput=false;this.gammaOutput=false;this.physicallyBasedShading=false;this.shadowMapEnabled=false;this.shadowMapAutoUpdate=true;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapDebug=false;this.shadowMapCascade=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.renderPluginsPre=[];this.renderPluginsPost=[];this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var k=this,l=[],m=0,n=null,o=null,p=-1,q=null,r=null,s=0,t=0,u=-1,v=-1,w=-1,x=-1,y=-1,z=-1,A=-1,B=-1,C=null,D=null,E=null,F=null,G=0,H=0,I=0,J=0,K=0,L=0,M={},N=new THREE.Frustum,O=new THREE.Matrix4,P=new THREE.Matrix4,Q=new THREE.Vector3,R=new THREE.Vector3,S=true,T={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}};var U;var V;var W;var X;var Y;_c();ad();this.context=U;var Z=U.getParameter(U.MAX_TEXTURE_IMAGE_UNITS);var $=U.getParameter(U.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var _=U.getParameter(U.MAX_TEXTURE_SIZE);var ab=U.getParameter(U.MAX_CUBE_MAP_TEXTURE_SIZE);var bb=X?U.getParameter(X.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;var cb=$>0;var db=cb&&V;var eb=Y?U.getParameter(U.COMPRESSED_TEXTURE_FORMATS):[];var fb=U.getShaderPrecisionFormat(U.VERTEX_SHADER,U.HIGH_FLOAT);var gb=U.getShaderPrecisionFormat(U.VERTEX_SHADER,U.MEDIUM_FLOAT);var hb=U.getShaderPrecisionFormat(U.VERTEX_SHADER,U.LOW_FLOAT);var ib=U.getShaderPrecisionFormat(U.FRAGMENT_SHADER,U.HIGH_FLOAT);var jb=U.getShaderPrecisionFormat(U.FRAGMENT_SHADER,U.MEDIUM_FLOAT);var kb=U.getShaderPrecisionFormat(U.FRAGMENT_SHADER,U.LOW_FLOAT);var lb=U.getShaderPrecisionFormat(U.VERTEX_SHADER,U.HIGH_INT);var mb=U.getShaderPrecisionFormat(U.VERTEX_SHADER,U.MEDIUM_INT);var nb=U.getShaderPrecisionFormat(U.VERTEX_SHADER,U.LOW_INT);var ob=U.getShaderPrecisionFormat(U.FRAGMENT_SHADER,U.HIGH_INT);var pb=U.getShaderPrecisionFormat(U.FRAGMENT_SHADER,U.MEDIUM_INT);var qb=U.getShaderPrecisionFormat(U.FRAGMENT_SHADER,U.LOW_INT);var rb=fb.precision>0&&ib.precision>0;var sb=gb.precision>0&&jb.precision>0;if(c==="highp"&&!rb){if(sb){c="mediump";console.warn("WebGLRenderer: highp not supported, using mediump")}else{c="lowp";console.warn("WebGLRenderer: highp and mediump not supported, using lowp")}}if(c==="mediump"&&!sb){c="lowp";console.warn("WebGLRenderer: mediump not supported, using lowp")}this.getContext=function(){return U};this.supportsVertexTextures=function(){return cb};this.supportsFloatTextures=function(){return V};this.supportsStandardDerivatives=function(){return W};this.supportsCompressedTextureS3TC=function(){return Y};this.getMaxAnisotropy=function(){return bb};this.getPrecision=function(){return c};this.setSize=function(a,c,d){b.width=a*this.devicePixelRatio;b.height=c*this.devicePixelRatio;if(this.devicePixelRatio!==1&&d!==false){b.style.width=a+"px";
b.style.height=c+"px"}this.setViewport(0,0,b.width,b.height)};this.setViewport=function(a,c,d,e){G=a!==undefined?a:0;H=c!==undefined?c:0;I=d!==undefined?d:b.width;J=e!==undefined?e:b.height;U.viewport(G,H,I,J)};this.setScissor=function(a,b,c,d){U.scissor(a,b,c,d)};this.enableScissorTest=function(a){a?U.enable(U.SCISSOR_TEST):U.disable(U.SCISSOR_TEST)};this.setClearColor=function(a,b){i.set(a);j=b!==undefined?b:1;U.clearColor(i.r,i.g,i.b,j)};this.setClearColorHex=function(a,b){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(a,b)};this.getClearColor=function(){return i};this.getClearAlpha=function(){return j};this.clear=function(a,b,c){var d=0;if(a===undefined||a)d|=U.COLOR_BUFFER_BIT;if(b===undefined||b)d|=U.DEPTH_BUFFER_BIT;if(c===undefined||c)d|=U.STENCIL_BUFFER_BIT;U.clear(d)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,c,d)};this.addPostPlugin=function(a){a.init(this);this.renderPluginsPost.push(a)};this.addPrePlugin=function(a){a.init(this);this.renderPluginsPre.push(a)};this.updateShadowMap=function(a,b){n=null;w=-1;A=-1;B=-1;q=-1;p=-1;S=true;u=-1;v=-1;this.shadowMapPlugin.update(a,b)};function tb(a){a.__webglVertexBuffer=U.createBuffer();a.__webglColorBuffer=U.createBuffer();k.info.memory.geometries++}function ub(a){a.__webglVertexBuffer=U.createBuffer();a.__webglColorBuffer=U.createBuffer();a.__webglLineDistanceBuffer=U.createBuffer();k.info.memory.geometries++}function vb(a){a.__webglVertexBuffer=U.createBuffer();a.__webglColorBuffer=U.createBuffer();a.__webglNormalBuffer=U.createBuffer();k.info.memory.geometries++}function wb(a){a.__webglVertexBuffer=U.createBuffer();a.__webglNormalBuffer=U.createBuffer();a.__webglTangentBuffer=U.createBuffer();a.__webglColorBuffer=U.createBuffer();a.__webglUVBuffer=U.createBuffer();a.__webglUV2Buffer=U.createBuffer();a.__webglSkinIndicesBuffer=U.createBuffer();a.__webglSkinWeightsBuffer=U.createBuffer();a.__webglFaceBuffer=U.createBuffer();a.__webglLineBuffer=U.createBuffer();var b,c;if(a.numMorphTargets){a.__webglMorphTargetsBuffers=[];for(b=0,c=a.numMorphTargets;b<c;b++){a.__webglMorphTargetsBuffers.push(U.createBuffer())}}if(a.numMorphNormals){a.__webglMorphNormalsBuffers=[];for(b=0,c=a.numMorphNormals;b<c;b++){a.__webglMorphNormalsBuffers.push(U.createBuffer())}}k.info.memory.geometries++}var xb=function(a){var b=a.target;b.removeEventListener("dispose",xb);Bb(b);k.info.memory.geometries--};var yb=function(a){var b=a.target;b.removeEventListener("dispose",yb);Cb(b);k.info.memory.textures--};var zb=function(a){var b=a.target;b.removeEventListener("dispose",zb);Db(b);k.info.memory.textures--};var Ab=function(a){var b=a.target;b.removeEventListener("dispose",Ab);Eb(b)};var Bb=function(a){a.__webglInit=undefined;if(a.__webglVertexBuffer!==undefined)U.deleteBuffer(a.__webglVertexBuffer);if(a.__webglNormalBuffer!==undefined)U.deleteBuffer(a.__webglNormalBuffer);if(a.__webglTangentBuffer!==undefined)U.deleteBuffer(a.__webglTangentBuffer);if(a.__webglColorBuffer!==undefined)U.deleteBuffer(a.__webglColorBuffer);if(a.__webglUVBuffer!==undefined)U.deleteBuffer(a.__webglUVBuffer);if(a.__webglUV2Buffer!==undefined)U.deleteBuffer(a.__webglUV2Buffer);if(a.__webglSkinIndicesBuffer!==undefined)U.deleteBuffer(a.__webglSkinIndicesBuffer);if(a.__webglSkinWeightsBuffer!==undefined)U.deleteBuffer(a.__webglSkinWeightsBuffer);if(a.__webglFaceBuffer!==undefined)U.deleteBuffer(a.__webglFaceBuffer);if(a.__webglLineBuffer!==undefined)U.deleteBuffer(a.__webglLineBuffer);if(a.__webglLineDistanceBuffer!==undefined)U.deleteBuffer(a.__webglLineDistanceBuffer);if(a.geometryGroups!==undefined){for(var b in a.geometryGroups){var c=a.geometryGroups[b];if(c.numMorphTargets!==undefined){for(var d=0,e=c.numMorphTargets;d<e;d++){U.deleteBuffer(c.__webglMorphTargetsBuffers[d])}}if(c.numMorphNormals!==undefined){for(var d=0,e=c.numMorphNormals;d<e;d++){U.deleteBuffer(c.__webglMorphNormalsBuffers[d])}}Fb(c)}}Fb(a)};var Cb=function(a){if(a.image&&a.image.__webglTextureCube){U.deleteTexture(a.image.__webglTextureCube)}else{if(!a.__webglInit)return;a.__webglInit=false;U.deleteTexture(a.__webglTexture)}};var Db=function(a){if(!a||!a.__webglTexture)return;U.deleteTexture(a.__webglTexture);if(a instanceof THREE.WebGLRenderTargetCube){for(var b=0;b<6;b++){U.deleteFramebuffer(a.__webglFramebuffer[b]);U.deleteRenderbuffer(a.__webglRenderbuffer[b])}}else{U.deleteFramebuffer(a.__webglFramebuffer);U.deleteRenderbuffer(a.__webglRenderbuffer)}};var Eb=function(a){var b=a.program;if(b===undefined)return;a.program=undefined;var c,d,e;var f=false;for(c=0,d=l.length;c<d;c++){e=l[c];if(e.program===b){e.usedTimes--;if(e.usedTimes===0){f=true}break}}if(f===true){var g=[];for(c=0,d=l.length;c<d;c++){e=l[c];if(e.program!==b){g.push(e)}}l=g;U.deleteProgram(b);k.info.memory.programs--}};function Fb(a){if(a.__webglCustomAttributesList){for(var b in a.__webglCustomAttributesList){U.deleteBuffer(a.__webglCustomAttributesList[b].buffer)}}}function Gb(a,b){var c=a.vertices.length;var d=b.material;if(d.attributes){if(a.__webglCustomAttributesList===undefined){a.__webglCustomAttributesList=[]}for(var e in d.attributes){var f=d.attributes[e];if(!f.__webglInitialized||f.createUniqueBuffers){f.__webglInitialized=true;var g=1;if(f.type==="v2")g=2;else if(f.type==="v3")g=3;else if(f.type==="v4")g=4;else if(f.type==="c")g=3;f.size=g;f.array=new Float32Array(c*g);f.buffer=U.createBuffer();f.buffer.belongsToAttribute=e;f.needsUpdate=true}a.__webglCustomAttributesList.push(f)}}}function Hb(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(c*3);a.__colorArray=new Float32Array(c*3);a.__sortArray=[];a.__webglParticleCount=c;Gb(a,b)}function Ib(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(c*3);a.__colorArray=new Float32Array(c*3);a.__lineDistanceArray=new Float32Array(c*1);a.__webglLineCount=c;Gb(a,b)}function Jb(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(c*3);a.__colorArray=new Float32Array(c*3);a.__normalArray=new Float32Array(c*3);a.__webglVertexCount=c;Gb(a,b)}function Kb(a,b){var c=b.geometry,d=a.faces3,e=a.faces4,f=d.length*3+e.length*4,g=d.length*1+e.length*2,h=d.length*3+e.length*4,i=Lb(b,a),j=Pb(i),k=Nb(i),l=Ob(i);a.__vertexArray=new Float32Array(f*3);if(k){a.__normalArray=new Float32Array(f*3)}if(c.hasTangents){a.__tangentArray=new Float32Array(f*4)}if(l){a.__colorArray=new Float32Array(f*3)}if(j){if(c.faceUvs.length>0||c.faceVertexUvs.length>0){a.__uvArray=new Float32Array(f*2)}if(c.faceUvs.length>1||c.faceVertexUvs.length>1){a.__uv2Array=new Float32Array(f*2)}}if(b.geometry.skinWeights.length&&b.geometry.skinIndices.length){a.__skinIndexArray=new Float32Array(f*4);a.__skinWeightArray=new Float32Array(f*4)}a.__faceArray=new Uint16Array(g*3);a.__lineArray=new Uint16Array(h*2);var m,n;if(a.numMorphTargets){a.__morphTargetsArrays=[];for(m=0,n=a.numMorphTargets;m<n;m++){a.__morphTargetsArrays.push(new Float32Array(f*3))}}if(a.numMorphNormals){a.__morphNormalsArrays=[];for(m=0,n=a.numMorphNormals;m<n;m++){a.__morphNormalsArrays.push(new Float32Array(f*3))}}a.__webglFaceCount=g*3;a.__webglLineCount=h*2;if(i.attributes){if(a.__webglCustomAttributesList===undefined){a.__webglCustomAttributesList=[]}for(var o in i.attributes){var p=i.attributes[o];var q={};for(var r in p){q[r]=p[r]}if(!q.__webglInitialized||q.createUniqueBuffers){q.__webglInitialized=true;var s=1;if(q.type==="v2")s=2;else if(q.type==="v3")s=3;else if(q.type==="v4")s=4;else if(q.type==="c")s=3;q.size=s;q.array=new Float32Array(f*s);q.buffer=U.createBuffer();q.buffer.belongsToAttribute=o;p.needsUpdate=true;q.__original=p}a.__webglCustomAttributesList.push(q)}}a.__inittedArrays=true}function Lb(a,b){return a.material instanceof THREE.MeshFaceMaterial?a.material.materials[b.materialIndex]:a.material}function Mb(a){return a&&a.shading!==undefined&&a.shading===THREE.SmoothShading}function Nb(a){if(a instanceof THREE.MeshBasicMaterial&&!a.envMap||a instanceof THREE.MeshDepthMaterial){return false}if(Mb(a)){return THREE.SmoothShading}else{return THREE.FlatShading}}function Ob(a){if(a.vertexColors){return a.vertexColors}return false}function Pb(a){if(a.map||a.lightMap||a.bumpMap||a.normalMap||a.specularMap||a instanceof THREE.ShaderMaterial){return true}return false}function Qb(a){var b,c,d;for(b in a.attributes){if(b==="index"){d=U.ELEMENT_ARRAY_BUFFER}else{d=U.ARRAY_BUFFER}c=a.attributes[b];c.buffer=U.createBuffer();U.bindBuffer(d,c.buffer);U.bufferData(d,c.array,U.STATIC_DRAW)}}function Rb(a,b,c){var d,e,f,g,h,i,j=a.vertices,k=j.length,l=a.colors,m=l.length,n=a.__vertexArray,o=a.__colorArray,p=a.__sortArray,q=a.verticesNeedUpdate,r=a.elementsNeedUpdate,s=a.colorsNeedUpdate,t=a.__webglCustomAttributesList,u,v,w,x,y,z,A;if(c.sortParticles){P.copy(O);P.multiply(c.matrixWorld);for(d=0;d<k;d++){f=j[d];Q.copy(f);Q.applyProjection(P);p[d]=[Q.z,d]}p.sort($b);for(d=0;d<k;d++){f=j[p[d][1]];g=d*3;n[g]=f.x;n[g+1]=f.y;n[g+2]=f.z}for(e=0;e<m;e++){g=e*3;i=l[p[e][1]];o[g]=i.r;o[g+1]=i.g;o[g+2]=i.b}if(t){for(u=0,v=t.length;u<v;u++){A=t[u];if(!(A.boundTo===undefined||A.boundTo==="vertices"))continue;g=0;y=A.value.length;if(A.size===1){for(x=0;x<y;x++){h=p[x][1];A.array[x]=A.value[h]}}else if(A.size===2){for(x=0;x<y;x++){h=p[x][1];z=A.value[h];A.array[g]=z.x;A.array[g+1]=z.y;g+=2}}else if(A.size===3){if(A.type==="c"){for(x=0;x<y;x++){h=p[x][1];z=A.value[h];A.array[g]=z.r;A.array[g+1]=z.g;A.array[g+2]=z.b;g+=3}}else{for(x=0;x<y;x++){h=p[x][1];z=A.value[h];A.array[g]=z.x;A.array[g+1]=z.y;A.array[g+2]=z.z;g+=3}}}else if(A.size===4){for(x=0;x<y;x++){h=p[x][1];z=A.value[h];A.array[g]=z.x;A.array[g+1]=z.y;A.array[g+2]=z.z;A.array[g+3]=z.w;g+=4}}}}}else{if(q){for(d=0;d<k;d++){f=j[d];g=d*3;n[g]=f.x;n[g+1]=f.y;n[g+2]=f.z}}if(s){for(e=0;e<m;e++){i=l[e];g=e*3;o[g]=i.r;o[g+1]=i.g;o[g+2]=i.b}}if(t){for(u=0,v=t.length;u<v;u++){A=t[u];if(A.needsUpdate&&(A.boundTo===undefined||A.boundTo==="vertices")){y=A.value.length;g=0;if(A.size===1){for(x=0;x<y;x++){A.array[x]=A.value[x]}}else if(A.size===2){for(x=0;x<y;x++){z=A.value[x];A.array[g]=z.x;A.array[g+1]=z.y;g+=2}}else if(A.size===3){if(A.type==="c"){for(x=0;x<y;x++){z=A.value[x];A.array[g]=z.r;A.array[g+1]=z.g;A.array[g+2]=z.b;g+=3}}else{for(x=0;x<y;x++){z=A.value[x];A.array[g]=z.x;A.array[g+1]=z.y;A.array[g+2]=z.z;g+=3}}}else if(A.size===4){for(x=0;x<y;x++){z=A.value[x];A.array[g]=z.x;A.array[g+1]=z.y;A.array[g+2]=z.z;A.array[g+3]=z.w;g+=4}}}}}}if(q||c.sortParticles){U.bindBuffer(U.ARRAY_BUFFER,a.__webglVertexBuffer);U.bufferData(U.ARRAY_BUFFER,n,b)}if(s||c.sortParticles){U.bindBuffer(U.ARRAY_BUFFER,a.__webglColorBuffer);U.bufferData(U.ARRAY_BUFFER,o,b)}if(t){for(u=0,v=t.length;u<v;u++){A=t[u];if(A.needsUpdate||c.sortParticles){U.bindBuffer(U.ARRAY_BUFFER,A.buffer);U.bufferData(U.ARRAY_BUFFER,A.array,b)}}}}function Sb(a,b){var c,d,e,f,g,h,i=a.vertices,j=a.colors,k=a.lineDistances,l=i.length,m=j.length,n=k.length,o=a.__vertexArray,p=a.__colorArray,q=a.__lineDistanceArray,r=a.verticesNeedUpdate,s=a.colorsNeedUpdate,t=a.lineDistancesNeedUpdate,u=a.__webglCustomAttributesList,v,w,x,y,z,A,B;if(r){for(c=0;c<l;c++){f=i[c];g=c*3;o[g]=f.x;o[g+1]=f.y;o[g+2]=f.z}U.bindBuffer(U.ARRAY_BUFFER,a.__webglVertexBuffer);U.bufferData(U.ARRAY_BUFFER,o,b)}if(s){for(d=0;d<m;d++){h=j[d];g=d*3;p[g]=h.r;p[g+1]=h.g;p[g+2]=h.b}U.bindBuffer(U.ARRAY_BUFFER,a.__webglColorBuffer);U.bufferData(U.ARRAY_BUFFER,p,b)}if(t){for(e=0;e<n;e++){q[e]=k[e]}U.bindBuffer(U.ARRAY_BUFFER,a.__webglLineDistanceBuffer);U.bufferData(U.ARRAY_BUFFER,q,b)}if(u){for(v=0,w=u.length;v<w;v++){B=u[v];if(B.needsUpdate&&(B.boundTo===undefined||B.boundTo==="vertices")){g=0;z=B.value.length;if(B.size===1){for(y=0;y<z;y++){B.array[y]=B.value[y]}}else if(B.size===2){for(y=0;y<z;y++){A=B.value[y];B.array[g]=A.x;B.array[g+1]=A.y;g+=2}}else if(B.size===3){if(B.type==="c"){for(y=0;y<z;y++){A=B.value[y];B.array[g]=A.r;B.array[g+1]=A.g;B.array[g+2]=A.b;g+=3}}else{for(y=0;y<z;y++){A=B.value[y];B.array[g]=A.x;B.array[g+1]=A.y;B.array[g+2]=A.z;g+=3}}}else if(B.size===4){for(y=0;y<z;y++){A=B.value[y];B.array[g]=A.x;B.array[g+1]=A.y;B.array[g+2]=A.z;B.array[g+3]=A.w;g+=4}}U.bindBuffer(U.ARRAY_BUFFER,B.buffer);U.bufferData(U.ARRAY_BUFFER,B.array,b)}}}}function Tb(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p=a.vertices,q=a.colors,r=a.normals,s=p.length,t=q.length,u=r.length,v=a.__vertexArray,w=a.__colorArray,x=a.__normalArray,y=a.verticesNeedUpdate,z=a.colorsNeedUpdate,A=a.normalsNeedUpdate,B=a.__webglCustomAttributesList;if(y){for(c=0;c<s;c++){f=p[c];g=c*3;v[g]=f.x;v[g+1]=f.y;v[g+2]=f.z}U.bindBuffer(U.ARRAY_BUFFER,a.__webglVertexBuffer);U.bufferData(U.ARRAY_BUFFER,v,b)}if(z){for(d=0;d<t;d++){h=q[d];g=d*3;w[g]=h.r;w[g+1]=h.g;w[g+2]=h.b}U.bindBuffer(U.ARRAY_BUFFER,a.__webglColorBuffer);U.bufferData(U.ARRAY_BUFFER,w,b)}if(A){for(e=0;e<u;e++){i=r[e];g=e*3;x[g]=i.x;x[g+1]=i.y;x[g+2]=i.z}U.bindBuffer(U.ARRAY_BUFFER,a.__webglNormalBuffer);U.bufferData(U.ARRAY_BUFFER,x,b)}if(B){for(j=0,k=B.length;j<k;j++){n=B[j];if(n.needsUpdate&&(n.boundTo===undefined||n.boundTo==="vertices")){g=0;m=n.value.length;if(n.size===1){for(l=0;l<m;l++){n.array[l]=n.value[l]}}else if(n.size===2){for(l=0;l<m;l++){o=n.value[l];n.array[g]=o.x;n.array[g+1]=o.y;g+=2}}else if(n.size===3){if(n.type==="c"){for(l=0;l<m;l++){o=n.value[l];n.array[g]=o.r;n.array[g+1]=o.g;n.array[g+2]=o.b;g+=3}}else{for(l=0;l<m;l++){o=n.value[l];n.array[g]=o.x;n.array[g+1]=o.y;n.array[g+2]=o.z;g+=3}}}else if(n.size===4){for(l=0;l<m;l++){o=n.value[l];n.array[g]=o.x;n.array[g+1]=o.y;n.array[g+2]=o.z;n.array[g+3]=o.w;g+=4}}U.bindBuffer(U.ARRAY_BUFFER,n.buffer);U.bufferData(U.ARRAY_BUFFER,n.array,b)}}}}function Ub(a,b,c,d,e){if(!a.__inittedArrays){return}var f=Nb(e),g=Ob(e),h=Pb(e),i=f===THREE.SmoothShading;var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob=0,pb=0,qb=0,rb=0,sb=0,tb=0,ub=0,vb=0,wb=0,xb=0,yb=0,zb=0,Ab=0,Bb,Cb=a.__vertexArray,Db=a.__uvArray,Eb=a.__uv2Array,Fb=a.__normalArray,Gb=a.__tangentArray,Hb=a.__colorArray,Ib=a.__skinIndexArray,Jb=a.__skinWeightArray,Kb=a.__morphTargetsArrays,Lb=a.__morphNormalsArrays,Mb=a.__webglCustomAttributesList,Qb,Rb=a.__faceArray,Sb=a.__lineArray,Tb=b.geometry,Ub=Tb.verticesNeedUpdate,Vb=Tb.elementsNeedUpdate,Wb=Tb.uvsNeedUpdate,Xb=Tb.normalsNeedUpdate,Yb=Tb.tangentsNeedUpdate,Zb=Tb.colorsNeedUpdate,$b=Tb.morphTargetsNeedUpdate,_b=Tb.vertices,ac=a.faces3,bc=a.faces4,cc=Tb.faces,dc=Tb.faceVertexUvs[0],ec=Tb.faceVertexUvs[1],fc=Tb.colors,gc=Tb.skinIndices,hc=Tb.skinWeights,ic=Tb.morphTargets,jc=Tb.morphNormals;if(Ub){for(j=0,k=ac.length;j<k;j++){m=cc[ac[j]];v=_b[m.a];w=_b[m.b];x=_b[m.c];Cb[pb]=v.x;Cb[pb+1]=v.y;Cb[pb+2]=v.z;Cb[pb+3]=w.x;Cb[pb+4]=w.y;Cb[pb+5]=w.z;Cb[pb+6]=x.x;Cb[pb+7]=x.y;Cb[pb+8]=x.z;pb+=9}for(j=0,k=bc.length;j<k;j++){m=cc[bc[j]];v=_b[m.a];w=_b[m.b];x=_b[m.c];y=_b[m.d];Cb[pb]=v.x;Cb[pb+1]=v.y;Cb[pb+2]=v.z;Cb[pb+3]=w.x;Cb[pb+4]=w.y;Cb[pb+5]=w.z;Cb[pb+6]=x.x;Cb[pb+7]=x.y;Cb[pb+8]=x.z;Cb[pb+9]=y.x;Cb[pb+10]=y.y;Cb[pb+11]=y.z;pb+=12}U.bindBuffer(U.ARRAY_BUFFER,a.__webglVertexBuffer);U.bufferData(U.ARRAY_BUFFER,Cb,c)}if($b){for(hb=0,ib=ic.length;hb<ib;hb++){yb=0;for(j=0,k=ac.length;j<k;j++){lb=ac[j];m=cc[lb];v=ic[hb].vertices[m.a];w=ic[hb].vertices[m.b];x=ic[hb].vertices[m.c];jb=Kb[hb];jb[yb]=v.x;jb[yb+1]=v.y;jb[yb+2]=v.z;jb[yb+3]=w.x;jb[yb+4]=w.y;jb[yb+5]=w.z;jb[yb+6]=x.x;jb[yb+7]=x.y;jb[yb+8]=x.z;if(e.morphNormals){if(i){mb=jc[hb].vertexNormals[lb];D=mb.a;E=mb.b;F=mb.c}else{D=jc[hb].faceNormals[lb];E=D;F=D}kb=Lb[hb];kb[yb]=D.x;kb[yb+1]=D.y;kb[yb+2]=D.z;kb[yb+3]=E.x;kb[yb+4]=E.y;kb[yb+5]=E.z;kb[yb+6]=F.x;kb[yb+7]=F.y;kb[yb+8]=F.z}yb+=9}for(j=0,k=bc.length;j<k;j++){lb=bc[j];m=cc[lb];v=ic[hb].vertices[m.a];w=ic[hb].vertices[m.b];x=ic[hb].vertices[m.c];y=ic[hb].vertices[m.d];jb=Kb[hb];jb[yb]=v.x;jb[yb+1]=v.y;jb[yb+2]=v.z;jb[yb+3]=w.x;jb[yb+4]=w.y;jb[yb+5]=w.z;jb[yb+6]=x.x;jb[yb+7]=x.y;jb[yb+8]=x.z;jb[yb+9]=y.x;jb[yb+10]=y.y;jb[yb+11]=y.z;if(e.morphNormals){if(i){mb=jc[hb].vertexNormals[lb];D=mb.a;E=mb.b;F=mb.c;G=mb.d}else{D=jc[hb].faceNormals[lb];E=D;F=D;G=D}kb=Lb[hb];kb[yb]=D.x;kb[yb+1]=D.y;kb[yb+2]=D.z;kb[yb+3]=E.x;kb[yb+4]=E.y;kb[yb+5]=E.z;kb[yb+6]=F.x;kb[yb+7]=F.y;kb[yb+8]=F.z;kb[yb+9]=G.x;kb[yb+10]=G.y;kb[yb+11]=G.z}yb+=12}U.bindBuffer(U.ARRAY_BUFFER,a.__webglMorphTargetsBuffers[hb]);U.bufferData(U.ARRAY_BUFFER,Kb[hb],c);if(e.morphNormals){U.bindBuffer(U.ARRAY_BUFFER,a.__webglMorphNormalsBuffers[hb]);U.bufferData(U.ARRAY_BUFFER,Lb[hb],c)}}}if(hc.length){for(j=0,k=ac.length;j<k;j++){m=cc[ac[j]];L=hc[m.a];M=hc[m.b];N=hc[m.c];Jb[xb]=L.x;Jb[xb+1]=L.y;Jb[xb+2]=L.z;Jb[xb+3]=L.w;Jb[xb+4]=M.x;Jb[xb+5]=M.y;Jb[xb+6]=M.z;Jb[xb+7]=M.w;Jb[xb+8]=N.x;Jb[xb+9]=N.y;Jb[xb+10]=N.z;Jb[xb+11]=N.w;P=gc[m.a];Q=gc[m.b];R=gc[m.c];Ib[xb]=P.x;Ib[xb+1]=P.y;Ib[xb+2]=P.z;Ib[xb+3]=P.w;Ib[xb+4]=Q.x;Ib[xb+5]=Q.y;Ib[xb+6]=Q.z;Ib[xb+7]=Q.w;Ib[xb+8]=R.x;Ib[xb+9]=R.y;Ib[xb+10]=R.z;Ib[xb+11]=R.w;xb+=12}for(j=0,k=bc.length;j<k;j++){m=cc[bc[j]];L=hc[m.a];M=hc[m.b];N=hc[m.c];O=hc[m.d];Jb[xb]=L.x;Jb[xb+1]=L.y;Jb[xb+2]=L.z;Jb[xb+3]=L.w;Jb[xb+4]=M.x;Jb[xb+5]=M.y;Jb[xb+6]=M.z;Jb[xb+7]=M.w;Jb[xb+8]=N.x;Jb[xb+9]=N.y;Jb[xb+10]=N.z;Jb[xb+11]=N.w;Jb[xb+12]=O.x;Jb[xb+13]=O.y;Jb[xb+14]=O.z;Jb[xb+15]=O.w;P=gc[m.a];Q=gc[m.b];R=gc[m.c];S=gc[m.d];Ib[xb]=P.x;Ib[xb+1]=P.y;Ib[xb+2]=P.z;Ib[xb+3]=P.w;Ib[xb+4]=Q.x;Ib[xb+5]=Q.y;Ib[xb+6]=Q.z;Ib[xb+7]=Q.w;Ib[xb+8]=R.x;Ib[xb+9]=R.y;Ib[xb+10]=R.z;Ib[xb+11]=R.w;Ib[xb+12]=S.x;Ib[xb+13]=S.y;Ib[xb+14]=S.z;Ib[xb+15]=S.w;xb+=16}if(xb>0){U.bindBuffer(U.ARRAY_BUFFER,a.__webglSkinIndicesBuffer);U.bufferData(U.ARRAY_BUFFER,Ib,c);U.bindBuffer(U.ARRAY_BUFFER,a.__webglSkinWeightsBuffer);U.bufferData(U.ARRAY_BUFFER,Jb,c)}}if(Zb&&g){for(j=0,k=ac.length;j<k;j++){m=cc[ac[j]];q=m.vertexColors;r=m.color;if(q.length===3&&g===THREE.VertexColors){H=q[0];I=q[1];J=q[2]}else{H=r;I=r;J=r}Hb[wb]=H.r;Hb[wb+1]=H.g;Hb[wb+2]=H.b;Hb[wb+3]=I.r;Hb[wb+4]=I.g;Hb[wb+5]=I.b;Hb[wb+6]=J.r;Hb[wb+7]=J.g;Hb[wb+8]=J.b;wb+=9}for(j=0,k=bc.length;j<k;j++){m=cc[bc[j]];q=m.vertexColors;r=m.color;if(q.length===4&&g===THREE.VertexColors){H=q[0];I=q[1];J=q[2];K=q[3]}else{H=r;I=r;J=r;K=r}Hb[wb]=H.r;Hb[wb+1]=H.g;Hb[wb+2]=H.b;Hb[wb+3]=I.r;Hb[wb+4]=I.g;Hb[wb+5]=I.b;Hb[wb+6]=J.r;Hb[wb+7]=J.g;Hb[wb+8]=J.b;Hb[wb+9]=K.r;Hb[wb+10]=K.g;Hb[wb+11]=K.b;wb+=12}if(wb>0){U.bindBuffer(U.ARRAY_BUFFER,a.__webglColorBuffer);U.bufferData(U.ARRAY_BUFFER,Hb,c)}}if(Yb&&Tb.hasTangents){for(j=0,k=ac.length;j<k;j++){m=cc[ac[j]];s=m.vertexTangents;z=s[0];A=s[1];B=s[2];Gb[ub]=z.x;Gb[ub+1]=z.y;Gb[ub+2]=z.z;Gb[ub+3]=z.w;Gb[ub+4]=A.x;Gb[ub+5]=A.y;Gb[ub+6]=A.z;Gb[ub+7]=A.w;Gb[ub+8]=B.x;Gb[ub+9]=B.y;Gb[ub+10]=B.z;Gb[ub+11]=B.w;ub+=12}for(j=0,k=bc.length;j<k;j++){m=cc[bc[j]];s=m.vertexTangents;z=s[0];A=s[1];B=s[2];C=s[3];Gb[ub]=z.x;Gb[ub+1]=z.y;Gb[ub+2]=z.z;Gb[ub+3]=z.w;Gb[ub+4]=A.x;Gb[ub+5]=A.y;Gb[ub+6]=A.z;Gb[ub+7]=A.w;Gb[ub+8]=B.x;Gb[ub+9]=B.y;Gb[ub+10]=B.z;Gb[ub+11]=B.w;Gb[ub+12]=C.x;Gb[ub+13]=C.y;Gb[ub+14]=C.z;Gb[ub+15]=C.w;ub+=16}U.bindBuffer(U.ARRAY_BUFFER,a.__webglTangentBuffer);U.bufferData(U.ARRAY_BUFFER,Gb,c)}if(Xb&&f){for(j=0,k=ac.length;j<k;j++){m=cc[ac[j]];n=m.vertexNormals;o=m.normal;if(n.length===3&&i){for(cb=0;cb<3;cb++){eb=n[cb];Fb[tb]=eb.x;Fb[tb+1]=eb.y;Fb[tb+2]=eb.z;tb+=3}}else{for(cb=0;cb<3;cb++){Fb[tb]=o.x;Fb[tb+1]=o.y;Fb[tb+2]=o.z;tb+=3}}}for(j=0,k=bc.length;j<k;j++){m=cc[bc[j]];n=m.vertexNormals;o=m.normal;if(n.length===4&&i){for(cb=0;cb<4;cb++){eb=n[cb];Fb[tb]=eb.x;Fb[tb+1]=eb.y;Fb[tb+2]=eb.z;tb+=3}}else{for(cb=0;cb<4;cb++){Fb[tb]=o.x;Fb[tb+1]=o.y;Fb[tb+2]=o.z;tb+=3}}}U.bindBuffer(U.ARRAY_BUFFER,a.__webglNormalBuffer);U.bufferData(U.ARRAY_BUFFER,Fb,c)}if(Wb&&dc&&h){for(j=0,k=ac.length;j<k;j++){l=ac[j];t=dc[l];if(t===undefined)continue;for(cb=0;cb<3;cb++){fb=t[cb];Db[qb]=fb.x;Db[qb+1]=fb.y;qb+=2}}for(j=0,k=bc.length;j<k;j++){l=bc[j];t=dc[l];if(t===undefined)continue;for(cb=0;cb<4;cb++){fb=t[cb];Db[qb]=fb.x;Db[qb+1]=fb.y;qb+=2}}if(qb>0){U.bindBuffer(U.ARRAY_BUFFER,a.__webglUVBuffer);U.bufferData(U.ARRAY_BUFFER,Db,c)}}if(Wb&&ec&&h){for(j=0,k=ac.length;j<k;j++){l=ac[j];u=ec[l];if(u===undefined)continue;for(cb=0;cb<3;cb++){gb=u[cb];Eb[rb]=gb.x;Eb[rb+1]=gb.y;rb+=2}}for(j=0,k=bc.length;j<k;j++){l=bc[j];u=ec[l];if(u===undefined)continue;for(cb=0;cb<4;cb++){gb=u[cb];Eb[rb]=gb.x;Eb[rb+1]=gb.y;rb+=2}}if(rb>0){U.bindBuffer(U.ARRAY_BUFFER,a.__webglUV2Buffer);U.bufferData(U.ARRAY_BUFFER,Eb,c)}}if(Vb){for(j=0,k=ac.length;j<k;j++){Rb[sb]=ob;Rb[sb+1]=ob+1;Rb[sb+2]=ob+2;sb+=3;Sb[vb]=ob;Sb[vb+1]=ob+1;Sb[vb+2]=ob;Sb[vb+3]=ob+2;Sb[vb+4]=ob+1;Sb[vb+5]=ob+2;vb+=6;ob+=3}for(j=0,k=bc.length;j<k;j++){Rb[sb]=ob;Rb[sb+1]=ob+1;Rb[sb+2]=ob+3;Rb[sb+3]=ob+1;Rb[sb+4]=ob+2;Rb[sb+5]=ob+3;sb+=6;Sb[vb]=ob;Sb[vb+1]=ob+1;Sb[vb+2]=ob;Sb[vb+3]=ob+3;Sb[vb+4]=ob+1;Sb[vb+5]=ob+2;Sb[vb+6]=ob+2;Sb[vb+7]=ob+3;vb+=8;ob+=4}U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer);U.bufferData(U.ELEMENT_ARRAY_BUFFER,Rb,c);U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,a.__webglLineBuffer);U.bufferData(U.ELEMENT_ARRAY_BUFFER,Sb,c)}if(Mb){for(cb=0,db=Mb.length;cb<db;cb++){Qb=Mb[cb];if(!Qb.__original.needsUpdate)continue;zb=0;Ab=0;if(Qb.size===1){if(Qb.boundTo===undefined||Qb.boundTo==="vertices"){for(j=0,k=ac.length;j<k;j++){m=cc[ac[j]];Qb.array[zb]=Qb.value[m.a];Qb.array[zb+1]=Qb.value[m.b];Qb.array[zb+2]=Qb.value[m.c];zb+=3}for(j=0,k=bc.length;j<k;j++){m=cc[bc[j]];Qb.array[zb]=Qb.value[m.a];Qb.array[zb+1]=Qb.value[m.b];Qb.array[zb+2]=Qb.value[m.c];Qb.array[zb+3]=Qb.value[m.d];zb+=4}}else if(Qb.boundTo==="faces"){for(j=0,k=ac.length;j<k;j++){Bb=Qb.value[ac[j]];Qb.array[zb]=Bb;Qb.array[zb+1]=Bb;Qb.array[zb+2]=Bb;zb+=3}for(j=0,k=bc.length;j<k;j++){Bb=Qb.value[bc[j]];Qb.array[zb]=Bb;Qb.array[zb+1]=Bb;Qb.array[zb+2]=Bb;Qb.array[zb+3]=Bb;zb+=4}}}else if(Qb.size===2){if(Qb.boundTo===undefined||Qb.boundTo==="vertices"){for(j=0,k=ac.length;j<k;j++){m=cc[ac[j]];v=Qb.value[m.a];w=Qb.value[m.b];x=Qb.value[m.c];Qb.array[zb]=v.x;Qb.array[zb+1]=v.y;Qb.array[zb+2]=w.x;Qb.array[zb+3]=w.y;Qb.array[zb+4]=x.x;Qb.array[zb+5]=x.y;zb+=6}for(j=0,k=bc.length;j<k;j++){m=cc[bc[j]];v=Qb.value[m.a];w=Qb.value[m.b];x=Qb.value[m.c];y=Qb.value[m.d];Qb.array[zb]=v.x;Qb.array[zb+1]=v.y;Qb.array[zb+2]=w.x;Qb.array[zb+3]=w.y;Qb.array[zb+4]=x.x;Qb.array[zb+5]=x.y;Qb.array[zb+6]=y.x;Qb.array[zb+7]=y.y;zb+=8}}else if(Qb.boundTo==="faces"){for(j=0,k=ac.length;j<k;j++){Bb=Qb.value[ac[j]];v=Bb;w=Bb;x=Bb;Qb.array[zb]=v.x;Qb.array[zb+1]=v.y;Qb.array[zb+2]=w.x;Qb.array[zb+3]=w.y;Qb.array[zb+4]=x.x;Qb.array[zb+5]=x.y;zb+=6}for(j=0,k=bc.length;j<k;j++){Bb=Qb.value[bc[j]];v=Bb;w=Bb;x=Bb;y=Bb;Qb.array[zb]=v.x;Qb.array[zb+1]=v.y;Qb.array[zb+2]=w.x;Qb.array[zb+3]=w.y;Qb.array[zb+4]=x.x;Qb.array[zb+5]=x.y;Qb.array[zb+6]=y.x;Qb.array[zb+7]=y.y;zb+=8}}}else if(Qb.size===3){var kc;if(Qb.type==="c"){kc=["r","g","b"]}else{kc=["x","y","z"]}if(Qb.boundTo===undefined||Qb.boundTo==="vertices"){for(j=0,k=ac.length;j<k;j++){m=cc[ac[j]];v=Qb.value[m.a];w=Qb.value[m.b];x=Qb.value[m.c];Qb.array[zb]=v[kc[0]];Qb.array[zb+1]=v[kc[1]];Qb.array[zb+2]=v[kc[2]];Qb.array[zb+3]=w[kc[0]];Qb.array[zb+4]=w[kc[1]];Qb.array[zb+5]=w[kc[2]];Qb.array[zb+6]=x[kc[0]];Qb.array[zb+7]=x[kc[1]];Qb.array[zb+8]=x[kc[2]];zb+=9}for(j=0,k=bc.length;j<k;j++){m=cc[bc[j]];v=Qb.value[m.a];w=Qb.value[m.b];x=Qb.value[m.c];y=Qb.value[m.d];Qb.array[zb]=v[kc[0]];Qb.array[zb+1]=v[kc[1]];Qb.array[zb+2]=v[kc[2]];Qb.array[zb+3]=w[kc[0]];Qb.array[zb+4]=w[kc[1]];Qb.array[zb+5]=w[kc[2]];Qb.array[zb+6]=x[kc[0]];Qb.array[zb+7]=x[kc[1]];Qb.array[zb+8]=x[kc[2]];Qb.array[zb+9]=y[kc[0]];Qb.array[zb+10]=y[kc[1]];Qb.array[zb+11]=y[kc[2]];zb+=12}}else if(Qb.boundTo==="faces"){for(j=0,k=ac.length;j<k;j++){Bb=Qb.value[ac[j]];v=Bb;w=Bb;x=Bb;Qb.array[zb]=v[kc[0]];Qb.array[zb+1]=v[kc[1]];Qb.array[zb+2]=v[kc[2]];Qb.array[zb+3]=w[kc[0]];Qb.array[zb+4]=w[kc[1]];Qb.array[zb+5]=w[kc[2]];Qb.array[zb+6]=x[kc[0]];Qb.array[zb+7]=x[kc[1]];Qb.array[zb+8]=x[kc[2]];zb+=9}for(j=0,k=bc.length;j<k;j++){Bb=Qb.value[bc[j]];v=Bb;w=Bb;x=Bb;y=Bb;Qb.array[zb]=v[kc[0]];Qb.array[zb+1]=v[kc[1]];Qb.array[zb+2]=v[kc[2]];Qb.array[zb+3]=w[kc[0]];Qb.array[zb+4]=w[kc[1]];Qb.array[zb+5]=w[kc[2]];Qb.array[zb+6]=x[kc[0]];Qb.array[zb+7]=x[kc[1]];Qb.array[zb+8]=x[kc[2]];Qb.array[zb+9]=y[kc[0]];Qb.array[zb+10]=y[kc[1]];Qb.array[zb+11]=y[kc[2]];zb+=12}}else if(Qb.boundTo==="faceVertices"){for(j=0,k=ac.length;j<k;j++){Bb=Qb.value[ac[j]];v=Bb[0];w=Bb[1];x=Bb[2];Qb.array[zb]=v[kc[0]];Qb.array[zb+1]=v[kc[1]];Qb.array[zb+2]=v[kc[2]];Qb.array[zb+3]=w[kc[0]];Qb.array[zb+4]=w[kc[1]];Qb.array[zb+5]=w[kc[2]];Qb.array[zb+6]=x[kc[0]];Qb.array[zb+7]=x[kc[1]];Qb.array[zb+8]=x[kc[2]];zb+=9}for(j=0,k=bc.length;j<k;j++){Bb=Qb.value[bc[j]];v=Bb[0];w=Bb[1];x=Bb[2];y=Bb[3];Qb.array[zb]=v[kc[0]];Qb.array[zb+1]=v[kc[1]];Qb.array[zb+2]=v[kc[2]];Qb.array[zb+3]=w[kc[0]];Qb.array[zb+4]=w[kc[1]];Qb.array[zb+5]=w[kc[2]];Qb.array[zb+6]=x[kc[0]];Qb.array[zb+7]=x[kc[1]];Qb.array[zb+8]=x[kc[2]];Qb.array[zb+9]=y[kc[0]];Qb.array[zb+10]=y[kc[1]];Qb.array[zb+11]=y[kc[2]];zb+=12}}}else if(Qb.size===4){if(Qb.boundTo===undefined||Qb.boundTo==="vertices"){for(j=0,k=ac.length;j<k;j++){m=cc[ac[j]];v=Qb.value[m.a];w=Qb.value[m.b];x=Qb.value[m.c];Qb.array[zb]=v.x;Qb.array[zb+1]=v.y;Qb.array[zb+2]=v.z;Qb.array[zb+3]=v.w;Qb.array[zb+4]=w.x;Qb.array[zb+5]=w.y;Qb.array[zb+6]=w.z;Qb.array[zb+7]=w.w;Qb.array[zb+8]=x.x;Qb.array[zb+9]=x.y;Qb.array[zb+10]=x.z;Qb.array[zb+11]=x.w;zb+=12}for(j=0,k=bc.length;j<k;j++){m=cc[bc[j]];v=Qb.value[m.a];w=Qb.value[m.b];x=Qb.value[m.c];y=Qb.value[m.d];Qb.array[zb]=v.x;Qb.array[zb+1]=v.y;Qb.array[zb+2]=v.z;Qb.array[zb+3]=v.w;Qb.array[zb+4]=w.x;Qb.array[zb+5]=w.y;Qb.array[zb+6]=w.z;Qb.array[zb+7]=w.w;Qb.array[zb+8]=x.x;Qb.array[zb+9]=x.y;Qb.array[zb+10]=x.z;Qb.array[zb+11]=x.w;Qb.array[zb+12]=y.x;Qb.array[zb+13]=y.y;Qb.array[zb+14]=y.z;Qb.array[zb+15]=y.w;zb+=16}}else if(Qb.boundTo==="faces"){for(j=0,k=ac.length;j<k;j++){Bb=Qb.value[ac[j]];v=Bb;w=Bb;x=Bb;Qb.array[zb]=v.x;Qb.array[zb+1]=v.y;Qb.array[zb+2]=v.z;Qb.array[zb+3]=v.w;Qb.array[zb+4]=w.x;Qb.array[zb+5]=w.y;Qb.array[zb+6]=w.z;Qb.array[zb+7]=w.w;Qb.array[zb+8]=x.x;Qb.array[zb+9]=x.y;Qb.array[zb+10]=x.z;Qb.array[zb+11]=x.w;zb+=12}for(j=0,k=bc.length;j<k;j++){Bb=Qb.value[bc[j]];v=Bb;w=Bb;x=Bb;y=Bb;Qb.array[zb]=v.x;Qb.array[zb+1]=v.y;Qb.array[zb+2]=v.z;Qb.array[zb+3]=v.w;Qb.array[zb+4]=w.x;Qb.array[zb+5]=w.y;Qb.array[zb+6]=w.z;Qb.array[zb+7]=w.w;Qb.array[zb+8]=x.x;Qb.array[zb+9]=x.y;Qb.array[zb+10]=x.z;Qb.array[zb+11]=x.w;Qb.array[zb+12]=y.x;Qb.array[zb+13]=y.y;Qb.array[zb+14]=y.z;Qb.array[zb+15]=y.w;zb+=16}}else if(Qb.boundTo==="faceVertices"){for(j=0,k=ac.length;j<k;j++){Bb=Qb.value[ac[j]];v=Bb[0];w=Bb[1];x=Bb[2];Qb.array[zb]=v.x;Qb.array[zb+1]=v.y;Qb.array[zb+2]=v.z;Qb.array[zb+3]=v.w;Qb.array[zb+4]=w.x;Qb.array[zb+5]=w.y;Qb.array[zb+6]=w.z;Qb.array[zb+7]=w.w;Qb.array[zb+8]=x.x;Qb.array[zb+9]=x.y;Qb.array[zb+10]=x.z;Qb.array[zb+11]=x.w;zb+=12}for(j=0,k=bc.length;j<k;j++){Bb=Qb.value[bc[j]];v=Bb[0];w=Bb[1];x=Bb[2];y=Bb[3];Qb.array[zb]=v.x;Qb.array[zb+1]=v.y;Qb.array[zb+2]=v.z;Qb.array[zb+3]=v.w;Qb.array[zb+4]=w.x;Qb.array[zb+5]=w.y;Qb.array[zb+6]=w.z;Qb.array[zb+7]=w.w;Qb.array[zb+8]=x.x;Qb.array[zb+9]=x.y;Qb.array[zb+10]=x.z;Qb.array[zb+11]=x.w;Qb.array[zb+12]=y.x;Qb.array[zb+13]=y.y;Qb.array[zb+14]=y.z;Qb.array[zb+15]=y.w;zb+=16}}}U.bindBuffer(U.ARRAY_BUFFER,Qb.buffer);U.bufferData(U.ARRAY_BUFFER,Qb.array,c)}}if(d){delete a.__inittedArrays;delete a.__colorArray;delete a.__normalArray;delete a.__tangentArray;delete a.__uvArray;delete a.__uv2Array;delete a.__faceArray;delete a.__vertexArray;delete a.__lineArray;delete a.__skinIndexArray;delete a.__skinWeightArray}}function Vb(a,b,c){var d=a.attributes;var e,f;for(e in d){f=d[e];if(f.needsUpdate){if(e==="index"){U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,f.buffer);U.bufferData(U.ELEMENT_ARRAY_BUFFER,f.array,b)}else{U.bindBuffer(U.ARRAY_BUFFER,f.buffer);U.bufferData(U.ARRAY_BUFFER,f.array,b)}f.needsUpdate=false}if(c&&!f.dynamic){delete f.array}}}this.renderBufferImmediate=function(a,b,c){if(a.hasPositions&&!a.__webglVertexBuffer)a.__webglVertexBuffer=U.createBuffer();if(a.hasNormals&&!a.__webglNormalBuffer)a.__webglNormalBuffer=U.createBuffer();if(a.hasUvs&&!a.__webglUvBuffer)a.__webglUvBuffer=U.createBuffer();if(a.hasColors&&!a.__webglColorBuffer)a.__webglColorBuffer=U.createBuffer();if(a.hasPositions){U.bindBuffer(U.ARRAY_BUFFER,a.__webglVertexBuffer);U.bufferData(U.ARRAY_BUFFER,a.positionArray,U.DYNAMIC_DRAW);U.enableVertexAttribArray(b.attributes.position);U.vertexAttribPointer(b.attributes.position,3,U.FLOAT,false,0,0)}if(a.hasNormals){U.bindBuffer(U.ARRAY_BUFFER,a.__webglNormalBuffer);if(c.shading===THREE.FlatShading){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=a.count*3;for(q=0;q<r;q+=9){p=a.normalArray;g=p[q];j=p[q+1];m=p[q+2];h=p[q+3];k=p[q+4];n=p[q+5];i=p[q+6];l=p[q+7];o=p[q+8];d=(g+h+i)/3;e=(j+k+l)/3;f=(m+n+o)/3;p[q]=d;p[q+1]=e;p[q+2]=f;p[q+3]=d;p[q+4]=e;p[q+5]=f;p[q+6]=d;p[q+7]=e;p[q+8]=f}}U.bufferData(U.ARRAY_BUFFER,a.normalArray,U.DYNAMIC_DRAW);U.enableVertexAttribArray(b.attributes.normal);U.vertexAttribPointer(b.attributes.normal,3,U.FLOAT,false,0,0)}if(a.hasUvs&&c.map){U.bindBuffer(U.ARRAY_BUFFER,a.__webglUvBuffer);U.bufferData(U.ARRAY_BUFFER,a.uvArray,U.DYNAMIC_DRAW);U.enableVertexAttribArray(b.attributes.uv);U.vertexAttribPointer(b.attributes.uv,2,U.FLOAT,false,0,0)}if(a.hasColors&&c.vertexColors!==THREE.NoColors){U.bindBuffer(U.ARRAY_BUFFER,a.__webglColorBuffer);U.bufferData(U.ARRAY_BUFFER,a.colorArray,U.DYNAMIC_DRAW);U.enableVertexAttribArray(b.attributes.color);U.vertexAttribPointer(b.attributes.color,3,U.FLOAT,false,0,0)}U.drawArrays(U.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,b,c,d,e,f){if(d.visible===false)return;var g,h,i,j,l,m,n;var o,p,r,s;g=pc(a,b,c,d,f);h=g.attributes;n=e.attributes;var t=false,u=d.wireframe?1:0,v=e.id*16777215+g.id*2+u;if(v!==q){q=v;t=true}if(t){Xb()}if(f instanceof THREE.Mesh){var w=n["index"];if(w){var x=e.offsets;if(x.length>1)t=true;for(var y=0,z=x.length;y<z;y++){var A=x[y].index;if(t){for(p in n){if(p==="index")continue;r=h[p];o=n[p];s=o.itemSize;if(r>=0){U.bindBuffer(U.ARRAY_BUFFER,o.buffer);Wb(r);U.vertexAttribPointer(r,s,U.FLOAT,false,0,A*s*4)}}U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,w.buffer)}U.drawElements(U.TRIANGLES,x[y].count,U.UNSIGNED_SHORT,x[y].start*2);k.info.render.calls++;k.info.render.vertices+=x[y].count;k.info.render.faces+=x[y].count/3}}else{if(t){for(p in n){if(p==="index")continue;r=h[p];o=n[p];s=o.itemSize;if(r>=0){U.bindBuffer(U.ARRAY_BUFFER,o.buffer);Wb(r);U.vertexAttribPointer(r,s,U.FLOAT,false,0,0)}}}var B=e.attributes["position"];U.drawArrays(U.TRIANGLES,0,B.numItems/3);k.info.render.calls++;k.info.render.vertices+=B.numItems/3;k.info.render.faces+=B.numItems/3/3}}else if(f instanceof THREE.ParticleSystem){if(t){for(p in n){r=h[p];o=n[p];s=o.itemSize;if(r>=0){U.bindBuffer(U.ARRAY_BUFFER,o.buffer);Wb(r);U.vertexAttribPointer(r,s,U.FLOAT,false,0,0)}}var B=n["position"];U.drawArrays(U.POINTS,0,B.numItems/3);k.info.render.calls++;k.info.render.points+=B.numItems/3}}else if(f instanceof THREE.Line){if(t){for(p in n){r=h[p];o=n[p];s=o.itemSize;if(r>=0){U.bindBuffer(U.ARRAY_BUFFER,o.buffer);Wb(r);U.vertexAttribPointer(r,s,U.FLOAT,false,0,0)}}Gc(d.linewidth);var B=n["position"];U.drawArrays(U.LINE_STRIP,0,B.numItems/3);k.info.render.calls++;k.info.render.points+=B.numItems}}};this.renderBuffer=function(a,b,c,d,e,f){if(d.visible===false)return;var g,h,i,j,l,m,n,o;g=pc(a,b,c,d,f);h=g.attributes;var p=false,r=d.wireframe?1:0,s=e.id*16777215+g.id*2+r;if(s!==q){q=s;p=true}if(p){Xb()}if(!d.morphTargets&&h.position>=0){if(p){U.bindBuffer(U.ARRAY_BUFFER,e.__webglVertexBuffer);Wb(h.position);U.vertexAttribPointer(h.position,3,U.FLOAT,false,0,0)}}else{if(f.morphTargetBase){Yb(d,e,f)}}if(p){if(e.__webglCustomAttributesList){for(n=0,o=e.__webglCustomAttributesList.length;n<o;n++){m=e.__webglCustomAttributesList[n];if(h[m.buffer.belongsToAttribute]>=0){U.bindBuffer(U.ARRAY_BUFFER,m.buffer);Wb(h[m.buffer.belongsToAttribute]);U.vertexAttribPointer(h[m.buffer.belongsToAttribute],m.size,U.FLOAT,false,0,0)}}}if(h.color>=0){U.bindBuffer(U.ARRAY_BUFFER,e.__webglColorBuffer);Wb(h.color);U.vertexAttribPointer(h.color,3,U.FLOAT,false,0,0)}if(h.normal>=0){U.bindBuffer(U.ARRAY_BUFFER,e.__webglNormalBuffer);
Wb(h.normal);U.vertexAttribPointer(h.normal,3,U.FLOAT,false,0,0)}if(h.tangent>=0){U.bindBuffer(U.ARRAY_BUFFER,e.__webglTangentBuffer);Wb(h.tangent);U.vertexAttribPointer(h.tangent,4,U.FLOAT,false,0,0)}if(h.uv>=0){U.bindBuffer(U.ARRAY_BUFFER,e.__webglUVBuffer);Wb(h.uv);U.vertexAttribPointer(h.uv,2,U.FLOAT,false,0,0)}if(h.uv2>=0){U.bindBuffer(U.ARRAY_BUFFER,e.__webglUV2Buffer);Wb(h.uv2);U.vertexAttribPointer(h.uv2,2,U.FLOAT,false,0,0)}if(d.skinning&&h.skinIndex>=0&&h.skinWeight>=0){U.bindBuffer(U.ARRAY_BUFFER,e.__webglSkinIndicesBuffer);Wb(h.skinIndex);U.vertexAttribPointer(h.skinIndex,4,U.FLOAT,false,0,0);U.bindBuffer(U.ARRAY_BUFFER,e.__webglSkinWeightsBuffer);Wb(h.skinWeight);U.vertexAttribPointer(h.skinWeight,4,U.FLOAT,false,0,0)}if(h.lineDistance>=0){U.bindBuffer(U.ARRAY_BUFFER,e.__webglLineDistanceBuffer);Wb(h.lineDistance);U.vertexAttribPointer(h.lineDistance,1,U.FLOAT,false,0,0)}}if(f instanceof THREE.Mesh){if(d.wireframe){Gc(d.wireframeLinewidth);if(p)U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer);U.drawElements(U.LINES,e.__webglLineCount,U.UNSIGNED_SHORT,0)}else{if(p)U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer);U.drawElements(U.TRIANGLES,e.__webglFaceCount,U.UNSIGNED_SHORT,0)}k.info.render.calls++;k.info.render.vertices+=e.__webglFaceCount;k.info.render.faces+=e.__webglFaceCount/3}else if(f instanceof THREE.Line){j=f.type===THREE.LineStrip?U.LINE_STRIP:U.LINES;Gc(d.linewidth);U.drawArrays(j,0,e.__webglLineCount);k.info.render.calls++}else if(f instanceof THREE.ParticleSystem){U.drawArrays(U.POINTS,0,e.__webglParticleCount);k.info.render.calls++;k.info.render.points+=e.__webglParticleCount}else if(f instanceof THREE.Ribbon){U.drawArrays(U.TRIANGLE_STRIP,0,e.__webglVertexCount);k.info.render.calls++}};function Wb(a){if(!M[a]){U.enableVertexAttribArray(a);M[a]=true}}function Xb(){for(var a in M){if(M[a]){U.disableVertexAttribArray(a);M[a]=false}}}function Yb(a,b,c){var d=a.program.attributes;if(c.morphTargetBase!==-1&&d.position>=0){U.bindBuffer(U.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[c.morphTargetBase]);Wb(d.position);U.vertexAttribPointer(d.position,3,U.FLOAT,false,0,0)}else if(d.position>=0){U.bindBuffer(U.ARRAY_BUFFER,b.__webglVertexBuffer);Wb(d.position);U.vertexAttribPointer(d.position,3,U.FLOAT,false,0,0)}if(c.morphTargetForcedOrder.length){var e=0;var f=c.morphTargetForcedOrder;var g=c.morphTargetInfluences;while(e<a.numSupportedMorphTargets&&e<f.length){if(d["morphTarget"+e]>=0){U.bindBuffer(U.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[f[e]]);Wb(d["morphTarget"+e]);U.vertexAttribPointer(d["morphTarget"+e],3,U.FLOAT,false,0,0)}if(d["morphNormal"+e]>=0&&a.morphNormals){U.bindBuffer(U.ARRAY_BUFFER,b.__webglMorphNormalsBuffers[f[e]]);Wb(d["morphNormal"+e]);U.vertexAttribPointer(d["morphNormal"+e],3,U.FLOAT,false,0,0)}c.__webglMorphTargetInfluences[e]=g[f[e]];e++}}else{var h,i=[];var g=c.morphTargetInfluences;var j,k=g.length;for(j=0;j<k;j++){h=g[j];if(h>0){i.push([h,j])}}if(i.length>a.numSupportedMorphTargets){i.sort($b);i.length=a.numSupportedMorphTargets}else if(i.length>a.numSupportedMorphNormals){i.sort($b)}else if(i.length===0){i.push([0,0])}var l,e=0;while(e<a.numSupportedMorphTargets){if(i[e]){l=i[e][1];if(d["morphTarget"+e]>=0){U.bindBuffer(U.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[l]);Wb(d["morphTarget"+e]);U.vertexAttribPointer(d["morphTarget"+e],3,U.FLOAT,false,0,0)}if(d["morphNormal"+e]>=0&&a.morphNormals){U.bindBuffer(U.ARRAY_BUFFER,b.__webglMorphNormalsBuffers[l]);Wb(d["morphNormal"+e]);U.vertexAttribPointer(d["morphNormal"+e],3,U.FLOAT,false,0,0)}c.__webglMorphTargetInfluences[e]=g[l]}else{c.__webglMorphTargetInfluences[e]=0}e++}}if(a.program.uniforms.morphTargetInfluences!==null){U.uniform1fv(a.program.uniforms.morphTargetInfluences,c.__webglMorphTargetInfluences)}}function Zb(a,b){if(a.z!==b.z){return b.z-a.z}else{return a.id-b.id}}function $b(a,b){return b[0]-a[0]}this.render=function(a,b,c,d){if(b instanceof THREE.Camera===false){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var e,f,g,h,i,j=a.__lights,l=a.fog;p=-1;S=true;if(a.autoUpdate===true)a.updateMatrixWorld();if(b.parent===undefined)b.updateMatrixWorld();b.matrixWorldInverse.getInverse(b.matrixWorld);O.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);N.setFromMatrix(O);if(this.autoUpdateObjects)this.initWebGLObjects(a);_b(this.renderPluginsPre,a,b);k.info.render.calls=0;k.info.render.vertices=0;k.info.render.faces=0;k.info.render.points=0;this.setRenderTarget(c);if(this.autoClear||d){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}i=a.__webglObjects;for(e=0,f=i.length;e<f;e++){g=i[e];h=g.object;g.id=e;g.render=false;if(h.visible){if(!(h instanceof THREE.Mesh||h instanceof THREE.ParticleSystem)||!h.frustumCulled||N.intersectsObject(h)){Cc(h,b);dc(g);g.render=true;if(this.sortObjects===true){if(h.renderDepth!==null){g.z=h.renderDepth}else{Q.getPositionFromMatrix(h.matrixWorld);Q.applyProjection(O);g.z=Q.z}}}}}if(this.sortObjects){i.sort(Zb)}i=a.__webglObjectsImmediate;for(e=0,f=i.length;e<f;e++){g=i[e];h=g.object;if(h.visible){Cc(h,b);cc(g)}}if(a.overrideMaterial){var m=a.overrideMaterial;this.setBlending(m.blending,m.blendEquation,m.blendSrc,m.blendDst);this.setDepthTest(m.depthTest);this.setDepthWrite(m.depthWrite);Hc(m.polygonOffset,m.polygonOffsetFactor,m.polygonOffsetUnits);ac(a.__webglObjects,false,"",b,j,l,true,m);bc(a.__webglObjectsImmediate,"",b,j,l,false,m)}else{var m=null;this.setBlending(THREE.NoBlending);ac(a.__webglObjects,true,"opaque",b,j,l,false,m);bc(a.__webglObjectsImmediate,"opaque",b,j,l,false,m);ac(a.__webglObjects,false,"transparent",b,j,l,true,m);bc(a.__webglObjectsImmediate,"transparent",b,j,l,true,m)}_b(this.renderPluginsPost,a,b);if(c&&c.generateMipmaps&&c.minFilter!==THREE.NearestFilter&&c.minFilter!==THREE.LinearFilter){Vc(c)}this.setDepthTest(true);this.setDepthWrite(true)};function _b(a,b,c){if(!a.length)return;for(var d=0,e=a.length;d<e;d++){n=null;r=null;w=-1;A=-1;B=-1;u=-1;v=-1;q=-1;p=-1;S=true;a[d].render(b,c,K,L);n=null;r=null;w=-1;A=-1;B=-1;u=-1;v=-1;q=-1;p=-1;S=true}}function ac(a,b,c,d,e,f,g,h){var i,j,l,m,n,o,p;if(b){n=a.length-1;o=-1;p=-1}else{n=0;o=a.length;p=1}for(var q=n;q!==o;q+=p){i=a[q];if(i.render){j=i.object;l=i.buffer;if(h){m=h}else{m=i[c];if(!m)continue;if(g)k.setBlending(m.blending,m.blendEquation,m.blendSrc,m.blendDst);k.setDepthTest(m.depthTest);k.setDepthWrite(m.depthWrite);Hc(m.polygonOffset,m.polygonOffsetFactor,m.polygonOffsetUnits)}k.setMaterialFaces(m);if(l instanceof THREE.BufferGeometry){k.renderBufferDirect(d,e,f,m,l,j)}else{k.renderBuffer(d,e,f,m,l,j)}}}}function bc(a,b,c,d,e,f,g){var h,i,j,l;for(var m=0,n=a.length;m<n;m++){h=a[m];i=h.object;if(i.visible){if(g){j=g}else{j=h[b];if(!j)continue;if(f)k.setBlending(j.blending,j.blendEquation,j.blendSrc,j.blendDst);k.setDepthTest(j.depthTest);k.setDepthWrite(j.depthWrite);Hc(j.polygonOffset,j.polygonOffsetFactor,j.polygonOffsetUnits)}k.renderImmediateObject(c,d,e,j,i)}}}this.renderImmediateObject=function(a,b,c,d,e){var f=pc(a,b,c,d,e);q=-1;k.setMaterialFaces(d);if(e.immediateRenderCallback){e.immediateRenderCallback(f,U,N)}else{e.render(function(a){k.renderBufferImmediate(a,f,d)})}};function cc(a){var b=a.object,c=b.material;if(c.transparent){a.transparent=c;a.opaque=null}else{a.opaque=c;a.transparent=null}}function dc(a){var b=a.object,c=a.buffer,d,e,f;f=b.material;if(f instanceof THREE.MeshFaceMaterial){e=c.materialIndex;d=f.materials[e];if(d.transparent){a.transparent=d;a.opaque=null}else{a.opaque=d;a.transparent=null}}else{d=f;if(d){if(d.transparent){a.transparent=d;a.opaque=null}else{a.opaque=d;a.transparent=null}}}}function ec(a,b){var c,d,e,f,g,h,i={};var j=a.morphTargets.length;var k=a.morphNormals.length;var l=b instanceof THREE.MeshFaceMaterial;a.geometryGroups={};for(c=0,d=a.faces.length;c<d;c++){e=a.faces[c];f=l?e.materialIndex:0;if(i[f]===undefined){i[f]={hash:f,counter:0}}h=i[f].hash+"_"+i[f].counter;if(a.geometryGroups[h]===undefined){a.geometryGroups[h]={faces3:[],faces4:[],materialIndex:f,vertices:0,numMorphTargets:j,numMorphNormals:k}}g=e instanceof THREE.Face3?3:4;if(a.geometryGroups[h].vertices+g>65535){i[f].counter+=1;h=i[f].hash+"_"+i[f].counter;if(a.geometryGroups[h]===undefined){a.geometryGroups[h]={faces3:[],faces4:[],materialIndex:f,vertices:0,numMorphTargets:j,numMorphNormals:k}}}if(e instanceof THREE.Face3){a.geometryGroups[h].faces3.push(c)}else{a.geometryGroups[h].faces4.push(c)}a.geometryGroups[h].vertices+=g}a.geometryGroupsList=[];for(var m in a.geometryGroups){a.geometryGroups[m].id=s++;a.geometryGroupsList.push(a.geometryGroups[m])}}this.initWebGLObjects=function(a){if(!a.__webglObjects){a.__webglObjects=[];a.__webglObjectsImmediate=[];a.__webglSprites=[];a.__webglFlares=[]}while(a.__objectsAdded.length){fc(a.__objectsAdded[0],a);a.__objectsAdded.splice(0,1)}while(a.__objectsRemoved.length){lc(a.__objectsRemoved[0],a);a.__objectsRemoved.splice(0,1)}for(var b=0,c=a.__webglObjects.length;b<c;b++){var d=a.__webglObjects[b].object;if(d.__webglInit===undefined){if(d.__webglActive!==undefined){lc(d,a)}fc(d,a)}ic(d)}};function fc(a,b){var c,d,e,f;if(a.__webglInit===undefined){a.__webglInit=true;a._modelViewMatrix=new THREE.Matrix4;a._normalMatrix=new THREE.Matrix3;if(a.geometry!==undefined&&a.geometry.__webglInit===undefined){a.geometry.__webglInit=true;a.geometry.addEventListener("dispose",xb)}d=a.geometry;if(d===undefined){}else if(d instanceof THREE.BufferGeometry){Qb(d)}else if(a instanceof THREE.Mesh){e=a.material;if(d.geometryGroups===undefined){ec(d,e)}for(c in d.geometryGroups){f=d.geometryGroups[c];if(!f.__webglVertexBuffer){wb(f);Kb(f,a);d.verticesNeedUpdate=true;d.morphTargetsNeedUpdate=true;d.elementsNeedUpdate=true;d.uvsNeedUpdate=true;d.normalsNeedUpdate=true;d.tangentsNeedUpdate=true;d.colorsNeedUpdate=true}}}else if(a instanceof THREE.Ribbon){if(!d.__webglVertexBuffer){vb(d);Jb(d,a);d.verticesNeedUpdate=true;d.colorsNeedUpdate=true;d.normalsNeedUpdate=true}}else if(a instanceof THREE.Line){if(!d.__webglVertexBuffer){ub(d);Ib(d,a);d.verticesNeedUpdate=true;d.colorsNeedUpdate=true;d.lineDistancesNeedUpdate=true}}else if(a instanceof THREE.ParticleSystem){if(!d.__webglVertexBuffer){tb(d);Hb(d,a);d.verticesNeedUpdate=true;d.colorsNeedUpdate=true}}}if(a.__webglActive===undefined){if(a instanceof THREE.Mesh){d=a.geometry;if(d instanceof THREE.BufferGeometry){gc(b.__webglObjects,d,a)}else if(d instanceof THREE.Geometry){for(c in d.geometryGroups){f=d.geometryGroups[c];gc(b.__webglObjects,f,a)}}}else if(a instanceof THREE.Ribbon||a instanceof THREE.Line||a instanceof THREE.ParticleSystem){d=a.geometry;gc(b.__webglObjects,d,a)}else if(a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback){hc(b.__webglObjectsImmediate,a)}else if(a instanceof THREE.Sprite){b.__webglSprites.push(a)}else if(a instanceof THREE.LensFlare){b.__webglFlares.push(a)}a.__webglActive=true}}function gc(a,b,c){a.push({buffer:b,object:c,opaque:null,transparent:null})}function hc(a,b){a.push({object:b,opaque:null,transparent:null})}function ic(a){var b=a.geometry,c,d,e;if(b instanceof THREE.BufferGeometry){Vb(b,U.DYNAMIC_DRAW,!b.dynamic)}else if(a instanceof THREE.Mesh){for(var f=0,g=b.geometryGroupsList.length;f<g;f++){c=b.geometryGroupsList[f];e=Lb(a,c);if(b.buffersNeedUpdate){Kb(c,a)}d=e.attributes&&jc(e);if(b.verticesNeedUpdate||b.morphTargetsNeedUpdate||b.elementsNeedUpdate||b.uvsNeedUpdate||b.normalsNeedUpdate||b.colorsNeedUpdate||b.tangentsNeedUpdate||d){Ub(c,a,U.DYNAMIC_DRAW,!b.dynamic,e)}}b.verticesNeedUpdate=false;b.morphTargetsNeedUpdate=false;b.elementsNeedUpdate=false;b.uvsNeedUpdate=false;b.normalsNeedUpdate=false;b.colorsNeedUpdate=false;b.tangentsNeedUpdate=false;b.buffersNeedUpdate=false;e.attributes&&kc(e)}else if(a instanceof THREE.Ribbon){e=Lb(a,b);d=e.attributes&&jc(e);if(b.verticesNeedUpdate||b.colorsNeedUpdate||b.normalsNeedUpdate||d){Tb(b,U.DYNAMIC_DRAW)}b.verticesNeedUpdate=false;b.colorsNeedUpdate=false;b.normalsNeedUpdate=false;e.attributes&&kc(e)}else if(a instanceof THREE.Line){e=Lb(a,b);d=e.attributes&&jc(e);if(b.verticesNeedUpdate||b.colorsNeedUpdate||b.lineDistancesNeedUpdate||d){Sb(b,U.DYNAMIC_DRAW)}b.verticesNeedUpdate=false;b.colorsNeedUpdate=false;b.lineDistancesNeedUpdate=false;e.attributes&&kc(e)}else if(a instanceof THREE.ParticleSystem){e=Lb(a,b);d=e.attributes&&jc(e);if(b.verticesNeedUpdate||b.colorsNeedUpdate||a.sortParticles||d){Rb(b,U.DYNAMIC_DRAW,a)}b.verticesNeedUpdate=false;b.colorsNeedUpdate=false;e.attributes&&kc(e)}}function jc(a){for(var b in a.attributes){if(a.attributes[b].needsUpdate)return true}return false}function kc(a){for(var b in a.attributes){a.attributes[b].needsUpdate=false}}function lc(a,b){if(a instanceof THREE.Mesh||a instanceof THREE.ParticleSystem||a instanceof THREE.Ribbon||a instanceof THREE.Line){mc(b.__webglObjects,a)}else if(a instanceof THREE.Sprite){nc(b.__webglSprites,a)}else if(a instanceof THREE.LensFlare){nc(b.__webglFlares,a)}else if(a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback){mc(b.__webglObjectsImmediate,a)}delete a.__webglActive}function mc(a,b){for(var c=a.length-1;c>=0;c--){if(a[c].object===b){a.splice(c,1)}}}function nc(a,b){for(var c=a.length-1;c>=0;c--){if(a[c]===b){a.splice(c,1)}}}this.initMaterial=function(a,b,c,d){a.addEventListener("dispose",Ab);var e,f,g,h,i,j,k,l,m;if(a instanceof THREE.MeshDepthMaterial){m="depth"}else if(a instanceof THREE.MeshNormalMaterial){m="normal"}else if(a instanceof THREE.MeshBasicMaterial){m="basic"}else if(a instanceof THREE.MeshLambertMaterial){m="lambert"}else if(a instanceof THREE.MeshPhongMaterial){m="phong"}else if(a instanceof THREE.LineBasicMaterial){m="basic"}else if(a instanceof THREE.LineDashedMaterial){m="dashed"}else if(a instanceof THREE.ParticleBasicMaterial){m="particle_basic"}if(m){oc(a,THREE.ShaderLib[m])}j=Zc(b);l=$c(b);k=Yc(d);i={map:!!a.map,envMap:!!a.envMap,lightMap:!!a.lightMap,bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,specularMap:!!a.specularMap,vertexColors:a.vertexColors,fog:c,useFog:a.fog,fogExp:c instanceof THREE.FogExp2,sizeAttenuation:a.sizeAttenuation,skinning:a.skinning,maxBones:k,useVertexTexture:db&&d&&d.useVertexTexture,boneTextureWidth:d&&d.boneTextureWidth,boneTextureHeight:d&&d.boneTextureHeight,morphTargets:a.morphTargets,morphNormals:a.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:j.directional,maxPointLights:j.point,maxSpotLights:j.spot,maxHemiLights:j.hemi,maxShadows:l,shadowMapEnabled:this.shadowMapEnabled&&d.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:a.alphaTest,metal:a.metal,perPixel:a.perPixel,wrapAround:a.wrapAround,doubleSided:a.side===THREE.DoubleSide,flipSided:a.side===THREE.BackSide};a.program=Jc(m,a.fragmentShader,a.vertexShader,a.uniforms,a.attributes,a.defines,i);var n=a.program.attributes;if(a.morphTargets){a.numSupportedMorphTargets=0;var o,p="morphTarget";for(h=0;h<this.maxMorphTargets;h++){o=p+h;if(n[o]>=0){a.numSupportedMorphTargets++}}}if(a.morphNormals){a.numSupportedMorphNormals=0;var o,p="morphNormal";for(h=0;h<this.maxMorphNormals;h++){o=p+h;if(n[o]>=0){a.numSupportedMorphNormals++}}}a.uniformsList=[];for(e in a.uniforms){a.uniformsList.push([a.uniforms[e],e])}};function oc(a,b){a.uniforms=THREE.UniformsUtils.clone(b.uniforms);a.vertexShader=b.vertexShader;a.fragmentShader=b.fragmentShader}function pc(a,b,c,d,e){t=0;if(d.needsUpdate){if(d.program)Eb(d);k.initMaterial(d,b,c,e);d.needsUpdate=false}if(d.morphTargets){if(!e.__webglMorphTargetInfluences){e.__webglMorphTargetInfluences=new Float32Array(k.maxMorphTargets)}}var f=false;var g=d.program,h=g.uniforms,i=d.uniforms;if(g!==n){U.useProgram(g);n=g;f=true}if(d.id!==p){p=d.id;f=true}if(f||a!==r){U.uniformMatrix4fv(h.projectionMatrix,false,a.projectionMatrix.elements);if(a!==r)r=a}if(d.skinning){if(db&&e.useVertexTexture){if(h.boneTexture!==null){var j=Ac();U.uniform1i(h.boneTexture,j);k.setTexture(e.boneTexture,j)}}else{if(h.boneGlobalMatrices!==null){U.uniformMatrix4fv(h.boneGlobalMatrices,false,e.boneMatrices)}}}if(f){if(c&&d.fog){uc(i,c)}if(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d.lights){if(S){Fc(g,b);S=false}xc(i,T)}if(d instanceof THREE.MeshBasicMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.MeshPhongMaterial){qc(i,d)}if(d instanceof THREE.LineBasicMaterial){rc(i,d)}else if(d instanceof THREE.LineDashedMaterial){rc(i,d);sc(i,d)}else if(d instanceof THREE.ParticleBasicMaterial){tc(i,d)}else if(d instanceof THREE.MeshPhongMaterial){vc(i,d)}else if(d instanceof THREE.MeshLambertMaterial){wc(i,d)}else if(d instanceof THREE.MeshDepthMaterial){i.mNear.value=a.near;i.mFar.value=a.far;i.opacity.value=d.opacity}else if(d instanceof THREE.MeshNormalMaterial){i.opacity.value=d.opacity}if(e.receiveShadow&&!d._shadowPass){yc(i,b)}Bc(g,d.uniformsList);if(d instanceof THREE.ShaderMaterial||d instanceof THREE.MeshPhongMaterial||d.envMap){if(h.cameraPosition!==null){Q.getPositionFromMatrix(a.matrixWorld);U.uniform3f(h.cameraPosition,Q.x,Q.y,Q.z)}}if(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.ShaderMaterial||d.skinning){if(h.viewMatrix!==null){U.uniformMatrix4fv(h.viewMatrix,false,a.matrixWorldInverse.elements)}}}zc(h,e);if(h.modelMatrix!==null){U.uniformMatrix4fv(h.modelMatrix,false,e.matrixWorld.elements)}return g}function qc(a,b){a.opacity.value=b.opacity;if(k.gammaInput){a.diffuse.value.copyGammaToLinear(b.color)}else{a.diffuse.value=b.color}a.map.value=b.map;a.lightMap.value=b.lightMap;a.specularMap.value=b.specularMap;if(b.bumpMap){a.bumpMap.value=b.bumpMap;a.bumpScale.value=b.bumpScale}if(b.normalMap){a.normalMap.value=b.normalMap;a.normalScale.value.copy(b.normalScale)}var c;if(b.map){c=b.map}else if(b.specularMap){c=b.specularMap}else if(b.normalMap){c=b.normalMap}else if(b.bumpMap){c=b.bumpMap}if(c!==undefined){var d=c.offset;var e=c.repeat;a.offsetRepeat.value.set(d.x,d.y,e.x,e.y)}a.envMap.value=b.envMap;a.flipEnvMap.value=b.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;if(k.gammaInput){a.reflectivity.value=b.reflectivity}else{a.reflectivity.value=b.reflectivity}a.refractionRatio.value=b.refractionRatio;a.combine.value=b.combine;a.useRefract.value=b.envMap&&b.envMap.mapping instanceof THREE.CubeRefractionMapping}function rc(a,b){a.diffuse.value=b.color;a.opacity.value=b.opacity}function sc(a,b){a.dashSize.value=b.dashSize;a.totalSize.value=b.dashSize+b.gapSize;a.scale.value=b.scale}function tc(a,c){a.psColor.value=c.color;a.opacity.value=c.opacity;a.size.value=c.size;a.scale.value=b.height/2;a.map.value=c.map}function uc(a,b){a.fogColor.value=b.color;if(b instanceof THREE.Fog){a.fogNear.value=b.near;a.fogFar.value=b.far}else if(b instanceof THREE.FogExp2){a.fogDensity.value=b.density}}function vc(a,b){a.shininess.value=b.shininess;if(k.gammaInput){a.ambient.value.copyGammaToLinear(b.ambient);a.emissive.value.copyGammaToLinear(b.emissive);a.specular.value.copyGammaToLinear(b.specular)}else{a.ambient.value=b.ambient;a.emissive.value=b.emissive;a.specular.value=b.specular}if(b.wrapAround){a.wrapRGB.value.copy(b.wrapRGB)}}function wc(a,b){if(k.gammaInput){a.ambient.value.copyGammaToLinear(b.ambient);a.emissive.value.copyGammaToLinear(b.emissive)}else{a.ambient.value=b.ambient;a.emissive.value=b.emissive}if(b.wrapAround){a.wrapRGB.value.copy(b.wrapRGB)}}function xc(a,b){a.ambientLightColor.value=b.ambient;a.directionalLightColor.value=b.directional.colors;a.directionalLightDirection.value=b.directional.positions;a.pointLightColor.value=b.point.colors;a.pointLightPosition.value=b.point.positions;a.pointLightDistance.value=b.point.distances;a.spotLightColor.value=b.spot.colors;a.spotLightPosition.value=b.spot.positions;a.spotLightDistance.value=b.spot.distances;a.spotLightDirection.value=b.spot.directions;a.spotLightAngleCos.value=b.spot.anglesCos;a.spotLightExponent.value=b.spot.exponents;a.hemisphereLightSkyColor.value=b.hemi.skyColors;a.hemisphereLightGroundColor.value=b.hemi.groundColors;a.hemisphereLightDirection.value=b.hemi.positions}function yc(a,b){if(a.shadowMatrix){var c=0;for(var d=0,e=b.length;d<e;d++){var f=b[d];if(!f.castShadow)continue;if(f instanceof THREE.SpotLight||f instanceof THREE.DirectionalLight&&!f.shadowCascade){a.shadowMap.value[c]=f.shadowMap;a.shadowMapSize.value[c]=f.shadowMapSize;a.shadowMatrix.value[c]=f.shadowMatrix;a.shadowDarkness.value[c]=f.shadowDarkness;a.shadowBias.value[c]=f.shadowBias;c++}}}}function zc(a,b){U.uniformMatrix4fv(a.modelViewMatrix,false,b._modelViewMatrix.elements);if(a.normalMatrix){U.uniformMatrix3fv(a.normalMatrix,false,b._normalMatrix.elements)}}function Ac(){var a=t;if(a>=Z){console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+Z)}t+=1;return a}function Bc(a,b){var c,d,e,f,g,h,i,j,l,m,n;for(l=0,m=b.length;l<m;l++){f=a.uniforms[b[l][1]];if(!f)continue;c=b[l][0];e=c.type;d=c.value;if(e==="i"){U.uniform1i(f,d)}else if(e==="f"){U.uniform1f(f,d)}else if(e==="v2"){U.uniform2f(f,d.x,d.y)}else if(e==="v3"){U.uniform3f(f,d.x,d.y,d.z)}else if(e==="v4"){U.uniform4f(f,d.x,d.y,d.z,d.w)}else if(e==="c"){U.uniform3f(f,d.r,d.g,d.b)}else if(e==="iv1"){U.uniform1iv(f,d)}else if(e==="iv"){U.uniform3iv(f,d)}else if(e==="fv1"){U.uniform1fv(f,d)}else if(e==="fv"){U.uniform3fv(f,d)}else if(e==="v2v"){if(c._array===undefined){c._array=new Float32Array(2*d.length)}for(i=0,j=d.length;i<j;i++){n=i*2;c._array[n]=d[i].x;c._array[n+1]=d[i].y}U.uniform2fv(f,c._array)}else if(e==="v3v"){if(c._array===undefined){c._array=new Float32Array(3*d.length)}for(i=0,j=d.length;i<j;i++){n=i*3;c._array[n]=d[i].x;c._array[n+1]=d[i].y;c._array[n+2]=d[i].z}U.uniform3fv(f,c._array)}else if(e==="v4v"){if(c._array===undefined){c._array=new Float32Array(4*d.length)}for(i=0,j=d.length;i<j;i++){n=i*4;c._array[n]=d[i].x;c._array[n+1]=d[i].y;c._array[n+2]=d[i].z;c._array[n+3]=d[i].w}U.uniform4fv(f,c._array)}else if(e==="m4"){if(c._array===undefined){c._array=new Float32Array(16)}d.flattenToArray(c._array);U.uniformMatrix4fv(f,false,c._array)}else if(e==="m4v"){if(c._array===undefined){c._array=new Float32Array(16*d.length)}for(i=0,j=d.length;i<j;i++){d[i].flattenToArrayOffset(c._array,i*16)}U.uniformMatrix4fv(f,false,c._array)}else if(e==="t"){g=d;h=Ac();U.uniform1i(f,h);if(!g)continue;if(g.image instanceof Array&&g.image.length===6){Rc(g,h)}else if(g instanceof THREE.WebGLRenderTargetCube){Sc(g,h)}else{k.setTexture(g,h)}}else if(e==="tv"){if(c._array===undefined){c._array=[]}for(i=0,j=c.value.length;i<j;i++){c._array[i]=Ac()}U.uniform1iv(f,c._array);for(i=0,j=c.value.length;i<j;i++){g=c.value[i];h=c._array[i];if(!g)continue;k.setTexture(g,h)}}}}function Cc(a,b){a._modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,a.matrixWorld);a._normalMatrix.getNormalMatrix(a._modelViewMatrix)}function Dc(a,b,c,d){a[b]=c.r*c.r*d;a[b+1]=c.g*c.g*d;a[b+2]=c.b*c.b*d}function Ec(a,b,c,d){a[b]=c.r*d;a[b+1]=c.g*d;a[b+2]=c.b*d}function Fc(a,b){var c,d,e,f,g=0,h=0,i=0,j,l,m,n,o,p,q,r=T,s=r.directional.colors,t=r.directional.positions,u=r.point.colors,v=r.point.positions,w=r.point.distances,x=r.spot.colors,y=r.spot.positions,z=r.spot.distances,A=r.spot.directions,B=r.spot.anglesCos,C=r.spot.exponents,D=r.hemi.skyColors,E=r.hemi.groundColors,F=r.hemi.positions,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,S=0,U=0;for(c=0,d=b.length;c<d;c++){e=b[c];if(e.onlyShadow)continue;j=e.color;n=e.intensity;q=e.distance;if(e instanceof THREE.AmbientLight){if(!e.visible)continue;if(k.gammaInput){g+=j.r*j.r;h+=j.g*j.g;i+=j.b*j.b}else{g+=j.r;h+=j.g;i+=j.b}}else if(e instanceof THREE.DirectionalLight){K+=1;if(!e.visible)continue;R.getPositionFromMatrix(e.matrixWorld);Q.getPositionFromMatrix(e.target.matrixWorld);R.sub(Q);R.normalize();if(R.x===0&&R.y===0&&R.z===0)continue;O=G*3;t[O]=R.x;t[O+1]=R.y;t[O+2]=R.z;if(k.gammaInput){Dc(s,O,j,n*n)}else{Ec(s,O,j,n)}G+=1}else if(e instanceof THREE.PointLight){L+=1;if(!e.visible)continue;P=H*3;if(k.gammaInput){Dc(u,P,j,n*n)}else{Ec(u,P,j,n)}Q.getPositionFromMatrix(e.matrixWorld);v[P]=Q.x;v[P+1]=Q.y;v[P+2]=Q.z;w[H]=q;H+=1}else if(e instanceof THREE.SpotLight){M+=1;if(!e.visible)continue;S=I*3;if(k.gammaInput){Dc(x,S,j,n*n)}else{Ec(x,S,j,n)}Q.getPositionFromMatrix(e.matrixWorld);y[S]=Q.x;y[S+1]=Q.y;y[S+2]=Q.z;z[I]=q;R.copy(Q);Q.getPositionFromMatrix(e.target.matrixWorld);R.sub(Q);R.normalize();A[S]=R.x;A[S+1]=R.y;A[S+2]=R.z;B[I]=Math.cos(e.angle);C[I]=e.exponent;I+=1}else if(e instanceof THREE.HemisphereLight){N+=1;if(!e.visible)continue;R.getPositionFromMatrix(e.matrixWorld);R.normalize();if(R.x===0&&R.y===0&&R.z===0)continue;U=J*3;F[U]=R.x;F[U+1]=R.y;F[U+2]=R.z;l=e.color;m=e.groundColor;if(k.gammaInput){o=n*n;Dc(D,U,l,o);Dc(E,U,m,o)}else{Ec(D,U,l,n);Ec(E,U,m,n)}J+=1}}for(c=G*3,d=Math.max(s.length,K*3);c<d;c++)s[c]=0;for(c=H*3,d=Math.max(u.length,L*3);c<d;c++)u[c]=0;for(c=I*3,d=Math.max(x.length,M*3);c<d;c++)x[c]=0;for(c=J*3,d=Math.max(D.length,N*3);c<d;c++)D[c]=0;for(c=J*3,d=Math.max(E.length,N*3);c<d;c++)E[c]=0;r.directional.length=G;r.point.length=H;r.spot.length=I;r.hemi.length=J;r.ambient[0]=g;r.ambient[1]=h;r.ambient[2]=i}this.setFaceCulling=function(a,b){if(a===THREE.CullFaceNone){U.disable(U.CULL_FACE)}else{if(b===THREE.FrontFaceDirectionCW){U.frontFace(U.CW)}else{U.frontFace(U.CCW)}if(a===THREE.CullFaceBack){U.cullFace(U.BACK)}else if(a===THREE.CullFaceFront){U.cullFace(U.FRONT)}else{U.cullFace(U.FRONT_AND_BACK)}U.enable(U.CULL_FACE)}};this.setMaterialFaces=function(a){var b=a.side===THREE.DoubleSide;var c=a.side===THREE.BackSide;if(u!==b){if(b){U.disable(U.CULL_FACE)}else{U.enable(U.CULL_FACE)}u=b}if(v!==c){if(c){U.frontFace(U.CW)}else{U.frontFace(U.CCW)}v=c}};this.setDepthTest=function(a){if(A!==a){if(a){U.enable(U.DEPTH_TEST)}else{U.disable(U.DEPTH_TEST)}A=a}};this.setDepthWrite=function(a){if(B!==a){U.depthMask(a);B=a}};function Gc(a){if(a!==F){U.lineWidth(a);F=a}}function Hc(a,b,c){if(C!==a){if(a){U.enable(U.POLYGON_OFFSET_FILL)}else{U.disable(U.POLYGON_OFFSET_FILL)}C=a}if(a&&(D!==b||E!==c)){U.polygonOffset(b,c);D=b;E=c}}this.setBlending=function(a,b,c,d){if(a!==w){if(a===THREE.NoBlending){U.disable(U.BLEND)}else if(a===THREE.AdditiveBlending){U.enable(U.BLEND);U.blendEquation(U.FUNC_ADD);U.blendFunc(U.SRC_ALPHA,U.ONE)}else if(a===THREE.SubtractiveBlending){U.enable(U.BLEND);U.blendEquation(U.FUNC_ADD);U.blendFunc(U.ZERO,U.ONE_MINUS_SRC_COLOR)}else if(a===THREE.MultiplyBlending){U.enable(U.BLEND);U.blendEquation(U.FUNC_ADD);U.blendFunc(U.ZERO,U.SRC_COLOR)}else if(a===THREE.CustomBlending){U.enable(U.BLEND)}else{U.enable(U.BLEND);U.blendEquationSeparate(U.FUNC_ADD,U.FUNC_ADD);U.blendFuncSeparate(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA,U.ONE,U.ONE_MINUS_SRC_ALPHA)}w=a}if(a===THREE.CustomBlending){if(b!==x){U.blendEquation(Xc(b));x=b}if(c!==y||d!==z){U.blendFunc(Xc(c),Xc(d));y=c;z=d}}else{x=null;y=null;z=null}};function Ic(a){var b,c,d=[];for(var e in a){b=a[e];if(b===false)continue;c="#define "+e+" "+b;d.push(c)}return d.join("\n")}function Jc(a,b,d,e,f,g,h){var i,j,n,o,p;var q=[];if(a){q.push(a)}else{q.push(b);q.push(d)}for(n in g){q.push(n);q.push(g[n])}for(i in h){q.push(i);q.push(h[i])}p=q.join();for(i=0,j=l.length;i<j;i++){var r=l[i];if(r.code===p){r.usedTimes++;return r.program}}var s="SHADOWMAP_TYPE_BASIC";if(h.shadowMapType===THREE.PCFShadowMap){s="SHADOWMAP_TYPE_PCF"}else if(h.shadowMapType===THREE.PCFSoftShadowMap){s="SHADOWMAP_TYPE_PCF_SOFT"}var t=Ic(g);o=U.createProgram();var u=["precision "+c+" float;",t,cb?"#define VERTEX_TEXTURES":"",k.gammaInput?"#define GAMMA_INPUT":"",k.gammaOutput?"#define GAMMA_OUTPUT":"",k.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,"#define MAX_BONES "+h.maxBones,h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.vertexColors?"#define USE_COLOR":"",h.skinning?"#define USE_SKINNING":"",h.useVertexTexture?"#define BONE_TEXTURE":"",h.boneTextureWidth?"#define N_BONE_PIXEL_X "+h.boneTextureWidth.toFixed(1):"",h.boneTextureHeight?"#define N_BONE_PIXEL_Y "+h.boneTextureHeight.toFixed(1):"",h.morphTargets?"#define USE_MORPHTARGETS":"",h.morphNormals?"#define USE_MORPHNORMALS":"",h.perPixel?"#define PHONG_PER_PIXEL":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+s:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",h.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n");var v=["precision "+c+" float;",h.bumpMap||h.normalMap?"#extension GL_OES_standard_derivatives : enable":"",t,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,h.alphaTest?"#define ALPHATEST "+h.alphaTest:"",k.gammaInput?"#define GAMMA_INPUT":"",k.gammaOutput?"#define GAMMA_OUTPUT":"",k.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",h.useFog&&h.fog?"#define USE_FOG":"",h.useFog&&h.fogExp?"#define FOG_EXP2":"",h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.vertexColors?"#define USE_COLOR":"",h.metal?"#define METAL":"",h.perPixel?"#define PHONG_PER_PIXEL":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+s:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n");var w=Nc("vertex",u+d);var x=Nc("fragment",v+b);U.attachShader(o,w);U.attachShader(o,x);U.linkProgram(o);if(!U.getProgramParameter(o,U.LINK_STATUS)){console.error("Could not initialise shader\n"+"VALIDATE_STATUS: "+U.getProgramParameter(o,U.VALIDATE_STATUS)+", gl error ["+U.getError()+"]")}U.deleteShader(x);U.deleteShader(w);o.uniforms={};o.attributes={};var y,z,A,B;y=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"];if(h.useVertexTexture){y.push("boneTexture")}else{y.push("boneGlobalMatrices")}for(z in e){y.push(z)}Kc(o,y);y=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(B=0;B<h.maxMorphTargets;B++){y.push("morphTarget"+B)}for(B=0;B<h.maxMorphNormals;B++){y.push("morphNormal"+B)}for(A in f){y.push(A)}Lc(o,y);o.id=m++;l.push({program:o,code:p,usedTimes:1});k.info.memory.programs=l.length;return o}function Kc(a,b){var c,d,e;for(c=0,d=b.length;c<d;c++){e=b[c];
a.uniforms[e]=U.getUniformLocation(a,e)}}function Lc(a,b){var c,d,e;for(c=0,d=b.length;c<d;c++){e=b[c];a.attributes[e]=U.getAttribLocation(a,e)}}function Mc(a){var b=a.split("\n");for(var c=0,d=b.length;c<d;c++){b[c]=c+1+": "+b[c]}return b.join("\n")}function Nc(a,b){var c;if(a==="fragment"){c=U.createShader(U.FRAGMENT_SHADER)}else if(a==="vertex"){c=U.createShader(U.VERTEX_SHADER)}U.shaderSource(c,b);U.compileShader(c);if(!U.getShaderParameter(c,U.COMPILE_STATUS)){console.error(U.getShaderInfoLog(c));console.error(Mc(b));return null}return c}function Oc(a){return(a&a-1)===0}function Pc(a,b,c){if(c){U.texParameteri(a,U.TEXTURE_WRAP_S,Xc(b.wrapS));U.texParameteri(a,U.TEXTURE_WRAP_T,Xc(b.wrapT));U.texParameteri(a,U.TEXTURE_MAG_FILTER,Xc(b.magFilter));U.texParameteri(a,U.TEXTURE_MIN_FILTER,Xc(b.minFilter))}else{U.texParameteri(a,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE);U.texParameteri(a,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE);U.texParameteri(a,U.TEXTURE_MAG_FILTER,Wc(b.magFilter));U.texParameteri(a,U.TEXTURE_MIN_FILTER,Wc(b.minFilter))}if(X&&b.type!==THREE.FloatType){if(b.anisotropy>1||b.__oldAnisotropy){U.texParameterf(a,X.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,bb));b.__oldAnisotropy=b.anisotropy}}}this.setTexture=function(a,b){if(a.needsUpdate){if(!a.__webglInit){a.__webglInit=true;a.addEventListener("dispose",yb);a.__webglTexture=U.createTexture();k.info.memory.textures++}U.activeTexture(U.TEXTURE0+b);U.bindTexture(U.TEXTURE_2D,a.__webglTexture);U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,a.flipY);U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha);U.pixelStorei(U.UNPACK_ALIGNMENT,a.unpackAlignment);var c=a.image,d=Oc(c.width)&&Oc(c.height),e=Xc(a.format),f=Xc(a.type);Pc(U.TEXTURE_2D,a,d);var g,h=a.mipmaps;if(a instanceof THREE.DataTexture){if(h.length>0&&d){for(var i=0,j=h.length;i<j;i++){g=h[i];U.texImage2D(U.TEXTURE_2D,i,e,g.width,g.height,0,e,f,g.data)}a.generateMipmaps=false}else{U.texImage2D(U.TEXTURE_2D,0,e,c.width,c.height,0,e,f,c.data)}}else if(a instanceof THREE.CompressedTexture){for(var i=0,j=h.length;i<j;i++){g=h[i];U.compressedTexImage2D(U.TEXTURE_2D,i,e,g.width,g.height,0,g.data)}}else{if(h.length>0&&d){for(var i=0,j=h.length;i<j;i++){g=h[i];U.texImage2D(U.TEXTURE_2D,i,e,e,f,g)}a.generateMipmaps=false}else{U.texImage2D(U.TEXTURE_2D,0,e,e,f,a.image)}}if(a.generateMipmaps&&d)U.generateMipmap(U.TEXTURE_2D);a.needsUpdate=false;if(a.onUpdate)a.onUpdate()}else{U.activeTexture(U.TEXTURE0+b);U.bindTexture(U.TEXTURE_2D,a.__webglTexture)}};function Qc(a,b){if(a.width<=b&&a.height<=b){return a}var c=Math.max(a.width,a.height);var d=Math.floor(a.width*b/c);var e=Math.floor(a.height*b/c);var f=document.createElement("canvas");f.width=d;f.height=e;var g=f.getContext("2d");g.drawImage(a,0,0,a.width,a.height,0,0,d,e);return f}function Rc(a,b){if(a.image.length===6){if(a.needsUpdate){if(!a.image.__webglTextureCube){a.image.__webglTextureCube=U.createTexture();k.info.memory.textures++}U.activeTexture(U.TEXTURE0+b);U.bindTexture(U.TEXTURE_CUBE_MAP,a.image.__webglTextureCube);U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,a.flipY);var c=a instanceof THREE.CompressedTexture;var d=[];for(var e=0;e<6;e++){if(k.autoScaleCubemaps&&!c){d[e]=Qc(a.image[e],ab)}else{d[e]=a.image[e]}}var f=d[0],g=Oc(f.width)&&Oc(f.height),h=Xc(a.format),i=Xc(a.type);Pc(U.TEXTURE_CUBE_MAP,a,g);for(var e=0;e<6;e++){if(c){var j,l=d[e].mipmaps;for(var m=0,n=l.length;m<n;m++){j=l[m];U.compressedTexImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+e,m,h,j.width,j.height,0,j.data)}}else{U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,h,h,i,d[e])}}if(a.generateMipmaps&&g){U.generateMipmap(U.TEXTURE_CUBE_MAP)}a.needsUpdate=false;if(a.onUpdate)a.onUpdate()}else{U.activeTexture(U.TEXTURE0+b);U.bindTexture(U.TEXTURE_CUBE_MAP,a.image.__webglTextureCube)}}}function Sc(a,b){U.activeTexture(U.TEXTURE0+b);U.bindTexture(U.TEXTURE_CUBE_MAP,a.__webglTexture)}function Tc(a,b,c){U.bindFramebuffer(U.FRAMEBUFFER,a);U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,c,b.__webglTexture,0)}function Uc(a,b){U.bindRenderbuffer(U.RENDERBUFFER,a);if(b.depthBuffer&&!b.stencilBuffer){U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_COMPONENT16,b.width,b.height);U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_ATTACHMENT,U.RENDERBUFFER,a)}else if(b.depthBuffer&&b.stencilBuffer){U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_STENCIL,b.width,b.height);U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_STENCIL_ATTACHMENT,U.RENDERBUFFER,a)}else{U.renderbufferStorage(U.RENDERBUFFER,U.RGBA4,b.width,b.height)}}this.setRenderTarget=function(a){var b=a instanceof THREE.WebGLRenderTargetCube;if(a&&!a.__webglFramebuffer){if(a.depthBuffer===undefined)a.depthBuffer=true;if(a.stencilBuffer===undefined)a.stencilBuffer=true;a.addEventListener("dispose",zb);a.__webglTexture=U.createTexture();k.info.memory.textures++;var c=Oc(a.width)&&Oc(a.height),d=Xc(a.format),e=Xc(a.type);if(b){a.__webglFramebuffer=[];a.__webglRenderbuffer=[];U.bindTexture(U.TEXTURE_CUBE_MAP,a.__webglTexture);Pc(U.TEXTURE_CUBE_MAP,a,c);for(var f=0;f<6;f++){a.__webglFramebuffer[f]=U.createFramebuffer();a.__webglRenderbuffer[f]=U.createRenderbuffer();U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,d,a.width,a.height,0,d,e,null);Tc(a.__webglFramebuffer[f],a,U.TEXTURE_CUBE_MAP_POSITIVE_X+f);Uc(a.__webglRenderbuffer[f],a)}if(c)U.generateMipmap(U.TEXTURE_CUBE_MAP)}else{a.__webglFramebuffer=U.createFramebuffer();if(a.shareDepthFrom){a.__webglRenderbuffer=a.shareDepthFrom.__webglRenderbuffer}else{a.__webglRenderbuffer=U.createRenderbuffer()}U.bindTexture(U.TEXTURE_2D,a.__webglTexture);Pc(U.TEXTURE_2D,a,c);U.texImage2D(U.TEXTURE_2D,0,d,a.width,a.height,0,d,e,null);Tc(a.__webglFramebuffer,a,U.TEXTURE_2D);if(a.shareDepthFrom){if(a.depthBuffer&&!a.stencilBuffer){U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_ATTACHMENT,U.RENDERBUFFER,a.__webglRenderbuffer)}else if(a.depthBuffer&&a.stencilBuffer){U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_STENCIL_ATTACHMENT,U.RENDERBUFFER,a.__webglRenderbuffer)}}else{Uc(a.__webglRenderbuffer,a)}if(c)U.generateMipmap(U.TEXTURE_2D)}if(b){U.bindTexture(U.TEXTURE_CUBE_MAP,null)}else{U.bindTexture(U.TEXTURE_2D,null)}U.bindRenderbuffer(U.RENDERBUFFER,null);U.bindFramebuffer(U.FRAMEBUFFER,null)}var g,h,i,j,l;if(a){if(b){g=a.__webglFramebuffer[a.activeCubeFace]}else{g=a.__webglFramebuffer}h=a.width;i=a.height;j=0;l=0}else{g=null;h=I;i=J;j=G;l=H}if(g!==o){U.bindFramebuffer(U.FRAMEBUFFER,g);U.viewport(j,l,h,i);o=g}K=h;L=i};function Vc(a){if(a instanceof THREE.WebGLRenderTargetCube){U.bindTexture(U.TEXTURE_CUBE_MAP,a.__webglTexture);U.generateMipmap(U.TEXTURE_CUBE_MAP);U.bindTexture(U.TEXTURE_CUBE_MAP,null)}else{U.bindTexture(U.TEXTURE_2D,a.__webglTexture);U.generateMipmap(U.TEXTURE_2D);U.bindTexture(U.TEXTURE_2D,null)}}function Wc(a){if(a===THREE.NearestFilter||a===THREE.NearestMipMapNearestFilter||a===THREE.NearestMipMapLinearFilter){return U.NEAREST}return U.LINEAR}function Xc(a){if(a===THREE.RepeatWrapping)return U.REPEAT;if(a===THREE.ClampToEdgeWrapping)return U.CLAMP_TO_EDGE;if(a===THREE.MirroredRepeatWrapping)return U.MIRRORED_REPEAT;if(a===THREE.NearestFilter)return U.NEAREST;if(a===THREE.NearestMipMapNearestFilter)return U.NEAREST_MIPMAP_NEAREST;if(a===THREE.NearestMipMapLinearFilter)return U.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return U.LINEAR;if(a===THREE.LinearMipMapNearestFilter)return U.LINEAR_MIPMAP_NEAREST;if(a===THREE.LinearMipMapLinearFilter)return U.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return U.UNSIGNED_BYTE;if(a===THREE.UnsignedShort4444Type)return U.UNSIGNED_SHORT_4_4_4_4;if(a===THREE.UnsignedShort5551Type)return U.UNSIGNED_SHORT_5_5_5_1;if(a===THREE.UnsignedShort565Type)return U.UNSIGNED_SHORT_5_6_5;if(a===THREE.ByteType)return U.BYTE;if(a===THREE.ShortType)return U.SHORT;if(a===THREE.UnsignedShortType)return U.UNSIGNED_SHORT;if(a===THREE.IntType)return U.INT;if(a===THREE.UnsignedIntType)return U.UNSIGNED_INT;if(a===THREE.FloatType)return U.FLOAT;if(a===THREE.AlphaFormat)return U.ALPHA;if(a===THREE.RGBFormat)return U.RGB;if(a===THREE.RGBAFormat)return U.RGBA;if(a===THREE.LuminanceFormat)return U.LUMINANCE;if(a===THREE.LuminanceAlphaFormat)return U.LUMINANCE_ALPHA;if(a===THREE.AddEquation)return U.FUNC_ADD;if(a===THREE.SubtractEquation)return U.FUNC_SUBTRACT;if(a===THREE.ReverseSubtractEquation)return U.FUNC_REVERSE_SUBTRACT;if(a===THREE.ZeroFactor)return U.ZERO;if(a===THREE.OneFactor)return U.ONE;if(a===THREE.SrcColorFactor)return U.SRC_COLOR;if(a===THREE.OneMinusSrcColorFactor)return U.ONE_MINUS_SRC_COLOR;if(a===THREE.SrcAlphaFactor)return U.SRC_ALPHA;if(a===THREE.OneMinusSrcAlphaFactor)return U.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return U.DST_ALPHA;if(a===THREE.OneMinusDstAlphaFactor)return U.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return U.DST_COLOR;if(a===THREE.OneMinusDstColorFactor)return U.ONE_MINUS_DST_COLOR;if(a===THREE.SrcAlphaSaturateFactor)return U.SRC_ALPHA_SATURATE;if(Y!==undefined){if(a===THREE.RGB_S3TC_DXT1_Format)return Y.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT1_Format)return Y.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT3_Format)return Y.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===THREE.RGBA_S3TC_DXT5_Format)return Y.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function Yc(a){if(db&&a&&a.useVertexTexture){return 1024}else{var b=U.getParameter(U.MAX_VERTEX_UNIFORM_VECTORS);var c=Math.floor((b-20)/4);var d=c;if(a!==undefined&&a instanceof THREE.SkinnedMesh){d=Math.min(a.bones.length,d);if(d<a.bones.length){console.warn("WebGLRenderer: too many bones - "+a.bones.length+", this GPU supports just "+d+" (try OpenGL instead of ANGLE)")}}return d}}function Zc(a){var b,c,d,e,f,g,h;e=f=g=h=0;for(b=0,c=a.length;b<c;b++){d=a[b];if(d.onlyShadow)continue;if(d instanceof THREE.DirectionalLight)e++;if(d instanceof THREE.PointLight)f++;if(d instanceof THREE.SpotLight)g++;if(d instanceof THREE.HemisphereLight)h++}return{directional:e,point:f,spot:g,hemi:h}}function $c(a){var b,c,d,e=0;for(b=0,c=a.length;b<c;b++){d=a[b];if(!d.castShadow)continue;if(d instanceof THREE.SpotLight)e++;if(d instanceof THREE.DirectionalLight&&!d.shadowCascade)e++}return e}function _c(){try{if(!(U=b.getContext("experimental-webgl",{alpha:d,premultipliedAlpha:e,antialias:f,stencil:g,preserveDrawingBuffer:h}))){throw"Error creating WebGL context."}}catch(a){console.error(a)}V=U.getExtension("OES_texture_float");W=U.getExtension("OES_standard_derivatives");X=U.getExtension("EXT_texture_filter_anisotropic")||U.getExtension("MOZ_EXT_texture_filter_anisotropic")||U.getExtension("WEBKIT_EXT_texture_filter_anisotropic");Y=U.getExtension("WEBGL_compressed_texture_s3tc")||U.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||U.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");if(!V){console.log("THREE.WebGLRenderer: Float textures not supported.")}if(!W){console.log("THREE.WebGLRenderer: Standard derivatives not supported.")}if(!X){console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported.")}if(!Y){console.log("THREE.WebGLRenderer: S3TC compressed textures not supported.")}if(U.getShaderPrecisionFormat===undefined){U.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}}function ad(){U.clearColor(0,0,0,1);U.clearDepth(1);U.clearStencil(0);U.enable(U.DEPTH_TEST);U.depthFunc(U.LEQUAL);U.frontFace(U.CCW);U.cullFace(U.BACK);U.enable(U.CULL_FACE);U.enable(U.BLEND);U.blendEquation(U.FUNC_ADD);U.blendFunc(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA);U.clearColor(i.r,i.g,i.b,j)}this.shadowMapPlugin=new THREE.ShadowMapPlugin;this.addPrePlugin(this.shadowMapPlugin);this.addPostPlugin(new THREE.SpritePlugin);this.addPostPlugin(new THREE.LensFlarePlugin)};THREE.WebGLRenderTarget=function(a,b,c){this.width=a;this.height=b;c=c||{};this.wrapS=c.wrapS!==undefined?c.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=c.wrapT!==undefined?c.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=c.magFilter!==undefined?c.magFilter:THREE.LinearFilter;this.minFilter=c.minFilter!==undefined?c.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=c.anisotropy!==undefined?c.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=c.format!==undefined?c.format:THREE.RGBAFormat;this.type=c.type!==undefined?c.type:THREE.UnsignedByteType;this.depthBuffer=c.depthBuffer!==undefined?c.depthBuffer:true;this.stencilBuffer=c.stencilBuffer!==undefined?c.stencilBuffer:true;this.generateMipmaps=true;this.shareDepthFrom=null};THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,clone:function(){var a=new THREE.WebGLRenderTarget(this.width,this.height);a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.format=this.format;a.type=this.type;a.depthBuffer=this.depthBuffer;a.stencilBuffer=this.stencilBuffer;a.generateMipmaps=this.generateMipmaps;a.shareDepthFrom=this.shareDepthFrom;return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.WebGLRenderTargetCube=function(a,b,c){THREE.WebGLRenderTarget.call(this,a,b,c);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=true};THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.centroidModel=new THREE.Vector3;this.normalModel=new THREE.Vector3;this.normalModelView=new THREE.Vector3;this.vertexNormalsLength=0;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.color=null;this.material=null;this.uvs=[[]];this.z=null};THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.v4=new THREE.RenderableVertex;this.centroidModel=new THREE.Vector3;this.normalModel=new THREE.Vector3;this.normalModelView=new THREE.Vector3;this.vertexNormalsLength=0;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.color=null;this.material=null;this.uvs=[[]];this.z=null};THREE.RenderableObject=function(){this.object=null;this.z=null};THREE.RenderableParticle=function(){this.object=null;this.x=null;this.y=null;this.z=null;this.rotation=null;this.scale=new THREE.Vector2;this.material=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null};THREE.GeometryUtils={merge:function(a,b,c){var d,e,f=a.vertices.length,g=a.faceVertexUvs[0].length,h=b instanceof THREE.Mesh?b.geometry:b,i=a.vertices,j=h.vertices,k=a.faces,l=h.faces,m=a.faceVertexUvs[0],n=h.faceVertexUvs[0];if(c===undefined)c=0;if(b instanceof THREE.Mesh){b.matrixAutoUpdate&&b.updateMatrix();d=b.matrix;e=(new THREE.Matrix3).getNormalMatrix(d)}for(var o=0,p=j.length;o<p;o++){var q=j[o];var r=q.clone();if(d)r.applyMatrix4(d);i.push(r)}for(o=0,p=l.length;o<p;o++){var s=l[o],t,u,v,w=s.vertexNormals,x=s.vertexColors;if(s instanceof THREE.Face3){t=new THREE.Face3(s.a+f,s.b+f,s.c+f)}else if(s instanceof THREE.Face4){t=new THREE.Face4(s.a+f,s.b+f,s.c+f,s.d+f)}t.normal.copy(s.normal);if(e){t.normal.applyMatrix3(e).normalize()}for(var y=0,z=w.length;y<z;y++){u=w[y].clone();if(e){u.applyMatrix3(e).normalize()}t.vertexNormals.push(u)}t.color.copy(s.color);for(var y=0,z=x.length;y<z;y++){v=x[y];t.vertexColors.push(v.clone())}t.materialIndex=s.materialIndex+c;t.centroid.copy(s.centroid);if(d){t.centroid.applyMatrix4(d)}k.push(t)}for(o=0,p=n.length;o<p;o++){var A=n[o],B=[];for(var y=0,z=A.length;y<z;y++){B.push(new THREE.Vector2(A[y].x,A[y].y))}m.push(B)}},removeMaterials:function(a,b){var c={};for(var d=0,e=b.length;d<e;d++){c[b[d]]=true}var f,g=[];for(var d=0,e=a.faces.length;d<e;d++){f=a.faces[d];if(!(f.materialIndex in c))g.push(f)}a.faces=g},randomPointInTriangle:function(a,b,c){var d,e,f,g=new THREE.Vector3,h=THREE.GeometryUtils.__v1;d=THREE.GeometryUtils.random();e=THREE.GeometryUtils.random();if(d+e>1){d=1-d;e=1-e}f=1-d-e;g.copy(a);g.multiplyScalar(d);h.copy(b);h.multiplyScalar(e);g.add(h);h.copy(c);h.multiplyScalar(f);g.add(h);return g},randomPointInFace:function(a,b,c){var d,e,f,g;if(a instanceof THREE.Face3){d=b.vertices[a.a];e=b.vertices[a.b];f=b.vertices[a.c];return THREE.GeometryUtils.randomPointInTriangle(d,e,f)}else if(a instanceof THREE.Face4){d=b.vertices[a.a];e=b.vertices[a.b];f=b.vertices[a.c];g=b.vertices[a.d];var h,i;if(c){if(a._area1&&a._area2){h=a._area1;i=a._area2}else{h=THREE.GeometryUtils.triangleArea(d,e,g);i=THREE.GeometryUtils.triangleArea(e,f,g);a._area1=h;a._area2=i}}else{h=THREE.GeometryUtils.triangleArea(d,e,g),i=THREE.GeometryUtils.triangleArea(e,f,g)}var j=THREE.GeometryUtils.random()*(h+i);if(j<h){return THREE.GeometryUtils.randomPointInTriangle(d,e,g)}else{return THREE.GeometryUtils.randomPointInTriangle(e,f,g)}}},randomPointsInGeometry:function(a,b){var c,d,e=a.faces,f=a.vertices,g=e.length,h=0,i=[],j,k,l,m;for(d=0;d<g;d++){c=e[d];if(c instanceof THREE.Face3){j=f[c.a];k=f[c.b];l=f[c.c];c._area=THREE.GeometryUtils.triangleArea(j,k,l)}else if(c instanceof THREE.Face4){j=f[c.a];k=f[c.b];l=f[c.c];m=f[c.d];c._area1=THREE.GeometryUtils.triangleArea(j,k,m);c._area2=THREE.GeometryUtils.triangleArea(k,l,m);c._area=c._area1+c._area2}h+=c._area;i[d]=h}function n(a){function b(c,d){if(d<c)return c;var e=c+Math.floor((d-c)/2);if(i[e]>a){return b(c,e-1)}else if(i[e]<a){return b(e+1,d)}else{return e}}var c=b(0,i.length-1);return c}var o,p,q=[];var r={};for(d=0;d<b;d++){o=THREE.GeometryUtils.random()*h;p=n(o);q[d]=THREE.GeometryUtils.randomPointInFace(e[p],a,true);if(!r[p]){r[p]=1}else{r[p]+=1}}return q},triangleArea:function(a,b,c){var d=THREE.GeometryUtils.__v1,e=THREE.GeometryUtils.__v2;d.subVectors(b,a);e.subVectors(c,a);d.cross(e);return.5*d.length()},center:function(a){a.computeBoundingBox();var b=a.boundingBox;var c=new THREE.Vector3;c.addVectors(b.min,b.max);c.multiplyScalar(-.5);a.applyMatrix((new THREE.Matrix4).makeTranslation(c.x,c.y,c.z));a.computeBoundingBox();return c},normalizeUVs:function(a){var b=a.faceVertexUvs[0];for(var c=0,d=b.length;c<d;c++){var e=b[c];for(var f=0,g=e.length;f<g;f++){if(e[f].x!==1)e[f].x=e[f].x-Math.floor(e[f].x);if(e[f].y!==1)e[f].y=e[f].y-Math.floor(e[f].y)}}},triangulateQuads:function(a){var b,c,d,e;var f=[];var g=[];var h=[];for(b=0,c=a.faceUvs.length;b<c;b++){g[b]=[]}for(b=0,c=a.faceVertexUvs.length;b<c;b++){h[b]=[]}for(b=0,c=a.faces.length;b<c;b++){var i=a.faces[b];if(i instanceof THREE.Face4){var j=i.a;var k=i.b;var l=i.c;var m=i.d;var n=new THREE.Face3;var o=new THREE.Face3;n.color.copy(i.color);o.color.copy(i.color);n.materialIndex=i.materialIndex;o.materialIndex=i.materialIndex;n.a=j;n.b=k;n.c=m;o.a=k;o.b=l;o.c=m;if(i.vertexColors.length===4){n.vertexColors[0]=i.vertexColors[0].clone();n.vertexColors[1]=i.vertexColors[1].clone();n.vertexColors[2]=i.vertexColors[3].clone();o.vertexColors[0]=i.vertexColors[1].clone();o.vertexColors[1]=i.vertexColors[2].clone();o.vertexColors[2]=i.vertexColors[3].clone()}f.push(n,o);for(d=0,e=a.faceVertexUvs.length;d<e;d++){if(a.faceVertexUvs[d].length){var p=a.faceVertexUvs[d][b];var q=p[0];var r=p[1];var s=p[2];var t=p[3];var u=[q.clone(),r.clone(),t.clone()];var v=[r.clone(),s.clone(),t.clone()];h[d].push(u,v)}}for(d=0,e=a.faceUvs.length;d<e;d++){if(a.faceUvs[d].length){var w=a.faceUvs[d][b];g[d].push(w,w)}}}else{f.push(i);for(d=0,e=a.faceUvs.length;d<e;d++){g[d].push(a.faceUvs[d][b])}for(d=0,e=a.faceVertexUvs.length;d<e;d++){h[d].push(a.faceVertexUvs[d][b])}}}a.faces=f;a.faceUvs=g;a.faceVertexUvs=h;a.computeCentroids();a.computeFaceNormals();a.computeVertexNormals();if(a.hasTangents)a.computeTangents()},setMaterialIndex:function(a,b,c,d){var e=a.faces;var f=c||0;var g=d||e.length-1;for(var h=f;h<=g;h++){e[h].materialIndex=b}}};THREE.GeometryUtils.random=THREE.Math.random16;THREE.GeometryUtils.__v1=new THREE.Vector3;THREE.GeometryUtils.__v2=new THREE.Vector3;THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(a,b,c,d){var e=new Image;var f=new THREE.Texture(e,b);var g=new THREE.ImageLoader;g.addEventListener("load",function(a){f.image=a.content;f.needsUpdate=true;if(c)c(f)});g.addEventListener("error",function(a){if(d)d(a.message)});g.crossOrigin=this.crossOrigin;g.load(a,e);f.sourceFile=a;return f},loadCompressedTexture:function(a,b,c,d){var e=new THREE.CompressedTexture;e.mapping=b;var f=new XMLHttpRequest;f.onload=function(){var a=f.response;var b=THREE.ImageUtils.parseDDS(a,true);e.format=b.format;e.mipmaps=b.mipmaps;e.image.width=b.width;e.image.height=b.height;e.generateMipmaps=false;e.needsUpdate=true;if(c)c(e)};f.onerror=d;f.open("GET",a,true);f.responseType="arraybuffer";f.send(null);return e},loadTextureCube:function(a,b,c,d){var e=[];e.loadCount=0;var f=new THREE.Texture;f.image=e;if(b!==undefined)f.mapping=b;f.flipY=false;for(var g=0,h=a.length;g<h;++g){var i=new Image;e[g]=i;i.onload=function(){e.loadCount+=1;if(e.loadCount===6){f.needsUpdate=true;if(c)c(f)}};i.onerror=d;i.crossOrigin=this.crossOrigin;i.src=a[g]}return f},loadCompressedTextureCube:function(a,b,c,d){var e=[];e.loadCount=0;var f=new THREE.CompressedTexture;f.image=e;if(b!==undefined)f.mapping=b;f.flipY=false;f.generateMipmaps=false;var g=function(a,b){return function(){var d=a.response;var g=THREE.ImageUtils.parseDDS(d,true);b.format=g.format;b.mipmaps=g.mipmaps;b.width=g.width;b.height=g.height;e.loadCount+=1;if(e.loadCount===6){f.format=g.format;f.needsUpdate=true;if(c)c(f)}}};if(a instanceof Array){for(var h=0,i=a.length;h<i;++h){var j={};e[h]=j;var k=new XMLHttpRequest;k.onload=g(k,j);k.onerror=d;var l=a[h];k.open("GET",l,true);k.responseType="arraybuffer";k.send(null)}}else{var l=a;var k=new XMLHttpRequest;k.onload=function(){var a=k.response;var b=THREE.ImageUtils.parseDDS(a,true);if(b.isCubemap){var d=b.mipmaps.length/b.mipmapCount;for(var g=0;g<d;g++){e[g]={mipmaps:[]};for(var h=0;h<b.mipmapCount;h++){e[g].mipmaps.push(b.mipmaps[g*b.mipmapCount+h]);e[g].format=b.format;e[g].width=b.width;e[g].height=b.height}}f.format=b.format;f.needsUpdate=true;if(c)c(f)}};k.onerror=d;k.open("GET",l,true);k.responseType="arraybuffer";k.send(null)}return f},parseDDS:function(a,b){var c={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};var d=542327876;var e=1,f=2,g=4,h=8,i=4096,j=131072,k=524288,l=8388608;var m=8,n=4194304,o=4096;var p=512,q=1024,r=2048,s=4096,t=8192,u=16384,v=32768,w=2097152;var x=1,y=2,z=4,A=64,B=512,C=131072;function D(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function E(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var F=D("DXT1");var G=D("DXT3");var H=D("DXT5");var I=31;var J=0;var K=1;var L=2;var M=3;var N=4;var O=7;var P=20;var Q=21;var R=27;var S=28;var T=29;var U=30;var V=new Int32Array(a,0,I);if(V[J]!==d){console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header");return c}if(!V[P]&z){console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code");return c}var W;var X=V[Q];switch(X){case F:W=8;c.format=THREE.RGB_S3TC_DXT1_Format;break;case G:W=16;c.format=THREE.RGBA_S3TC_DXT3_Format;break;case H:W=16;c.format=THREE.RGBA_S3TC_DXT5_Format;break;default:console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",E(X));return c}c.mipmapCount=1;if(V[L]&j&&b!==false){c.mipmapCount=Math.max(1,V[O])}c.isCubemap=V[S]&p?true:false;c.width=V[N];c.height=V[M];var Y=V[K]+4;var Z=c.width;var $=c.height;var _=c.isCubemap?6:1;for(var ab=0;ab<_;ab++){for(var bb=0;bb<c.mipmapCount;bb++){var cb=Math.max(4,Z)/4*Math.max(4,$)/4*W;var db=new Uint8Array(a,Y,cb);var eb={data:db,width:Z,height:$};c.mipmaps.push(eb);Y+=cb;Z=Math.max(Z*.5,1);$=Math.max($*.5,1)}Z=c.width;$=c.height}return c},getNormalMap:function(a,b){var c=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]};var d=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]};var e=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/b,a[1]/b,a[2]/b]};b=b|1;var f=a.width;var g=a.height;var h=document.createElement("canvas");h.width=f;h.height=g;var i=h.getContext("2d");i.drawImage(a,0,0);var j=i.getImageData(0,0,f,g).data;var k=i.createImageData(f,g);var l=k.data;for(var m=0;m<f;m++){for(var n=0;n<g;n++){var o=n-1<0?0:n-1;var p=n+1>g-1?g-1:n+1;var q=m-1<0?0:m-1;var r=m+1>f-1?f-1:m+1;var s=[];var t=[0,0,j[(n*f+m)*4]/255*b];s.push([-1,0,j[(n*f+q)*4]/255*b]);s.push([-1,-1,j[(o*f+q)*4]/255*b]);s.push([0,-1,j[(o*f+m)*4]/255*b]);s.push([1,-1,j[(o*f+r)*4]/255*b]);s.push([1,0,j[(n*f+r)*4]/255*b]);s.push([1,1,j[(p*f+r)*4]/255*b]);s.push([0,1,j[(p*f+m)*4]/255*b]);s.push([-1,1,j[(p*f+q)*4]/255*b]);var u=[];var v=s.length;for(var w=0;w<v;w++){var x=s[w];var y=s[(w+1)%v];x=d(x,t);y=d(y,t);u.push(e(c(x,y)))}var z=[0,0,0];for(var w=0;w<u.length;w++){z[0]+=u[w][0];z[1]+=u[w][1];z[2]+=u[w][2]}z[0]/=u.length;z[1]/=u.length;z[2]/=u.length;var A=(n*f+m)*4;l[A]=(z[0]+1)/2*255|0;l[A+1]=(z[1]+1)/2*255|0;l[A+2]=z[2]*255|0;l[A+3]=255}}i.putImageData(k,0,0);return h},generateDataTexture:function(a,b,c){var d=a*b;var e=new Uint8Array(3*d);var f=Math.floor(c.r*255);var g=Math.floor(c.g*255);var h=Math.floor(c.b*255);for(var i=0;i<d;i++){e[i*3]=f;e[i*3+1]=g;e[i*3+2]=h}var j=new THREE.DataTexture(e,a,b,THREE.RGBFormat);j.needsUpdate=true;return j}};THREE.SceneUtils={createMultiMaterialObject:function(a,b){var c=new THREE.Object3D;for(var d=0,e=b.length;d<e;d++){c.add(new THREE.Mesh(a,b[d]))}return c},detach:function(a,b,c){a.applyMatrix(b.matrixWorld);b.remove(a);c.add(a)},attach:function(a,b,c){var d=new THREE.Matrix4;d.getInverse(c.matrixWorld);a.applyMatrix(d);b.remove(a);c.add(a)}};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(a){var b=a.familyName.toLowerCase();var c=this;c.faces[b]=c.faces[b]||{};c.faces[b][a.cssFontWeight]=c.faces[b][a.cssFontWeight]||{};c.faces[b][a.cssFontWeight][a.cssFontStyle]=a;var d=c.faces[b][a.cssFontWeight][a.cssFontStyle]=a;return a},drawText:function(a){var b=[],c=[];var d,e,f=this.getFace(),g=this.size/f.resolution,h=0,i=String(a).split(""),j=i.length;var k=[];for(d=0;d<j;d++){var l=new THREE.Path;var m=this.extractGlyphPoints(i[d],f,g,h,l);h+=m.offset;k.push(m.path)}var n=h/2;return{paths:k,offset:n}},extractGlyphPoints:function(a,b,c,d,e){var f=[];var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=b.glyphs[a]||b.glyphs["?"];if(!z)return;if(z.o){j=z._cachedOutline||(z._cachedOutline=z.o.split(" "));l=j.length;m=c;n=c;for(g=0;g<l;){k=j[g++];switch(k){case"m":o=j[g++]*m+d;p=j[g++]*n;e.moveTo(o,p);break;case"l":o=j[g++]*m+d;p=j[g++]*n;e.lineTo(o,p);break;case"q":q=j[g++]*m+d;r=j[g++]*n;u=j[g++]*m+d;v=j[g++]*n;e.quadraticCurveTo(u,v,q,r);y=f[f.length-1];if(y){s=y.x;t=y.y;for(h=1,i=this.divisions;h<=i;h++){var A=h/i;var B=THREE.Shape.Utils.b2(A,s,u,q);var C=THREE.Shape.Utils.b2(A,t,v,r)}}break;case"b":q=j[g++]*m+d;r=j[g++]*n;u=j[g++]*m+d;v=j[g++]*-n;w=j[g++]*m+d;x=j[g++]*-n;e.bezierCurveTo(q,r,u,v,w,x);y=f[f.length-1];if(y){s=y.x;t=y.y;for(h=1,i=this.divisions;h<=i;h++){var A=h/i;var B=THREE.Shape.Utils.b3(A,s,u,w,q);var C=THREE.Shape.Utils.b3(A,t,v,x,r)}}break}}}return{offset:z.ha*c,path:e}}};THREE.FontUtils.generateShapes=function(a,b){b=b||{};var c=b.size!==undefined?b.size:100;var d=b.curveSegments!==undefined?b.curveSegments:4;var e=b.font!==undefined?b.font:"helvetiker";var f=b.weight!==undefined?b.weight:"normal";var g=b.style!==undefined?b.style:"normal";THREE.FontUtils.size=c;THREE.FontUtils.divisions=d;THREE.FontUtils.face=e;THREE.FontUtils.weight=f;THREE.FontUtils.style=g;var h=THREE.FontUtils.drawText(a);var i=h.paths;var j=[];for(var k=0,l=i.length;k<l;k++){Array.prototype.push.apply(j,i[k].toShapes())}return j};!function(a){var b=1e-10;var c=function(a,b){var c=a.length;if(c<3)return null;var f=[],g=[],h=[];var i,j,k;if(d(a)>0){for(j=0;j<c;j++)g[j]=j}else{for(j=0;j<c;j++)g[j]=c-1-j}var l=c;var m=2*l;for(j=l-1;l>2;){if(m--<=0){console.log("Warning, unable to triangulate polygon!");if(b)return h;return f}i=j;if(l<=i)i=0;j=i+1;if(l<=j)j=0;k=j+1;if(l<=k)k=0;if(e(a,i,j,k,l,g)){var n,o,p,q,r;n=g[i];o=g[j];p=g[k];f.push([a[n],a[o],a[p]]);h.push([g[i],g[j],g[k]]);for(q=j,r=j+1;r<l;q++,r++){g[q]=g[r]}l--;m=2*l}}if(b)return h;return f};var d=function(a){var b=a.length;var c=0;for(var d=b-1,e=0;e<b;d=e++){c+=a[d].x*a[e].y-a[e].x*a[d].y}return c*.5};var e=function(a,c,d,e,f,g){var h;var i,j,k,l;var m,n,o,p;i=a[g[c]].x;j=a[g[c]].y;k=a[g[d]].x;l=a[g[d]].y;m=a[g[e]].x;n=a[g[e]].y;if(b>(k-i)*(n-j)-(l-j)*(m-i))return false;var q,r,s,t,u,v;var w,x,y,z,A,B;var C,D,E;q=m-k;r=n-l;s=i-m;t=j-n;u=k-i;v=l-j;for(h=0;h<f;h++){if(h===c||h===d||h===e)continue;o=a[g[h]].x;p=a[g[h]].y;w=o-i;x=p-j;y=o-k;z=p-l;A=o-m;B=p-n;E=q*z-r*y;C=u*x-v*w;D=s*B-t*A;if(E>=0&&D>=0&&C>=0)return false}return true};a.Triangulate=c;a.Triangulate.area=d;return a}(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(a){console.log("Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(a){var b=this.getUtoTmapping(a);return this.getPoint(b)};THREE.Curve.prototype.getPoints=function(a){if(!a)a=5;var b,c=[];for(b=0;b<=a;b++){c.push(this.getPoint(b/a))}return c};THREE.Curve.prototype.getSpacedPoints=function(a){if(!a)a=5;var b,c=[];for(b=0;b<=a;b++){c.push(this.getPointAt(b/a))}return c};THREE.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]};THREE.Curve.prototype.getLengths=function(a){if(!a)a=this.__arcLengthDivisions?this.__arcLengthDivisions:200;if(this.cacheArcLengths&&this.cacheArcLengths.length==a+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var b=[];var c,d=this.getPoint(0);var e,f=0;b.push(0);for(e=1;e<=a;e++){c=this.getPoint(e/a);f+=c.distanceTo(d);b.push(f);d=c}this.cacheArcLengths=b;return b};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(a,b){var c=this.getLengths();var d=0,e=c.length;var f;if(b){f=b}else{f=a*c[e-1]}var g=0,h=e-1,i;while(g<=h){d=Math.floor(g+(h-g)/2);i=c[d]-f;if(i<0){g=d+1;continue}else if(i>0){h=d-1;continue}else{h=d;break}}d=h;if(c[d]==f){var j=d/(e-1);return j}var k=c[d];var l=c[d+1];var m=l-k;var n=(f-k)/m;var j=(d+n)/(e-1);return j};THREE.Curve.prototype.getTangent=function(a){var b=1e-4;var c=a-b;var d=a+b;if(c<0)c=0;if(d>1)d=1;var e=this.getPoint(c);var f=this.getPoint(d);var g=f.clone().sub(e);return g.normalize()};THREE.Curve.prototype.getTangentAt=function(a){var b=this.getUtoTmapping(a);return this.getTangent(b)};THREE.LineCurve=function(a,b){this.v1=a;this.v2=b};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().sub(this.v1);b.multiplyScalar(a).add(this.v1);return b};THREE.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)};THREE.LineCurve.prototype.getTangent=function(a){var b=this.v2.clone().sub(this.v1);return b.normalize()};THREE.QuadraticBezierCurve=function(a,b,c){this.v0=a;this.v1=b;this.v2=c};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);
THREE.QuadraticBezierCurve.prototype.getPoint=function(a){var b,c;b=THREE.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x);c=THREE.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y);return new THREE.Vector2(b,c)};THREE.QuadraticBezierCurve.prototype.getTangent=function(a){var b,c;b=THREE.Curve.Utils.tangentQuadraticBezier(a,this.v0.x,this.v1.x,this.v2.x);c=THREE.Curve.Utils.tangentQuadraticBezier(a,this.v0.y,this.v1.y,this.v2.y);var d=new THREE.Vector2(b,c);d.normalize();return d};THREE.CubicBezierCurve=function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.getPoint=function(a){var b,c;b=THREE.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);c=THREE.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(b,c)};THREE.CubicBezierCurve.prototype.getTangent=function(a){var b,c;b=THREE.Curve.Utils.tangentCubicBezier(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);c=THREE.Curve.Utils.tangentCubicBezier(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var d=new THREE.Vector2(b,c);d.normalize();return d};THREE.SplineCurve=function(a){this.points=a==undefined?[]:a};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.getPoint=function(a){var b=new THREE.Vector2;var c=[];var d=this.points,e,f,g;e=(d.length-1)*a;f=Math.floor(e);g=e-f;c[0]=f==0?f:f-1;c[1]=f;c[2]=f>d.length-2?d.length-1:f+1;c[3]=f>d.length-3?d.length-1:f+2;b.x=THREE.Curve.Utils.interpolate(d[c[0]].x,d[c[1]].x,d[c[2]].x,d[c[3]].x,g);b.y=THREE.Curve.Utils.interpolate(d[c[0]].y,d[c[1]].y,d[c[2]].y,d[c[3]].y,g);return b};THREE.EllipseCurve=function(a,b,c,d,e,f,g){this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=f;this.aClockwise=g};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.getPoint=function(a){var b=this.aEndAngle-this.aStartAngle;if(!this.aClockwise){a=1-a}var c=this.aStartAngle+a*b;var d=this.aX+this.xRadius*Math.cos(c);var e=this.aY+this.yRadius*Math.sin(c);return new THREE.Vector2(d,e)};THREE.ArcCurve=function(a,b,c,d,e,f){THREE.EllipseCurve.call(this,a,b,c,c,d,e,f)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.Curve.Utils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a,b,c,d,e){var f=6*a*a-6*a;var g=3*a*a-4*a+1;var h=-6*a*a+6*a;var i=3*a*a-2*a;return f+g+h+i},interpolate:function(a,b,c,d,e){var f=(c-a)*.5;var g=(d-b)*.5;var h=e*e;var i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b}};THREE.Curve.create=function(a,b){a.prototype=Object.create(THREE.Curve.prototype);a.prototype.getPoint=b;return a};THREE.LineCurve3=THREE.Curve.create(function(a,b){this.v1=a;this.v2=b},function(a){var b=new THREE.Vector3;b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(a,b,c){this.v0=a;this.v1=b;this.v2=c},function(a){var b,c,d;b=THREE.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x);c=THREE.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y);d=THREE.Shape.Utils.b2(a,this.v0.z,this.v1.z,this.v2.z);return new THREE.Vector3(b,c,d)});THREE.CubicBezierCurve3=THREE.Curve.create(function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d},function(a){var b,c,d;b=THREE.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);c=THREE.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);d=THREE.Shape.Utils.b3(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new THREE.Vector3(b,c,d)});THREE.SplineCurve3=THREE.Curve.create(function(a){this.points=a==undefined?[]:a},function(a){var b=new THREE.Vector3;var c=[];var d=this.points,e,f,g;e=(d.length-1)*a;f=Math.floor(e);g=e-f;c[0]=f==0?f:f-1;c[1]=f;c[2]=f>d.length-2?d.length-1:f+1;c[3]=f>d.length-3?d.length-1:f+2;var h=d[c[0]],i=d[c[1]],j=d[c[2]],k=d[c[3]];b.x=THREE.Curve.Utils.interpolate(h.x,i.x,j.x,k.x,g);b.y=THREE.Curve.Utils.interpolate(h.y,i.y,j.y,k.y,g);b.z=THREE.Curve.Utils.interpolate(h.z,i.z,j.z,k.z,g);return b});THREE.ClosedSplineCurve3=THREE.Curve.create(function(a){this.points=a==undefined?[]:a},function(a){var b=new THREE.Vector3;var c=[];var d=this.points,e,f,g;e=(d.length-0)*a;f=Math.floor(e);g=e-f;f+=f>0?0:(Math.floor(Math.abs(f)/d.length)+1)*d.length;c[0]=(f-1)%d.length;c[1]=f%d.length;c[2]=(f+1)%d.length;c[3]=(f+2)%d.length;b.x=THREE.Curve.Utils.interpolate(d[c[0]].x,d[c[1]].x,d[c[2]].x,d[c[3]].x,g);b.y=THREE.Curve.Utils.interpolate(d[c[0]].y,d[c[1]].y,d[c[2]].y,d[c[3]].y,g);b.z=THREE.Curve.Utils.interpolate(d[c[0]].z,d[c[1]].z,d[c[2]].z,d[c[3]].z,g);return b});THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.add=function(a){this.curves.push(a)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var a=this.curves[0].getPoint(0);var b=this.curves[this.curves.length-1].getPoint(1);if(!a.equals(b)){this.curves.push(new THREE.LineCurve(b,a))}};THREE.CurvePath.prototype.getPoint=function(a){var b=a*this.getLength();var c=this.getCurveLengths();var d=0,e,f;while(d<c.length){if(c[d]>=b){e=c[d]-b;f=this.curves[d];var g=1-e/f.getLength();return f.getPointAt(g);break}d++}return null};THREE.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var a=[],b=0;var c,d=this.curves.length;for(c=0;c<d;c++){b+=this.curves[c].getLength();a.push(b)}this.cacheLengths=a;return a};THREE.CurvePath.prototype.getBoundingBox=function(){var a=this.getPoints();var b,c,d;var e,f,g;b=c=Number.NEGATIVE_INFINITY;e=f=Number.POSITIVE_INFINITY;var h,i,j,k;var l=a[0]instanceof THREE.Vector3;k=l?new THREE.Vector3:new THREE.Vector2;for(i=0,j=a.length;i<j;i++){h=a[i];if(h.x>b)b=h.x;else if(h.x<e)e=h.x;if(h.y>c)c=h.y;else if(h.y<f)f=h.y;if(l){if(h.z>d)d=h.z;else if(h.z<g)g=h.z}k.add(h)}var m={minX:e,minY:f,maxX:b,maxY:c,centroid:k.divideScalar(j)};if(l){m.maxZ=d;m.minZ=g}return m};THREE.CurvePath.prototype.createPointsGeometry=function(a){var b=this.getPoints(a,true);return this.createGeometry(b)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(a){var b=this.getSpacedPoints(a,true);return this.createGeometry(b)};THREE.CurvePath.prototype.createGeometry=function(a){var b=new THREE.Geometry;for(var c=0;c<a.length;c++){b.vertices.push(new THREE.Vector3(a[c].x,a[c].y,a[c].z||0))}return b};THREE.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)};THREE.CurvePath.prototype.getTransformedPoints=function(a,b){var c=this.getPoints(a);var d,e;if(!b){b=this.bends}for(d=0,e=b.length;d<e;d++){c=this.getWrapPoints(c,b[d])}return c};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(a,b){var c=this.getSpacedPoints(a);var d,e;if(!b){b=this.bends}for(d=0,e=b.length;d<e;d++){c=this.getWrapPoints(c,b[d])}return c};THREE.CurvePath.prototype.getWrapPoints=function(a,b){var c=this.getBoundingBox();var d,e,f,g,h,i;for(d=0,e=a.length;d<e;d++){f=a[d];g=f.x;h=f.y;i=g/c.maxX;i=b.getUtoTmapping(i,g);var j=b.getPoint(i);var k=b.getNormalVector(i).multiplyScalar(h);f.x=j.x+k.x;f.y=j.y+k.y}return a};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);THREE.Gyroscope.prototype.updateMatrixWorld=function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld);this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject);this.matrixWorld.makeFromPositionQuaternionScale(this.translationWorld,this.rotationObject,this.scaleWorld)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;a=true}for(var b=0,c=this.children.length;b<c;b++){this.children[b].updateMatrixWorld(a)}};THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3;THREE.Gyroscope.prototype.translationObject=new THREE.Vector3;THREE.Gyroscope.prototype.rotationWorld=new THREE.Quaternion;THREE.Gyroscope.prototype.rotationObject=new THREE.Quaternion;THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3;THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3;THREE.Path=function(a){THREE.CurvePath.call(this);this.actions=[];if(a){this.fromPoints(a)}};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};THREE.Path.prototype.fromPoints=function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++){this.lineTo(a[b].x,a[b].y)}};THREE.Path.prototype.moveTo=function(a,b){var c=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:c})};THREE.Path.prototype.lineTo=function(a,b){var c=Array.prototype.slice.call(arguments);var d=this.actions[this.actions.length-1].args;var e=d[d.length-2];var f=d[d.length-1];var g=new THREE.LineCurve(new THREE.Vector2(e,f),new THREE.Vector2(a,b));this.curves.push(g);this.actions.push({action:THREE.PathActions.LINE_TO,args:c})};THREE.Path.prototype.quadraticCurveTo=function(a,b,c,d){var e=Array.prototype.slice.call(arguments);var f=this.actions[this.actions.length-1].args;var g=f[f.length-2];var h=f[f.length-1];var i=new THREE.QuadraticBezierCurve(new THREE.Vector2(g,h),new THREE.Vector2(a,b),new THREE.Vector2(c,d));this.curves.push(i);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:e})};THREE.Path.prototype.bezierCurveTo=function(a,b,c,d,e,f){var g=Array.prototype.slice.call(arguments);var h=this.actions[this.actions.length-1].args;var i=h[h.length-2];var j=h[h.length-1];var k=new THREE.CubicBezierCurve(new THREE.Vector2(i,j),new THREE.Vector2(a,b),new THREE.Vector2(c,d),new THREE.Vector2(e,f));this.curves.push(k);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:g})};THREE.Path.prototype.splineThru=function(a){var b=Array.prototype.slice.call(arguments);var c=this.actions[this.actions.length-1].args;var d=c[c.length-2];var e=c[c.length-1];var f=[new THREE.Vector2(d,e)];Array.prototype.push.apply(f,a);var g=new THREE.SplineCurve(f);this.curves.push(g);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:b})};THREE.Path.prototype.arc=function(a,b,c,d,e,f){var g=this.actions[this.actions.length-1].args;var h=g[g.length-2];var i=g[g.length-1];this.absarc(a+h,b+i,c,d,e,f)};THREE.Path.prototype.absarc=function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)};THREE.Path.prototype.ellipse=function(a,b,c,d,e,f,g){var h=this.actions[this.actions.length-1].args;var i=h[h.length-2];var j=h[h.length-1];this.absellipse(a+i,b+j,c,d,e,f,g)};THREE.Path.prototype.absellipse=function(a,b,c,d,e,f,g){var h=Array.prototype.slice.call(arguments);var i=new THREE.EllipseCurve(a,b,c,d,e,f,g);this.curves.push(i);var j=i.getPoint(g?1:0);h.push(j.x);h.push(j.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:h})};THREE.Path.prototype.getSpacedPoints=function(a,b){if(!a)a=40;var c=[];for(var d=0;d<a;d++){c.push(this.getPoint(d/a))}return c};THREE.Path.prototype.getPoints=function(a,b){if(this.useSpacedPoints){console.log("tata");return this.getSpacedPoints(a,b)}a=a||12;var c=[];var d,e,f,g,h;var i,j,k,l,m,n,o,p,q,r,s,t,u;for(d=0,e=this.actions.length;d<e;d++){f=this.actions[d];g=f.action;h=f.args;switch(g){case THREE.PathActions.MOVE_TO:c.push(new THREE.Vector2(h[0],h[1]));break;case THREE.PathActions.LINE_TO:c.push(new THREE.Vector2(h[0],h[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:i=h[2];j=h[3];m=h[0];n=h[1];if(c.length>0){q=c[c.length-1];o=q.x;p=q.y}else{q=this.actions[d-1].args;o=q[q.length-2];p=q[q.length-1]}for(r=1;r<=a;r++){s=r/a;t=THREE.Shape.Utils.b2(s,o,m,i);u=THREE.Shape.Utils.b2(s,p,n,j);c.push(new THREE.Vector2(t,u))}break;case THREE.PathActions.BEZIER_CURVE_TO:i=h[4];j=h[5];m=h[0];n=h[1];k=h[2];l=h[3];if(c.length>0){q=c[c.length-1];o=q.x;p=q.y}else{q=this.actions[d-1].args;o=q[q.length-2];p=q[q.length-1]}for(r=1;r<=a;r++){s=r/a;t=THREE.Shape.Utils.b3(s,o,m,k,i);u=THREE.Shape.Utils.b3(s,p,n,l,j);c.push(new THREE.Vector2(t,u))}break;case THREE.PathActions.CSPLINE_THRU:q=this.actions[d-1].args;var v=new THREE.Vector2(q[q.length-2],q[q.length-1]);var w=[v];var x=a*h[0].length;w=w.concat(h[0]);var y=new THREE.SplineCurve(w);for(r=1;r<=x;r++){c.push(y.getPointAt(r/x))}break;case THREE.PathActions.ARC:var z=h[0],A=h[1],B=h[2],C=h[3],D=h[4],E=!!h[5];var F=D-C;var G;var H=a*2;for(r=1;r<=H;r++){s=r/H;if(!E){s=1-s}G=C+s*F;t=z+B*Math.cos(G);u=A+B*Math.sin(G);c.push(new THREE.Vector2(t,u))}break;case THREE.PathActions.ELLIPSE:var z=h[0],A=h[1],I=h[2],J=h[3],C=h[4],D=h[5],E=!!h[6];var F=D-C;var G;var H=a*2;for(r=1;r<=H;r++){s=r/H;if(!E){s=1-s}G=C+s*F;t=z+I*Math.cos(G);u=A+J*Math.sin(G);c.push(new THREE.Vector2(t,u))}break}}var K=c[c.length-1];var L=1e-10;if(Math.abs(K.x-c[0].x)<L&&Math.abs(K.y-c[0].y)<L)c.splice(c.length-1,1);if(b){c.push(c[0])}return c};THREE.Path.prototype.toShapes=function(){var a,b,c,d,e;var f=[],g=new THREE.Path;for(a=0,b=this.actions.length;a<b;a++){c=this.actions[a];e=c.args;d=c.action;if(d==THREE.PathActions.MOVE_TO){if(g.actions.length!=0){f.push(g);g=new THREE.Path}}g[d].apply(g,e)}if(g.actions.length!=0){f.push(g)}if(f.length==0)return[];var h,i,j=[];var k=!THREE.Shape.Utils.isClockWise(f[0].getPoints());if(f.length==1){h=f[0];i=new THREE.Shape;i.actions=h.actions;i.curves=h.curves;j.push(i);return j}if(k){i=new THREE.Shape;for(a=0,b=f.length;a<b;a++){h=f[a];if(THREE.Shape.Utils.isClockWise(h.getPoints())){i.actions=h.actions;i.curves=h.curves;j.push(i);i=new THREE.Shape}else{i.holes.push(h)}}}else{for(a=0,b=f.length;a<b;a++){h=f[a];if(THREE.Shape.Utils.isClockWise(h.getPoints())){if(i)j.push(i);i=new THREE.Shape;i.actions=h.actions;i.curves=h.curves}else{i.holes.push(h)}}j.push(i)}return j};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.extrude=function(a){var b=new THREE.ExtrudeGeometry(this,a);return b};THREE.Shape.prototype.makeGeometry=function(a){var b=new THREE.ShapeGeometry(this,a);return b};THREE.Shape.prototype.getPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;b<c;b++){d[b]=this.holes[b].getTransformedPoints(a,this.bends)}return d};THREE.Shape.prototype.getSpacedPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;b<c;b++){d[b]=this.holes[b].getTransformedSpacedPoints(a,this.bends)}return d};THREE.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}};THREE.Shape.prototype.extractPoints=function(a){if(this.useSpacedPoints){return this.extractAllSpacedPoints(a)}return this.extractAllPoints(a)};THREE.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}};THREE.Shape.Utils={removeHoles:function(a,b){var c=a.concat();var d=c.concat();var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=[];for(m=0;m<b.length;m++){o=b[m];Array.prototype.push.apply(d,o);p=Number.POSITIVE_INFINITY;for(n=0;n<o.length;n++){s=o[n];var z=[];for(r=0;r<c.length;r++){t=c[r];q=s.distanceToSquared(t);z.push(q);if(q<p){p=q;i=n;j=r}}}e=j-1>=0?j-1:c.length-1;g=i-1>=0?i-1:o.length-1;var A=[o[i],c[j],c[e]];var B=THREE.FontUtils.Triangulate.area(A);var C=[o[i],o[g],c[j]];var D=THREE.FontUtils.Triangulate.area(C);var E=1;var F=-1;var G=j,H=i;j+=E;i+=F;if(j<0){j+=c.length}j%=c.length;if(i<0){i+=o.length}i%=o.length;e=j-1>=0?j-1:c.length-1;g=i-1>=0?i-1:o.length-1;A=[o[i],c[j],c[e]];var I=THREE.FontUtils.Triangulate.area(A);C=[o[i],o[g],c[j]];var J=THREE.FontUtils.Triangulate.area(C);if(B+D>I+J){j=G;i=H;if(j<0){j+=c.length}j%=c.length;if(i<0){i+=o.length}i%=o.length;e=j-1>=0?j-1:c.length-1;g=i-1>=0?i-1:o.length-1}else{}u=c.slice(0,j);v=c.slice(j);w=o.slice(i);x=o.slice(0,i);var K=[o[i],c[j],c[e]];var L=[o[i],o[g],c[j]];y.push(K);y.push(L);c=u.concat(w).concat(x).concat(v)}return{shape:c,isolatedPts:y,allpoints:d}},triangulateShape:function(a,b){var c=THREE.Shape.Utils.removeHoles(a,b);var d=c.shape,e=c.allpoints,f=c.isolatedPts;var g=THREE.FontUtils.Triangulate(d,false);var h,i,j,k,l,m,n={},o={};for(h=0,i=e.length;h<i;h++){l=e[h].x+":"+e[h].y;if(n[l]!==undefined){console.log("Duplicate point",l)}n[l]=h}for(h=0,i=g.length;h<i;h++){k=g[h];for(j=0;j<3;j++){l=k[j].x+":"+k[j].y;m=n[l];if(m!==undefined){k[j]=m}}}for(h=0,i=f.length;h<i;h++){k=f[h];for(j=0;j<3;j++){l=k[j].x+":"+k[j].y;m=n[l];if(m!==undefined){k[j]=m}}}return g.concat(f)},isClockWise:function(a){return THREE.FontUtils.Triangulate.area(a)<0},b2p0:function(a,b){var c=1-a;return c*c*b},b2p1:function(a,b){return 2*(1-a)*a*b},b2p2:function(a,b){return a*a*b},b2:function(a,b,c,d){return this.b2p0(a,b)+this.b2p1(a,c)+this.b2p2(a,d)},b3p0:function(a,b){var c=1-a;return c*c*c*b},b3p1:function(a,b){var c=1-a;return 3*c*c*a*b},b3p2:function(a,b){var c=1-a;return 3*c*a*a*b},b3p3:function(a,b){return a*a*a*b},b3:function(a,b,c,d,e){return this.b3p0(a,b)+this.b3p1(a,c)+this.b3p2(a,d)+this.b3p3(a,e)}};THREE.AnimationHandler=function(){var a=[];var b={};var c={};c.update=function(b){for(var c=0;c<a.length;c++)a[c].update(b)};c.addToUpdate=function(b){if(a.indexOf(b)===-1)a.push(b)};c.removeFromUpdate=function(b){var c=a.indexOf(b);if(c!==-1)a.splice(c,1)};c.add=function(a){if(b[a.name]!==undefined)console.log("THREE.AnimationHandler.add: Warning! "+a.name+" already exists in library. Overwriting.");b[a.name]=a;e(a)};c.get=function(a){if(typeof a==="string"){if(b[a]){return b[a]}else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+a);return null}}else{}};c.parse=function(a){var b=[];if(a instanceof THREE.SkinnedMesh){for(var c=0;c<a.bones.length;c++){b.push(a.bones[c])}}else{d(a,b)}return b};var d=function(a,b){b.push(a);for(var c=0;c<a.children.length;c++)d(a.children[c],b)};var e=function(a){if(a.initialized===true)return;for(var b=0;b<a.hierarchy.length;b++){for(var c=0;c<a.hierarchy[b].keys.length;c++){if(a.hierarchy[b].keys[c].time<0)a.hierarchy[b].keys[c].time=0;if(a.hierarchy[b].keys[c].rot!==undefined&&!(a.hierarchy[b].keys[c].rot instanceof THREE.Quaternion)){var d=a.hierarchy[b].keys[c].rot;a.hierarchy[b].keys[c].rot=new THREE.Quaternion(d[0],d[1],d[2],d[3])}}if(a.hierarchy[b].keys.length&&a.hierarchy[b].keys[0].morphTargets!==undefined){var e={};for(var c=0;c<a.hierarchy[b].keys.length;c++){for(var f=0;f<a.hierarchy[b].keys[c].morphTargets.length;f++){var g=a.hierarchy[b].keys[c].morphTargets[f];e[g]=-1}}a.hierarchy[b].usedMorphTargets=e;for(var c=0;c<a.hierarchy[b].keys.length;c++){var h={};for(var g in e){for(var f=0;f<a.hierarchy[b].keys[c].morphTargets.length;f++){if(a.hierarchy[b].keys[c].morphTargets[f]===g){h[g]=a.hierarchy[b].keys[c].morphTargetsInfluences[f];break}}if(f===a.hierarchy[b].keys[c].morphTargets.length){h[g]=0}}a.hierarchy[b].keys[c].morphTargetsInfluences=h}}for(var c=1;c<a.hierarchy[b].keys.length;c++){if(a.hierarchy[b].keys[c].time===a.hierarchy[b].keys[c-1].time){a.hierarchy[b].keys.splice(c,1);c--}}for(var c=0;c<a.hierarchy[b].keys.length;c++){a.hierarchy[b].keys[c].index=c}}var i=parseInt(a.length*a.fps,10);a.JIT={};a.JIT.hierarchy=[];for(var b=0;b<a.hierarchy.length;b++)a.JIT.hierarchy.push(new Array(i));a.initialized=true};c.LINEAR=0;c.CATMULLROM=1;c.CATMULLROM_FORWARD=2;return c}();THREE.Animation=function(a,b,c){this.root=a;this.data=THREE.AnimationHandler.get(b);this.hierarchy=THREE.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.isPaused=true;this.loop=true;this.interpolationType=c!==undefined?c:THREE.AnimationHandler.LINEAR;this.points=[];this.target=new THREE.Vector3};THREE.Animation.prototype.play=function(a,b){if(this.isPlaying===false){this.isPlaying=true;this.loop=a!==undefined?a:true;this.currentTime=b!==undefined?b:0;var c,d=this.hierarchy.length,e;for(c=0;c<d;c++){e=this.hierarchy[c];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD){e.useQuaternion=true}e.matrixAutoUpdate=true;if(e.animationCache===undefined){e.animationCache={};e.animationCache.prevKey={pos:0,rot:0,scl:0};e.animationCache.nextKey={pos:0,rot:0,scl:0};e.animationCache.originalMatrix=e instanceof THREE.Bone?e.skinMatrix:e.matrix}var f=e.animationCache.prevKey;var g=e.animationCache.nextKey;f.pos=this.data.hierarchy[c].keys[0];f.rot=this.data.hierarchy[c].keys[0];f.scl=this.data.hierarchy[c].keys[0];g.pos=this.getNextKeyWith("pos",c,1);g.rot=this.getNextKeyWith("rot",c,1);g.scl=this.getNextKeyWith("scl",c,1)}this.update(0)}this.isPaused=false;THREE.AnimationHandler.addToUpdate(this)};THREE.Animation.prototype.pause=function(){if(this.isPaused===true){THREE.AnimationHandler.addToUpdate(this)}else{THREE.AnimationHandler.removeFromUpdate(this)}this.isPaused=!this.isPaused};THREE.Animation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.removeFromUpdate(this)};THREE.Animation.prototype.update=function(a){if(this.isPlaying===false)return;var b=["pos","rot","scl"];var c;var d;var e;var f,g;var h,i;var j;var k;var l;var m=this.data.JIT.hierarchy;var n,o;var p,q,r;this.currentTime+=a*this.timeScale;o=this.currentTime;n=this.currentTime=this.currentTime%this.data.length;l=parseInt(Math.min(n*this.data.fps,this.data.length*this.data.fps),10);for(var s=0,t=this.hierarchy.length;s<t;s++){j=this.hierarchy[s];k=j.animationCache;for(var u=0;u<3;u++){c=b[u];h=k.prevKey[c];i=k.nextKey[c];if(i.time<=o){if(n<o){if(this.loop){h=this.data.hierarchy[s].keys[0];i=this.getNextKeyWith(c,s,1);while(i.time<n){h=i;i=this.getNextKeyWith(c,s,i.index+1)}}else{this.stop();return}}else{do{h=i;i=this.getNextKeyWith(c,s,i.index+1)}while(i.time<n)}k.prevKey[c]=h;k.nextKey[c]=i}j.matrixAutoUpdate=true;j.matrixWorldNeedsUpdate=true;d=(n-h.time)/(i.time-h.time);f=h[c];g=i[c];if(d<0||d>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+d+" on bone "+s);d=d<0?0:1}if(c==="pos"){e=j.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){e.x=f[0]+(g[0]-f[0])*d;e.y=f[1]+(g[1]-f[1])*d;e.z=f[2]+(g[2]-f[2])*d}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=this.getPrevKeyWith("pos",s,h.index-1)["pos"];this.points[1]=f;this.points[2]=g;this.points[3]=this.getNextKeyWith("pos",s,i.index+1)["pos"];d=d*.33+.33;p=this.interpolateCatmullRom(this.points,d);e.x=p[0];e.y=p[1];e.z=p[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){q=this.interpolateCatmullRom(this.points,d*1.01);this.target.set(q[0],q[1],q[2]);this.target.sub(e);this.target.y=0;this.target.normalize();r=Math.atan2(this.target.x,this.target.z);j.rotation.set(0,r,0)}}}else if(c==="rot"){THREE.Quaternion.slerp(f,g,j.quaternion,d)}else if(c==="scl"){e=j.scale;e.x=f[0]+(g[0]-f[0])*d;e.y=f[1]+(g[1]-f[1])*d;e.z=f[2]+(g[2]-f[2])*d}}}};THREE.Animation.prototype.interpolateCatmullRom=function(a,b){var c=[],d=[],e,f,g,h,i,j,k,l,m;e=(a.length-1)*b;f=Math.floor(e);g=e-f;c[0]=f===0?f:f-1;c[1]=f;c[2]=f>a.length-2?f:f+1;c[3]=f>a.length-3?f:f+2;j=a[c[0]];k=a[c[1]];l=a[c[2]];m=a[c[3]];h=g*g;i=g*h;d[0]=this.interpolate(j[0],k[0],l[0],m[0],g,h,i);d[1]=this.interpolate(j[1],k[1],l[1],m[1],g,h,i);d[2]=this.interpolate(j[2],k[2],l[2],m[2],g,h,i);return d};THREE.Animation.prototype.interpolate=function(a,b,c,d,e,f,g){var h=(c-a)*.5,i=(d-b)*.5;return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b};THREE.Animation.prototype.getNextKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){c=c<d.length-1?c:d.length-1}else{c=c%d.length}for(;c<d.length;c++){if(d[c][a]!==undefined){return d[c]}}return this.data.hierarchy[b].keys[0]};THREE.Animation.prototype.getPrevKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){c=c>0?c:0}else{c=c>=0?c:c+d.length}for(;c>=0;c--){if(d[c][a]!==undefined){return d[c]}}return this.data.hierarchy[b].keys[d.length-1]};THREE.KeyFrameAnimation=function(a,b,c){this.root=a;this.data=THREE.AnimationHandler.get(b);this.hierarchy=THREE.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=.001;this.isPlaying=false;this.isPaused=true;this.loop=true;this.JITCompile=c!==undefined?c:true;for(var d=0,e=this.hierarchy.length;d<e;d++){var f=this.data.hierarchy[d].keys,g=this.data.hierarchy[d].sids,h=this.hierarchy[d];if(f.length&&g){for(var i=0;i<g.length;i++){var j=g[i],k=this.getNextKeyWith(j,d,0);if(k){k.apply(j)}}h.matrixAutoUpdate=false;this.data.hierarchy[d].node.updateMatrix();h.matrixWorldNeedsUpdate=true}}};THREE.KeyFrameAnimation.prototype.play=function(a,b){if(!this.isPlaying){this.isPlaying=true;this.loop=a!==undefined?a:true;this.currentTime=b!==undefined?b:0;this.startTimeMs=b;this.startTime=1e7;this.endTime=-this.startTime;var c,d=this.hierarchy.length,e,f;for(c=0;c<d;c++){e=this.hierarchy[c];f=this.data.hierarchy[c];e.useQuaternion=true;if(f.animationCache===undefined){f.animationCache={};f.animationCache.prevKey=null;f.animationCache.nextKey=null;f.animationCache.originalMatrix=e instanceof THREE.Bone?e.skinMatrix:e.matrix}var g=this.data.hierarchy[c].keys;if(g.length){f.animationCache.prevKey=g[0];f.animationCache.nextKey=g[1];this.startTime=Math.min(g[0].time,this.startTime);this.endTime=Math.max(g[g.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;THREE.AnimationHandler.addToUpdate(this)};THREE.KeyFrameAnimation.prototype.pause=function(){if(this.isPaused){THREE.AnimationHandler.addToUpdate(this)}else{THREE.AnimationHandler.removeFromUpdate(this)}this.isPaused=!this.isPaused};THREE.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.removeFromUpdate(this);for(var a=0;a<this.data.hierarchy.length;a++){var b=this.hierarchy[a];var c=this.data.hierarchy[a];if(c.animationCache!==undefined){var d=c.animationCache.originalMatrix;if(b instanceof THREE.Bone){d.copy(b.skinMatrix);b.skinMatrix=d}else{d.copy(b.matrix);b.matrix=d}delete c.animationCache}}};THREE.KeyFrameAnimation.prototype.update=function(a){if(!this.isPlaying)return;var b,c;var d;var e;var f;var g=this.data.JIT.hierarchy;var h,i;var j;this.currentTime+=a*this.timeScale;i=this.currentTime;h=this.currentTime=this.currentTime%this.data.length;if(h<this.startTimeMs){h=this.currentTime=this.startTimeMs+h}f=parseInt(Math.min(h*this.data.fps,this.data.length*this.data.fps),10);j=h<i;if(j&&!this.loop){for(var k=0,l=this.hierarchy.length;k<l;k++){var m=this.data.hierarchy[k].keys,n=this.data.hierarchy[k].sids,o=m.length-1,p=this.hierarchy[k];if(m.length){for(var q=0;q<n.length;q++){var r=n[q],s=this.getPrevKeyWith(r,k,o);if(s){s.apply(r)}}this.data.hierarchy[k].node.updateMatrix();p.matrixWorldNeedsUpdate=true}}this.stop();return}if(h<this.startTime){return}for(var k=0,l=this.hierarchy.length;k<l;k++){d=this.hierarchy[k];e=this.data.hierarchy[k];var m=e.keys,t=e.animationCache;if(this.JITCompile&&g[k][f]!==undefined){if(d instanceof THREE.Bone){d.skinMatrix=g[k][f];d.matrixWorldNeedsUpdate=false}else{d.matrix=g[k][f];d.matrixWorldNeedsUpdate=true}}else if(m.length){if(this.JITCompile&&t){if(d instanceof THREE.Bone){d.skinMatrix=t.originalMatrix}else{d.matrix=t.originalMatrix}}b=t.prevKey;c=t.nextKey;if(b&&c){if(c.time<=i){if(j&&this.loop){b=m[0];c=m[1];while(c.time<h){b=c;c=m[b.index+1]}}else if(!j){var u=m.length-1;while(c.time<h&&c.index!==u){b=c;c=m[b.index+1]}}t.prevKey=b;t.nextKey=c}if(c.time>=h)b.interpolate(c,h);else b.interpolate(c,c.time)}this.data.hierarchy[k].node.updateMatrix();d.matrixWorldNeedsUpdate=true}}if(this.JITCompile){if(g[0][f]===undefined){this.hierarchy[0].updateMatrixWorld(true);for(var k=0;k<this.hierarchy.length;k++){if(this.hierarchy[k]instanceof THREE.Bone){g[k][f]=this.hierarchy[k].skinMatrix.clone()}else{g[k][f]=this.hierarchy[k].matrix.clone()}}}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;c=c%d.length;for(;c<d.length;c++){if(d[c].hasTarget(a)){return d[c]}}return d[0]};THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;c=c>=0?c:c+d.length;for(;c>=0;c--){if(d[c].hasTarget(a)){return d[c]}}return d[d.length-1]};THREE.CubeCamera=function(a,b,c){THREE.Object3D.call(this);var d=90,e=1;var f=new THREE.PerspectiveCamera(d,e,a,b);f.up.set(0,-1,0);f.lookAt(new THREE.Vector3(1,0,0));this.add(f);var g=new THREE.PerspectiveCamera(d,e,a,b);g.up.set(0,-1,0);g.lookAt(new THREE.Vector3(-1,0,0));this.add(g);var h=new THREE.PerspectiveCamera(d,e,a,b);h.up.set(0,0,1);h.lookAt(new THREE.Vector3(0,1,0));this.add(h);var i=new THREE.PerspectiveCamera(d,e,a,b);i.up.set(0,0,-1);i.lookAt(new THREE.Vector3(0,-1,0));this.add(i);var j=new THREE.PerspectiveCamera(d,e,a,b);j.up.set(0,-1,0);j.lookAt(new THREE.Vector3(0,0,1));this.add(j);var k=new THREE.PerspectiveCamera(d,e,a,b);k.up.set(0,-1,0);k.lookAt(new THREE.Vector3(0,0,-1));this.add(k);this.renderTarget=new THREE.WebGLRenderTargetCube(c,c,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(a,b){var c=this.renderTarget;var d=c.generateMipmaps;c.generateMipmaps=false;c.activeCubeFace=0;a.render(b,f,c);c.activeCubeFace=1;a.render(b,g,c);c.activeCubeFace=2;a.render(b,h,c);c.activeCubeFace=3;a.render(b,i,c);c.activeCubeFace=4;a.render(b,j,c);c.generateMipmaps=d;c.activeCubeFace=5;a.render(b,k,c)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CombinedCamera=function(a,b,c,d,e,f,g){THREE.Camera.call(this);this.fov=c;this.left=-a/2;this.right=a/2;this.top=b/2;this.bottom=-b/2;this.cameraO=new THREE.OrthographicCamera(a/-2,a/2,b/2,b/-2,f,g);this.cameraP=new THREE.PerspectiveCamera(c,a/b,d,e);this.zoom=1;this.toPerspective();var h=a/b};THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype);THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPerspectiveMode=true;this.inOrthographicMode=false};THREE.CombinedCamera.prototype.toOrthographic=function(){var a=this.fov;var b=this.cameraP.aspect;var c=this.cameraP.near;var d=this.cameraP.far;var e=(c+d)/2;var f=Math.tan(a/2)*e;var g=2*f;var h=g*b;var i=h/2;f/=this.zoom;i/=this.zoom;this.cameraO.left=-i;this.cameraO.right=i;this.cameraO.top=f;this.cameraO.bottom=-f;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPerspectiveMode=false;this.inOrthographicMode=true};THREE.CombinedCamera.prototype.setSize=function(a,b){this.cameraP.aspect=a/b;this.left=-a/2;this.right=a/2;this.top=b/2;this.bottom=-b/2};THREE.CombinedCamera.prototype.setFov=function(a){this.fov=a;if(this.inPerspectiveMode){this.toPerspective()}else{this.toOrthographic()}};THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){if(this.inPerspectiveMode){this.toPerspective()}else{this.toPerspective();this.toOrthographic()}};THREE.CombinedCamera.prototype.setLens=function(a,b){if(b===undefined)b=24;var c=2*THREE.Math.radToDeg(Math.atan(b/(a*2)));this.setFov(c);return c};THREE.CombinedCamera.prototype.setZoom=function(a){this.zoom=a;if(this.inPerspectiveMode){this.toPerspective()
}else{this.toOrthographic()}};THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CircleGeometry=function(a,b,c,d){THREE.Geometry.call(this);a=a||50;c=c!==undefined?c:0;d=d!==undefined?d:Math.PI*2;b=b!==undefined?Math.max(3,b):8;var e,f=[],g=new THREE.Vector3,h=new THREE.Vector2(.5,.5);this.vertices.push(g);f.push(h);for(e=0;e<=b;e++){var i=new THREE.Vector3;var j=c+e/b*d;i.x=a*Math.cos(j);i.y=a*Math.sin(j);this.vertices.push(i);f.push(new THREE.Vector2((i.x/a+1)/2,(i.y/a+1)/2))}var k=new THREE.Vector3(0,0,1);for(e=1;e<=b;e++){var l=e;var m=e+1;var n=0;this.faces.push(new THREE.Face3(l,m,n,[k,k,k]));this.faceVertexUvs[0].push([f[e],f[e+1],h])}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CubeGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);var g=this;this.width=a;this.height=b;this.depth=c;this.widthSegments=d||1;this.heightSegments=e||1;this.depthSegments=f||1;var h=this.width/2;var i=this.height/2;var j=this.depth/2;k("z","y",-1,-1,this.depth,this.height,h,0);k("z","y",1,-1,this.depth,this.height,-h,1);k("x","z",1,1,this.width,this.depth,i,2);k("x","z",1,-1,this.width,this.depth,-i,3);k("x","y",1,-1,this.width,this.height,j,4);k("x","y",-1,-1,this.width,this.height,-j,5);function k(a,b,c,d,e,f,h,i){var j,k,l,m=g.widthSegments,n=g.heightSegments,o=e/2,p=f/2,q=g.vertices.length;if(a==="x"&&b==="y"||a==="y"&&b==="x"){j="z"}else if(a==="x"&&b==="z"||a==="z"&&b==="x"){j="y";n=g.depthSegments}else if(a==="z"&&b==="y"||a==="y"&&b==="z"){j="x";m=g.depthSegments}var r=m+1,s=n+1,t=e/m,u=f/n,v=new THREE.Vector3;v[j]=h>0?1:-1;for(l=0;l<s;l++){for(k=0;k<r;k++){var w=new THREE.Vector3;w[a]=(k*t-o)*c;w[b]=(l*u-p)*d;w[j]=h;g.vertices.push(w)}}for(l=0;l<n;l++){for(k=0;k<m;k++){var x=k+r*l;var y=k+r*(l+1);var z=k+1+r*(l+1);var A=k+1+r*l;var B=new THREE.Face4(x+q,y+q,z+q,A+q);B.normal.copy(v);B.vertexNormals.push(v.clone(),v.clone(),v.clone(),v.clone());B.materialIndex=i;g.faces.push(B);g.faceVertexUvs[0].push([new THREE.Vector2(k/m,1-l/n),new THREE.Vector2(k/m,1-(l+1)/n),new THREE.Vector2((k+1)/m,1-(l+1)/n),new THREE.Vector2((k+1)/m,1-l/n)])}}}this.computeCentroids();this.mergeVertices()};THREE.CubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.radiusTop=a=a!==undefined?a:20;this.radiusBottom=b=b!==undefined?b:20;this.height=c=c!==undefined?c:100;this.radiusSegments=d=d||8;this.heightSegments=e=e||1;this.openEnded=f=f!==undefined?f:false;var g=c/2;var h,i,j=[],k=[];for(i=0;i<=e;i++){var l=[];var m=[];var n=i/e;var o=n*(b-a)+a;for(h=0;h<=d;h++){var p=h/d;var q=new THREE.Vector3;q.x=o*Math.sin(p*Math.PI*2);q.y=-n*c+g;q.z=o*Math.cos(p*Math.PI*2);this.vertices.push(q);l.push(this.vertices.length-1);m.push(new THREE.Vector2(p,1-n))}j.push(l);k.push(m)}var r=(b-a)/c;var s,t;for(h=0;h<d;h++){if(a!==0){s=this.vertices[j[0][h]].clone();t=this.vertices[j[0][h+1]].clone()}else{s=this.vertices[j[1][h]].clone();t=this.vertices[j[1][h+1]].clone()}s.setY(Math.sqrt(s.x*s.x+s.z*s.z)*r).normalize();t.setY(Math.sqrt(t.x*t.x+t.z*t.z)*r).normalize();for(i=0;i<e;i++){var u=j[i][h];var v=j[i+1][h];var w=j[i+1][h+1];var x=j[i][h+1];var y=s.clone();var z=s.clone();var A=t.clone();var B=t.clone();var C=k[i][h].clone();var D=k[i+1][h].clone();var E=k[i+1][h+1].clone();var F=k[i][h+1].clone();this.faces.push(new THREE.Face4(u,v,w,x,[y,z,A,B]));this.faceVertexUvs[0].push([C,D,E,F])}}if(f===false&&a>0){this.vertices.push(new THREE.Vector3(0,g,0));for(h=0;h<d;h++){var u=j[0][h];var v=j[0][h+1];var w=this.vertices.length-1;var y=new THREE.Vector3(0,1,0);var z=new THREE.Vector3(0,1,0);var A=new THREE.Vector3(0,1,0);var C=k[0][h].clone();var D=k[0][h+1].clone();var E=new THREE.Vector2(D.u,0);this.faces.push(new THREE.Face3(u,v,w,[y,z,A]));this.faceVertexUvs[0].push([C,D,E])}}if(f===false&&b>0){this.vertices.push(new THREE.Vector3(0,-g,0));for(h=0;h<d;h++){var u=j[i][h+1];var v=j[i][h];var w=this.vertices.length-1;var y=new THREE.Vector3(0,-1,0);var z=new THREE.Vector3(0,-1,0);var A=new THREE.Vector3(0,-1,0);var C=k[i][h+1].clone();var D=k[i][h].clone();var E=new THREE.Vector2(D.u,1);this.faces.push(new THREE.Face3(u,v,w,[y,z,A]));this.faceVertexUvs[0].push([C,D,E])}}this.computeCentroids();this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry=function(a,b){if(typeof a==="undefined"){a=[];return}THREE.Geometry.call(this);a=a instanceof Array?a:[a];this.shapebb=a[a.length-1].getBoundingBox();this.addShapeList(a,b);this.computeCentroids();this.computeFaceNormals()};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.addShapeList=function(a,b){var c=a.length;for(var d=0;d<c;d++){var e=a[d];this.addShape(e,b)}};THREE.ExtrudeGeometry.prototype.addShape=function(a,b){var c=b.amount!==undefined?b.amount:100;var d=b.bevelThickness!==undefined?b.bevelThickness:6;var e=b.bevelSize!==undefined?b.bevelSize:d-2;var f=b.bevelSegments!==undefined?b.bevelSegments:3;var g=b.bevelEnabled!==undefined?b.bevelEnabled:true;var h=b.curveSegments!==undefined?b.curveSegments:12;var i=b.steps!==undefined?b.steps:1;var j=b.extrudePath;var k,l=false;var m=b.material;var n=b.extrudeMaterial;var o=b.UVGenerator!==undefined?b.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;var p=this.shapebb;var q,r,s,t;if(j){k=j.getSpacedPoints(i);l=true;g=false;q=b.frames!==undefined?b.frames:new THREE.TubeGeometry.FrenetFrames(j,i,false);r=new THREE.Vector3;s=new THREE.Vector3;t=new THREE.Vector3}if(!g){f=0;d=0;e=0}var u,v,w;var x=this;var y=[];var z=this.vertices.length;var A=a.extractPoints(h);var B=A.shape;var C=A.holes;var D=!THREE.Shape.Utils.isClockWise(B);if(D){B=B.reverse();for(v=0,w=C.length;v<w;v++){u=C[v];if(THREE.Shape.Utils.isClockWise(u)){C[v]=u.reverse()}}D=false}var E=THREE.Shape.Utils.triangulateShape(B,C);var F=B;for(v=0,w=C.length;v<w;v++){u=C[v];B=B.concat(u)}function G(a,b,c){if(!b)console.log("die");return b.clone().multiplyScalar(c).add(a)}var H,I,J,K,L,M=B.length,N,O=E.length,P,Q=F.length;var R=180/Math.PI;function S(a,b,c){return U(a,b,c)}function T(a,b,c){var d=Math.atan2(b.y-a.y,b.x-a.x);var e=Math.atan2(c.y-a.y,c.x-a.x);if(d>e){e+=Math.PI*2}var f=(d+e)/2;var g=-Math.cos(f);var h=-Math.sin(f);var i=new THREE.Vector2(g,h);return i}function U(a,b,c){var d=THREE.ExtrudeGeometry.__v1,e=THREE.ExtrudeGeometry.__v2,f=THREE.ExtrudeGeometry.__v3,g=THREE.ExtrudeGeometry.__v4,h=THREE.ExtrudeGeometry.__v5,i=THREE.ExtrudeGeometry.__v6,j,k,l,m,n,o;d.set(a.x-b.x,a.y-b.y);e.set(a.x-c.x,a.y-c.y);j=d.normalize();k=e.normalize();f.set(-j.y,j.x);g.set(k.y,-k.x);h.copy(a).add(f);i.copy(a).add(g);if(h.equals(i)){return g.clone()}h.copy(b).add(f);i.copy(c).add(g);l=j.dot(g);m=i.sub(h).dot(g);if(l===0){console.log("Either infinite or no solutions!");if(m===0){console.log("Its finite solutions.")}else{console.log("Too bad, no solutions.")}}n=m/l;if(n<0){return T(a,b,c)}o=j.multiplyScalar(n).add(h);return o.sub(a).clone()}var V=[];for(var W=0,X=F.length,Y=X-1,Z=W+1;W<X;W++,Y++,Z++){if(Y===X)Y=0;if(Z===X)Z=0;var $=F[W];var _=F[Y];var ab=F[Z];V[W]=S(F[W],F[Y],F[Z])}var bb=[],cb,db=V.concat();for(v=0,w=C.length;v<w;v++){u=C[v];cb=[];for(W=0,X=u.length,Y=X-1,Z=W+1;W<X;W++,Y++,Z++){if(Y===X)Y=0;if(Z===X)Z=0;cb[W]=S(u[W],u[Y],u[Z])}bb.push(cb);db=db.concat(cb)}for(H=0;H<f;H++){J=H/f;K=d*(1-J);I=e*Math.sin(J*Math.PI/2);for(W=0,X=F.length;W<X;W++){L=G(F[W],V[W],I);ib(L.x,L.y,-K)}for(v=0,w=C.length;v<w;v++){u=C[v];cb=bb[v];for(W=0,X=u.length;W<X;W++){L=G(u[W],cb[W],I);ib(L.x,L.y,-K)}}}I=e;for(W=0;W<M;W++){L=g?G(B[W],db[W],I):B[W];if(!l){ib(L.x,L.y,0)}else{s.copy(q.normals[0]).multiplyScalar(L.x);r.copy(q.binormals[0]).multiplyScalar(L.y);t.copy(k[0]).add(s).add(r);ib(t.x,t.y,t.z)}}var eb;for(eb=1;eb<=i;eb++){for(W=0;W<M;W++){L=g?G(B[W],db[W],I):B[W];if(!l){ib(L.x,L.y,c/i*eb)}else{s.copy(q.normals[eb]).multiplyScalar(L.x);r.copy(q.binormals[eb]).multiplyScalar(L.y);t.copy(k[eb]).add(s).add(r);ib(t.x,t.y,t.z)}}}for(H=f-1;H>=0;H--){J=H/f;K=d*(1-J);I=e*Math.sin(J*Math.PI/2);for(W=0,X=F.length;W<X;W++){L=G(F[W],V[W],I);ib(L.x,L.y,c+K)}for(v=0,w=C.length;v<w;v++){u=C[v];cb=bb[v];for(W=0,X=u.length;W<X;W++){L=G(u[W],cb[W],I);if(!l){ib(L.x,L.y,c+K)}else{ib(L.x,L.y+k[i-1].y,k[i-1].x+K)}}}}fb();gb();function fb(){if(g){var a=0;var b=M*a;for(W=0;W<O;W++){N=E[W];jb(N[2]+b,N[1]+b,N[0]+b,true)}a=i+f*2;b=M*a;for(W=0;W<O;W++){N=E[W];jb(N[0]+b,N[1]+b,N[2]+b,false)}}else{for(W=0;W<O;W++){N=E[W];jb(N[2],N[1],N[0],true)}for(W=0;W<O;W++){N=E[W];jb(N[0]+M*i,N[1]+M*i,N[2]+M*i,false)}}}function gb(){var a=0;hb(F,a);a+=F.length;for(v=0,w=C.length;v<w;v++){u=C[v];hb(u,a);a+=u.length}}function hb(a,b){var c,d;W=a.length;while(--W>=0){c=W;d=W-1;if(d<0)d=a.length-1;var e=0,g=i+f*2;for(e=0;e<g;e++){var h=M*e;var j=M*(e+1);var k=b+c+h,l=b+d+h,m=b+d+j,n=b+c+j;kb(k,l,m,n,a,e,g,c,d)}}}function ib(a,b,c){x.vertices.push(new THREE.Vector3(a,b,c))}function jb(c,d,e,f){c+=z;d+=z;e+=z;x.faces.push(new THREE.Face3(c,d,e,null,null,m));var g=f?o.generateBottomUV(x,a,b,c,d,e):o.generateTopUV(x,a,b,c,d,e);x.faceVertexUvs[0].push(g)}function kb(c,d,e,f,g,h,i,j,k){c+=z;d+=z;e+=z;f+=z;x.faces.push(new THREE.Face4(c,d,e,f,null,null,n));var l=o.generateSideWallUV(x,a,g,b,c,d,e,f,h,i,j,k);x.faceVertexUvs[0].push(l)}};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(a,b,c,d,e,f){var g=a.vertices[d].x,h=a.vertices[d].y,i=a.vertices[e].x,j=a.vertices[e].y,k=a.vertices[f].x,l=a.vertices[f].y;return[new THREE.Vector2(g,h),new THREE.Vector2(i,j),new THREE.Vector2(k,l)]},generateBottomUV:function(a,b,c,d,e,f){return this.generateTopUV(a,b,c,d,e,f)},generateSideWallUV:function(a,b,c,d,e,f,g,h,i,j,k,l){var m=a.vertices[e].x,n=a.vertices[e].y,o=a.vertices[e].z,p=a.vertices[f].x,q=a.vertices[f].y,r=a.vertices[f].z,s=a.vertices[g].x,t=a.vertices[g].y,u=a.vertices[g].z,v=a.vertices[h].x,w=a.vertices[h].y,x=a.vertices[h].z;if(Math.abs(n-q)<.01){return[new THREE.Vector2(m,1-o),new THREE.Vector2(p,1-r),new THREE.Vector2(s,1-u),new THREE.Vector2(v,1-x)]}else{return[new THREE.Vector2(n,1-o),new THREE.Vector2(q,1-r),new THREE.Vector2(t,1-u),new THREE.Vector2(w,1-x)]}}};THREE.ExtrudeGeometry.__v1=new THREE.Vector2;THREE.ExtrudeGeometry.__v2=new THREE.Vector2;THREE.ExtrudeGeometry.__v3=new THREE.Vector2;THREE.ExtrudeGeometry.__v4=new THREE.Vector2;THREE.ExtrudeGeometry.__v5=new THREE.Vector2;THREE.ExtrudeGeometry.__v6=new THREE.Vector2;THREE.ShapeGeometry=function(a,b){THREE.Geometry.call(this);if(a instanceof Array===false)a=[a];this.shapebb=a[a.length-1].getBoundingBox();this.addShapeList(a,b);this.computeCentroids();this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;c<d;c++){this.addShape(a[c],b)}return this};THREE.ShapeGeometry.prototype.addShape=function(a,b){if(b===undefined)b={};var c=b.curveSegments!==undefined?b.curveSegments:12;var d=b.material;var e=b.UVGenerator===undefined?THREE.ExtrudeGeometry.WorldUVGenerator:b.UVGenerator;var f=this.shapebb;var g,h,i,j;var k=this.vertices.length;var l=a.extractPoints(c);var m=l.shape;var n=l.holes;var o=!THREE.Shape.Utils.isClockWise(m);if(o){m=m.reverse();for(g=0,h=n.length;g<h;g++){i=n[g];if(THREE.Shape.Utils.isClockWise(i)){n[g]=i.reverse()}}o=false}var p=THREE.Shape.Utils.triangulateShape(m,n);var q=m;for(g=0,h=n.length;g<h;g++){i=n[g];m=m.concat(i)}var r,s=m.length;var t,u=p.length;var v,w=q.length;for(g=0;g<s;g++){r=m[g];this.vertices.push(new THREE.Vector3(r.x,r.y,0))}for(g=0;g<u;g++){t=p[g];var x=t[0]+k;var y=t[1]+k;var z=t[2]+k;this.faces.push(new THREE.Face3(x,y,z,null,null,d));this.faceVertexUvs[0].push(e.generateBottomUV(this,a,b,x,y,z))}};THREE.LatheGeometry=function(a,b,c,d){THREE.Geometry.call(this);b=b||12;c=c||0;d=d||2*Math.PI;var e=1/(a.length-1);var f=1/b;for(var g=0,h=b;g<=h;g++){var i=c+g*f*d;var j=Math.cos(i),k=Math.sin(i);for(var l=0,m=a.length;l<m;l++){var n=a[l];var o=new THREE.Vector3;o.x=j*n.x-k*n.y;o.y=k*n.x+j*n.y;o.z=n.z;this.vertices.push(o)}}var p=a.length;for(var g=0,h=b;g<h;g++){for(var l=0,m=a.length-1;l<m;l++){var q=l+p*g;var r=q;var s=q+p;var j=q+1+p;var t=q+1;this.faces.push(new THREE.Face4(r,s,j,t));var u=g*f;var v=l*e;var w=u+f;var x=v+e;this.faceVertexUvs[0].push([new THREE.Vector2(u,v),new THREE.Vector2(w,v),new THREE.Vector2(w,x),new THREE.Vector2(u,x)])}}this.mergeVertices();this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.width=a;this.height=b;this.widthSegments=c||1;this.heightSegments=d||1;var e,f;var g=a/2;var h=b/2;var i=this.widthSegments;var j=this.heightSegments;var k=i+1;var l=j+1;var m=this.width/i;var n=this.height/j;var o=new THREE.Vector3(0,0,1);for(f=0;f<l;f++){for(e=0;e<k;e++){var p=e*m-g;var q=f*n-h;this.vertices.push(new THREE.Vector3(p,-q,0))}}for(f=0;f<j;f++){for(e=0;e<i;e++){var r=e+k*f;var s=e+k*(f+1);var t=e+1+k*(f+1);var u=e+1+k*f;var v=new THREE.Face4(r,s,t,u);v.normal.copy(o);v.vertexNormals.push(o.clone(),o.clone(),o.clone(),o.clone());this.faces.push(v);this.faceVertexUvs[0].push([new THREE.Vector2(e/i,1-f/j),new THREE.Vector2(e/i,1-(f+1)/j),new THREE.Vector2((e+1)/i,1-(f+1)/j),new THREE.Vector2((e+1)/i,1-f/j)])}}this.computeCentroids()};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);a=a||0;b=b||50;e=e!==undefined?e:0;f=f!==undefined?f:Math.PI*2;c=c!==undefined?Math.max(3,c):8;d=d!==undefined?Math.max(3,d):8;var g,h,i=[],j=a,k=(b-a)/d;for(g=0;g<=d;g++){for(h=0;h<=c;h++){var l=new THREE.Vector3;var m=e+h/c*f;l.x=j*Math.cos(m);l.y=j*Math.sin(m);this.vertices.push(l);i.push(new THREE.Vector2((l.x/j+1)/2,-(l.y/j+1)/2+1))}j+=k}var n=new THREE.Vector3(0,0,1);for(g=0;g<d;g++){var o=g*c;for(h=0;h<=c;h++){var m=h+o;var p=m+g;var q=m+c+g;var r=m+c+1+g;this.faces.push(new THREE.Face3(p,q,r,[n,n,n]));this.faceVertexUvs[0].push([i[p],i[q],i[r]]);p=m+g;q=m+c+1+g;r=m+1+g;this.faces.push(new THREE.Face3(p,q,r,[n,n,n]));this.faceVertexUvs[0].push([i[p],i[q],i[r]])}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,j)};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this);this.radius=a=a||50;this.widthSegments=b=Math.max(3,Math.floor(b)||8);this.heightSegments=c=Math.max(2,Math.floor(c)||6);this.phiStart=d=d!==undefined?d:0;this.phiLength=e=e!==undefined?e:Math.PI*2;this.thetaStart=f=f!==undefined?f:0;this.thetaLength=g=g!==undefined?g:Math.PI;var h,i,j=[],k=[];for(i=0;i<=c;i++){var l=[];var m=[];for(h=0;h<=b;h++){var n=h/b;var o=i/c;var p=new THREE.Vector3;p.x=-a*Math.cos(d+n*e)*Math.sin(f+o*g);p.y=a*Math.cos(f+o*g);p.z=a*Math.sin(d+n*e)*Math.sin(f+o*g);this.vertices.push(p);l.push(this.vertices.length-1);m.push(new THREE.Vector2(n,1-o))}j.push(l);k.push(m)}for(i=0;i<this.heightSegments;i++){for(h=0;h<this.widthSegments;h++){var q=j[i][h+1];var r=j[i][h];var s=j[i+1][h];var t=j[i+1][h+1];var u=this.vertices[q].clone().normalize();var v=this.vertices[r].clone().normalize();var w=this.vertices[s].clone().normalize();var x=this.vertices[t].clone().normalize();var y=k[i][h+1].clone();var z=k[i][h].clone();var A=k[i+1][h].clone();var B=k[i+1][h+1].clone();if(Math.abs(this.vertices[q].y)===this.radius){this.faces.push(new THREE.Face3(q,s,t,[u,w,x]));this.faceVertexUvs[0].push([y,A,B])}else if(Math.abs(this.vertices[s].y)===this.radius){this.faces.push(new THREE.Face3(q,r,s,[u,v,w]));this.faceVertexUvs[0].push([y,z,A])}else{this.faces.push(new THREE.Face4(q,r,s,t,[u,v,w,x]));this.faceVertexUvs[0].push([y,z,A,B])}}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TextGeometry=function(a,b){b=b||{};var c=THREE.FontUtils.generateShapes(a,b);b.amount=b.height!==undefined?b.height:50;if(b.bevelThickness===undefined)b.bevelThickness=10;if(b.bevelSize===undefined)b.bevelSize=8;if(b.bevelEnabled===undefined)b.bevelEnabled=false;THREE.ExtrudeGeometry.call(this,c,b)};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TorusGeometry=function(a,b,c,d,e){THREE.Geometry.call(this);var f=this;this.radius=a||100;this.tube=b||40;this.radialSegments=c||8;this.tubularSegments=d||6;this.arc=e||Math.PI*2;var g=new THREE.Vector3,h=[],i=[];for(var j=0;j<=this.radialSegments;j++){for(var k=0;k<=this.tubularSegments;k++){var l=k/this.tubularSegments*this.arc;var m=j/this.radialSegments*Math.PI*2;g.x=this.radius*Math.cos(l);g.y=this.radius*Math.sin(l);var n=new THREE.Vector3;n.x=(this.radius+this.tube*Math.cos(m))*Math.cos(l);n.y=(this.radius+this.tube*Math.cos(m))*Math.sin(l);n.z=this.tube*Math.sin(m);this.vertices.push(n);h.push(new THREE.Vector2(k/this.tubularSegments,j/this.radialSegments));i.push(n.clone().sub(g).normalize())}}for(var j=1;j<=this.radialSegments;j++){for(var k=1;k<=this.tubularSegments;k++){var o=(this.tubularSegments+1)*j+k-1;var p=(this.tubularSegments+1)*(j-1)+k-1;var q=(this.tubularSegments+1)*(j-1)+k;var r=(this.tubularSegments+1)*j+k;var s=new THREE.Face4(o,p,q,r,[i[o],i[p],i[q],i[r]]);s.normal.add(i[o]);s.normal.add(i[p]);s.normal.add(i[q]);s.normal.add(i[r]);s.normal.normalize();this.faces.push(s);this.faceVertexUvs[0].push([h[o].clone(),h[p].clone(),h[q].clone(),h[r].clone()])}}this.computeCentroids()};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this);var h=this;this.radius=a||100;this.tube=b||40;this.radialSegments=c||64;this.tubularSegments=d||8;this.p=e||2;this.q=f||3;this.heightScale=g||1;this.grid=new Array(this.radialSegments);var i=new THREE.Vector3;var j=new THREE.Vector3;var k=new THREE.Vector3;for(var l=0;l<this.radialSegments;++l){this.grid[l]=new Array(this.tubularSegments);for(var m=0;m<this.tubularSegments;++m){var n=l/this.radialSegments*2*this.p*Math.PI;var o=m/this.tubularSegments*2*Math.PI;var p=E(n,o,this.q,this.p,this.radius,this.heightScale);var q=E(n+.01,o,this.q,this.p,this.radius,this.heightScale);var r,s;i.subVectors(q,p);j.addVectors(q,p);k.crossVectors(i,j);j.crossVectors(k,i);k.normalize();j.normalize();r=-this.tube*Math.cos(o);s=this.tube*Math.sin(o);p.x+=r*j.x+s*k.x;p.y+=r*j.y+s*k.y;p.z+=r*j.z+s*k.z;this.grid[l][m]=D(p.x,p.y,p.z)}}for(var l=0;l<this.radialSegments;++l){for(var m=0;m<this.tubularSegments;++m){var t=(l+1)%this.radialSegments;var u=(m+1)%this.tubularSegments;var v=this.grid[l][m];var w=this.grid[t][m];var x=this.grid[t][u];var y=this.grid[l][u];var z=new THREE.Vector2(l/this.radialSegments,m/this.tubularSegments);var A=new THREE.Vector2((l+1)/this.radialSegments,m/this.tubularSegments);var B=new THREE.Vector2((l+1)/this.radialSegments,(m+1)/this.tubularSegments);var C=new THREE.Vector2(l/this.radialSegments,(m+1)/this.tubularSegments);this.faces.push(new THREE.Face4(v,w,x,y));this.faceVertexUvs[0].push([z,A,B,C])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();function D(a,b,c){return h.vertices.push(new THREE.Vector3(a,b,c))-1}function E(a,b,c,d,e,f){var g=Math.cos(a);var h=Math.cos(b);var i=Math.sin(a);var j=c/d*a;var k=Math.cos(j);var l=e*(2+k)*.5*g;var m=e*(2+k)*i*.5;var n=f*e*Math.sin(j)*.5;return new THREE.Vector3(l,m,n)}};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.path=a;this.segments=b||64;this.radius=c||1;this.radiusSegments=d||8;this.closed=e||false;if(f)this.debug=new THREE.Object3D;this.grid=[];var g=this,h,i,j,k=this.segments+1,l,m,n,o,p,q,r,s,t,u,v,w=new THREE.Vector3,x,y,z,A,B,C,D,E,F,G,H,I;var J=new THREE.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),K=J.tangents,L=J.normals,M=J.binormals;this.tangents=K;this.normals=L;this.binormals=M;function N(a,b,c){return g.vertices.push(new THREE.Vector3(a,b,c))-1}for(x=0;x<k;x++){this.grid[x]=[];r=x/(k-1);v=a.getPointAt(r);h=K[x];i=L[x];j=M[x];if(this.debug){this.debug.add(new THREE.ArrowHelper(h,v,c,255));this.debug.add(new THREE.ArrowHelper(i,v,c,16711680));this.debug.add(new THREE.ArrowHelper(j,v,c,65280))}for(y=0;y<this.radiusSegments;y++){s=y/this.radiusSegments*2*Math.PI;t=-this.radius*Math.cos(s);u=this.radius*Math.sin(s);w.copy(v);w.x+=t*i.x+u*j.x;w.y+=t*i.y+u*j.y;w.z+=t*i.z+u*j.z;this.grid[x][y]=N(w.x,w.y,w.z)}}for(x=0;x<this.segments;x++){for(y=0;y<this.radiusSegments;y++){z=this.closed?(x+1)%this.segments:x+1;A=(y+1)%this.radiusSegments;B=this.grid[x][y];C=this.grid[z][y];D=this.grid[z][A];E=this.grid[x][A];F=new THREE.Vector2(x/this.segments,y/this.radiusSegments);G=new THREE.Vector2((x+1)/this.segments,y/this.radiusSegments);H=new THREE.Vector2((x+1)/this.segments,(y+1)/this.radiusSegments);I=new THREE.Vector2(x/this.segments,(y+1)/this.radiusSegments);this.faces.push(new THREE.Face4(B,C,D,E));this.faceVertexUvs[0].push([F,G,H,I])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.FrenetFrames=function(a,b,c){var d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Vector3,g=[],h=[],i=[],j=new THREE.Vector3,k=new THREE.Matrix4,l=b+1,m,n=1e-4,o,p,q,r,s,t,u;this.tangents=g;this.normals=h;this.binormals=i;for(s=0;s<l;s++){t=s/(l-1);g[s]=a.getTangentAt(t);g[s].normalize()}x();function v(a){h[0]=new THREE.Vector3;i[0]=new THREE.Vector3;if(a===undefined)a=new THREE.Vector3(0,0,1);h[0].crossVectors(a,g[0]).normalize();i[0].crossVectors(g[0],h[0]).normalize()}function w(){var b=a.getTangentAt(n);h[0]=(new THREE.Vector3).subVectors(b,g[0]).normalize();i[0]=(new THREE.Vector3).crossVectors(g[0],h[0]);h[0].crossVectors(i[0],g[0]).normalize();i[0].crossVectors(g[0],h[0]).normalize()}function x(){h[0]=new THREE.Vector3;i[0]=new THREE.Vector3;o=Number.MAX_VALUE;p=Math.abs(g[0].x);q=Math.abs(g[0].y);r=Math.abs(g[0].z);if(p<=o){o=p;e.set(1,0,0)}if(q<=o){o=q;e.set(0,1,0)}if(r<=o){e.set(0,0,1)}j.crossVectors(g[0],e).normalize();h[0].crossVectors(g[0],j);i[0].crossVectors(g[0],h[0])}for(s=1;s<l;s++){h[s]=h[s-1].clone();i[s]=i[s-1].clone();j.crossVectors(g[s-1],g[s]);if(j.length()>n){j.normalize();m=Math.acos(g[s-1].dot(g[s]));h[s].applyMatrix4(k.makeRotationAxis(j,m))}i[s].crossVectors(g[s],h[s])}if(c){m=Math.acos(h[0].dot(h[l-1]));m/=l-1;if(g[0].dot(j.crossVectors(h[0],h[l-1]))>0){m=-m}for(s=1;s<l;s++){h[s].applyMatrix4(k.makeRotationAxis(g[s],m*s));i[s].crossVectors(g[s],h[s])}}};THREE.PolyhedronGeometry=function(a,b,c,d){THREE.Geometry.call(this);c=c||1;d=d||0;var e=this;for(var f=0,g=a.length;f<g;f++){t(new THREE.Vector3(a[f][0],a[f][1],a[f][2]))}var h=[],i=this.vertices;var j=[];for(var f=0,g=b.length;f<g;f++){var k=i[b[f][0]];var l=i[b[f][1]];var m=i[b[f][2]];j[f]=new THREE.Face3(k.index,l.index,m.index,[k.clone(),l.clone(),m.clone()])}for(var f=0,g=j.length;f<g;f++){v(j[f],d)}for(var f=0,g=this.faceVertexUvs[0].length;f<g;f++){var n=this.faceVertexUvs[0][f];var o=n[0].x;var p=n[1].x;var q=n[2].x;var r=Math.max(o,Math.max(p,q));var s=Math.min(o,Math.min(p,q));if(r>.9&&s<.1){if(o<.2)n[0].x+=1;if(p<.2)n[1].x+=1;if(q<.2)n[2].x+=1}}this.mergeVertices();for(var f=0,g=this.vertices.length;f<g;f++){this.vertices[f].multiplyScalar(c)}function t(a){var b=a.normalize().clone();b.index=e.vertices.push(b)-1;var c=w(a)/2/Math.PI+.5;var d=x(a)/Math.PI+.5;b.uv=new THREE.Vector2(c,1-d);return b}function u(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);d.centroid.add(a).add(b).add(c).divideScalar(3);d.normal.copy(d.centroid).normalize();e.faces.push(d);var f=w(d.centroid);e.faceVertexUvs[0].push([y(a.uv,a,f),y(b.uv,b,f),y(c.uv,c,f)])}function v(a,b){var c=Math.pow(2,b);var d=Math.pow(4,b);var f=t(e.vertices[a.a]);var g=t(e.vertices[a.b]);var h=t(e.vertices[a.c]);var i=[];for(var j=0;j<=c;j++){i[j]=[];var k=t(f.clone().lerp(h,j/c));var l=t(g.clone().lerp(h,j/c));var m=c-j;for(var n=0;n<=m;n++){if(n==0&&j==c){i[j][n]=k}else{i[j][n]=t(k.clone().lerp(l,n/m))}}}for(var j=0;j<c;j++){for(var n=0;n<2*(c-j)-1;n++){var o=Math.floor(n/2);if(n%2==0){u(i[j][o+1],i[j+1][o],i[j][o])}else{u(i[j][o+1],i[j+1][o+1],i[j+1][o])}}}}function w(a){return Math.atan2(a.z,-a.x)}function x(a){return Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}function y(a,b,c){if(c<0&&a.x===1)a=new THREE.Vector2(a.x-1,a.y);if(b.x===0&&b.z===0)a=new THREE.Vector2(c/2/Math.PI+.5,a.y);return a.clone()}this.computeCentroids();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.IcosahedronGeometry=function(a,b){this.radius=a;this.detail=b;var c=(1+Math.sqrt(5))/2;var d=[[-1,c,0],[1,c,0],[-1,-c,0],[1,-c,0],[0,-1,c],[0,1,c],[0,-1,-c],[0,1,-c],[c,0,-1],[c,0,1],[-c,0,-1],[-c,0,1]];var e=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];THREE.PolyhedronGeometry.call(this,d,e,a,b)};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry=function(a,b){var c=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]];var d=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];THREE.PolyhedronGeometry.call(this,c,d,a,b)};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry=function(a,b){var c=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]];var d=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];THREE.PolyhedronGeometry.call(this,c,d,a,b)};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry=function(a,b,c,d){THREE.Geometry.call(this);var e=this.vertices;var f=this.faces;var g=this.faceVertexUvs[0];d=d===undefined?false:d;var h,i,j,k;var l,m;var n=c+1;var o=b+1;for(h=0;h<=c;h++){m=h/c;for(j=0;j<=b;j++){l=j/b;k=a(l,m);e.push(k)}}var p,q,r,s;var t,u,v,w;for(h=0;h<c;h++){for(j=0;j<b;j++){p=h*o+j;q=h*o+j+1;r=(h+1)*o+j;s=(h+1)*o+j+1;t=new THREE.Vector2(j/b,h/c);u=new THREE.Vector2((j+1)/b,h/c);v=new THREE.Vector2(j/b,(h+1)/c);w=new THREE.Vector2((j+1)/b,(h+1)/c);if(d){f.push(new THREE.Face3(p,q,r));f.push(new THREE.Face3(q,s,r));g.push([t,u,v]);g.push([u,w,v])}else{f.push(new THREE.Face4(p,q,s,r));g.push([t,u,w,v])}}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ConvexGeometry=function(a){THREE.Geometry.call(this);var b=[[0,1,2],[0,2,1]];for(var c=3;c<a.length;c++){d(c)}function d(c){var d=a[c].clone();var f=d.length();d.x+=f*h();d.y+=f*h();d.z+=f*h();var i=[];for(var j=0;j<b.length;){var k=b[j];if(e(k,d)){for(var l=0;l<3;l++){var m=[k[l],k[(l+1)%3]];var n=true;for(var o=0;o<i.length;o++){if(g(i[o],m)){i[o]=i[i.length-1];i.pop();n=false;break}}if(n){i.push(m)}}b[j]=b[b.length-1];b.pop()}else{j++}}for(var o=0;o<i.length;o++){b.push([i[o][0],i[o][1],c])}}function e(b,c){var d=a[b[0]];var e=a[b[1]];var g=a[b[2]];var h=f(d,e,g);var i=h.dot(d);return h.dot(c)>=i}function f(a,b,c){var d=new THREE.Vector3;var e=new THREE.Vector3;d.subVectors(c,b);e.subVectors(a,b);d.cross(e);d.normalize();return d}function g(a,b){return a[0]===b[1]&&a[1]===b[0]}function h(){return(Math.random()-.5)*2*1e-6}function i(a){var b=a.length();return new THREE.Vector2(a.x/b,a.y/b)}var j=0;var k=new Array(a.length);for(var c=0;c<b.length;c++){var l=b[c];for(var m=0;m<3;m++){if(k[l[m]]===undefined){k[l[m]]=j++;this.vertices.push(a[l[m]])}l[m]=k[l[m]]}}for(var c=0;c<b.length;c++){this.faces.push(new THREE.Face3(b[c][0],b[c][1],b[c][2]))}for(var c=0;c<this.faces.length;c++){var l=this.faces[c];this.faceVertexUvs[0].push([i(this.vertices[l.a]),i(this.vertices[l.b]),i(this.vertices[l.c])])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.ConvexGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.AxisHelper=function(a){a=a||1;var b=new THREE.Geometry;b.vertices.push(new THREE.Vector3,new THREE.Vector3(a,0,0),new THREE.Vector3,new THREE.Vector3(0,a,0),new THREE.Vector3,new THREE.Vector3(0,0,a));b.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775));var c=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,b,c,THREE.LinePieces)};THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);THREE.ArrowHelper=function(a,b,c,d){THREE.Object3D.call(this);if(d===undefined)d=16776960;if(c===undefined)c=1;this.position=b;this.useQuaternion=true;var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0));e.vertices.push(new THREE.Vector3(0,1,0));this.line=new THREE.Line(e,new THREE.LineBasicMaterial({color:d}));this.line.matrixAutoUpdate=false;this.add(this.line);var f=new THREE.CylinderGeometry(0,.05,.25,5,1);f.applyMatrix((new THREE.Matrix4).makeTranslation(0,.875,0));this.cone=new THREE.Mesh(f,new THREE.MeshBasicMaterial({color:d}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(a);this.setLength(c)};THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.setDirection=function(){var a=new THREE.Vector3;var b;return function(c){if(c.y>.999){this.quaternion.set(0,0,0,1)}else if(c.y<-.999){this.quaternion.set(1,0,0,0)}else{a.set(c.z,0,-c.x).normalize();b=Math.acos(c.y);this.quaternion.setFromAxisAngle(a,b)}}}();THREE.ArrowHelper.prototype.setLength=function(a){this.scale.set(a,a,a)};THREE.ArrowHelper.prototype.setColor=function(a){this.line.material.color.setHex(a);this.cone.material.color.setHex(a)};THREE.BoxHelper=function(a){a=a||1;var b=new THREE.Geometry;var c=[new THREE.Vector3(a,a,a),new THREE.Vector3(-a,a,a),new THREE.Vector3(-a,-a,a),new THREE.Vector3(a,-a,a),new THREE.Vector3(a,a,-a),new THREE.Vector3(-a,a,-a),new THREE.Vector3(-a,-a,-a),new THREE.Vector3(a,-a,-a)];b.vertices.push(c[0],c[1],c[1],c[2],c[2],c[3],c[3],c[0],c[4],c[5],c[5],c[6],c[6],c[7],c[7],c[4],c[0],c[4],c[1],c[5],c[2],c[6],c[3],c[7]);this.vertices=c;THREE.Line.call(this,b,new THREE.LineBasicMaterial,THREE.LinePieces)};THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype);THREE.BoxHelper.prototype.update=function(a){var b=a.geometry;if(b.boundingBox===null){b.computeBoundingBox()}var c=b.boundingBox.min;var d=b.boundingBox.max;var e=this.vertices;e[0].set(d.x,d.y,d.z);e[1].set(c.x,d.y,d.z);e[2].set(c.x,c.y,d.z);e[3].set(d.x,c.y,d.z);e[4].set(d.x,d.y,c.z);e[5].set(c.x,d.y,c.z);e[6].set(c.x,c.y,c.z);e[7].set(d.x,c.y,c.z);this.geometry.computeBoundingSphere();this.geometry.verticesNeedUpdate=true;this.matrixAutoUpdate=false;this.matrixWorld=a.matrixWorld};THREE.CameraHelper=function(a){THREE.Line.call(this);var b=new THREE.Geometry;var c=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors});
var d={};var e=16755200;var f=16711680;var g=43775;var h=16777215;var i=3355443;j("n1","n2",e);j("n2","n4",e);j("n4","n3",e);j("n3","n1",e);j("f1","f2",e);j("f2","f4",e);j("f4","f3",e);j("f3","f1",e);j("n1","f1",e);j("n2","f2",e);j("n3","f3",e);j("n4","f4",e);j("p","n1",f);j("p","n2",f);j("p","n3",f);j("p","n4",f);j("u1","u2",g);j("u2","u3",g);j("u3","u1",g);j("c","t",h);j("p","c",i);j("cn1","cn2",i);j("cn3","cn4",i);j("cf1","cf2",i);j("cf3","cf4",i);function j(a,b,c){k(a,c);k(b,c)}function k(a,c){b.vertices.push(new THREE.Vector3);b.colors.push(new THREE.Color(c));if(d[a]===undefined){d[a]=[]}d[a].push(b.vertices.length-1)}THREE.Line.call(this,b,c,THREE.LinePieces);this.camera=a;this.matrixWorld=a.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=d;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);THREE.CameraHelper.prototype.update=function(){var a=new THREE.Vector3;var b=new THREE.Camera;var c=new THREE.Projector;return function(){var d=this;var e=1,f=1;b.projectionMatrix.copy(this.camera.projectionMatrix);g("c",0,0,-1);g("t",0,0,1);g("n1",-e,-f,-1);g("n2",e,-f,-1);g("n3",-e,f,-1);g("n4",e,f,-1);g("f1",-e,-f,1);g("f2",e,-f,1);g("f3",-e,f,1);g("f4",e,f,1);g("u1",e*.7,f*1.1,-1);g("u2",-e*.7,f*1.1,-1);g("u3",0,f*2,-1);g("cf1",-e,0,1);g("cf2",e,0,1);g("cf3",0,-f,1);g("cf4",0,f,1);g("cn1",-e,0,-1);g("cn2",e,0,-1);g("cn3",0,-f,-1);g("cn4",0,f,-1);function g(e,f,g,h){a.set(f,g,h);c.unprojectVector(a,b);var i=d.pointMap[e];if(i!==undefined){for(var j=0,k=i.length;j<k;j++){d.geometry.vertices[i[j]].copy(a)}}}this.geometry.verticesNeedUpdate=true}}();THREE.DirectionalLightHelper=function(a,b){THREE.Object3D.call(this);this.matrixAutoUpdate=false;this.light=a;var c=new THREE.SphereGeometry(b,4,2);var d=new THREE.MeshBasicMaterial({fog:false,wireframe:true});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightSphere=new THREE.Mesh(c,d);this.lightSphere.matrixWorld=this.light.matrixWorld;this.lightSphere.matrixAutoUpdate=false;this.add(this.lightSphere);c=new THREE.Geometry;c.vertices.push(this.light.position);c.vertices.push(this.light.target.position);c.computeLineDistances();d=new THREE.LineDashedMaterial({dashSize:4,gapSize:4,opacity:.75,transparent:true,fog:false});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(c,d);this.add(this.targetLine)};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.update=function(){this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.computeLineDistances();this.targetLine.geometry.verticesNeedUpdate=true;this.targetLine.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};THREE.GridHelper=function(a,b){var c=new THREE.Geometry;var d=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});var e=new THREE.Color(4473924),f=new THREE.Color(8947848);for(var g=-a;g<=a;g+=b){c.vertices.push(new THREE.Vector3(-a,0,g));c.vertices.push(new THREE.Vector3(a,0,g));c.vertices.push(new THREE.Vector3(g,0,-a));c.vertices.push(new THREE.Vector3(g,0,a));var h=g===0?e:f;c.colors.push(h,h,h,h)}THREE.Line.call(this,c,d,THREE.LinePieces)};THREE.GridHelper.prototype=Object.create(THREE.Line.prototype);THREE.HemisphereLightHelper=function(a,b,c,d){THREE.Object3D.call(this);this.light=a;var e=new THREE.SphereGeometry(b,4,2);e.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var f=0,g=8;f<g;f++){e.faces[f].materialIndex=f<4?0:1}var h=new THREE.MeshBasicMaterial({fog:false,wireframe:true});h.color.copy(a.color).multiplyScalar(a.intensity);var i=new THREE.MeshBasicMaterial({fog:false,wireframe:true});i.color.copy(a.groundColor).multiplyScalar(a.intensity);this.lightSphere=new THREE.Mesh(e,new THREE.MeshFaceMaterial([h,i]));this.lightSphere.position=a.position;this.lightSphere.lookAt(new THREE.Vector3);this.add(this.lightSphere)};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.update=function(){this.lightSphere.lookAt(new THREE.Vector3);this.lightSphere.material.materials[0].color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightSphere.material.materials[1].color.copy(this.light.groundColor).multiplyScalar(this.light.intensity)};THREE.PointLightHelper=function(a,b){THREE.Object3D.call(this);this.matrixAutoUpdate=false;this.light=a;var c=new THREE.SphereGeometry(b,4,2);var d=new THREE.MeshBasicMaterial({fog:false,wireframe:true});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightSphere=new THREE.Mesh(c,d);this.lightSphere.matrixWorld=this.light.matrixWorld;this.lightSphere.matrixAutoUpdate=false;this.add(this.lightSphere)};THREE.PointLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.PointLightHelper.prototype.update=function(){this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};THREE.SpotLightHelper=function(a,b){THREE.Object3D.call(this);this.matrixAutoUpdate=false;this.light=a;var c=new THREE.SphereGeometry(b,4,2);var d=new THREE.MeshBasicMaterial({fog:false,wireframe:true});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightSphere=new THREE.Mesh(c,d);this.lightSphere.matrixWorld=this.light.matrixWorld;this.lightSphere.matrixAutoUpdate=false;this.add(this.lightSphere);c=new THREE.CylinderGeometry(1e-4,1,1,8,1,true);c.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));c.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));d=new THREE.MeshBasicMaterial({fog:false,wireframe:true,opacity:.3,transparent:true});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightCone=new THREE.Mesh(c,d);this.lightCone.position=this.light.position;var e=a.distance?a.distance:1e4;var f=e*Math.tan(a.angle);this.lightCone.scale.set(f,f,e);this.lightCone.lookAt(this.light.target.position);this.add(this.lightCone)};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.update=function(){var a=this.light.distance?this.light.distance:1e4;var b=a*Math.tan(this.light.angle);this.lightCone.scale.set(b,b,a);this.lightCone.lookAt(this.light.target.position);this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightCone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(a){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare=function(a,b,c,d,e){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=undefined;if(a!==undefined){this.add(a,b,c,d,e)}};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare.prototype.add=function(a,b,c,d,e,f){if(b===undefined)b=-1;if(c===undefined)c=0;if(f===undefined)f=1;if(e===undefined)e=new THREE.Color(16777215);if(d===undefined)d=THREE.NormalBlending;c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:f,color:e,blending:d})};THREE.LensFlare.prototype.updateLensFlares=function(){var a,b=this.lensFlares.length;var c;var d=-this.positionScreen.x*2;var e=-this.positionScreen.y*2;for(a=0;a<b;a++){c=this.lensFlares[a];c.x=this.positionScreen.x+d*c.distance;c.y=this.positionScreen.y+e*c.distance;c.wantedRotation=c.x*Math.PI*.25;c.rotation+=(c.wantedRotation-c.rotation)*.25}};THREE.MorphBlendMesh=function(a,b){THREE.Mesh.call(this,a,b);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;var d="__default";var e=0;var f=c-1;var g=c/1;this.createAnimation(d,e,f,g);this.setAnimationWeight(d,1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.createAnimation=function(a,b,c,d){var e={startFrame:b,endFrame:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[a]=e;this.animationsList.push(e)};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(a){var b=/([a-z]+)(\d+)/;var c,d={};var e=this.geometry;for(var f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f];var i=h.name.match(b);if(i&&i.length>1){var j=i[1];var k=i[2];if(!d[j])d[j]={start:Infinity,end:-Infinity};var l=d[j];if(f<l.start)l.start=f;if(f>l.end)l.end=f;if(!c)c=j}}for(var j in d){var l=d[j];this.createAnimation(j,l.start,l.end,a)}this.firstAnimation=c};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){var b=this.animationsMap[a];if(b){b.direction=1;b.directionBackwards=false}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){var b=this.animationsMap[a];if(b){b.direction=-1;b.directionBackwards=true}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];if(c){c.fps=b;c.duration=(c.end-c.start)/c.fps}};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];if(c){c.duration=b;c.fps=(c.end-c.start)/c.duration}};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];if(c){c.weight=b}};THREE.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];if(c){c.time=b}};THREE.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0;var c=this.animationsMap[a];if(c){b=c.time}return b};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1;var c=this.animationsMap[a];if(c){b=c.duration}return b};THREE.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];if(b){b.time=0;b.active=true}else{console.warn("animation["+a+"] undefined")}};THREE.MorphBlendMesh.prototype.stopAnimation=function(a){var b=this.animationsMap[a];if(b){b.active=false}};THREE.MorphBlendMesh.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var d=this.animationsList[b];if(!d.active)continue;var e=d.duration/d.length;d.time+=d.direction*a;if(d.mirroredLoop){if(d.time>d.duration||d.time<0){d.direction*=-1;if(d.time>d.duration){d.time=d.duration;d.directionBackwards=true}if(d.time<0){d.time=0;d.directionBackwards=false}}}else{d.time=d.time%d.duration;if(d.time<0)d.time+=d.duration}var f=d.startFrame+THREE.Math.clamp(Math.floor(d.time/e),0,d.length-1);var g=d.weight;if(f!==d.currentFrame){this.morphTargetInfluences[d.lastFrame]=0;this.morphTargetInfluences[d.currentFrame]=1*g;this.morphTargetInfluences[f]=0;d.lastFrame=d.currentFrame;d.currentFrame=f}var h=d.time%e/e;if(d.directionBackwards)h=1-h;this.morphTargetInfluences[d.currentFrame]=h*g;this.morphTargetInfluences[d.lastFrame]=(1-h)*g}};THREE.LensFlarePlugin=function(){var a,b,c,d={};this.init=function(f){a=f.context;b=f;c=f.getPrecision();d.vertices=new Float32Array(8+8);d.faces=new Uint16Array(6);var g=0;d.vertices[g++]=-1;d.vertices[g++]=-1;d.vertices[g++]=0;d.vertices[g++]=0;d.vertices[g++]=1;d.vertices[g++]=-1;d.vertices[g++]=1;d.vertices[g++]=0;d.vertices[g++]=1;d.vertices[g++]=1;d.vertices[g++]=1;d.vertices[g++]=1;d.vertices[g++]=-1;d.vertices[g++]=1;d.vertices[g++]=0;d.vertices[g++]=1;g=0;d.faces[g++]=0;d.faces[g++]=1;d.faces[g++]=2;d.faces[g++]=0;d.faces[g++]=2;d.faces[g++]=3;d.vertexBuffer=a.createBuffer();d.elementBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,d.vertices,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d.elementBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,d.faces,a.STATIC_DRAW);d.tempTexture=a.createTexture();d.occlusionTexture=a.createTexture();a.bindTexture(a.TEXTURE_2D,d.tempTexture);a.texImage2D(a.TEXTURE_2D,0,a.RGB,16,16,0,a.RGB,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.bindTexture(a.TEXTURE_2D,d.occlusionTexture);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,16,16,0,a.RGBA,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);if(a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){d.hasVertexTexture=false;d.program=e(THREE.ShaderFlares["lensFlare"],c)}else{d.hasVertexTexture=true;d.program=e(THREE.ShaderFlares["lensFlareVertexTexture"],c)}d.attributes={};d.uniforms={};d.attributes.vertex=a.getAttribLocation(d.program,"position");d.attributes.uv=a.getAttribLocation(d.program,"uv");d.uniforms.renderType=a.getUniformLocation(d.program,"renderType");d.uniforms.map=a.getUniformLocation(d.program,"map");d.uniforms.occlusionMap=a.getUniformLocation(d.program,"occlusionMap");d.uniforms.opacity=a.getUniformLocation(d.program,"opacity");d.uniforms.color=a.getUniformLocation(d.program,"color");d.uniforms.scale=a.getUniformLocation(d.program,"scale");d.uniforms.rotation=a.getUniformLocation(d.program,"rotation");d.uniforms.screenPosition=a.getUniformLocation(d.program,"screenPosition")};this.render=function(c,e,f,g){var h=c.__webglFlares,i=h.length;if(!i)return;var j=new THREE.Vector3;var k=g/f,l=f*.5,m=g*.5;var n=16/g,o=new THREE.Vector2(n*k,n);var p=new THREE.Vector3(1,1,0),q=new THREE.Vector2(1,1);var r=d.uniforms,s=d.attributes;a.useProgram(d.program);a.enableVertexAttribArray(d.attributes.vertex);a.enableVertexAttribArray(d.attributes.uv);a.uniform1i(r.occlusionMap,0);a.uniform1i(r.map,1);a.bindBuffer(a.ARRAY_BUFFER,d.vertexBuffer);a.vertexAttribPointer(s.vertex,2,a.FLOAT,false,2*8,0);a.vertexAttribPointer(s.uv,2,a.FLOAT,false,2*8,8);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d.elementBuffer);a.disable(a.CULL_FACE);a.depthMask(false);var t,u,v,w,x;for(t=0;t<i;t++){n=16/g;o.set(n*k,n);w=h[t];j.set(w.matrixWorld.elements[12],w.matrixWorld.elements[13],w.matrixWorld.elements[14]);j.applyMatrix4(e.matrixWorldInverse);j.applyProjection(e.projectionMatrix);p.copy(j);q.x=p.x*l+l;q.y=p.y*m+m;if(d.hasVertexTexture||q.x>0&&q.x<f&&q.y>0&&q.y<g){a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,d.tempTexture);a.copyTexImage2D(a.TEXTURE_2D,0,a.RGB,q.x-8,q.y-8,16,16,0);a.uniform1i(r.renderType,0);a.uniform2f(r.scale,o.x,o.y);a.uniform3f(r.screenPosition,p.x,p.y,p.z);a.disable(a.BLEND);a.enable(a.DEPTH_TEST);a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,d.occlusionTexture);a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,q.x-8,q.y-8,16,16,0);a.uniform1i(r.renderType,1);a.disable(a.DEPTH_TEST);a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,d.tempTexture);a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0);w.positionScreen.copy(p);if(w.customUpdateCallback){w.customUpdateCallback(w)}else{w.updateLensFlares()}a.uniform1i(r.renderType,2);a.enable(a.BLEND);for(u=0,v=w.lensFlares.length;u<v;u++){x=w.lensFlares[u];if(x.opacity>.001&&x.scale>.001){p.x=x.x;p.y=x.y;p.z=x.z;n=x.size*x.scale/g;o.x=n*k;o.y=n;a.uniform3f(r.screenPosition,p.x,p.y,p.z);a.uniform2f(r.scale,o.x,o.y);a.uniform1f(r.rotation,x.rotation);a.uniform1f(r.opacity,x.opacity);a.uniform3f(r.color,x.color.r,x.color.g,x.color.b);b.setBlending(x.blending,x.blendEquation,x.blendSrc,x.blendDst);b.setTexture(x.texture,1);a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0)}}}}a.enable(a.CULL_FACE);a.enable(a.DEPTH_TEST);a.depthMask(true)};function e(b,c){var d=a.createProgram();var e=a.createShader(a.FRAGMENT_SHADER);var f=a.createShader(a.VERTEX_SHADER);var g="precision "+c+" float;\n";a.shaderSource(e,g+b.fragmentShader);a.shaderSource(f,g+b.vertexShader);a.compileShader(e);a.compileShader(f);a.attachShader(d,e);a.attachShader(d,f);a.linkProgram(d);return d}};THREE.ShadowMapPlugin=function(){var a,b,c,d,e,f,g=new THREE.Frustum,h=new THREE.Matrix4,i=new THREE.Vector3,j=new THREE.Vector3,k=new THREE.Vector3;this.init=function(g){a=g.context;b=g;var h=THREE.ShaderLib["depthRGBA"];var i=THREE.UniformsUtils.clone(h.uniforms);c=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i});d=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i,morphTargets:true});e=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i,skinning:true});f=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i,morphTargets:true,skinning:true});c._shadowPass=true;d._shadowPass=true;e._shadowPass=true;f._shadowPass=true};this.render=function(a,c){if(!(b.shadowMapEnabled&&b.shadowMapAutoUpdate))return;this.update(a,c)};this.update=function(i,j){var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=[],F=0,G=null;a.clearColor(1,1,1,1);a.disable(a.BLEND);a.enable(a.CULL_FACE);a.frontFace(a.CCW);if(b.shadowMapCullFace===THREE.CullFaceFront){a.cullFace(a.FRONT)}else{a.cullFace(a.BACK)}b.setDepthTest(true);for(p=0,q=i.__lights.length;p<q;p++){C=i.__lights[p];if(!C.castShadow)continue;if(C instanceof THREE.DirectionalLight&&C.shadowCascade){for(t=0;t<C.shadowCascadeCount;t++){var H;if(!C.shadowCascadeArray[t]){H=l(C,t);H.originalCamera=j;var I=new THREE.Gyroscope;I.position=C.shadowCascadeOffset;I.add(H);I.add(H.target);j.add(I);C.shadowCascadeArray[t]=H;console.log("Created virtualLight",H)}else{H=C.shadowCascadeArray[t]}m(C,t);E[F]=H;F++}}else{E[F]=C;F++}}for(p=0,q=E.length;p<q;p++){C=E[p];if(!C.shadowMap){var J=THREE.LinearFilter;if(b.shadowMapType===THREE.PCFSoftShadowMap){J=THREE.NearestFilter}var K={minFilter:J,magFilter:J,format:THREE.RGBAFormat};C.shadowMap=new THREE.WebGLRenderTarget(C.shadowMapWidth,C.shadowMapHeight,K);C.shadowMapSize=new THREE.Vector2(C.shadowMapWidth,C.shadowMapHeight);C.shadowMatrix=new THREE.Matrix4}if(!C.shadowCamera){if(C instanceof THREE.SpotLight){C.shadowCamera=new THREE.PerspectiveCamera(C.shadowCameraFov,C.shadowMapWidth/C.shadowMapHeight,C.shadowCameraNear,C.shadowCameraFar)}else if(C instanceof THREE.DirectionalLight){C.shadowCamera=new THREE.OrthographicCamera(C.shadowCameraLeft,C.shadowCameraRight,C.shadowCameraTop,C.shadowCameraBottom,C.shadowCameraNear,C.shadowCameraFar)}else{console.error("Unsupported light type for shadow");continue}i.add(C.shadowCamera);if(i.autoUpdate===true)i.updateMatrixWorld()}if(C.shadowCameraVisible&&!C.cameraHelper){C.cameraHelper=new THREE.CameraHelper(C.shadowCamera);C.shadowCamera.add(C.cameraHelper)}if(C.isVirtual&&H.originalCamera==j){n(j,C)}u=C.shadowMap;v=C.shadowMatrix;w=C.shadowCamera;w.position.getPositionFromMatrix(C.matrixWorld);k.getPositionFromMatrix(C.target.matrixWorld);w.lookAt(k);w.updateMatrixWorld();w.matrixWorldInverse.getInverse(w.matrixWorld);if(C.cameraHelper)C.cameraHelper.visible=C.shadowCameraVisible;if(C.shadowCameraVisible)C.cameraHelper.update();v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);v.multiply(w.projectionMatrix);v.multiply(w.matrixWorldInverse);h.multiplyMatrices(w.projectionMatrix,w.matrixWorldInverse);g.setFromMatrix(h);b.setRenderTarget(u);b.clear();D=i.__webglObjects;for(r=0,s=D.length;r<s;r++){A=D[r];B=A.object;A.render=false;if(B.visible&&B.castShadow){if(!(B instanceof THREE.Mesh||B instanceof THREE.ParticleSystem)||!B.frustumCulled||g.intersectsObject(B)){B._modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,B.matrixWorld);A.render=true}}}var L,M,N;for(r=0,s=D.length;r<s;r++){A=D[r];if(A.render){B=A.object;y=A.buffer;L=o(B);M=B.geometry.morphTargets.length>0&&L.morphTargets;N=B instanceof THREE.SkinnedMesh&&L.skinning;if(B.customDepthMaterial){z=B.customDepthMaterial}else if(N){z=M?f:e}else if(M){z=d}else{z=c}if(y instanceof THREE.BufferGeometry){b.renderBufferDirect(w,i.__lights,G,z,y,B)}else{b.renderBuffer(w,i.__lights,G,z,y,B)}}}D=i.__webglObjectsImmediate;for(r=0,s=D.length;r<s;r++){A=D[r];B=A.object;if(B.visible&&B.castShadow){B._modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,B.matrixWorld);b.renderImmediateObject(w,i.__lights,G,c,B)}}}var O=b.getClearColor(),P=b.getClearAlpha();a.clearColor(O.r,O.g,O.b,P);a.enable(a.BLEND);if(b.shadowMapCullFace===THREE.CullFaceFront){a.cullFace(a.BACK)}};function l(a,b){var c=new THREE.DirectionalLight;c.isVirtual=true;c.onlyShadow=true;c.castShadow=true;c.shadowCameraNear=a.shadowCameraNear;c.shadowCameraFar=a.shadowCameraFar;c.shadowCameraLeft=a.shadowCameraLeft;c.shadowCameraRight=a.shadowCameraRight;c.shadowCameraBottom=a.shadowCameraBottom;c.shadowCameraTop=a.shadowCameraTop;c.shadowCameraVisible=a.shadowCameraVisible;c.shadowDarkness=a.shadowDarkness;c.shadowBias=a.shadowCascadeBias[b];c.shadowMapWidth=a.shadowCascadeWidth[b];c.shadowMapHeight=a.shadowCascadeHeight[b];c.pointsWorld=[];c.pointsFrustum=[];var d=c.pointsWorld,e=c.pointsFrustum;for(var f=0;f<8;f++){d[f]=new THREE.Vector3;e[f]=new THREE.Vector3}var g=a.shadowCascadeNearZ[b];var h=a.shadowCascadeFarZ[b];e[0].set(-1,-1,g);e[1].set(1,-1,g);e[2].set(-1,1,g);e[3].set(1,1,g);e[4].set(-1,-1,h);e[5].set(1,-1,h);e[6].set(-1,1,h);e[7].set(1,1,h);return c}function m(a,b){var c=a.shadowCascadeArray[b];c.position.copy(a.position);c.target.position.copy(a.target.position);c.lookAt(c.target);c.shadowCameraVisible=a.shadowCameraVisible;c.shadowDarkness=a.shadowDarkness;c.shadowBias=a.shadowCascadeBias[b];var d=a.shadowCascadeNearZ[b];var e=a.shadowCascadeFarZ[b];var f=c.pointsFrustum;f[0].z=d;f[1].z=d;f[2].z=d;f[3].z=d;f[4].z=e;f[5].z=e;f[6].z=e;f[7].z=e}function n(a,b){var c=b.shadowCamera,d=b.pointsFrustum,e=b.pointsWorld;i.set(Infinity,Infinity,Infinity);j.set(-Infinity,-Infinity,-Infinity);for(var f=0;f<8;f++){var g=e[f];g.copy(d[f]);THREE.ShadowMapPlugin.__projector.unprojectVector(g,a);g.applyMatrix4(c.matrixWorldInverse);if(g.x<i.x)i.x=g.x;if(g.x>j.x)j.x=g.x;if(g.y<i.y)i.y=g.y;if(g.y>j.y)j.y=g.y;if(g.z<i.z)i.z=g.z;if(g.z>j.z)j.z=g.z}c.left=i.x;c.right=j.x;c.top=j.y;c.bottom=i.y;c.updateProjectionMatrix()}function o(a){return a.material instanceof THREE.MeshFaceMaterial?a.material.materials[0]:a.material}};THREE.ShadowMapPlugin.__projector=new THREE.Projector;THREE.SpritePlugin=function(){var a,b,c,d={};this.init=function(f){a=f.context;b=f;c=f.getPrecision();d.vertices=new Float32Array(8+8);d.faces=new Uint16Array(6);var g=0;d.vertices[g++]=-1;d.vertices[g++]=-1;d.vertices[g++]=0;d.vertices[g++]=0;d.vertices[g++]=1;d.vertices[g++]=-1;d.vertices[g++]=1;d.vertices[g++]=0;d.vertices[g++]=1;d.vertices[g++]=1;d.vertices[g++]=1;d.vertices[g++]=1;d.vertices[g++]=-1;d.vertices[g++]=1;d.vertices[g++]=0;d.vertices[g++]=1;g=0;d.faces[g++]=0;d.faces[g++]=1;d.faces[g++]=2;d.faces[g++]=0;d.faces[g++]=2;d.faces[g++]=3;d.vertexBuffer=a.createBuffer();d.elementBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,d.vertices,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d.elementBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,d.faces,a.STATIC_DRAW);d.program=e(THREE.ShaderSprite["sprite"],c);d.attributes={};d.uniforms={};d.attributes.position=a.getAttribLocation(d.program,"position");d.attributes.uv=a.getAttribLocation(d.program,"uv");d.uniforms.uvOffset=a.getUniformLocation(d.program,"uvOffset");d.uniforms.uvScale=a.getUniformLocation(d.program,"uvScale");d.uniforms.rotation=a.getUniformLocation(d.program,"rotation");d.uniforms.scale=a.getUniformLocation(d.program,"scale");d.uniforms.alignment=a.getUniformLocation(d.program,"alignment");d.uniforms.color=a.getUniformLocation(d.program,"color");d.uniforms.map=a.getUniformLocation(d.program,"map");d.uniforms.opacity=a.getUniformLocation(d.program,"opacity");d.uniforms.useScreenCoordinates=a.getUniformLocation(d.program,"useScreenCoordinates");d.uniforms.sizeAttenuation=a.getUniformLocation(d.program,"sizeAttenuation");d.uniforms.screenPosition=a.getUniformLocation(d.program,"screenPosition");d.uniforms.modelViewMatrix=a.getUniformLocation(d.program,"modelViewMatrix");d.uniforms.projectionMatrix=a.getUniformLocation(d.program,"projectionMatrix");d.uniforms.fogType=a.getUniformLocation(d.program,"fogType");d.uniforms.fogDensity=a.getUniformLocation(d.program,"fogDensity");d.uniforms.fogNear=a.getUniformLocation(d.program,"fogNear");d.uniforms.fogFar=a.getUniformLocation(d.program,"fogFar");d.uniforms.fogColor=a.getUniformLocation(d.program,"fogColor");d.uniforms.alphaTest=a.getUniformLocation(d.program,"alphaTest")};this.render=function(c,e,g,h){var i=c.__webglSprites,j=i.length;if(!j)return;var k=d.attributes,l=d.uniforms;var m=h/g;var n=g*.5,o=h*.5;a.useProgram(d.program);a.enableVertexAttribArray(k.position);a.enableVertexAttribArray(k.uv);a.disable(a.CULL_FACE);a.enable(a.BLEND);a.bindBuffer(a.ARRAY_BUFFER,d.vertexBuffer);a.vertexAttribPointer(k.position,2,a.FLOAT,false,2*8,0);a.vertexAttribPointer(k.uv,2,a.FLOAT,false,2*8,8);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d.elementBuffer);a.uniformMatrix4fv(l.projectionMatrix,false,e.projectionMatrix.elements);a.activeTexture(a.TEXTURE0);a.uniform1i(l.map,0);var p=0;var q=0;var r=c.fog;if(r){a.uniform3f(l.fogColor,r.color.r,r.color.g,r.color.b);if(r instanceof THREE.Fog){a.uniform1f(l.fogNear,r.near);a.uniform1f(l.fogFar,r.far);a.uniform1i(l.fogType,1);p=1;q=1}else if(r instanceof THREE.FogExp2){a.uniform1f(l.fogDensity,r.density);a.uniform1i(l.fogType,2);p=2;q=2}}else{a.uniform1i(l.fogType,0);p=0;q=0}var s,t,u,v,w,x,y=[];for(s=0;s<j;s++){t=i[s];u=t.material;if(!t.visible||u.opacity===0)continue;if(!u.useScreenCoordinates){t._modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,t.matrixWorld);t.z=-t._modelViewMatrix.elements[14]}else{t.z=-t.position.z}}i.sort(f);for(s=0;s<j;s++){t=i[s];u=t.material;if(!t.visible||u.opacity===0)continue;if(u.map&&u.map.image&&u.map.image.width){a.uniform1f(l.alphaTest,u.alphaTest);if(u.useScreenCoordinates===true){a.uniform1i(l.useScreenCoordinates,1);a.uniform3f(l.screenPosition,(t.position.x*b.devicePixelRatio-n)/n,(o-t.position.y*b.devicePixelRatio)/o,Math.max(0,Math.min(1,t.position.z)));y[0]=b.devicePixelRatio;y[1]=b.devicePixelRatio}else{a.uniform1i(l.useScreenCoordinates,0);a.uniform1i(l.sizeAttenuation,u.sizeAttenuation?1:0);a.uniformMatrix4fv(l.modelViewMatrix,false,t._modelViewMatrix.elements);y[0]=1;y[1]=1}if(c.fog&&u.fog){x=q}else{x=0}if(p!==x){a.uniform1i(l.fogType,x);p=x}w=1/(u.scaleByViewport?h:1);y[0]*=w*m*t.scale.x;y[1]*=w*t.scale.y;a.uniform2f(l.uvScale,u.uvScale.x,u.uvScale.y);a.uniform2f(l.uvOffset,u.uvOffset.x,u.uvOffset.y);a.uniform2f(l.alignment,u.alignment.x,u.alignment.y);a.uniform1f(l.opacity,u.opacity);a.uniform3f(l.color,u.color.r,u.color.g,u.color.b);a.uniform1f(l.rotation,t.rotation);a.uniform2fv(l.scale,y);b.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst);b.setDepthTest(u.depthTest);b.setDepthWrite(u.depthWrite);b.setTexture(u.map,0);a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0)}}a.enable(a.CULL_FACE)};function e(b,c){var d=a.createProgram();var e=a.createShader(a.FRAGMENT_SHADER);var f=a.createShader(a.VERTEX_SHADER);var g="precision "+c+" float;\n";a.shaderSource(e,g+b.fragmentShader);a.shaderSource(f,g+b.vertexShader);a.compileShader(e);a.compileShader(f);a.attachShader(d,e);a.attachShader(d,f);a.linkProgram(d);return d}function f(a,b){if(a.z!==b.z){return b.z-a.z}else{return b.id-a.id}}};THREE.DepthPassPlugin=function(){this.enabled=false;this.renderTarget=null;var a,b,c,d,e,f,g=new THREE.Frustum,h=new THREE.Matrix4;this.init=function(g){a=g.context;b=g;var h=THREE.ShaderLib["depthRGBA"];var i=THREE.UniformsUtils.clone(h.uniforms);c=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i});d=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i,morphTargets:true});e=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i,skinning:true});f=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:i,morphTargets:true,skinning:true});c._shadowPass=true;d._shadowPass=true;e._shadowPass=true;f._shadowPass=true};this.render=function(a,b){if(!this.enabled)return;this.update(a,b)};this.update=function(j,k){var l,m,n,o,p,q,r,s,t,u,v,w,x=null;a.clearColor(1,1,1,1);a.disable(a.BLEND);b.setDepthTest(true);if(j.autoUpdate===true)j.updateMatrixWorld();k.matrixWorldInverse.getInverse(k.matrixWorld);h.multiplyMatrices(k.projectionMatrix,k.matrixWorldInverse);g.setFromMatrix(h);b.setRenderTarget(this.renderTarget);b.clear();w=j.__webglObjects;for(n=0,o=w.length;n<o;n++){t=w[n];u=t.object;t.render=false;if(u.visible){if(!(u instanceof THREE.Mesh||u instanceof THREE.ParticleSystem)||!u.frustumCulled||g.intersectsObject(u)){u._modelViewMatrix.multiplyMatrices(k.matrixWorldInverse,u.matrixWorld);t.render=true}}}var y,z,A;for(n=0,o=w.length;n<o;n++){t=w[n];if(t.render){u=t.object;r=t.buffer;if(u instanceof THREE.ParticleSystem&&!u.customDepthMaterial)continue;y=i(u);if(y)b.setMaterialFaces(u.material);z=u.geometry.morphTargets.length>0&&y.morphTargets;A=u instanceof THREE.SkinnedMesh&&y.skinning;if(u.customDepthMaterial){s=u.customDepthMaterial}else if(A){s=z?f:e}else if(z){s=d}else{s=c}if(r instanceof THREE.BufferGeometry){b.renderBufferDirect(k,j.__lights,x,s,r,u)}else{b.renderBuffer(k,j.__lights,x,s,r,u)}}}w=j.__webglObjectsImmediate;for(n=0,o=w.length;n<o;n++){t=w[n];u=t.object;if(u.visible){u._modelViewMatrix.multiplyMatrices(k.matrixWorldInverse,u.matrixWorld);b.renderImmediateObject(k,j.__lights,x,c,u)}}var B=b.getClearColor(),C=b.getClearAlpha();a.clearColor(B.r,B.g,B.b,C);a.enable(a.BLEND)};function i(a){return a.material instanceof THREE.MeshFaceMaterial?a.material.materials[0]:a.material}};THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility = (       visibility.r / 9.0 ) *","( 1.0 - visibility.g / 9.0 ) *","(       visibility.b / 9.0 ) *","( 1.0 - visibility.a / 9.0 );","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}};
THREE.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}};var SimplexNoise=function(a){if(a==undefined)a=Math;this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]];this.p=[];for(var b=0;b<256;b++){this.p[b]=Math.floor(a.random()*256)}this.perm=[];for(var b=0;b<512;b++){this.perm[b]=this.p[b&255]}this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};SimplexNoise.prototype.dot=function(a,b,c){return a[0]*b+a[1]*c};SimplexNoise.prototype.noise=function(a,b){var c,d,e;var f=.5*(Math.sqrt(3)-1);var g=(a+b)*f;var h=Math.floor(a+g);var i=Math.floor(b+g);var j=(3-Math.sqrt(3))/6;var k=(h+i)*j;var l=h-k;var m=i-k;var n=a-l;var o=b-m;var p,q;if(n>o){p=1;q=0}else{p=0;q=1}var r=n-p+j;var s=o-q+j;var t=n-1+2*j;var u=o-1+2*j;var v=h&255;var w=i&255;var x=this.perm[v+this.perm[w]]%12;var y=this.perm[v+p+this.perm[w+q]]%12;var z=this.perm[v+1+this.perm[w+1]]%12;var A=.5-n*n-o*o;if(A<0)c=0;else{A*=A;c=A*A*this.dot(this.grad3[x],n,o)}var B=.5-r*r-s*s;if(B<0)d=0;else{B*=B;d=B*B*this.dot(this.grad3[y],r,s)}var C=.5-t*t-u*u;if(C<0)e=0;else{C*=C;e=C*C*this.dot(this.grad3[z],t,u)}return 70*(c+d+e)};SimplexNoise.prototype.noise3d=function(a,b,c){var d,e,f,g;var h=1/3;var i=(a+b+c)*h;var j=Math.floor(a+i);var k=Math.floor(b+i);var l=Math.floor(c+i);var m=1/6;var n=(j+k+l)*m;var o=j-n;var p=k-n;var q=l-n;var r=a-o;var s=b-p;var t=c-q;var u,v,w;var x,y,z;if(r>=s){if(s>=t){u=1;v=0;w=0;x=1;y=1;z=0}else if(r>=t){u=1;v=0;w=0;x=1;y=0;z=1}else{u=0;v=0;w=1;x=1;y=0;z=1}}else{if(s<t){u=0;v=0;w=1;x=0;y=1;z=1}else if(r<t){u=0;v=1;w=0;x=0;y=1;z=1}else{u=0;v=1;w=0;x=1;y=1;z=0}}var A=r-u+m;var B=s-v+m;var C=t-w+m;var D=r-x+2*m;var E=s-y+2*m;var F=t-z+2*m;var G=r-1+3*m;var H=s-1+3*m;var I=t-1+3*m;var J=j&255;var K=k&255;var L=l&255;var M=this.perm[J+this.perm[K+this.perm[L]]]%12;var N=this.perm[J+u+this.perm[K+v+this.perm[L+w]]]%12;var O=this.perm[J+x+this.perm[K+y+this.perm[L+z]]]%12;var P=this.perm[J+1+this.perm[K+1+this.perm[L+1]]]%12;var Q=.6-r*r-s*s-t*t;if(Q<0)d=0;else{Q*=Q;d=Q*Q*this.dot(this.grad3[M],r,s,t)}var R=.6-A*A-B*B-C*C;if(R<0)e=0;else{R*=R;e=R*R*this.dot(this.grad3[N],A,B,C)}var S=.6-D*D-E*E-F*F;if(S<0)f=0;else{S*=S;f=S*S*this.dot(this.grad3[O],D,E,F)}var T=.6-G*G-H*H-I*I;if(T<0)g=0;else{T*=T;g=T*T*this.dot(this.grad3[P],G,H,I)}return 32*(d+e+f+g)};!function(a){var b=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];var e;for(var f=0;f<a.length;f++){if(a[f].id===d.id){e=a[f]}}if(e){for(var g in d.settings){e.settings[g]=d.settings[g]}if(d.transitions){for(var f=0;f<d.transitions.length;f++){var h=d.transitions[f];var i=undefined;var j=-1;for(var k=0;k<e.transitions.length;k++){if(e.transitions[k].name===h.name){i=e.transitions[k];j=k}}if(i!==undefined){e.transitions[j]=h}else{e.transitions.push(h)}}}for(var g in d.settingsRange){e.settingsRange[g]=d.settingsRange[g]}for(var l in d){if(typeof d[l]==="string"||typeof d[l]==="number"){e[l]=d[l]}}}else{a.push(d)}}};if(typeof exports!=="undefined"){exports.TimelineMerge=b}a.TimelineMerge=b}(this);!function(a,b){var c=640,d=640,e=336,f=5,g=200,h=60,i=20,j=5,k=null,l=0,m,n,o,p,q,r,s,t=0,u=0,v=0,w=[{size:"1920 (Very Fast)",speed:.5},{size:"1280 (Fast)",speed:.7},{size:"1080 (Decent)",speed:.9},{size:"840 (Slow)",speed:1.15},{size:"640 (Very Slow)",speed:9999}],x=[];var y=b.WebglPerformanceTest={create:function(b,f){o=new THREE.Scene;p=new THREE.OrthographicCamera(-.5,.5,-.5,.5,-100,100);m=!b;if(m){q=new THREE.WebGLRenderer({antialias:true,alpha:false});q.setClearColor(0,1);q.setSize(c,c)}else{q=b}k=f;var g=a.createElement("canvas");g.width=d;g.height=e;s=g.getContext("2d");s.fillStyle="black";s.fillRect(0,0,d,e);n=new THREE.Texture(g,new THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBAFormat,THREE.UnsignedByteType,1);n.needsUpdate=true;n.generateMipmaps=false;n.premultiplyAlpha=false;r=new THREE.WebGLRenderTarget(d,e,{antialias:true,minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,depthBuffer:false,stencilBuffer:false});var h=new THREE.Mesh(new THREE.PlaneGeometry(1,1,1,1),new THREE.ShaderMaterial({vertexShader:["varying mediump vec2 vUv;","void main() {","	vUv = vec2(uv.x,uv.y);","	gl_Position = projectionMatrix *  modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying mediump vec2 vUv;","uniform sampler2D tDiffuse;","void main() {","vec4 col = texture2D(tDiffuse,vUv);","if (dot(col,vec4(0.75))>0.8) { col= vec4(0.75); }","gl_FragColor = sqrt(abs(sin(texture2D(tDiffuse,vUv*0.5))))*vec4(1.1) + col + vec4(dot(col,vec4(0.5)));","}"].join("\n"),attributes:{},uniforms:{tDiffuse:{type:"t",value:n}},side:THREE.DoubleSide}));o.add(h);q.render(o,p,r,true);q.getContext().flush();u=performance.now()},run:function(a){if(l>g||t>=j){y.onFinished();return}b.requestAnimationFrame(y.run);var c=0,h,k=new Uint8Array(4),m=q.getContext();s.fillStyle="#"+Math.random();s.fillRect(0,0,d,e);m.readPixels(0,0,0,1,m.RGBA,m.UNSIGNED_BYTE,k);m.finish();h=b.performance.now();for(var u=0;u<f;u++){n.needsUpdate=true;q.setTexture(n,u);q.render(o,p,r,true)}q.getContext().flush();m.readPixels(0,0,0,1,m.RGBA,m.UNSIGNED_BYTE,k);q.getContext().finish();var w=b.performance.now()-h;x.push(w);if(w>i)t++;else t=0;l++;v=performance.now()},onFinished:function(){x.sort();var b;console.log("finished: "+x.length);var c=0;var d;if(t<j){for(var e=h;e<g-h;e++){c+=x[e]}b=c/(g-h*2);console.log("Webgl Performance Score: "+b);d=b*(Math.max(performance.now()-u,3500)/3500);var f;for(var e=w.length-1;e>=0;e--){if(b<=w[e].speed){f=w[e].size}}}else{for(var e=1;e<x.length-1;e++){c+=x[e]}b=c/(x.length-2);d=b}console.log(b);if(!k)a.write("Webgl Performance Score: "+(c/(g-h*2)).toPrecision(4)+"<br/>Recommended Size: "+f);else k(b,(performance.now()-u)/1e3,d);n.dispose();r.dispose()},debug:function(){y.create(null,function(a,b,c){console.log(a+" in "+b+" final score:"+c)});y.run()}}}(document,window);!function(){var a=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/;JSON._parse=JSON.parse;JSON.parse=function(b){return JSON._parse(b,function(b,c){if(typeof c==="string"){if(a.exec(c)){return new Date(c)}}return c})};if(window.jQuery!==undefined){jQuery.parseJSON=JSON.parse;jQuery.ajaxSettings.converters["text json"]=JSON.parse}}();var http={};!function(){function a(a,b,c,d,e){var f;if(XMLHttpRequest){f=new XMLHttpRequest}else{f=new ActiveXObject("Microsoft.XMLHTTP")}f.open(a,b,true);f.setRequestHeader("Content-Type","application/json;charset=UTF-8");f.setRequestHeader("If-None-Match","some-random-string");f.setRequestHeader("Cache-Control","no-cache,max-age=0");f.setRequestHeader("Pragma","no-cache");f.onreadystatechange=function(){if(f.readyState===4){var a=f.responseText;try{a=JSON.parse(a)}catch(b){}var g=Array.prototype.slice.call(arguments);g.unshift(a);g.push(f);if(f.status===200&&typeof c==="function"){c.apply(e||f,g)}else if(typeof d==="function"){d.apply(e||f,g)}else{if(console){console.warn("Made Ajax request but set no callback.")}}}};return f}http.HEAD=function(b,c,d,e){xhr=a("HEAD",b,c,d,e);xhr.send()};http.GET=function(b,c,d,e){xhr=a("GET",b,c,d,e);xhr.send()};http.POST=function(b,c,d,e,f){xhr=a("POST",b,d,e,f);xhr.send(JSON.stringify(c))};http.DELETE=function(b,c,d,e){xhr=a("DELETE",b,c,d,e);xhr.send()}}();var EventDispatcher=function(){this._handlers={}};EventDispatcher.prototype={bind:function(a,b){this._handlers[a]=this._handlers[a]||[];if(this._handlers[a].indexOf(b)===-1){this._handlers[a].push(b)}},unbind:function(a,b){if(this._handlers[a]){if(b){this._handlers[a].splice(this._handlers[a].indexOf(b),1)}else{this._handlers[a]=[]}}},trigger:function(a,b){var c;b=Array.prototype.slice.apply(arguments).slice(1);if(this._handlers[a]){for(c=0;c<this._handlers[a].length;++c){this._handlers[a][c].apply(this,b)}}}};var StateDrive=function(){EventDispatcher.call(this);this._state=0;this._callQueue={}};StateDrive.prototype=new EventDispatcher;StateDrive.prototype.getState=function(){return this._state};StateDrive.prototype.setState=function(a){this._state=a;this._executeQueuedCalls()};StateDrive.prototype.setMinCallState=function(a,b,c){var d=this[a],e=arguments[arguments.length-1],f=arguments.length>2?Array.prototype.slice.apply(arguments).slice(1,arguments.length-1):[],g;this[a]=function(){if(this._state>=e||arguments.length<f.length){return d.apply(this,arguments)}else{for(g=0;g<f.length;++g){if(!arguments[g].match(f[g])){return d.apply(this,arguments)}}return this._queueCall(a,arguments,e)}}};StateDrive.prototype._queueCall=function(a,b,c){this._callQueue[c]=this._callQueue[c]||[];this._callQueue[c].push({name:a,args:b})};StateDrive.prototype._executeQueuedCalls=function(){var a,b;for(a=0;a<=this._state;++a){if(this._callQueue[a]){for(b=0;b<this._callQueue[a].length;++b){this[this._callQueue[a][b].name].apply(this,this._callQueue[a][b].args)}this._callQueue[a]=[]}}};var Channel=function(a,b){StateDrive.call(this);this.localNode=a;this.remoteNode=b};Channel.prototype=new StateDrive;Channel.prototype.open=function(){};Channel.prototype.close=function(){};Channel.prototype.send=function(a){return false};Channel.STATE={CLOSED:1,OPENING:2,OPEN:3};var SocketChannel=function(a,b){Channel.call(this,a,b);this.setState(Channel.STATE.CLOSED);this.setMinCallState("send",Channel.STATE.OPEN);this.setMinCallState("close",Channel.STATE.OPEN);this.multiplexer=SocketMultiplexer.get(a.mesh)};SocketChannel.prototype=new Channel;SocketChannel.prototype.open=function(){this.multiplexer.register(this);this.multiplexer.open()};SocketChannel.prototype.close=function(){this.multiplexer.close(this)};SocketChannel.prototype.send=function(a){this.multiplexer.send(this,a)};var RTCPeerConnection=null;var getUserMedia=null;var attachMediaStream=null;var reattachMediaStream=null;var webrtcDetectedBrowser=null;var webrtcDetectedVersion=null;function trace(a){if(a[a.length-1]=="\n"){a=a.substring(0,a.length-1)}console.log((performance.now()/1e3).toFixed(3)+": "+a)}if(navigator.mozGetUserMedia){console.log("This appears to be Firefox");webrtcDetectedBrowser="firefox";webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]);try{RTCPeerConnection=mozRTCPeerConnection;RTCSessionDescription=mozRTCSessionDescription;RTCIceCandidate=mozRTCIceCandidate;getUserMedia=navigator.mozGetUserMedia.bind(navigator);createIceServer=function(a,b,c){var d=null;var e=a.split(":");if(e[0].indexOf("stun")===0){d={url:a}}else if(e[0].indexOf("turn")===0&&(a.indexOf("transport=udp")!==-1||a.indexOf("?transport")===-1)){var f=a.split("?");d={url:f[0],credential:c,username:b}}return d};attachMediaStream=function(a,b){console.log("Attaching media stream");a.mozSrcObject=b;a.play()};reattachMediaStream=function(a,b){console.log("Reattaching media stream");a.mozSrcObject=b.mozSrcObject;a.play()};MediaStream.prototype.getVideoTracks=function(){return[]};MediaStream.prototype.getAudioTracks=function(){return[]}}catch(e){console.warn("RTCChannel Error: "+e)}}else if(navigator.webkitGetUserMedia){console.log("This appears to be Chrome");webrtcDetectedBrowser="chrome";webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2]);createIceServer=function(a,b,c){var d=null;var e=a.split(":");if(e[0].indexOf("stun")===0){d={url:a}}else if(e[0].indexOf("turn")===0){if(webrtcDetectedVersion<28){var f=a.split("turn:");d={url:"turn:"+b+"@"+f[1],credential:c}}else{d={url:a,credential:c,username:b}}}return d};RTCPeerConnection=webkitRTCPeerConnection;getUserMedia=navigator.webkitGetUserMedia.bind(navigator);attachMediaStream=function(a,b){if(typeof a.srcObject!=="undefined"){a.srcObject=b}else if(typeof a.mozSrcObject!=="undefined"){a.mozSrcObject=b}else if(typeof a.src!=="undefined"){a.src=URL.createObjectURL(b)}else{console.log("Error attaching stream to element.")}};reattachMediaStream=function(a,b){a.src=b.src};if(!webkitMediaStream.prototype.getVideoTracks){webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks};webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}}if(!webkitRTCPeerConnection.prototype.getLocalStreams){webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams};webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams}}}else{console.log("Browser does not appear to be WebRTC-capable")}var DATA_CHANNEL_CONFIG={optional:[{RtpDataChannels:true},{DtlsSrtpKeyAgreement:true}]};var DATA_CHANNEL_SUPPORTED=function(){try{var a=new RTCPeerConnection({iceServers:[]},DATA_CHANNEL_CONFIG);var b=a.createDataChannel("supportCheck",{reliable:false});b.close();return true}catch(c){return false}}();var BANDWIDTH=64;var RTCChannelUtils={defaultIceServers:function(a){var b=[];if(navigator.mozGetUserMedia){b.push(createIceServer("stun:23.21.150.121"))}else{var c=a.localNode.mesh.options;if(c.turn){b.push(createIceServer(c.turn,c.username,c.password))}b.push(createIceServer("stun:stun.l.google.com:19302"))}return b},highBandwidth:function(a,b){b=b||BANDWIDTH;a=a.replace("b=AS:30","b=AS:"+b);return a},preferOpus:function(a){var b=a.split("\r\n"),c,d;for(d=0;d<b.length;d++){if(b[d].search("m=audio")!==-1){c=d;break}}if(c===null){return a}for(d=0;d<b.length;d++){if(b[d].search("opus/48000")!==-1){var e=RTCChannelUtils.extractSdp(b[d],/:(\d+) opus\/48000/i);if(e){b[c]=RTCChannelUtils.setDefaultCodec(b[c],e)}break}}b=RTCChannelUtils.removeCN(b,c);a=b.join("\r\n");return a},extractSdp:function(a,b){var c=a.match(b);return c&&c.length==2?c[1]:null},setDefaultCodec:function(a,b){var c=a.split(" ");var d=[];var e=0;for(var f=0;f<c.length;f++){if(e===3){d[e++]=b}if(c[f]!==b){d[e++]=c[f]}}return d.join(" ")},removeCN:function(a,b){var c=a[b].split(" ");for(var d=a.length-1;d>=0;d--){var e=RTCChannelUtils.extractSdp(a[d],/a=rtpmap:(\d+) CN\/\d+/i);if(e){var f=c.indexOf(e);if(f!==-1){c.splice(f,1)}a.splice(d,1)}}a[b]=c.join(" ");return a},createPeerConnection:function(a){var b=new RTCPeerConnection({iceServers:RTCChannelUtils.defaultIceServers(a)},DATA_CHANNEL_CONFIG);a.pc=b;b.onicecandidate=function(b){if(b.candidate){a.remoteNode._trigger("rtc_iceCandidate",b.candidate)}};b.onconnecting=function(a){console.log("onConnecting",a)};b.onopen=function(a){console.log("onOpen",a)};b.onaddstream=function(a){console.log("add stream",a)};b.ondatachannel=function(a){console.log("add data channel???",a)}},sendOffer:function(a){a.pc.createOffer(function(b){b.sdp=RTCChannelUtils.preferOpus(b.sdp);b.sdp=RTCChannelUtils.highBandwidth(b.sdp);a.pc.setLocalDescription(b);a.remoteNode._trigger("rtc_offer",b)},function(){console.log("createOffer error")})},sendAnswer:function(a){a.pc.createAnswer(function(b){b.sdp=RTCChannelUtils.preferOpus(b.sdp);b.sdp=RTCChannelUtils.highBandwidth(b.sdp);a.pc.setLocalDescription(b);a.remoteNode._trigger("rtc_answer",b)})},bind:function(a){a.remoteNode.bind("rtc_iceCandidate",function(b){var c=new RTCIceCandidate(b);a.pc.addIceCandidate(c)});a.remoteNode.bind("rtc_answer",function(b){a.pc.setRemoteDescription(new RTCSessionDescription(b))});a.remoteNode.bind("rtc_offer",function(b){a.pc.setRemoteDescription(new RTCSessionDescription(b));RTCChannelUtils.sendAnswer(a)})},addStream:function(a){},createDataChannel:function(a){var b="mesh";var c={reliable:false};var d;try{d=a.pc.createDataChannel(b,c)}catch(e){console.log("seems that DataChannel is NOT actually supported!");throw e}return RTCChannelUtils.addDataChannel(a,d)},addDataChannel:function(a,b){a.dataChannel=b;b.onopen=function(c){a.setState(Channel.STATE.OPEN);a.trigger("open",{timestamp:c.timestamp,data:["open",b]})};b.onclose=function(c){a.trigger("close",{timestamp:c.timestamp,data:["close",b]})};b.onmessage=function(b){var c;try{c=JSON.parse(b.data)}catch(b){console.log("Error parsing ",b.data)}a.trigger("message",{timestamp:b.timestamp,data:c})};return b}};var RTCChannel=function(a,b){Channel.call(this,a,b);this.setState(Channel.STATE.CLOSED);this.setMinCallState("send",Channel.STATE.OPEN);this.setMinCallState("close",Channel.STATE.OPEN)};RTCChannel.prototype=new Channel;RTCChannel.prototype.open=function(){if(this.localNode===this.remoteNode){return}if(RTCPeerConnection){RTCChannelUtils.bind(this);RTCChannelUtils.createPeerConnection(this);RTCChannelUtils.addStream(this);RTCChannelUtils.createDataChannel(this);if(this.remoteNode.initiator){RTCChannelUtils.sendOffer(this)}}};RTCChannel.prototype.close=function(){};RTCChannel.prototype.send=function(a){if(this.getState()===Channel.STATE.OPEN){this.dataChannel.send(a);return true}return false};var SocketMultiplexer=function(a){StateDrive.call(this);this.mesh=a;this.setState(Channel.STATE.CLOSED);this.setMinCallState("send",Channel.STATE.OPEN);this.channels={}};SocketMultiplexer._byMesh={};SocketMultiplexer.get=function(a){var b=SocketMultiplexer._byMesh[a];if(!b){b=new SocketMultiplexer(a);SocketMultiplexer._byMesh[a]=b}return b};SocketMultiplexer.prototype=new StateDrive;SocketMultiplexer.prototype.register=function(a){if(this.channels[a.remoteNode.id]===undefined){this.channels[a.remoteNode.id]=a;var b=this.getState();a.setState(b);if(b===Channel.STATE.OPEN){a.trigger("open",{timestamp:Date.now(),data:["open"]})}}};SocketMultiplexer.prototype.unregister=function(a){delete this.channels[a.remoteNode.id];a.setState(Channel.STATE.CLOSED)};SocketMultiplexer.prototype.open=function(a){if(this.getState()!==Channel.STATE.CLOSED){return}this.setState(Channel.STATE.OPENING);var b=this;var c=b.socket=new WebSocket(this.mesh.options.ws);c.addEventListener("open",function(a){b.setState(Channel.STATE.OPEN);for(var c in b.channels){var d=b.channels[c];d.setState(Channel.STATE.OPEN);d.trigger("open",{timestamp:Date.now(),data:["open"]})}},false);c.addEventListener("message",function(a){var c;try{c=JSON.parse(a.data)}catch(d){throw new Error("Invalid container received",c)}var e=c[0];var f=c[1];var g;try{g=JSON.parse(c[2])}catch(d){throw new Error("Invalid data received",g)}if(g[0]==="connect"){var h=b.channels[null];h.localNode.id=e;delete b.channels[null];b.channels[e]=h}var i=b.channels[e];if(i){i.trigger("message",{from:i.remoteNode.id,timestamp:f,data:g})}else{}},false);c.addEventListener("close",function(){b.setState(Channel.STATE.CLOSED);for(var a in b.channels){var c=b.channels[a];c.setState(Channel.STATE.CLOSED);c.trigger("close",{from:c.remoteNode.id,timestamp:Date.now(),data:["close"]})}},false);c.addEventListener("error",function(){b.setState(Channel.STATE.CLOSED);for(var a in b.channels){var c=b.channels[a];c.setState(Channel.STATE.CLOSED);c.trigger("error",{from:c.remoteNode.id,timestamp:Date.now(),data:["error"]})}},false)};SocketMultiplexer.prototype.close=function(a){this.unregister(a);if(a.remoteNode===a.localNode.mesh.self){this.setState(Channel.STATE.CLOSED);this.socket.close()}};var debounce=function(a,b,c){var d;var e=null;return function(){var f=this,g=arguments;var h=function(){e=null;if(!c)d=a.apply(f,g)};var i=c&&!e;clearTimeout(e);e=setTimeout(h,b);if(i)d=a.apply(f,g);return d}};SocketMultiplexer._send=debounce(function(){});SocketMultiplexer.prototype.send=function(a,b){var c=JSON.stringify([[a.remoteNode.id],b]);return this.socket.send(c)};var ChannelChannel=function(a,b){Channel.call(this,a,b);this.setState(Channel.STATE.CLOSED);this.setMinCallState("send",Channel.STATE.OPEN);this.setMinCallState("close",Channel.STATE.OPEN);this.multiplexer=ChannelMultiplexer.get(a.mesh)};ChannelChannel.prototype=new Channel;ChannelChannel.prototype.open=function(){this.multiplexer.register(this);this.multiplexer.open()};ChannelChannel.prototype.close=function(){this.multiplexer.close(this)};ChannelChannel.prototype.send=function(a){this.multiplexer.send(this,a)};var ChannelMultiplexer=function(a){StateDrive.call(this);this.mesh=a;this.setState(Channel.STATE.CLOSED);this.setMinCallState("send",Channel.STATE.OPEN);this.channels={}};ChannelMultiplexer._byMesh={};ChannelMultiplexer.get=function(a){var b=ChannelMultiplexer._byMesh[a];if(!b){b=new ChannelMultiplexer(a);ChannelMultiplexer._byMesh[a]=b}return b};ChannelMultiplexer.prototype=new StateDrive;ChannelMultiplexer.prototype.register=function(a){if(this.channels[a.remoteNode.id]===undefined){this.channels[a.remoteNode.id]=a;var b=this.getState();a.setState(b);if(b===Channel.STATE.OPEN){a.trigger("open",{timestamp:Date.now(),data:["open"]})}}};ChannelMultiplexer.prototype.unregister=function(a){delete this.channels[a.remoteNode.id];a.setState(Channel.STATE.CLOSED)};ChannelMultiplexer.prototype.open=function(a){if(this.getState()!==Channel.STATE.CLOSED){return}this.setState(Channel.STATE.OPENING);var b=this;var c=document.createElement("script");c.src="/_ah/channel/jsapi";document.body.appendChild(c);c.onload=function(){http.GET("/api/channel/"+b.mesh.id,function(a){var c=new goog.appengine.Channel(a.token);var d=b.socket=c.open();d.onopen=function(a){b.setState(Channel.STATE.OPEN);for(var c in b.channels){var d=b.channels[c];d.setState(Channel.STATE.OPEN);d.trigger("open",{timestamp:Date.now(),data:["open"]})}};d.onmessage=function(a){var c;try{c=JSON.parse(a.data)}catch(d){throw new Error("Invalid container received",c)}var e=c[0];var f=c[1];var g;try{g=JSON.parse(c[2])}catch(d){throw new Error("Invalid data received",g)}if(g[0]==="connect"){var h=b.channels[null];if(h){h.localNode.id=e;delete b.channels[null];b.channels[e]=h}else{console.warn("Connection already defined for",e)}if(b.channels[e]==undefined){console.warn("Channel for",e,"not defined.")}}var i=b.channels[e];if(i){i.trigger("message",{from:i.remoteNode.id,timestamp:f,data:g})}else{}};d.onclose=function(){console.log("my channel was closed !!! :(");b.setState(Channel.STATE.CLOSED);for(var a in b.channels){var c=b.channels[a];c.setState(Channel.STATE.CLOSED);c.trigger("close",{from:fromChannel.remoteNode.id,timestamp:Date.now(),data:["close"]})}};d.onerror=function(){b.setState(Channel.STATE.CLOSED);for(var a in b.channels){var c=b.channels[a];c.setState(Channel.STATE.CLOSED);c.trigger("error",{from:fromChannel.remoteNode.id,timestamp:Date.now(),data:["error"]})}}},function(){console.log("Error opening channel.");console.log.apply(console,arguments)})}};ChannelMultiplexer.prototype.close=function(a){this.unregister(a);if(a.remoteNode===a.localNode.mesh.self){this.setState(Channel.STATE.CLOSED);this.socket.close()}};ChannelMultiplexer.prototype.send=function(a,b){var c=[[a.remoteNode.id],b];http.POST("/api/channel/"+this.mesh.id+"/"+this.mesh.self.id,c,function(){});return true};var Peers=function(){Array.call(this);StateDrive.call(this);this.setState(Node.STATE.DISCONNECTED);this.setMinCallState("bind",Node.STATE.CONNECTED);this.setMinCallState("unbind",Node.STATE.CONNECTED);this.setMinCallState("trigger",Node.STATE.CONNECTED)};Peers.prototype=[];for(var k in StateDrive.prototype){Peers.prototype[k]=StateDrive.prototype[k]}Peers.prototype.bind=function(){EventDispatcher.prototype.bind.apply(this,arguments);this._bind.apply(this,arguments)};Peers.prototype._bind=function(){var a=arguments;this.forEach(function(b){b._bind.apply(b,a)})};Peers.prototype.unbind=function(){EventDispatcher.prototype.unbind.apply(this,arguments);this._unbind.apply(this,arguments)};Peers.prototype._unbind=function(){var a=arguments;this.forEach(function(b){b._unbind.apply(b,a)})};Peers.prototype.trigger=function(){var a=arguments;this.forEach(function(b){b.trigger.apply(b,a)})};Peers.prototype.getById=function(a){return this.filter(function(b){return b.id===a})[0]};var NodeUtils={PROTECTED_EVENTS:["open","close","error","connect","enter","leave","bind","unbind"],uidSeed:1,remoteBindsByNodeIds:{},send:function(a,b){var c=a._channels.filter(function(a){return a.getState()===Channel.STATE.OPEN})[0];if(c){c.send(b)}else{console.warn("There is no open send channel.")}},acknowledgeRemoteBind:function(a,b){NodeUtils.remoteBindsByNodeIds[a]=NodeUtils.remoteBindsByNodeIds[a]||[];if(NodeUtils.remoteBindsByNodeIds[a].indexOf(b)===-1){NodeUtils.remoteBindsByNodeIds[a].push(b)}},acknowledgeRemoteUnbind:function(a,b){var c;if(NodeUtils.remoteBindsByNodeIds[a]&&(c=NodeUtils.remoteBindsByNodeIds[a].indexOf(b))){NodeUtils.remoteBindsByNodeIds[a].splice(c,1)}},doesRemoteBindTo:function(a,b){var c=NodeUtils.remoteBindsByNodeIds[a];if(c===undefined){return true}return c&&NodeUtils.remoteBindsByNodeIds[a].indexOf(b)!==-1}};var Node=function(a,b,c){StateDrive.call(this);var d=NodeUtils.uidSeed++;this.__defineGetter__("uid",function(){return d});this.mesh=a;this.id=b;this._channels=[];this._signalingChannel=null;this._remotelyBoundTypes={};this.__defineGetter__("initiator",function(){return c});this.setState(Node.STATE.DISCONNECTED);this.setMinCallState("connect",Node.STATE.DISCONNECTED);this.setMinCallState("disconnect",Node.STATE.CONNECTED);this.setMinCallState("bind",Node.STATE.CONNECTED);this.setMinCallState("unbind",Node.STATE.CONNECTED);this.setMinCallState("_bind",Node.STATE.CONNECTED);this.setMinCallState("_unbind",Node.STATE.CONNECTED);this.setMinCallState("trigger",Node.STATE.CONNECTED)};Node.prototype=new StateDrive;Node.prototype.toString=function(){return"Node@"+this.uid};Node.prototype.connect=function(a){var b=this;var c=this.getState();if(c===Node.STATE.CONNECTING||c===Node.STATE.CONNECTED){return}b.setState(Node.STATE.CONNECTING);if(this.mesh.options.ws){this._signalingChannel=new SocketChannel(this.mesh.self,this)}else{this._signalingChannel=new ChannelChannel(this.mesh.self,this)}if(b!==b.mesh.self&&b.mesh.options.useWebRTC){this._channels.push(new RTCChannel(this.mesh.self,this))}this._channels.push(this._signalingChannel);var d=function(a){var c=b.preprocessIncoming(a.data);EventDispatcher.prototype.trigger.apply(b,c);if(b!==b.mesh.self){EventDispatcher.prototype.trigger.apply(b.mesh.peers,c)}EventDispatcher.prototype.trigger.apply(b.mesh,c)};this._channels.forEach(function(a){["open","message","error","close"].forEach(function(b){a.bind(b,d)})});this._signalingChannel.bind("open",function(a){if(b!=b.mesh.self){var c=Object.keys(b.mesh._handlers);var d=Object.keys(b.mesh.peers._handlers);d.forEach(function(a){if(c.indexOf(a)===-1){c.push(a)}});c.forEach(function(a){b._bind(a)});b._channels.forEach(function(a){a.open()})}b.setState(Node.STATE.CONNECTED)});this._signalingChannel.open()};Node.prototype.disconnect=function(){this._channels.forEach(function(a){a.unbind("message");a.close()})};Node.prototype.bind=function(a,b){EventDispatcher.prototype.bind.apply(this,arguments);this._bind.apply(this,arguments)};Node.prototype._bind=function(a,b){if(this!==this.mesh.self){if(NodeUtils.PROTECTED_EVENTS.indexOf(a)===-1){var c=this._remotelyBoundTypes[a];if(!c){this._remotelyBoundTypes[a]=0;NodeUtils.send(this,'["bind","'+a+'"]')}this._remotelyBoundTypes[a]+=1}}};Node.prototype.unbind=function(a,b){EventDispatcher.prototype.unbind.apply(this,arguments);this._unbind.apply(this,arguments)};Node.prototype._unbind=function(a,b){if(this!==this.mesh.self){if(NodeUtils.PROTECTED_EVENTS.indexOf(a)===-1){this._remotelyBoundTypes[a]-=1;var c=this._remotelyBoundTypes[a];if(c===0){NodeUtils.send(this,'["unbind","'+a+'"]')}}}};Node.prototype.trigger=function(a,b){if(this===this.mesh.self){EventDispatcher.prototype.trigger.apply(this,arguments);EventDispatcher.prototype.trigger.apply(this.mesh,arguments);return}if(!NodeUtils.doesRemoteBindTo(this.id,a)){return}this._trigger.apply(this,arguments)};Node.prototype._trigger=function(a,b){var c;try{var d=this.preprocessOutgoing.apply(this,arguments);c=JSON.stringify(Array.prototype.slice.apply(d));if(c==="null"){return}}catch(e){throw new Error("Trigger not serializable")}NodeUtils.send(this,c)};Node.prototype.preprocessIncoming=function(a){var b=a[0],c=[],d,e;switch(b){case"connect":c.push(b);for(e=1;e<a.length;++e){d=new Node(this.mesh,a[e],true);c.push(d);this.mesh.peers.push(d);if(this.mesh.options.autoPeerConnect){d.connect()}}if(this!=this.mesh.self){console.warn('Expected "connect" triggered only on self node.')}this.mesh.peers.setState(Node.STATE.CONNECTED);this.mesh.setState(Node.STATE.CONNECTED);break;case"enter":c.push(b);for(e=1;e<a.length;++e){d=new Node(this.mesh,a[e],false);c.push(d);this.mesh.peers.push(d);if(this.mesh.options.autoPeerConnect){d.connect()}}break;case"leave":c.push(b);for(e=1;e<a.length;++e){d=this.mesh.peers.getById(a[e]);if(d){c.push(d);this.mesh.peers.splice(this.mesh.peers.indexOf(d),1);d.disconnect()}else{console.warn("Node",a[e],"leave event but not in peers.")}}break;case"bind":NodeUtils.acknowledgeRemoteBind(this.id,a[1]);c=a;break;case"unbind":NodeUtils.acknowledgeRemoteUnbind(this.id,a[1]);c=a;break;default:c=a;break}return c};Node.prototype.preprocessOutgoing=function(a,b){if(NodeUtils.PROTECTED_EVENTS.indexOf(a)===-1){return arguments}else{throw new Error("Event type "+a+" protected")}};Node.STATE={DISCONNECTED:1,CONNECTING:2,CONNECTED:3};var MeshUtils={uidSeed:1};var Mesh=function(a,b){var c=this;StateDrive.call(this);if(a&&typeof a!=="string"){throw new Error("Invalid type ID")}var d=MeshUtils.uidSeed++;this.__defineGetter__("uid",function(){return d});this.id=a;this.self=new Node(this,null);this.peers=new Peers;this.options={};this.config(b);this.setState(Node.STATE.DISCONNECTED);this.setMinCallState("connect",Node.STATE.DISCONNECTED);this.setMinCallState("bind",Node.STATE.CONNECTED);this.setMinCallState("unbind",Node.STATE.CONNECTED);this.setMinCallState("trigger",Node.STATE.CONNECTED);if(this.options.autoConnect){c.connect()}};Mesh.prototype=new StateDrive;
Mesh.prototype.toString=function(){return"Mesh@"+this.uid};Mesh.prototype.config=function(a){var b;for(b in Mesh.options){this.options[b]=this.options[b]===undefined?Mesh.options[b]:this.options[b]}if(typeof a==="string"){this.options.api=a}else if(typeof a==="object"){for(b in a){this.options[b]=a[b]}}};Mesh.prototype.connect=function(){var a=this,b,c;if(this.options.ws){c=this.options.ws.match("[^/]+$");if(c){this.id=c[0]}this.self.connect();this.peers.forEach(function(a){a.connect()})}else if(this.options.channel){this.id=this.options.name;this.self.connect();this.peers.forEach(function(a){a.connect()})}else if(this.options.api){http.GET(this.options.api+"/"+(this.id||""),function(b){a.config(b);a.connect()},function(){console.warn("Error connecting to server, retrying in 10 seconds.");setTimeout(function(){a.connect()},10*1e3)})}else{throw new Error("Invalid options")}};Mesh.prototype.disconnect=function(){this.self.disconnect();this.peers.forEach(function(a){a.disconnect()})};Mesh.prototype.bind=function(a,b){EventDispatcher.prototype.bind.apply(this,arguments);this.peers._bind.apply(this.peers,arguments)};Mesh.prototype.unbind=function(a,b){EventDispatcher.prototype.unbind.apply(this,arguments);this.peers._unbind.apply(this.peers,arguments)};Mesh.prototype.trigger=function(a,b){this.self.trigger.apply(this.self,arguments);this.peers.trigger.apply(this.peers,arguments)};Mesh.options={api:"/api/mesh",autoConnect:true,autoPeerConnect:true,useWebRTC:true};var samples=[],clockDelta=0;var now;if(window.performance&&performance.now){now=function(){return performance.timing.navigationStart+performance.now()}}else{now=function(){return+new Date}}var nowsync=function(){return now()-clockDelta};var createSyncData=function(){return{clientLocalTime:now()}};var handleSyncResponse=function(a){var b=now();if(typeof a==="string"){a=JSON.parse(a)}a.receiveTime=b;a.latency=(a.receiveTime-a.clientLocalTime)*.5;a.clockDelta=a.receiveTime-a.serverLocalTime-a.latency;updateSync(a)};var updateSync=function(a){clockDelta=a.clockDelta;pushSample(a);if(samples.length<9){return setTimeout(clocksync.syncMethod,100)}completeSync()};var completeSync=function(){var a=filterSamples(samples);clockDelta=getAverageClockDelta(a);if(clocksync.callback){clocksync.callback(nowsync(),clockDelta)}};var pushSample=function(a){var b,c=samples.length;for(b=0;b<c;b++){if(a.latency<samples[b].latency){samples.splice(b,0,a);return}}samples.push(a)};var calcMedian=function(a){var b=Math.floor(a.length/2);if(a.length%2){return a[b]}else{return(a[b-1]+a[b])/2}};var filterSamples=function(a){var b=[],c,d,e=a.length,f=getStandardDeviation(a),g=calcMedian(a);for(c=0;c<e;c++){d=a[c].latency;if(d>g.latency-f&&d<g.latency+f){b.push(a[c])}}return b};var getAverageClockDelta=function(a){var b=a.length,c=0;while(b--){c+=a[b].clockDelta}return c/a.length};var isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"},getNumWithSetDec=function(a,b){var c=Math.pow(10,b||0);return b?Math.round(c*a)/c:a},getAverageFromNumArr=function(a,b){if(!isArray(a)){return false}var c=a.length,d=0;while(c--){d+=a[c].latency}return getNumWithSetDec(d/a.length,b)},getVariance=function(a,b){if(!isArray(a)){return false}var c=getAverageFromNumArr(a,b),d=a.length,e=0;while(d--){e+=Math.pow(a[d].latency-c,2)}e/=a.length;return getNumWithSetDec(e,b)},getStandardDeviation=function(a,b){if(!isArray(a)){return false}var c=Math.sqrt(getVariance(a,b));return getNumWithSetDec(c,b)};var ajaxSyncMethod=function(){var a=new XMLHttpRequest;a.open("HEAD","/api/clocksync",false);var b=Date.now();a.onreadystatechange=function(c){if(a.readyState===a.DONE){var d=parseFloat(a.getResponseHeader("Last-Modified"));clocksync.syncResponse({clientLocalTime:b,serverLocalTime:d})}};a.send()};var clocksync={delta:clockDelta,time:nowsync,sync:function(a){this.callback=a;this.syncMethod()},syncMethod:ajaxSyncMethod,data:createSyncData,syncResponse:handleSyncResponse};this["Handlebars"]=this["Handlebars"]||{};this["Handlebars"]["templates"]=this["Handlebars"]["templates"]||{};this["Handlebars"]["templates"]["AboutView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="background"></div>\n<div class="page">\n    <div class="scroll">\n        <div class="content">\n\n            <section class="column left">\n\n                <div class="logo">\n                    <button><div class="asset logo-about"></div></button>\n                    <aside class="separator">-</aside>\n                    <p class="title"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"AboutView.title",h):i.call(b,"t","AboutView.title",h)))+'</bdo></p>\n                </div>\n\n                <article>\n                    <div class="video"><div id="ytPlayer_about"></div></div>\n                    <p class="body"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"AboutView.article1.body",h):i.call(b,"t","AboutView.article1.body",h)))+'</bdo></p>\n                    <div class="video"><div id="ytPlayer_about2"></div></div>\n\n                    <div class="photo">\n                      <a href="/img/about/download/justareflektor_arcadefire.jpg" target="_blank">\n                        <img src="/img/about/justareflektor_arcadefire.jpg" width="100%" />\n                      </a>\n                      <a href="/img/about/download/justareflektor_arcadefire_1.jpg" target="_blank">\n                        <img src="/img/about/justareflektor_arcadefire_1.jpg" width="100%" />\n                      </a>\n                      <a href="/img/about/download/justareflektor_arcadefire_2.jpg" target="_blank">\n                        <img src="/img/about/justareflektor_arcadefire_2.jpg" width="100%" />\n                      </a>\n                      <a href="/img/about/download/justareflektor_arcadefire_3.jpg" target="_blank">\n                        <img src="/img/about/justareflektor_arcadefire_3.jpg" width="100%" />\n                      </a>\n                      <a href="/img/about/download/justareflektor_arcadefire_4.jpg" target="_blank">\n                        <img src="/img/about/justareflektor_arcadefire_4.jpg" width="100%" />\n                      </a>\n                      <a href="/img/about/download/justareflektor_arcadefire_5.jpg" target="_blank">\n                        <img src="/img/about/justareflektor_arcadefire_5.jpg" width="100%" />\n                      </a>\n                      \n                    </div>\n                </article>\n\n            </section>\n\n            <section class="column right">\n\n                <p class="title"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"AboutView.creditsTitle",h):i.call(b,"t","AboutView.creditsTitle",h)))+'</bdo></p>\n\n                <p class="separator">-</p>\n\n                <p>Written, Directed and Produced by Vincent&nbsp;Morisset</p>\n                <p>Music by Arcade Fire</p>\n                <p>Creative Direction by Vincent&nbsp;Morisset and Aaron&nbsp;Koblin</p>\n                \n                <header>Starring:</header>\n                <div class="entry"><p class="role">Heroine</p><p class="separator">-</p><p class="name">Axelle ‘Ebony’ Munezero</p></div>\n                <div class="entry"><p class="role">Verite</p><p class="separator">-</p><p class="name">Maurice Gilles</p></div>\n                <div class="entry"><p class="role">Lanmè</p><p class="separator">-</p><p class="name">Bybiane Hyppolite</p></div>\n                <div class="entry"><p class="role">Reflektè</p><p class="separator">-</p><p class="name">Charlemagne Fritzner</p></div>\n                <div class="entry"><p class="role">Zonbis</p><p class="separator">-</p><p class="name">Varnessa Alcan, Ricardo Tiberice, Dorcas Jean Louis, Bellgarde MacKendy, Augusutin A. Mentor, Jayes Yves Rotty, Viergeline Jean, Genlittin Guillaume</p></div>\n                <div class="entry"><p class="role">Rara Group</p><p class="separator">-</p><p class="name">Rara Tesser Esprit</p></div>\n\n                <header>Produced by:</header>\n	            <header>AATOAA</header>\n                <div class="entry"><p class="role">Lead Creative Developer</p><p class="separator">-</p><p class="name">Édouard Lanctôt-Benoit</p></div>\n                <div class="entry"><p class="role">Artistic Direction</p><p class="separator">-</p><p class="name">Caroline Robert</p></div>\n                <div class="entry"><p class="role">Visual Effects</p><p class="separator">-</p><p class="name">Brandon Blommaert</p></div>\n\n                <header>Google Creative Lab</header>\n                <div class="entry"><p class="role">Creative Director</p><p class="separator">-</p><p class="name">Aaron Koblin</p></div>\n                <div class="entry"><p class="role">Technologist</p><p class="separator">-</p><p class="name">Doug Fritz</p></div>\n                <div class="entry"><p class="role">Technologist</p><p class="separator">-</p><p class="name">Jono Bandel</p></div>\n                <div class="entry"><p class="role">Technologist</p><p class="separator">-</p><p class="name">Aleksandar Rodic</p></div>\n                <div class="entry"><p class="role">Technologist</p><p class="separator">-</p><p class="name">Mr.doob</p></div>\n                <div class="entry"><p class="role">Producer</p><p class="separator">-</p><p class="name">Sabah Kosoy</p></div>\n                <div class="entry"><p class="role">Producer</p><p class="separator">-</p><p class="name">Valdean Klump</p></div>\n                <div class="entry"><p class="role">Marketing Manager</p><p class="separator">-</p><p class="name">Jenny Ramaswamy</p></div>\n                <div class="entry"><p class="role">Marketing Manager</p><p class="separator">-</p><p class="name">Clem Wright</p></div>\n\n                <header>Unit9</header>\n                <div class="entry"><p class="role">Interactive Producer</p><p class="separator">-</p><p class="name">Amelia Roberts</p></div>\n                <div class="entry"><p class="role">Lead Developer</p><p class="separator">-</p><p class="name">Maciej Zasada</p></div>\n                <div class="entry"><p class="role">Developer</p><p class="separator">-</p><p class="name">Fábio Azevedo</p></div>\n\n                <header>Antler Films</header>\n                <div class="entry"><p class="role">Producer</p><p class="separator">-</p><p class="name">Sach Baylin-Stern</p></div>\n                <div class="entry"><p class="role">Director</p><p class="separator">-</p><p class="name">Vincent Morisset</p></div>\n                <div class="entry"><p class="role">DOP</p><p class="separator">-</p><p class="name">Mathieu Laverdière</p></div>\n                <div class="entry"><p class="role">Costume Designer</p><p class="separator">-</p><p class="name">Renata Morales</p></div>\n                <div class="entry"><p class="role">Choreography</p><p class="separator">-</p><p class="name">Axelle ‘Ebony’ Munezero</p></div>\n                <div class="entry"><p class="role">Editor</p><p class="separator">-</p><p class="name">Nicolas Roy</p></div>\n                \n                <header>Jacmel, Haiti</header>\n                <div class="entry"><p class="role">Line Production</p><p class="separator">-</p><p class="name">Cine-Institute Jacmel</p></div>\n                <div class="entry"><p class="role">Line Producer</p><p class="separator">-</p><p class="name">Andrew Bigosinski</p></div>\n                <div class="entry"><p class="role">Production Manager</p><p class="separator">-</p><p class="name">Frero Pierre</p></div>\n                <div class="entry"><p class="role">Casting / Locations</p><p class="separator">-</p><p class="name">Ilrique Foukifoura Perin</p></div>\n                <div class="entry"><p class="role">Production Assistant</p><p class="separator">-</p><p class="name">Cesar Jean Rony</p></div>\n                <div class="entry"><p class="role">Production Assistant</p><p class="separator">-</p><p class="name">Macdala Prevot</p></div>\n                <div class="entry"><p class="role">1st Camera Assistant / Key Grip</p><p class="separator">-</p><p class="name">Belony Saint Pierre</p></div>\n                <div class="entry"><p class="role">2nd Camera Assistant</p><p class="separator">-</p><p class="name">Djuny Guillaume</p></div>\n                <div class="entry"><p class="role">Video Technician</p><p class="separator">-</p><p class="name">Manase Fortune</p></div>\n                <div class="entry"><p class="role">Playback Technician</p><p class="separator">-</p><p class="name">Guy Marie Jean Louis</p></div>\n                <div class="entry"><p class="role">Make-Up</p><p class="separator">-</p><p class="name">Marie Merci Andris</p></div>\n                <div class="entry"><p class="role">Additional Footage</p><p class="separator">-</p><p class="name">Ian Lagarde, Andy Mitchell, Dave Adams, Jon Bougher</p></div>\n                                          \n                <header>Montréal, Canada</header>\n                <div class="entry"><p class="role">Seamstress</p><p class="separator">-</p><p class="name">Ana Luisa Rodriguez</p></div>\n                <div class="entry"><p class="role">Hair Stylist</p><p class="separator">-</p><p class="name">Esperence Umubyeyi</p></div>\n                <div class="entry"><p class="role">1st AC</p><p class="separator">-</p><p class="name">Guillaume Sabourin</p></div>\n                <div class="entry"><p class="role">Key Electrician</p><p class="separator">-</p><p class="name">Alexis Vallée Charest</p></div>\n                <div class="entry"><p class="role">Key Grip</p><p class="separator">-</p><p class="name">Mathieu Émond</p></div>\n                <div class="entry"><p class="role">Studio Propsmaster</p><p class="separator">-</p><p class="name">Guillaume Bédard</p></div>\n                <div class="entry"><p class="role">Video Technician</p><p class="separator">-</p><p class="name">Mariane Laporte</p></div>\n                <div class="entry"><p class="role">Studio Manager</p><p class="separator">-</p><p class="name">Hugues Lavoie</p></div>\n                <div class="entry"><p class="role">Production Assistant</p><p class="separator">-</p><p class="name">Cody Larocque</p></div>\n                <div class="entry"><p class="role">Production Assistant</p><p class="separator">-</p><p class="name">Laurent Peyre</p></div>\n                <div class="entry"><p class="role">Wardrobe Assistant</p><p class="separator">-</p><p class="name">Charlotte Eedson</p></div>\n\n                <header>Post Production</header>\n                <div class="entry"><p class="role">Sound editing</p><p class="separator">-</p><p class="name">Mark Lawson</p></div>\n                <div class="entry"><p class="role">Assistant Editor</p><p class="separator">-</p><p class="name">Véronique Barbe</p></div>\n                <div class="entry"><p class="role">Digital Compositing</p><p class="separator">-</p><p class="name">Sylvain Lebeau</p></div>\n                <div class="entry"><p class="role">Digital Compositing</p><p class="separator">-</p><p class="name">Nicolas Pellicelli</p></div>\n                <div class="entry"><p class="role">Pre-Grading</p><p class="separator">-</p><p class="name">Julien Alix</p></div>\n                <div class="entry"><p class="role">Grading</p><p class="separator">-</p><p class="name">Brandon Blommaert</p></div>\n                <div class="entry"><p class="role">Grading</p><p class="separator">-</p><p class="name">Caroline Robert</p></div>\n\n                <div class="entry space-above"><p class="role">Camera Rental</p><p class="separator">-</p><p class="name">Les Productions J. Chamberland</p></div>\n                <div class="entry"><p class="role">Studio / Equipment Rental</p><p class="separator">-</p><p class="name">Ciné-pool</p></div>\n                <div class="entry"><p class="role">Vehicle Rental</p><p class="separator">-</p><p class="name">Via Route</p></div>\n                <div class="entry"><p class="role">Compositing Studio</p><p class="separator">-</p><p class="name">Shed</p></div>\n                <div class="entry"><p class="role">Online Editing Studio</p><p class="separator">-</p><p class="name">Post-Moderne</p></div>\n                <div class="entry"><p class="role">Travel Agent</p><p class="separator">-</p><p class="name">ITA International Travel</p></div>\n                <div class="entry"><p class="role">Accomodation</p><p class="separator">-</p><p class="name">Hotel Cyvadier Jacmel</p></div>\n                <div class="entry"><p class="role">Legal</p><p class="separator">-</p><p class="name">Stephane Moraille</p></div>\n                \n                <header>Behind-The-Scenes Video</header>\n                <div class="entry"><p class="role">Director</p><p class="separator">-</p><p class="name">Ian Lagarde</p></div>\n                <div class="entry"><p class="role">Editor</p><p class="separator">-</p><p class="name">Simon Gosselin</p></div>\n                \n                <header>Arcade Fire Management</header>\n                <div class="entry"><p>Scott Rodger</p></div>\n                <div class="entry"><p>Dounia Mikou</p></div>\n\n                <header>Special Thanks</header>\n                <div class="entry"><p>Andy Berndt</p></div>\n                <div class="entry"><p>Ian Ellison-Taylor</p></div>\n                <div class="entry"><p>Fred Chasen</p></div>\n                <div class="entry"><p>AJ Bae</p></div>\n                <div class="entry"><p>Punyabrata Ray</p></div>\n                <div class="entry"><p>Raymond Toy</p></div>\n                <div class="entry"><p>Brandon Jones</p></div>\n                <div class="entry"><p>Jenn Choy</p></div>\n                <div class="entry"><p>Cory Ferreria</p></div>\n                <div class="entry"><p>Jason Amarante</p></div>\n                <div class="entry"><p>Veronica Navarrete</p></div>\n                <div class="entry"><p>Jen Bloch</p></div>\n                <div class="entry"><p>Jesse Eisenhardt</p></div>\n                <div class="entry"><p>Nicholas Boeder</p></div>\n                <div class="entry"><p>Fred Runner</p></div>\n                <div class="entry"><p>Lynn Fu</p></div>\n                <div class="entry"><p>Joanne Feola</p></div>\n                <div class="entry"><p>Suzanne Chambers</p></div>\n                <div class="entry"><p>Jean-François Nadeau</p></div>\n                <div class="entry"><p>Yves Renaud</p></div>\n                <div class="entry"><p>Marc-André Chaput</p></div>\n                <div class="entry"><p>François Turcotte</p></div>\n                <div class="entry"><p>Tom Sacchi</p></div>\n                <div class="entry"><p>Piero Frescobaldi</p></div>\n                <div class="entry"><p>Yates Buckley</p></div>\n                <div class="entry"><p>Justin Uberti</p></div>\n                <div class="entry"><p>Scott Van Woudenberg</p></div>\n              \n                <div class="entry space-above"><p class="separator">-</p></div>\n\n            </section>\n            <div class="clear"></div>\n        </div>\n    </div>\n\n    <button class="close hover">\n        <div class="asset icon-close out"></div>\n        <div class="asset icon-close-over over"></div>\n    </button>\n</div>\n';return f});this["Handlebars"]["templates"]["CameraDeniedView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="background"></div>\n<div class="page">\n    <div class="content">\n\n        <p class="message"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"CameraDeniedView.message",h):i.call(b,"t","CameraDeniedView.message",h)))+"</bdo></p>\n\n    </div>\n</div>\n";return f});this["Handlebars"]["templates"]["DeviceDisconnectedView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="background"></div>\n<div class="page">\n    <div class="content">\n        <div class="disconnected">\n            <p class="message"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"General.disconnection",h):i.call(b,"t","General.disconnection",h)))+'</bdo></p>\n            <p class="code"></p>\n            <div class="link mouse-mode"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"General.disconnectionmouse",h):i.call(b,"t","General.disconnectionmouse",h)))+'</bdo></div>\n        </div>\n        <div class="connected">\n            <!--<img class="loader-icon" src="img/essential/ajax-loader.gif" />-->\n            <p><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"JoinView.connecting",h):i.call(b,"t","JoinView.connecting",h)))+"</bdo></p>\n        </div>\n    </div>\n</div>\n";return f});this["Handlebars"]["templates"]["EndScreenView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="background"></div>\n<div class="page">\n\n    <div class="content">\n        <button class="box restart"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"EndScreenView.restart",h):i.call(b,"t","EndScreenView.restart",h)))+'</bdo></button>\n\n        <nav class="links">\n            <ul>\n                <li><button class="link route trigger" data-route="/about"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"FooterLinksView.about",h):i.call(b,"t","FooterLinksView.about",h)))+'</bdo></button></li>\n                <li><button class="link" data-url="/tech?home"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"FooterLinksView.technology",h):i.call(b,"t","FooterLinksView.technology",h)))+'</bdo></button></li>\n                <li><button class="link external" data-url="http://www.arcadefire.com/"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"FooterLinksView.album",h):i.call(b,"t","FooterLinksView.album",h)))+'</bdo></button></li>\n            </ul>\n        </nav>\n\n        <nav class="sharing">\n            <ul>\n                <li class="button"><button class="share google"><div class="asset icon-google"></div></button></li>\n                <li class="button"><button class="share facebook"><div class="asset icon-facebook"></div></button></li>\n                <li class="button"><button class="share twitter"><div class="asset icon-twitter"></div></button></li>\n            </ul>\n        </nav>\n\n    </div>\n</div>\n';return f});this["Handlebars"]["templates"]["ExperienceLoadingView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="background"></div>\n<div class="page">\n\n	<div class="loading-mouse-only"></div>\n\n    <div class="content">\n	    <div class="left">\n	        <div class="interaction WebcamControlView"></div>\n		    <div class="loading">\n			    <img class="loader-icon" src="img/essential/ajax-loader.gif" />\n			    <p class="title"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"ExperienceLoadingView.title",h):i.call(b,"t","ExperienceLoadingView.title",h)))+'</bdo></p>\n			    <p class="progress">0%</p>\n		    </div>\n	    </div>\n        <div class="right">\n            <video class="instructions-video"></video>\n            <video class="instructions-video secondary"></video>\n            <p class="instructions regular"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"ExperienceLoadingView.instructionsRegular",h):i.call(b,"t","ExperienceLoadingView.instructionsRegular",h)))+'</bdo></p>\n            <p class="instructions touch"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"ExperienceLoadingView.instructionsTouch",h):i.call(b,"t","ExperienceLoadingView.instructionsTouch",h)))+'</bdo></p>\n            <div class="error inactive link mouse-mode">\n                <p><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"PhoneDetection.errorWebcam",h):i.call(b,"t","PhoneDetection.errorWebcam",h)))+'</bdo></p>\n            </div>\n            <p class="error-touch">';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"Error.ioschrome",h):i.call(b,"t","Error.ioschrome",h)))+"</p>\n        </div>\n    </div>\n</div>\n";return f});this["Handlebars"]["templates"]["ExperienceView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="background"></div>\n<div class="page">\n    <section class="interactions"></section>\n</div>\n<div class="break-free-content">\n    <div class="asset break-free"></div>\n</div>\n<div class="inactive-overlay">\n    <div class="background"></div>\n    <p><bdo>It seems that your phone has gone to sleep or your mobile browser tab was deactivated. Please go back to the experience on your phone to resume.</bdo></p>\n</div>\n<div class="overlay">\n    <p><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"Buffering",h):i.call(b,"t","Buffering",h)))+"</bdo></p>\n</div>\n";return f});this["Handlebars"]["templates"]["FooterGoogleView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};return'<div class="page">\n    <button class="link external asset logo-chrome-experiment" data-url="http://www.chromeexperiments.com/"></button>\n    <aside class="separator"></aside>\n    <button class="link external asset logo-made-with-some-friends-from-google" data-url="http://www.google.com/"></button>\n</div>'});this["Handlebars"]["templates"]["FooterLinksView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="page">\n    <nav class="links">\n        <ul>\n            <li><button class="link external" data-url="http://www.arcadefire.com/">';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"FooterLinksView.album",h):i.call(b,"t","FooterLinksView.album",h)))+'</button></li>\n            <li><button class="link route trigger" data-route="/about"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"FooterLinksView.about",h):i.call(b,"t","FooterLinksView.about",h)))+'</bdo></button></li>\n            <li><button class="link" data-url="/tech?home"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"FooterLinksView.technology",h):i.call(b,"t","FooterLinksView.technology",h)))+'</bdo></button></li>\n            <li><button class="link external" data-url="https://www.google.com/policies/"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"FooterLinksView.terms",h):i.call(b,"t","FooterLinksView.terms",h)))+'</bdo></button></li>\n            <li><button class="static"></button></li>\n            <li class="button google"><button class="share google"><div class="asset icon-google"></div></button></li>\n            <li class="button"><button class="share facebook"><div class="asset icon-facebook"></div></button></li>\n            <li class="button"><button class="share twitter"><div class="asset icon-twitter"></div></button></li>\n        </ul>\n    </nav>\n    <select class="language">\n        <option value="cs">čeština</option>\n        <option value="de">Deutsch</option>\n        <option value="en-gb">English (UK)</option>\n        <option value="en-us">English (US)</option>\n        <option value="es">Español</option>\n        <option value="es-419">Español (Latinoamérica)</option>\n        <option value="fr">Français</option>\n        <option value="it">Italiano</option>\n        <option value="ht">Kreyòl Ayisyen</option>\n        <option value="nl">Nederlands</option>\n        <option value="pl">Polski</option>\n        <option value="pt-br">Portuguès (Brasil)</option>\n        <option value="sv">Svenska</option>\n        <option value="tr">Türkçe</option>\n        <option value="ru">ру́сский</option>\n        <option value="ar">العربية</option>\n        <option value="th">ไทย</option>\n        <option value="ko">한국어</option>\n        <option value="zh-hk">中文(简体中文)</option>\n        <option value="zh-tw">中文(繁體中文)</option>\n        <option value="jp">日本語</option>\n    </select>\n    <nav>\n        <ul>\n            <li class="button fs">\n                <button class="fullscreen onoff hover">\n                    <div class="asset icon-fullscreen-on on out"></div>\n                    <div class="asset icon-fullscreen-on-over on over"></div>\n                    <div class="asset icon-fullscreen-off off out"></div>\n                    <div class="asset icon-fullscreen-off-over off over"></div>\n                </button>\n            </li>\n        </ul>\n    </nav>\n</div>\n';return f});this["Handlebars"]["templates"]["HelpOrientationView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};return'<div class="three"></div>\n<button class="box reset-orientation">Reset orientation</button>\n'});this["Handlebars"]["templates"]["HelpTrackingView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};return'<div class="content">\n\n</div>\n'});this["Handlebars"]["templates"]["HelpView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="background"></div>\n<div class="page">\n    <div class="content">\n\n        <div class="logo">\n            <div class="asset logo-about"></div>\n            <aside class="separator">-</aside>\n            <p class="title"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"HelpView.title",h):i.call(b,"t","HelpView.title",h)))+'</bdo></p>\n        </div>\n\n        <div class="debug">\n            <div class="display orientation"></div>\n        </div>\n\n        <div class="copy-grid">\n            <div class="one-column">\n                <h1 class="hero-text"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"HelpView.instructionsTitle",h):i.call(b,"t","HelpView.instructionsTitle",h)))+'</bdo></h1>\n            </div>\n            <div class="two-columns">\n                <p class="copy regular"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"HelpView.instructionsRegular",h):i.call(b,"t","HelpView.instructionsRegular",h)))+'</bdo></p>\n                <p class="copy touch"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"HelpView.instructionsTouch",h):i.call(b,"t","HelpView.instructionsTouch",h)))+'</bdo></p>\n            </div>\n        </div>\n\n    </div>\n\n    <section class="inactive">\n        <div class="asset webcam-arrow"></div>\n        <p><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"HelpView.promptWebcam",h):i.call(b,"t","HelpView.promptWebcam",h)))+'</bdo></p>\n        <div class="mouse-controls link mouse-mode"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"SetupView.mouse",h):i.call(b,"t","SetupView.mouse",h)))+'</bdo></div>\n    </section>\n\n    <section class="disconnected">\n        <p><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"HelpView.promptConnection",h):i.call(b,"t","HelpView.promptConnection",h)))+'</bdo></p>\n        <div class="mouse-controls link mouse-mode"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"SetupView.mouse",h):i.call(b,"t","SetupView.mouse",h)))+'</bdo></div>\n    </section>\n\n    <section class="break-free">\n        <p><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"HelpView.breakfree",h):i.call(b,"t","HelpView.breakfree",h)))+'</bdo></p>\n    </section>\n\n    <button class="close hover">\n        <div class="asset icon-close out"></div>\n        <div class="asset icon-close-over over"></div>\n    </button>\n\n</div>\n';
return f});this["Handlebars"]["templates"]["InstructionsView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="background"></div>\n<div class="page">\n    <div class="content">\n\n        <div class="asset instructions-projector"></div>\n        <p class="instructions"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"InstructionsView.instructions",h):i.call(b,"t","InstructionsView.instructions",h)))+'</bdo></p>\n        <div class="link mouse-mode-camera"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"SetupView.mouse",h):i.call(b,"t","SetupView.mouse",h)))+'</bdo></div>\n    </div>\n    <div class="webcam-arrow"></div>\n</div>\n';return f});this["Handlebars"]["templates"]["LandingPageView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;f+='<div class="background"></div>\n<div class="gradient"></div>\n<div class="page">\n    <div class="background asset background-homepage"></div>\n\n    <div class="content">\n\n        <div class="hero-logo asset logo-hero-just-a-reflector"></div>\n        <p class="title"><bdo>';i={hash:{},data:e};f+=k((g=c["t"]||b["t"],g?g.call(b,"LandingPage.title",i):j.call(b,"t","LandingPage.title",i)))+'</bdo></p>\n        <button class="box enter" dir><bdo>';i={hash:{},data:e};f+=k((g=c["t"]||b["t"],g?g.call(b,"LandingPage.enter",i):j.call(b,"t","LandingPage.enter",i)))+'</bdo></button>\n        <p class="error-browser other" dir><bdo>';i={hash:{},data:e};f+=k((g=c["t"]||b["t"],g?g.call(b,"LandingPage.errorBrowser",i):j.call(b,"t","LandingPage.errorBrowser",i)))+'</bdo></p>\n        <p class="error-browser ff" dir><bdo>';i={hash:{},data:e};f+=k((g=c["t"]||b["t"],g?g.call(b,"LandingPage.errorFF",i):j.call(b,"t","LandingPage.errorFF",i)))+'</bdo></p>\n\n    </div>\n\n    <div class="link mouse-mode" dir><bdo>';i={hash:{},data:e};h=(g=c["t"]||b["t"],g?g.call(b,"SetupView.mouse",i):j.call(b,"t","SetupView.mouse",i));if(h||h===0){f+=h}f+="</bdo></div>\n</div>\n";return f});this["Handlebars"]["templates"]["MouseAllowCameraView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="background"></div>\n<div class="page">\n\n    <div class="content">\n\n        <p class="instructions"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"HelpView.promptWebcam",h):i.call(b,"t","HelpView.promptWebcam",h)))+'</bdo></p>\n\n    </div>\n\n    <div class="webcam-arrow"></div>\n\n</div>\n';return f});this["Handlebars"]["templates"]["PerformanceWarningView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="background"></div>\n<div class="page">\n    <div class="content">\n        <p class="copy"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"PlatformNotSupportedView.performance",h):i.call(b,"t","PlatformNotSupportedView.performance",h)))+'</bdo></p>\n        <button class="box">OK</button>\n    </div>\n</div>\n';return f});this["Handlebars"]["templates"]["PersistentControlsView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};return'<div class="page">\n\n    <button class="help hover">\n        <div class="asset icon-help out"></div>\n        <div class="asset icon-help-over over"></div>\n    </button>\n\n    <div class="quality">\n        <button class="gear hover">\n            <div class="asset icon-gear out"></div>\n            <div class="asset icon-gear-over over"></div>\n        </button>\n        <div class="menu">\n            <div class="item" data-width="1280">720p</div>\n            <div class="item" data-width="960">480p</div>\n            <div class="item" data-width="640">360p</div>\n        </div>\n    </div>\n\n    <div class="volume-control">\n\n        <div class="volume-control-bar">\n\n            <div class="bar"></div>\n            <div class="bar"></div>\n            <div class="bar"></div>\n            <div class="bar"></div>\n            <div class="bar"></div>\n            <div class="bar"></div>\n            <div class="bar"></div>\n            <div class="bar"></div>\n            <div class="bar"></div>\n            <div class="bar"></div>\n\n        </div>\n\n    </div>\n\n    <button class="fullscreen onoff hover">\n        <div class="asset icon-fullscreen-on on out"></div>\n        <div class="asset icon-fullscreen-on-over on over"></div>\n        <div class="asset icon-fullscreen-off off out"></div>\n        <div class="asset icon-fullscreen-off-over off over"></div>\n    </button>\n</div>'});this["Handlebars"]["templates"]["PlatformNotSupportedView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};return'<div class="background"></div>\n<div class="page">\n    <div class="content">\n        <p class="message"><bdo></bdo></p>\n    </div>\n</div>\n'});this["Handlebars"]["templates"]["PreloaderView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};return'<img class="loader-icon" src="img/essential/ajax-loader.gif" />\n'});this["Handlebars"]["templates"]["RuntimeErrorView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="background"></div>\n<div class="page">\n    <div class="content">\n        <p class="copy"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"RuntimeError.message",h):i.call(b,"t","RuntimeError.message",h)))+'</bdo></p>\n        <button class="box link" data-url="/"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"RuntimeError.startAgain",h):i.call(b,"t","RuntimeError.startAgain",h)))+"</bdo></button>\n    </div>\n</div>\n";return f});this["Handlebars"]["templates"]["SetupView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="background"></div>\n<div class="page">\n    <div class="content">\n        <p class="instructions"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"SetupView.instructions",h):i.call(b,"t","SetupView.instructions",h)))+'</bdo></p>\n        <div class="link mouse-mode"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"SetupView.mouse",h):i.call(b,"t","SetupView.mouse",h)))+"</bdo></div>\n    </div>\n</div>\n";return f});this["Handlebars"]["templates"]["SyncSuccessView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="background"></div>\n<div class="page">\n    <div class="content"><bdo>';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"SyncSuccessView.connected",h):i.call(b,"t","SyncSuccessView.connected",h)))+"</bdo></div>\n</div>\n";return f});this["Handlebars"]["templates"]["TimelineView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="",g,h,i=c.helperMissing,j=this.escapeExpression;f+='<div class="seeker">\n\n    <p class="error-touch">';h={hash:{},data:e};f+=j((g=c["t"]||b["t"],g?g.call(b,"Error.ioschrome",h):i.call(b,"t","Error.ioschrome",h)))+'</p>\n\n    <div class="captions" id="timeline-captions">\n    </div>\n\n    <div class="bar">\n        <div class="progress" id="video-percent-elapsed"></div>\n        <canvas class="buffer"></canvas>\n        <div class="handler" id="seeker-button"></div>\n    </div>\n\n</div>\n\n<div class="content">\n\n    <div class="controls">\n\n        <button class="play-pause hover onoff transition">\n            <div class="asset icon-play off out"></div>\n            <div class="asset icon-play-over off over"></div>\n            <div class="asset icon-pause on out"></div>\n            <div class="asset icon-pause-over on over"></div>\n        </button>\n\n\n        <div class="time">\n            <p class="elapsed">0:00</p>\n            <p class="separator">/</p>\n            <p class="total">7:30</p>\n        </div>\n\n    </div>\n\n</div>\n\n';return f});this["Handlebars"]["templates"]["WebcamControlView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};var f="";return f});this["Handlebars"]["templates"]["WebcamTipView"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,a.helpers);e=e||{};return'<div class="content">\n\n    <div class="popup">\n\n        <h1>Popup Header</h1>\n        <p>Popup description</p>\n\n        <button class="box">\n            <div class="button">\n                I understand.\n            </div>\n        </button>\n        \n    </div>\n\n</div>\n'});var ConfigCommon=Class._extend({_public:{localisationResGetPath:"/api/client/localisation/get?lng=__lng__&ns=__ns__&format=unit9",meshApiUrl:"/api/mesh",mobileConnectionUrl:window.location.protocol+"//"+window.location.host,localResources:false}});var ConfigLocal=Class._extend({_public:{localResources:false,googleAnalyticsId:"UA-43052049-1"}});var ConfigDev=Class._extend({_public:{googleAnalyticsId:"UA-43052049-1"}});var ConfigTest=Class._extend({_public:{googleAnalyticsId:"UA-42413001-1"}});var ConfigProd=Class._extend({_public:{googleAnalyticsId:"UA-42413001-1"}});var Config=Class._extend(Class.SINGLETON,{_static:{RULES:[{host:"/([\\d]{1,3}\\.){3}[\\d]{1,3}|localhost",config:ConfigLocal},{host:"dev.arcade-fire.appspot.com",config:ConfigDev},{host:"test.arcade-fire.appspot.com",config:ConfigTest},{host:".*",config:ConfigProd}]},_public:{construct:function(){var a,b,c;b=new ConfigCommon;for(c in b){if(b[c]!==undefined){this[c]=b[c]}}for(a=0;a<Config.RULES.length;++a){if(window.location.toString().match(new RegExp(Config.RULES[a].host))){b=new Config.RULES[a].config;b._class=Config.RULES[a].config;break}}for(c in b){if(b[c]!==undefined){this[c]=b[c]}}}}});!function(){var a="/src/desktop/js/lib/stats.min.js",b="/src/desktop/js/lib/dat.gui.js";var c={stats:null,gui:null,data:{test:15},enabled:false,folders:[],delayedTimeoutId:-1,init:function(a){var b=2,c=function(){if(--b===0){if(typeof a==="function"){a()}}};this.initStats(c);this.initGui(c)},initStats:function(b){var c=this;if(!this.enabled){return}$.getScript(a,function(){c.stats=new Stats;c.stats.setMode(0);c.stats.domElement.style.position="absolute";c.stats.domElement.style.left="0px";c.stats.domElement.style.top="0px";document.body.appendChild(c.stats.domElement);window.stats=c.stats;if(typeof b==="function"){b()}})},initGui:function(a){var c=this;if(!this.enabled){return}$.getScript(b,function(){c.gui=new dat.GUI;window.gui=c.gui;if(typeof a==="function"){a()}})},add:function(a,b,c){var d=null,e=this;if(!this.enabled){return}if(!this.gui){clearTimeout(this.delayedTimeoutId);this.delayedTimeoutId=setTimeout(function(){e.add(a,b,c)},50);return}if(c){d=this["folder"+c];if(!d){d=this.gui.addFolder(c);this["folder"+c]=d;this.folders.push(d)}}if(d){return d.add(a,b).listen()}else{return this.gui.add(a,b).listen()}},remove:function(a,b){var c=null;if(!this.enabled){return}if(b){c=this["folder"+b]}if(c){c.remove(a)}else{this.gui.remove(a)}},openFolder:function(a){if(this["folder"+a]){this["folder"+a].open()}},closeFolder:function(a){if(this["folder"+a]){this["folder"+a].close()}},closeFolders:function(){var a=0;for(a=0;a<this.folders.length;++a){this.folders[a].close()}}};window.Debug=c}();!function(a){a.Tracking=function(){this.TRACKING_SIZE=256;this.USE_ANIMATION_FRAME=true;this.USE_WEBWORKER_FOR_OPENCV=true;this.PATH_TO_TRACKING_WORKER="js/worker/";this.PATH_TO_SHADERS="shaders/tracking/";this.SHADERS_LIST=["vertex.vert","simpleExposure.frag","frameDiff.frag","hueLumaSaturationThreshold.frag","Blur.vert","Blur.frag","Edge.frag","BlurRemove.frag","MotionDirection.frag","BlurMotion.frag"];this.BUFFER_SIZE=this.TRACKING_SIZE*this.TRACKING_SIZE*4;this.VIDEO_UPDATE_RATE=1e3/24;this.RESET_TIMEOUT=1e4;this.LUMINOSITY_SEND_DELAY=500;this.defaultSettings={edgesOffset:1,blurOffset:.25,hardEdges:4,blurThreshold:.2,minLuminosity:.15,minChroma:.14,hueRange:.35};this.defaultSettingsColor={edgesOffset:.75,blurOffset:.5,hardEdges:9,blurThreshold:.25,minLuminosity:.11,minChroma:.155,hueRange:.35};this.defaultSettingsHalo={edgesOffset:1,blurOffset:0,hardEdges:1.5,blurThreshold:1,minLuminosity:.4,minChroma:.2,hueRange:.35};this.options=null;this.renderer=null;this.separateRender=false;this.shaders={};this.shaderMaterial={};this.renderPasses={};this.projector=null;this.projectionCamera=null;this.videoReady=false;this.numShadersLoaded=0;this.CVWorker=null;this.workerIsBusy=false;this.buff=null;this.video=null;this.videoCanvas=null;this.videoTexture=null;this.lastVideoUpdateTime=0;this.currentVideoFrame=0;this.trackingPause=false;this.READY=false;this.initialised=false;this.position=null;this.normalizedPosition=new THREE.Vector3(0,0,1);this.lastFrameTime=0;this.phoneLife=0;this.phoneDeath=0;this.foundHole=false;this.lastPhoneLuminosityMessage=0;this.targetHoleRatio=.3;this.targetLuminosity=1;this.averageColorBlob=.5;this.averageHoleRatio=.4;this.averageColorHalo=0;this.firstLuminosityMessageSent=false;this.frameDiffIsPing=false;this.persistence=0;this.isTouchingSide=false;this.offset=0;this.exposure=1;this.lowLightScore=0;this.highLightScore=0;this.orientationReset=false;this.orientationResetTime=-1;this.numFrontal=0;this.smoothRotation=new THREE.Vector3(0,0,0);this.rotation=new THREE.Vector3(0,0,1);this.rotationMatrix=new THREE.Matrix3;this.frontalTolerance={x:.5,y:.6,z:.7,num:8};this.debugView=null;this.onerror=null;this.onready=null;this.onluminosity=null;this.onupdate=null;this.onresetorientation=null;this.start=function(b){var c=this;this.onerror=b.onerror||function(a){throw new Error(a)};this.onready=b.onready;this.onluminosity=b.onluminosity;this.onresetorientation=b.onresetorientation;this.onupdate=b.onupdate;this.debugView=b.debugView;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;a.URL=a.URL||a.webkitURL||a.mozURL||a.msURL||a.oURL;if(!navigator.getUserMedia||!a.URL)this.onerror("Tracking Error : getUserMedia not supported");if(!a.THREE)this.onerror("Tracking Error: THREE.js Required for tracking.");this.PATH_TO_TRACKING_WORKER=b.workerPath!==undefined?b.workerPath:"js/worker/";this.PATH_TO_SHADERS=b.shaderPath!==undefined?b.shaderPath:"shaders/tracking/";this.USE_WEBWORKER_FOR_OPENCV=b.useWebWorkers!==undefined?b.useWebWorkers:true;this.USE_ANIMATION_FRAME=b.useAnimationFrame!==undefined?b.useAnimationFrame:true;this.renderer=b.renderer;if(!this.renderer){this.renderer=new THREE.WebGLRenderer({antialias:false,alpha:false});this.renderer.setClearColor(0,1);this.renderer.setSize(this.TRACKING_SIZE,this.TRACKING_SIZE);this.renderer.autoClear=false;this.separateRender=true}this.options=b.options||{"static":false};this.options.edgesOffset=this.options.edgesOffset===undefined?this.defaultSettings.edgesOffset:this.options.edgesOffset;this.options.blurOffset=this.options.blurOffset===undefined?this.defaultSettings.blurOffset:this.options.blurOffset;this.options.hardEdges=this.options.hardEdges===undefined?this.defaultSettings.hardEdges:this.options.hardEdges;this.options.blurThreshold=this.options.blurThreshold===undefined?this.defaultSettings.blurThreshold:this.options.blurThreshold;this.options.minLuminosity=this.options.minLuminosity===undefined?this.defaultSettings.minLuminosity:this.options.minLuminosity;this.options.minChroma=this.options.minChroma===undefined?this.defaultSettings.minChroma:this.options.minChroma;this.options.hueRange=this.options.hueRange===undefined?this.defaultSettings.hueRange:this.options.hueRange;this.options.lowLightScore=1e-5;this.options.highLightScore=1e-4;if(!b.video||b.loadVideo){this.video=document.createElement("video");navigator.getUserMedia({video:{mandatory:{minWidth:1280,minHeight:720}}},function(b){c.video.play();c.video.src=a.URL.createObjectURL(b);c.video.addEventListener("loadeddata",function(){c.videoReady=true;c.loadProgress()})},function(a){console.log(a);c.onerror("Tracking Error: Camera Denied",a)})}else{this.video=b.video;if(this.video.readyState===this.video.HAVE_ENOUGH_DATA){this.videoReady=true;this.loadProgress()}else{this.video.addEventListener("loadeddata",function(){c.videoReady=true;c.loadProgress()})}}if(!b.shaders||b.loadExternalShaders){this.shaders=b.shaders||{};for(var d=0;d<this.SHADERS_LIST.length;d++){!function(a,b){b.shaders[a]=undefined;var c=new XMLHttpRequest;c.onreadystatechange=function(){if(c.readyState===4){if(c.status===200){loaded=true;b.numShadersLoaded++;b.shaders[a]=c.responseText;b.loadProgress()}else{b.onerror("XHR Loading Error for tracking shader: "+a)}}};c.open("GET",b.PATH_TO_SHADERS+a,true);c.overrideMimeType("text/plain; charset=x-user-defined");c.send(null)}(this.SHADERS_LIST[d],this)}}else{this.shaders=b.shaders;for(var d=0;d<this.SHADERS_LIST.length;d++){if(!this.shaders[this.SHADERS_LIST[d]]){this.onerror("Missing Shader For Tracking: "+this.SHADERS_LIST[d])}else{c.numShadersLoaded++}}this.loadProgress()}this.CVWorker=Boolean(!this.USE_WEBWORKER_FOR_OPENCV&&a.TrackingWorker)?a.TrackingWorker:new Worker(this.PATH_TO_TRACKING_WORKER+"TrackingWorker.js");this.CVWorker.postMessage=this.CVWorker.webkitPostMessage||this.CVWorker.postMessage;this.CVWorker.addEventListener("message",function(){c.receiveTrackingDataFromOpenCV.apply(c,arguments)},false);console.log("Using Web Workers for OpenCV:"+!Boolean(!this.USE_WEBWORKER_FOR_OPENCV&&a.TrackingWorker))};this.resume=function(){this.running=true;a.requestAnimationFrame(this.animationFrame)};this.stop=function(){this.running=false};this.loadProgress=function(){if(!this.initialised&&this.videoReady&&this.numShadersLoaded===this.SHADERS_LIST.length)this.init()};this.init=function(){var a=this,b=null;this.projector=new THREE.Projector;this.projectionCamera=new THREE.PerspectiveCamera(45,1,1,1e3),this.position=new THREE.Vector3(0,0,1);this.rotation=new THREE.Vector3(0,0,0);this.normalizedPosition=new THREE.Vector3(0,0,1);this.video.play();this.videoCanvas=document.createElement("canvas");this.videoCanvas.width=this.TRACKING_SIZE;this.videoCanvas.height=this.TRACKING_SIZE;this.videoCanvas.c=this.videoCanvas.getContext("2d");this.videoTexture=new THREE.Texture(this.videoCanvas,new THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBFormat,THREE.UnsignedByteType,1);this.videoTexture.generateMipmaps=false;this.videoTexture.needsUpdate=true;this.sendWebcamRatio();b="simpleExposure";this.shaderMaterial[b]=new THREE.ShaderMaterial({vertexShader:this.shaders["vertex.vert"],fragmentShader:this.shaders["simpleExposure.frag"],attributes:{},uniforms:{texture:{type:"t",value:this.videoTexture},exposure:{type:"f",value:1},offset:{type:"f",value:0}},depthTest:false,transparent:false,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.renderPasses["simpleExposure"]=new FramebufferWrapper(this.TRACKING_SIZE,this.TRACKING_SIZE,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.shaderMaterial[b],depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:this.renderer});b="blur";this.shaderMaterial[b]=new THREE.ShaderMaterial({vertexShader:this.shaders["Blur.vert"],fragmentShader:this.shaders["Blur.frag"],attributes:{},uniforms:{texture:{type:"t",value:this.renderPasses["simpleExposure"].texture},offset:{type:"v2",value:new THREE.Vector2(.75/this.TRACKING_SIZE,.75/this.TRACKING_SIZE)}},depthTest:false,transparent:false,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.renderPasses[b]=new FramebufferWrapper(this.TRACKING_SIZE,this.TRACKING_SIZE,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.shaderMaterial[b],depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:this.renderer});this.renderPasses[b].renderPlane.scale.y=-1;b="edges";this.shaderMaterial[b]=new THREE.ShaderMaterial({vertexShader:this.shaders["Blur.vert"],fragmentShader:this.shaders["Edge.frag"],attributes:{},uniforms:{texture:{type:"t",value:this.renderPasses["blur"].texture},offset:{type:"v2",value:new THREE.Vector2(.75/this.TRACKING_SIZE,.75/this.TRACKING_SIZE)},hardEdgeThreshold:{type:"f",value:8.5}},depthTest:false,transparent:false,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.renderPasses[b]=new FramebufferWrapper(this.TRACKING_SIZE,this.TRACKING_SIZE,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.shaderMaterial[b],depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:this.renderer});this.renderPasses[b].renderPlane.scale.y=-1;b="hueLuma";this.shaderMaterial[b]=new THREE.ShaderMaterial({vertexShader:this.shaders["vertex.vert"],fragmentShader:this.shaders["hueLumaSaturationThreshold.frag"],attributes:{},uniforms:{texture:{type:"t",value:this.renderPasses["simpleExposure"].texture},tEdges:{type:"t",value:this.renderPasses["edges"].texture},targetHue:{type:"f",value:0},hueRange:{type:"f",value:.2},minLuminosity:{type:"f",value:.2},minChroma:{type:"f",value:.12}},depthTest:false,transparent:false,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.renderPasses[b]=new FramebufferWrapper(this.TRACKING_SIZE,this.TRACKING_SIZE,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.shaderMaterial[b],depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:this.renderer});this.renderPasses["lastFrame"]=new FramebufferWrapper(this.TRACKING_SIZE,this.TRACKING_SIZE,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:new THREE.MeshBasicMaterial({map:this.renderPasses["simpleExposure"].texture,side:THREE.DoubleSide}),depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:this.renderer});this.renderPasses["lastFrame"].renderPlane.scale.y=-1;b="frameDiff";this.shaderMaterial[b]=new THREE.ShaderMaterial({vertexShader:this.shaders["vertex.vert"],fragmentShader:this.shaders["frameDiff.frag"],attributes:{},uniforms:{tCurrent:{type:"t",value:this.renderPasses["simpleExposure"].texture},tLast:{type:"t",value:this.renderPasses["lastFrame"].texture},tAccum:{type:"t",value:null},accumDelta:{type:"f",value:.3},minDiff:{type:"f",value:200/256}},depthTest:false,transparent:false,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.renderPasses[b]=new FramebufferWrapper(this.TRACKING_SIZE,this.TRACKING_SIZE,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.shaderMaterial[b],depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:this.renderer});this.renderPasses["frameDiffPong"]=new FramebufferWrapper(this.TRACKING_SIZE,this.TRACKING_SIZE,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.shaderMaterial[b],depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:this.renderer});b="blurmotion";this.shaderMaterial[b]=new THREE.ShaderMaterial({vertexShader:this.shaders["Blur.vert"],fragmentShader:this.shaders["BlurMotion.frag"],attributes:{},uniforms:{texture:{type:"t",value:this.renderPasses["simpleExposure"].texture},tLastFrame:{type:"t",value:this.renderPasses["lastFrame"].texture},tFrameDiff:{type:"t",value:this.renderPasses["frameDiff"].texture},offset:{type:"v2",value:new THREE.Vector2(1.25/this.TRACKING_SIZE,1.25/this.TRACKING_SIZE)}},depthTest:false,transparent:false,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.renderPasses[b]=new FramebufferWrapper(this.TRACKING_SIZE,this.TRACKING_SIZE,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.shaderMaterial[b],depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:this.renderer});this.renderPasses[b].renderPlane.scale.y=-1;b="direction";this.shaderMaterial[b]=new THREE.ShaderMaterial({vertexShader:this.shaders["Blur.vert"],fragmentShader:this.shaders["MotionDirection.frag"],attributes:{},uniforms:{texture:{type:"t",value:this.renderPasses["blurmotion"].texture},tLastFrame:{type:"t",value:this.renderPasses["lastFrame"].texture},tFrameDiff:{type:"t",value:this.renderPasses["frameDiff"].texture},offset:{type:"v2",value:new THREE.Vector2(1.5/this.TRACKING_SIZE,1.5/this.TRACKING_SIZE)}},depthTest:false,transparent:false,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.renderPasses[b]=new FramebufferWrapper(this.TRACKING_SIZE,this.TRACKING_SIZE,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.shaderMaterial[b],depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:this.renderer});this.renderPasses[b].renderPlane.scale.y=-1;b="edges2";this.shaderMaterial[b]=new THREE.ShaderMaterial({vertexShader:this.shaders["Blur.vert"],fragmentShader:this.shaders["BlurRemove.frag"],attributes:{},uniforms:{texture:{type:"t",value:this.renderPasses["hueLuma"].texture},tDiffDirection:{type:"t",value:this.renderPasses["direction"].texture},offset:{type:"v2",value:new THREE.Vector2(.5/this.TRACKING_SIZE,.5/this.TRACKING_SIZE)},threshold:{type:"f",value:.75}},depthTest:false,transparent:false,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.renderPasses[b]=new FramebufferWrapper(this.TRACKING_SIZE,this.TRACKING_SIZE,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.shaderMaterial[b],depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:this.renderer});this.renderPasses[b].renderPlane.scale.y=-1;if(this.debugView){this.debugView.setup(this.renderer,false);this.debugView.initTexturePlanes(this.videoTexture,this.renderPasses)}!function(a){a.animationFrame=function(){a.run.call(a,a.animationFrame)}}(this);this.lastVideoUpdateTime=Date.now();this.running=true;this.initialised=true;if(this.onready)this.onready();if(this.USE_ANIMATION_FRAME)this.run()};this.addDebugView=function(a){this.debugView=a;this.debugView.setup(this.renderer,false);this.debugView.initTexturePlanes(this.videoTexture,this.renderPasses)};this.run=function(){if(!this.initialised)return;if(this.USE_ANIMATION_FRAME&&this.running)a.requestAnimationFrame(this.animationFrame);if(Date.now()-this.lastVideoUpdateTime>=this.VIDEO_UPDATE_RATE&&!this.trackingPause){var b=Math.min(Math.max(Date.now()-this.lastVideoUpdateTime/(1e3/24),.5),2);this.lastVideoUpdateTime+=Math.floor((Date.now()-this.lastVideoUpdateTime)/this.VIDEO_UPDATE_RATE)*this.VIDEO_UPDATE_RATE;this.videoCanvas.c.drawImage(this.video,0,0,this.TRACKING_SIZE,this.TRACKING_SIZE);this.videoTexture.needsUpdate=true;this.currentVideoFrame++;if(this.currentVideoFrame%24==0&&!this.trackingPause){var c=this.videoCanvas.c.getImageData(0,0,this.TRACKING_SIZE,this.TRACKING_SIZE),d=c.data,e=this.TRACKING_SIZE*this.TRACKING_SIZE*4,f=0,g=0,h=0,i=0,j=765;for(var k=0;k<e;k+=4){f=d[k]+d[k+1]+d[k+2];if(f<128){++g}else if(f>700){++h}if(f>i)i=f;if(f<j)j=f}j*=1/765;i*=1/765;this.options.lowLightScore=this.lowLightScore=this.lowLightScore*.5+.5*(g/(e/4));this.options.highLightScore=this.highLightScore=this.highLightScore*.5+.5*(h/(e/4));this.shaderMaterial["simpleExposure"].uniforms.offset.value=-j;this.shaderMaterial["simpleExposure"].uniforms.exposure.value=1/(i-j);this.offset=-j;this.exposure=1/(i-j)}this.shaderMaterial["hueLuma"].uniforms.minChroma.value=this.options.minChroma;this.shaderMaterial["hueLuma"].uniforms.minLuminosity.value=this.options.minLuminosity;this.shaderMaterial["hueLuma"].uniforms.hueRange.value=this.options.hueRange;this.shaderMaterial["edges"].uniforms.hardEdgeThreshold.value=this.options.hardEdges;this.shaderMaterial["edges2"].uniforms.threshold.value=this.options.blurThreshold;this.shaderMaterial["blur"].uniforms.offset.value.set(this.options.edgesOffset/this.TRACKING_SIZE,this.options.edgesOffset/this.TRACKING_SIZE);this.shaderMaterial["edges"].uniforms.offset.value.set(1/this.TRACKING_SIZE,1/this.TRACKING_SIZE);this.shaderMaterial["edges2"].uniforms.offset.value.set(this.options.blurOffset/this.TRACKING_SIZE,this.options.blurOffset/this.TRACKING_SIZE);this.shaderMaterial["frameDiff"].uniforms.accumDelta.value=.35-.1*b;this.renderer.setClearColor(0,0);this.renderer.clear();this.renderPasses["simpleExposure"].render();var l=this.frameDiffIsPing?this.renderPasses["frameDiff"]:this.renderPasses["frameDiffPong"];var m=this.frameDiffIsPing?this.renderPasses["frameDiffPong"]:this.renderPasses["frameDiff"];this.shaderMaterial["frameDiff"].uniforms.tAccum.value=m.texture;l.render();this.frameDiffIsPing=!this.frameDiffIsPing;this.shaderMaterial["direction"].uniforms.tFrameDiff.value=l.texture;this.shaderMaterial["blurmotion"].uniforms.tFrameDiff.value=l.texture;this.renderPasses["blurmotion"].render();this.renderPasses["direction"].render();this.renderPasses["blur"].render();this.renderPasses["edges"].render();this.renderPasses["hueLuma"].render();this.renderPasses["edges2"].render();if(!this.buff||!this.buff.byteLength)this.buff=new Uint8Array(this.BUFFER_SIZE);var n=this.renderer.getContext();n.readPixels(0,0,this.TRACKING_SIZE,this.TRACKING_SIZE,n.RGBA,n.UNSIGNED_BYTE,this.buff);this.CVWorker.postMessage(this.buff,[this.buff.buffer]);this.renderPasses["lastFrame"].render();if(this.debugView)this.debugView.render()}};this.receiveTrackingDataFromOpenCV=function(a){var b=a.data;this.READY=true;if(this.currentVideoFrame-b.currentFrame>3)this.trackingPause=true;else if(this.currentVideoFrame-b.currentFrame<=1)this.trackingPause=false;var c=(Date.now()-this.lastFrameTime)/(1e3/24);c=Math.min(Math.max(c,.5),2);this.lastFrameTime=Date.now();this.isTouchingSide=b.isTouchingSide;var d=.1;var e=d*c;var f=1;var g=10;var h=4;var i=.325;var j=.25;var k=.65;var l=.4;var m=.2;var n=.25;var o=.85;var p=.12;if(b.foundHole&&b.life>=h&&b.holeRatio){this.averageHoleRatio=this.averageHoleRatio*(1-e)+b.holeRatio*e;this.averageColorBlob=this.averageColorBlob*(1-e)+b.colorBlob*e;this.averageColorHalo=this.averageColorHalo*(1-e)+b.colorHalo*e;var q=Math.min(Math.max(this.averageColorHalo*g*(1-this.averageColorBlob),0),1);q*=1-this.averageColorBlob;if(!this.options["static"]){for(var r in this.defaultSettings){this.options[r]=this.defaultSettings[r]*(1-this.averageColorBlob)+this.defaultSettingsColor[r]*this.averageColorBlob;
this.options[r]=this.options[r]*(1-q)+this.defaultSettingsHalo[r]*q}}if(b.life>=h&&Date.now()-this.lastPhoneLuminosityMessage>this.LUMINOSITY_SEND_DELAY){this.lastPhoneLuminosityMessage=Date.now();this.firstLuminosityMessageSent=true;var s=Math.max(this.averageColorBlob-.5,0)*2;var t=this.averageHoleRatio*(1-s)+k*s;var u=this.averageHoleRatio<i?1:-1;var v=Math.abs(this.averageHoleRatio-i);v*=v;this.targetHoleRatio=this.targetHoleRatio+v*u*f;if(this.lowLightScore>o){this.targetHoleRatio+=(this.lowLightScore-o)/(1-o)*p}this.targetHoleRatio=Math.min(Math.max(this.targetHoleRatio,j),k);var w=(this.targetHoleRatio-j)/(k-j);this.targetLuminosity=1-l*w-(1-this.averageColorBlob)*m;if(q>.15){this.targetLuminosity=Math.max(this.targetLuminosity-q*n,.5)}console.log(this.averageHoleRatio,v,u,this.targetHoleRatio);if(this.onluminosity)this.onluminosity(this.targetLuminosity,this.targetHoleRatio)}}if(!this.firstLuminosityMessageSent&&this.lowLightScore>o&&Date.now()-this.lastPhoneLuminosityMessage>this.LUMINOSITY_SEND_DELAY){this.lastPhoneLuminosityMessage=Date.now();this.targetLuminosity=1-.45*(this.lowLightScore-o)/(1-o);this.targetHoleRatio=j+(k-j)/2;if(this.onluminosity)this.onluminosity(this.targetLuminosity,this.targetHoleRatio);console.log("Low Webcam Luminosity Detected - Lowering default Phone Brightness")}if(b.pose){if(b.foundHole){var x=Math.min(b.life/3,1);this.position.x+=(b.pose.bestTranslation[0]-this.position.x)*x;this.position.y+=(b.pose.bestTranslation[1]-this.position.y)*x;this.position.z+=(b.pose.bestTranslation[2]-this.position.z)*x*c*.35;this.rotation.set(-Math.asin(-b.pose.bestRotation[1][2]),-Math.atan2(b.pose.bestRotation[0][2],b.pose.bestRotation[2][2]),-Math.atan2(b.pose.bestRotation[1][0],b.pose.bestRotation[1][1])-Math.PI/2)}else{this.position.x+=(b.pose.bestTranslation[0]-this.position.x)*(c*.4+.1);this.position.y+=(b.pose.bestTranslation[1]-this.position.y)*(c*.4+.1);this.position.z+=(b.pose.bestTranslation[2]-this.position.z)*c*.1}}else if(b.useEstimate&&b.estimatedPose){this.position.x+=(b.estimatedPose.bestTranslation[0]-this.position.x)*c*.5;this.position.y+=(b.estimatedPose.bestTranslation[1]-this.position.y)*c*.5}this.normalizedPosition.copy(this.position);this.projector.projectVector(this.normalizedPosition,this.projectionCamera);this.normalizedPosition.z=Math.max(Math.min(Math.abs(this.position.z+150)/1e3,1),0);if(isNaN(this.normalizedPosition.x)||isNaN(this.normalizedPosition.y)||isNaN(this.normalizedPosition.z)){this.normalizedPosition.set(0,0,.5);this.position.set(0,0,.5)}this.phoneLife=b.life;this.phoneDeath=b.lastLife;this.foundHole=b.foundHole;if(this.phoneLife>=2)this.persistence+=(1-this.persistence)*.2*c*Math.min(this.phoneLife/5,1);else this.persistence-=this.persistence*.1*c*Math.min(this.phoneDeath/6,1);if(b.pose&&b.pose.bestRotation){this.rotationMatrix.set(b.pose.bestRotation[0][0],b.pose.bestRotation[0][1],b.pose.bestRotation[0][2],b.pose.bestRotation[1][0],b.pose.bestRotation[1][1],b.pose.bestRotation[1][2],b.pose.bestRotation[2][0],b.pose.bestRotation[2][1],b.pose.bestRotation[2][2]);var y=new THREE.Vector3(0,0,1).applyMatrix3(this.rotationMatrix);if(Math.abs(y.x)<this.frontalTolerance.x&&Math.abs(y.y)<this.frontalTolerance.y&&Math.abs(y.z)>this.frontalTolerance.z){this.numFrontal=Math.max(this.numFrontal+1,0)}else{this.numFrontal=Math.min(this.numFrontal-1,0)}if(!this.orientationReset&&this.numFrontal>=this.frontalTolerance.num&&this.phoneLife>=this.frontalTolerance.num){this.orientationReset=true;this.orientationResetTime=(new Date).getTime();if(this.onresetorientation)this.onresetorientation()}}else{if((new Date).getTime()-this.orientationResetTime>this.RESET_TIMEOUT){this.orientationReset=false}}if(this.debugView)this.debugView.updateData(b,this.video,this.position,this.rotation,this.normalizedPosition);if(this.onupdate)this.onupdate()};this.pause=function(){this.running=false};this.resume=function(){if(!this.running){this.running=true;if(this.USE_ANIMATION_FRAME)this.run()}};this.getPosition=function(){return this.normalizedPosition};this.isFrontal=function(){return this.numFrontal>=5};this.showDebugContours=function(a){this.CVWorker.postMessage({action:"setReturnContours",returnContours:a})};this.sendWebcamRatio=function(){this.CVWorker.postMessage({action:"setWebcamRatio",width:this.video.videoWidth,height:this.video.videoHeight})}}}(window);var AppController=Class._extend(Class.SINGLETON,{_public:{construct:function(){this.init();this.bindEvents()},init:function(){DetectionController.getInstance().detectAll();Resource.local=Config.getInstance().localResources},bindEvents:function(){var a=this;PreloadController.getInstance().events.on(PreloadController.EVENT_INITIAL_COMPLETE,function(){a.onPreloadInitialComplete()})},beginPreload:function(){var a=function(){PreloadController.getInstance().preloadInitial();PreloadController.getInstance().preloadResources();PreloadController.getInstance().preloadTimelineData()};switch(Config.getInstance()._class){case ConfigLocal:case ConfigDev:console.log("// INIT DEBUG //");window.Debug.enabled=true;window.Debug.init(a);break;default:console.log("// INIT DEFAULT //");a();break}},start:function(){var a=this;AnimationController.getInstance().start();PerformanceController.getInstance().initialize();var b=[{name:"LOW",min:0,max:20},{name:"MEDIUM",min:20,max:40},{name:"HIGH",min:40,max:Infinity}];var c=[{name:"LOW",min:0,max:6},{name:"MEDIUM",min:7,max:14},{name:"HIGH",min:20,max:Infinity}];PerformanceController.getInstance().startMonitoringPerformance(PerformanceController.THRESHOLD_LIMITED);PerformanceController.getInstance().setPerformanceThresholds(b);PerformanceController.getInstance().events.on(PerformanceController.EVENT_BANDWIDTH_READY,function(){});PerformanceController.getInstance().setBandwidthThresholds(c);PerformanceController.getInstance().detectBandwidth();PerformanceController.getInstance().detectLowFPS(10);PerformanceController.getInstance().detectHighLowFramerate(true);Viewport.getInstance().update();a.beginPreload()},onPreloadInitialComplete:function(){RoutingController.getInstance().route()}}});var DetectionController=Class._extend(Class.SINGLETON,{_static:{PLATFORM_MOBILE:"mobile",PLATFORM_TABLET:"tablet",PLATFORM_DESKTOP:"desktop",OS_MAC:"Mac",OS_WINDOWS:"Windows",OS_LINUX:"Linux",OS_IOS:"iOS",OS_ANDROID:"Android",BROWSER_CHROME:"Chrome",BROWSER_SAFARI:"Safari",BROWSER_FIREFOX:"Firefox",BROWSER_INTERNET_EXPLORER:"InternetExplorer",DISPLAY_NORMAL:"1x",DISPLAY_RETINA:"2x",REQUIREMENTS:{hasCanvas:true,hasWebSockets:true,hasWebGL:true,hasMinimumBandwidth:true}},_public:{isChromeOnIOSonMobile:false,platform:null,display:null,os:null,browser:null,browserVersion:null,isNotSupported:false,isMobile:false,isTablet:false,isDesktop:false,isTouch:false,isRetina:false,isIos:false,isAndroid:false,isMac:false,isWindows:false,isLinux:false,isSafari:false,isChrome:false,isFirefox:false,isInternetExplorer:false,language:"en",hasCanvas:false,hasWebSockets:false,hasWebGL:false,hasMinimumBandwidth:true,setIsChromeOnIOSonMobile:function(){this.isChromeOnIOSonMobile=true;$("html").addClass("sleep-touch")},detectAll:function(){this.detectPlatform();this.detectOs();this.detectBrowser();this.detectDisplay();this.detectCanvas();this.detectWebSockets();this.detectWebGL();this.addStyles()},detectPlatform:function(){this.isMobile=$(".detection .mobile").css("display")==="block";this.isTablet=$(".detection .tablet").css("display")==="block";this.isDesktop=!this.isMobile&&!this.isTablet;this.isTouch=window.ontouchstart!==undefined;this.platform=this.isMobile?DetectionController.PLATFORM_MOBILE:this.isTablet?DetectionController.PLATFORM_TABLET:DetectionController.PLATFORM_DESKTOP},detectOs:function(){this.isIos=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)!==null;if(this.isIos){this.os=DetectionController.OS_IOS}this.isAndroid=navigator.userAgent.toLowerCase().indexOf("android")!==-1;if(this.isAndroid){this.os=DetectionController.OS_ANDROID}this.isMac=navigator.platform.toLowerCase().indexOf("mac")!==-1;if(this.isMac){this.os=DetectionController.OS_MAC}this.isWindows=navigator.platform.toLowerCase().indexOf("win")!==-1;if(this.isWindows){this.os=DetectionController.OS_WINDOWS}this.isLinux=navigator.platform.toLowerCase().indexOf("linux")!==-1;if(this.isLinux){this.os=DetectionController.OS_LINUX}},getSupportInfo:function(){var a,b={supported:true,reason:[]},c;var d=new Array;for(a in DetectionController.REQUIREMENTS){if(DetectionController.REQUIREMENTS[a]!==undefined){c=DetectionController.REQUIREMENTS[a];d.push(DetectionController.REQUIREMENTS[a]);if(c!==undefined&&d.__proto__===[].__proto__){if(d.indexOf(this[a])===-1){b.supported=false;b.reason.push({property:a,value:this[a]})}}else{if(this[a]!==c){b.supported=false;b.reason.push({property:a,value:this[a]})}}}}return b},detectBrowser:function(){this.isChrome=navigator.userAgent.indexOf("Chrome")!==-1;if(this.isChrome){this.browser=DetectionController.BROWSER_CHROME}this.isSafari=!this.isChrome&&navigator.userAgent.indexOf("Safari")!==-1;if(this.isSafari){this.browser=DetectionController.BROWSER_SAFARI}this.isFirefox=navigator.userAgent.indexOf("Firefox")!==-1;if(this.isFirefox){this.browser=DetectionController.BROWSER_FIREFOX}this.isInternetExplorer=navigator.userAgent.indexOf("MSIE")!==-1;if(this.isInternetExplorer){this.browser=DetectionController.BROWSER_INTERNET_EXPLORER;this.browserVersion=parseInt(navigator.userAgent.match(/MSIE \d+\.\d+/g)[0].match(/\d+/)[0],10)}},detectDisplay:function(){this.isRetina=$(".detection .display-retina").css("display")==="block";this.display=this.isRetina?DetectionController.DISPLAY_RETINA:DetectionController.DISPLAY_NORMAL},detectLanguage:function(){this.language=window.i18n.lng().toLowerCase();$("html").addClass("lng-"+this.language)},detectCanvas:function(){this.hasCanvas=window.FlashCanvas===undefined},detectWebSockets:function(){this.hasWebSockets=window.WebSocket!==undefined},detectWebGL:function(){function a(a){if(!!window.WebGLRenderingContext){var b=document.createElement("canvas"),c=["webgl","experimental-webgl","moz-webgl","webkit-3d"],d=false;for(var e=0;e<4;e++){try{d=b.getContext(c[e]);if(d&&typeof d.getParameter=="function"){if(a){return{name:c[e],gl:d}}return true}}catch(f){}}return false}return false}this.hasWebGL=a()},detectBandwidth:function(){console.log("bandwidth:",PerformanceController.getInstance().getBandwidth(),"Mbps");this.hasMinimumBandwidth=true},addStyles:function(){var a=$("html");a.addClass("browser-"+this.browser);a.addClass("browser-version-"+this.browserVersion);a.addClass("os-"+this.os);a.addClass(this.isTouch?"touch":"mouse")}},_private:{}});var PreloadController=Class._extend(Class.SINGLETON,{_static:{EVENT_INITIAL_PROGRESS:"PreloadController_EVENT_INITIAL_PROGRESS",EVENT_INITIAL_COMPLETE:"PreloadController_EVENT_INITIAL_COMPLETE",EVENT_MAIN_PROGRESS:"PreloadController_EVENT_MAIN_PROGRESS",EVENT_MAIN_COMPLETE:"PreloadController_EVENT_MAIN_COMPLETE",EVENT_ASSETS_DATA_PROGRESS:"PreloadController_EVENT_ASSETS_DATA_PROGRESS",EVENT_ASSETS_DATA_COMPLETE:"PreloadController_EVENT_ASSETS_DATA_COMPLETE",EVENT_EXPERIENCE_PROGRESS:"PreloadController_EVENT_EXPERIENCE_PROGRESS",EVENT_EXPERIENCE_COMPLETE:"PreloadController_EVENT_EXPERIENCE_COMPLETE",EVENT_TIMELINE_DATA_COMPLETE:"PreloadController_EVENT_TIMELINE_DATA_COMPLETE",EVENT_TIMELINE_DATA_PROGRESS:"PreloadController_EVENT_TIMELINE_DATA_PROGRESS"},_public:{experienceLoadStarted:false,resourcesInfo:null,timelineInfo:null,videoElement:null,preloadInitial:function(){var a=this,b=new InitialPreloadTask;b.events.on(Task.EVENT_PROGRESS,function(b,c){a.events.trigger(PreloadController.EVENT_INITIAL_PROGRESS,[c.progress]);return b});b.events.on(Task.EVENT_DONE,function(){a.events.trigger(PreloadController.EVENT_INITIAL_COMPLETE)});b.execute()},preloadMain:function(){var a=this,b=new MainPreloadTask;b.events.on(Task.EVENT_PROGRESS,function(b,c){a.events.trigger(PreloadController.EVENT_MAIN_PROGRESS,[c.progress]);return b});b.events.on(Task.EVENT_DONE,function(){a.events.trigger(PreloadController.EVENT_MAIN_COMPLETE)});b.execute()},preloadExperience:function(){var a=this,b,c,d;if(this.experienceLoadStarted){this.events.trigger(PreloadController.EVENT_EXPERIENCE_COMPLETE);return}this.experienceLoadStarted=true;c=["common","renderer"];for(d in this.resourcesInfo){if(this.resourcesInfo[d]!==undefined){var e=false;for(var f=0;f<this.timelineInfo.timeline.length;f++){if(this.timelineInfo.timeline[f].id===d&&this.timelineInfo.timeline[f].ignore)e=true}if(!e)c.push(d)}}b=new ExperiencePreloadTask(this.resourcesInfo,c,true);b.events.on(Task.EVENT_PROGRESS,function(b,c){a.events.trigger(PreloadController.EVENT_EXPERIENCE_PROGRESS,[c.progress]);return b});b.events.on(Task.EVENT_DONE,function(){a.events.trigger(PreloadController.EVENT_EXPERIENCE_COMPLETE)});b.execute()},preloadTimelineData:function(){var a=this,b=new LoadTimelineInformation;b.events.on(Task.EVENT_PROGRESS,function(b,c){a.events.trigger(PreloadController.EVENT_TIMELINE_DATA_PROGRESS,[c.progress]);return b});b.events.on(Task.EVENT_DONE,function(){a.events.trigger(PreloadController.EVENT_TIMELINE_DATA_COMPLETE)});b.execute()},preloadResources:function(){var a=this,b=new LoadAssetsInformation;b.events.on(Task.EVENT_PROGRESS,function(b,c){a.events.trigger(PreloadController.EVENT_ASSETS_DATA_PROGRESS,[c.progress]);return b});b.events.on(Task.EVENT_DONE,function(){a.events.trigger(PreloadController.EVENT_ASSETS_DATA_COMPLETE)});b.execute()}}});var LocalisationController=Class._extend(Class.SINGLETON,{_static:{EVENT_READY:"LocalisationController_EVENT_READY"},_public:{init:function(){var a=this,b;Handlebars.registerHelper("t",function(a){var b=window.i18n.t(a);if(b==="[MISSING]"){b=window.i18n.t(a,{lng:"en-us"})}return new Handlebars.SafeString(b)});b=this.getQueryStringLanguage();if(b){this.isLanguageSupported(b,function(c){if(c){a.initI18Next(b)}else{if(b.indexOf("-")===-1){b=null;a.initI18Next(b)}else{b=b.substring(0,b.indexOf("-"));a.isLanguageSupported(b,function(c){if(!c){b=null}a.initI18Next(b)})}}})}else{this.initI18Next(b)}},initI18Next:function(a){var b=this;window.i18n.init({fallbackLng:"en-us",detectLngQS:"lng",cookieName:"lng",ns:"desktop",lng:a||window.LANGUAGE,resGetPath:Config.getInstance().localisationResGetPath},function(){DetectionController.getInstance().detectLanguage();b.events.trigger(LocalisationController.EVENT_READY)})},getQueryStringLanguage:function(){var a=window.location.search.match("lng=([a-zA-Z]+(-)?[a-zA-Z]+)");return a&&a.length>1?a[1]:null},getCookieLanguage:function(){var a=document.cookie.match("lng=([a-zA-Z]+(-)?[a-zA-Z]+)");return a&&a.length>1?a[1]:null},isLanguageSupported:function(a,b){if(typeof b!=="function"){return}$.get(Config.getInstance().localisationResGetPath.replace("__lng__",a).replace("__ns__","desktop")).done(function(){b(true)}).error(function(){b(false)})}}});var RoutingControllerBase=Class._extend(Class.ABSTRACT,{_public:{historyStates:[],history:[],fullScreenStates:[],construct:function(a,b){this.supportsHistory=!!window.history;this.routes=a;this.baseUrl=b||"";this.timesRouted=0},init:function(){var a=this;setInterval(function(){a.checkHashChange()},200);FullScreenController.getInstance().events.bind(FullScreenController.EVENT_FULLSCREEN_OFF,function(){a.onFullScreenOff()})},back:function(){this.historyStates.pop();var a=this.historyStates.pop();console.log("////// back",a);this.route(a||"/",{trigger:true})},route:function(a,b){var c=a,d=a,e,f,g=true,h;a=a||window.location.pathname+window.location.search+window.location.hash;e=this.parseUrl(a);if(a.indexOf("__")!==0){this.history.push(a)}if(!this.initialRouted){this.routeInitial();this.initialRouted=true}f=this.getRouteHandlers(e);for(h=0;h<f.length;++h){if(f[h].preventDefault){g=false}if(f[h].trigger){c=f[h].trigger}if(f[h].back){d=f[h].back}}if(g){this.routeDefault()}for(h=0;h<f.length;++h){if(this.history.length<3&&f[h].firstRoute){this[f[h].firstRoute](e)}if(f.length===1||!f[h].exclusive){this[f[h].handler](e)}}if(this.supportsHistory){this.historyStates.push(d)}if(b&&b.trigger){this.trigger(c)}this.lastHash=window.location.hash;this.timesRouted++},routeInitial:function(){var a=this;window.onpopstate=function(){if(a.timesRouted>2){a.back()}};return},routeDefault:function(){return}},_private:{baseUrl:null,routes:null,initialRouted:false,supportsHistory:false,lastHash:null,lastState:null,timesRouted:0,parseUrl:function(a){var b=a.indexOf("#"),c,d,e,f;if(!this.supportsHistory&&b!==-1){a=a.substring(b+1,a.length);b=a.indexOf("#")}c=a.indexOf("?");d=b===-1?"":a.substring(b+1,a.length);e=this.parseSearch(c===-1?"":b===-1?a.substring(c+1,a.length):a.substring(c+1,b));f=c===-1?b===-1?a:a.substring(0,b):a.substring(0,c);return{base:f,hash:d,search:e}},getRouteHandlers:function(a){var b=[],c,d,e;for(c=0;c<this.routes.length;++c){d=this.routes[c];e=a.base.match(new RegExp(d.base));if(e){b.push(d)}}return b},parseSearch:function(a){var b={},c=a.split("&"),d,e;for(e=0;e<c.length;++e){d=c[e].split("=");b[d[0]]=d[1]}return b},trigger:function(a){if(FullScreenController.getInstance().isFullScreen()){this.fullScreenStates.push(a)}else{if(this.supportsHistory){window.history.pushState(null,null,this.baseUrl+a)}else{window.location.hash="#"+a}}},checkHashChange:function(){if(window.location.hash!==this.lastHash){this.lastHash=window.location.hash;this.onHashChange()}},onHashChange:function(){this.route()},onFullScreenOff:function(){var a;for(a=0;a<this.fullScreenStates.length;++a){this.trigger(this.fullScreenStates[a])}this.fullScreenStates=[]}}});var RoutingController=RoutingControllerBase._extend(Class.SINGLETON,{_static:{ROUTES:[{base:"^\\/$",handler:"routeHome"},{base:"^\\/instructions(\\/)?$",handler:"routeInstructions",trigger:"/",back:"/"},{base:"^\\/mousecamera(\\/)?$",handler:"routeMouseCamera",trigger:"/",back:"/"},{base:"^\\/cameradenied(\\/)?$",handler:"routeCameraDenied",trigger:"/",back:"/"},{base:"^\\/setup(\\/)?$",handler:"routeSetup",trigger:"/",back:"/"},{base:"^\\/experience-loading(\\/)?$",handler:"routeExperienceLoading",trigger:"/",back:"/"},{base:"^\\/experience(\\/)?$",handler:"routeExperience",back:"/"},{base:"^\\/disconnected(\\/)?$",handler:"routeDisconnected",trigger:"/",back:"/"},{base:"^\\/error(\\/)?$",handler:"routeError",trigger:"/",back:"/"},{base:"^\\/end(\\/)?$",handler:"routeEndScreen",preventDefault:false,firstRoute:"routeExperience",trigger:"/"},{base:"^\\/about(\\/)?$",handler:"routeAbout",preventDefault:true,firstRoute:"routeHome"},{base:"__back__",handler:"back",trigger:false}]},_public:{historyStates:[],history:[],enabled:false,construct:function(){RoutingControllerBase.call(this,RoutingController.ROUTES);View.registerHelper(function(){var a=i18n.lng().toLowerCase().indexOf("ar")===0?"rtl":"ltr";this.$container.find("bdo").each(function(){if($(this).attr("dir")=="ltr"){var b=$(this).text().split("").reverse().join("");$(this).replaceWith(b)}else $(this).attr("dir",a)});if(a=="rtl"){this.$container.find("bdo").each(function(){$(this).html($(this).html())})}},true);View.registerHelper(function(){this.$container.find(".link").each(function(){var a=$(this);a.off("click");if(a.hasClass("route")){a.bind("click",function(){RoutingController.getInstance().route(a.data("route"),a.hasClass("trigger")?{trigger:true}:null)})}else{a.bind("click",function(){window.open(a.data("url"),a.hasClass("external")?"_blank":"_self")})}})});View.registerHelper(function(){this.$container.find(".link.mouse-mode a").each(function(){var a=$(this);a.off("click").bind("click",function(){InputController.getInstance().setMode(InputController.INPUT_TYPE_MOUSE);if(ViewController.getInstance().getView("ExperienceLoadingView").shown){ViewController.getInstance().getView("ExperienceLoadingView").onMouseMode()}else{RoutingController.getInstance().route("/experience-loading")}})})});ViewController.getInstance().init({"section.PreloaderView":{id:"PreloaderView",Class:PreloaderView},"section.LandingPageView":{id:"LandingPageView",Class:LandingPageView},"section.SetupView":{id:"SetupView",Class:SetupView},"section.SyncSuccessView":{id:"SyncSuccessView",Class:SyncSuccessView},"section.InstructionsView":{id:"InstructionsView",Class:InstructionsView},"section.MouseAllowCameraView":{id:"MouseAllowCameraView",Class:MouseAllowCameraView},"section.CameraDeniedView":{id:"CameraDeniedView",Class:CameraDeniedView},"section.ExperienceLoadingView":{id:"ExperienceLoadingView",Class:ExperienceLoadingView},"section.ExperienceView":{id:"ExperienceView",Class:ExperienceView},"section.EndScreenView":{id:"EndScreenView",Class:EndScreenView},"nav.TimelineView":{id:"TimelineView",Class:TimelineView},"section.HelpView":{id:"HelpView",Class:HelpView},"section.PerformanceWarningView":{id:"PerformanceWarningView",Class:PerformanceWarningView},"header.PersistentControlsView":{id:"PersistentControlsView",Class:PersistentControlsView},"footer.FooterGoogleView":{id:"FooterGoogleView",Class:FooterGoogleView},"footer.FooterLinksView":{id:"FooterLinksView",Class:FooterLinksView},"section.AboutView":{id:"AboutView",Class:AboutView},"div.WebcamTipView":{id:"WebcamTipView",Class:WebcamTipView},"section.PlatformNotSupportedView":{id:"PlatformNotSupportedView",Class:PlatformNotSupportedView},"section.DeviceDisconnectedView":{id:"DeviceDisconnectedView",Class:DeviceDisconnectedView},"section.RuntimeErrorView":{id:"RuntimeErrorView",Class:RuntimeErrorView}});this.bindExceptionViews();this.init()},bindExceptionViews:function(){var a=this;RemoteController.getInstance().events.bind(RemoteController.EVENT_PEER_LEAVE,function(){if(TimelineController.getInstance().canShowDisconnectionError()){ViewController.getInstance().getView("TimelineView").slideOut();ViewController.getInstance().getView("DeviceDisconnectedView").show(true)}});RemoteController.getInstance().events.bind(RemoteController.EVENT_MESH_CLOSE,function(){RoutingController.getInstance().route("/error")});RemoteController.getInstance().events.bind(RemoteController.EVENT_EXPERIENCE_RESTART,function(){a.route("/experience");TimelineController.getInstance().stop();TimelineController.getInstance().start()})},routeInitial:function(){var a=DetectionController.getInstance().getSupportInfo();this.checkDebugFlags();RoutingControllerBase.prototype.routeInitial.call(this);if(!a.supported&&DetectionController.getInstance().isChrome){this.routeNotSupported(a);return}this.routePreloader()},checkDebugFlags:function(){if(window.location.href.match(/experience/g)!=null){TimelineController.DIRECT_FLAG=true}},routeDefault:function(){RoutingControllerBase.prototype.routeDefault.call(this);ViewController.getInstance().getView("LandingPageView").hide();ViewController.getInstance().getView("SetupView").hide();ViewController.getInstance().getView("SyncSuccessView").hide();ViewController.getInstance().getView("InstructionsView").hide();ViewController.getInstance().getView("MouseAllowCameraView").hide();ViewController.getInstance().getView("CameraDeniedView").hide();ViewController.getInstance().getView("ExperienceLoadingView").hide();ViewController.getInstance().getView("ExperienceView").hide();ViewController.getInstance().getView("TimelineView").hide();ViewController.getInstance().getView("PerformanceWarningView").hide();ViewController.getInstance().getView("HelpView").hide();ViewController.getInstance().getView("PersistentControlsView").hide();ViewController.getInstance().getView("FooterGoogleView").hide();ViewController.getInstance().getView("FooterLinksView").hide();ViewController.getInstance().getView("ExperienceView").hide();ViewController.getInstance().getView("EndScreenView").hide();ViewController.getInstance().getView("AboutView").hide();ViewController.getInstance().getView("DeviceDisconnectedView").hide();ViewController.getInstance().getView("RuntimeErrorView").hide()},routeNotSupported:function(a){ViewController.getInstance().getView("PreloaderView").hide();ViewController.getInstance().getView("PlatformNotSupportedView").show(a)},routePreloader:function(){ViewController.getInstance().getView("PreloaderView").show()},routeHome:function(){if(!this.enabled){return}ViewController.getInstance().getView("LandingPageView").show();ViewController.getInstance().getView("FooterGoogleView").show();ViewController.getInstance().getView("FooterLinksView").show()},routeInstructions:function(){ViewController.getInstance().getView("InstructionsView").show();ViewController.getInstance().getView("PersistentControlsView").show()},routeMouseCamera:function(){ViewController.getInstance().getView("MouseAllowCameraView").show();ViewController.getInstance().getView("PersistentControlsView").show()},routeCameraDenied:function(){ViewController.getInstance().getView("CameraDeniedView").show()},routeSetup:function(){ViewController.getInstance().getView("SetupView").show();ViewController.getInstance().getView("PersistentControlsView").show()},routeExperienceLoading:function(){ViewController.getInstance().getView("ExperienceLoadingView").show();ViewController.getInstance().getView("PersistentControlsView").show()},routeExperience:function(){ViewController.getInstance().getView("ExperienceView").show();ViewController.getInstance().getView("PersistentControlsView").show();ViewController.getInstance().getView("TimelineView").show()},routeEndScreen:function(){ViewController.getInstance().getView("EndScreenView").show()},routeDisconnected:function(){ViewController.getInstance().getView("DeviceDisconnectedView").show()},routeError:function(){ViewController.getInstance().getView("RuntimeErrorView").show()},routeAbout:function(){ViewController.getInstance().getView("AboutView").show()}}});var ViewController=Class._extend(Class.SINGLETON,{_static:{},_public:{init:function(a){var b,c,d;for(d in a){if(a[d]!==undefined){b=a[d].id;if(!this.viewsById[b]){c=a[d].Class;this.viewsById[b]=new c(b,d)}}}},getView:function(a){return this.viewsById[a]}},_private:{viewsById:{}}});var SharingController=Class._extend(Class.SINGLETON,{_static:{},_public:{shareLink:null,construct:function(){this.shareLink=window.location.protocol+"//"+window.location.host+"/lng/"+i18n.lng().toLowerCase()},shareLinkOnFacebook:function(a){a=encodeURIComponent(a||this.shareLink);AnalyticsController.getInstance().trackEvent(AnalyticsController.EVENT_SHARE_FACEBOOK);this.openPopup("http://www.facebook.com/sharer.php?u={url}".replace("{url}",a),600,300)},shareOnTwitter:function(a,b){a=encodeURIComponent(a||$.t("Sharing.twitter"));b="";AnalyticsController.getInstance().trackEvent(AnalyticsController.EVENT_SHARE_TWITTER);this.openPopup("https://twitter.com/share/?text={text}&url={url}".replace("{text}",a).replace("{url}",b),600,460)},shareLinkOnGoogle:function(a){a=encodeURIComponent(a||this.shareLink);AnalyticsController.getInstance().trackEvent(AnalyticsController.EVENT_SHARE_GOOGLE);this.openPopup("https://plus.google.com/share?url={url}".replace("{url}",a),640,480)}},_private:{openPopup:function(a,b,c,d,e,f){var g;d=d||true;e=d?(screen.width-b)*.5:e;f=d?(screen.height-c)*.5:f;g="toolbar=no,status=no,width={width},height={height},left={left},top={top}".replace("{width}",b).replace("{height}",c).replace("{left}",e).replace("{top}",f);window.open(a,"_blank",g)}}});var FullScreenController=Class._extend(Class.SINGLETON,{_static:{EVENT_FULLSCREEN_ON:"FullScreenController_EVENT_FULLSCREEN_ON",EVENT_FULLSCREEN_OFF:"FullScreenController_EVENT_FULLSCREEN_OFF",EVENT_FULLSCREEN_CHANGE:"FullScreenController_EVENT_FULLSCREEN_CHANGE"},_public:{construct:function(){var a=this;if(document.documentElement.requestFullScreen){this.isPropertyName="fullScreen";this.requestFunctionName="requestFullScreen";this.cancelFunctionName="cancelFullScreen"}else if(document.documentElement.webkitRequestFullScreen){this.isPropertyName="webkitIsFullScreen";this.requestFunctionName="webkitRequestFullScreen";this.cancelFunctionName="webkitCancelFullScreen"}else if(document.documentElement.mozRequestFullScreen){this.isPropertyName="mozfullScreen";this.requestFunctionName="mozRequestFullScreen";this.cancelFunctionName="mozCancelFullScreen"}else if(document.documentElement.mozRequestFullScreen){this.requestFunctionName="mozRequestFullScreen";this.cancelFunctionName="mozCancelFullScreen"}$(document).bind("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){a.onFullScreenChange()})},toggle:function(a){if(this.isPropertyName){if(this.isFullScreen()){this.cancel(a)}else{this.request(a)}}},request:function(a){if(this.requestFunctionName){a[this.requestFunctionName]()}},cancel:function(a){if(this.cancelFunctionName){document[this.cancelFunctionName]()}return a},isFullScreen:function(){return document[this.isPropertyName]}},_private:{isPropertyName:null,requestFunctionName:null,cancelFunctionName:null,onFullScreenChange:function(){this.events.trigger(FullScreenController.EVENT_FULLSCREEN_CHANGE);if(this.isFullScreen()){this.events.trigger(FullScreenController.EVENT_FULLSCREEN_ON)}else{this.events.trigger(FullScreenController.EVENT_FULLSCREEN_OFF)}}}});var RemoteController=Class._extend(Class.SINGLETON,{_static:{RESYNC_TIME:1e3,ACTIVITY_TIMEOUT:5e3,MAX_SECONDS_INACTIVE:6,EVENT_CONNECTION_CODE_READY:"RemoteController_EVENT_CONNECTION_URL_READY",EVENT_PEER_EXIST:"RemoteController_EVENT_PEER_EXIST",EVENT_PEER_ENTER:"RemoteController_EVENT_PEER_ENTER",EVENT_PEER_LEAVE:"RemoteController_EVENT_PEER_LEAVE",EVENT_PEER_LOADING_PROGRESS:"RemoteController_EVENT_PEER_LOADING_PROGRESS",EVENT_PEER_READY:"RemoteController_EVENT_PEER_READY",EVENT_MESH_FULL:"RemoteController_EVENT_MESH_FULL",EVENT_MESH_CLOSE:"RemoteController_EVENT_CLOSE",EVENT_PEER_INVALID_PLATFORM:"RemoteController_EVENT_PEER_INVALID_PLATFORM",EVENT_PEER_ORIENTATION:"RemoteController_EVENT_PEER_ORIENTATION",EVENT_EXPERIENCE_RESTART:"RemoteController_EVENT_EXPERIENCE_RESTART",INFO_PLATFROM_CHOME_IOS:"RemoteController_EVENT_INFO_PLATFROM_CHOME_IOS",EVENT_DEVICE_INACTIVE:"RemoteController_EVENT_DEVICE_INACTIVE",EVENT_DEVICE_ACTIVE:"RemoteController_EVENT_DEVICE_ACTIVE",EVENT_TOUCH:"RemoteController_EVENT_TOUCH"},_public:{sleepMonitorEnabled:false,isConnected:function(){return this.peerNode!==null},getConnectionCode:function(){return this.mesh?this.mesh.id:-1},host:function(){if(this.mesh){this.dispose()}this.mesh=new window.Mesh(null,{api:Config.getInstance().meshApiUrl,autoConnect:false,useWebRTC:false});this.bindEvents();this.mesh.connect()},join:function(a){if(this.mesh){this.dispose()}this.mesh=new window.Mesh(a,{api:Config.getInstance().meshApiUrl,autoConnect:false,useWebRTC:false});this.bindEvents();this.mesh.connect()},start:function(){if(this.mesh){this.mesh.trigger("start")}else{console.warn("Mesh undefined",this.mesh)}},play:function(){if(this.mesh){this.mesh.trigger("play")}},pause:function(){if(this.mesh){this.mesh.trigger("pause")}},end:function(){if(this.mesh){this.mesh.trigger("end")}},restart:function(){if(this.mesh){this.mesh.trigger("restart")}},resyncExperienceTime:function(a){if(this.mesh){this.mesh.trigger("resync",clocksync.time()+RemoteController.RESYNC_TIME,a)}},dispose:function(){if(this.peerNode){this.peerNode.unbind();this.peerNode=null}if(this.mesh){this.mesh.unbind();this.mesh.disconnect();this.mesh=null}},showAxelle:function(a){if(this.mesh){this.mesh.trigger("axelle_start",a)}},pauseAxelle:function(a){if(this.mesh){this.mesh.trigger("axelle_pause",a)}},hideAxelle:function(a){if(this.mesh){this.mesh.trigger("axelle_hide",a)}},showTurnItBack:function(){if(!this.isPromptShown){this.isPromptShown=true;this.mesh.trigger("turnitback_start")}},hideTurnItBack:function(){if(this.isPromptShown){this.isPromptShown=false;this.mesh.trigger("turnitback_stop")}},setLuminosity:function(a,b){if(this.mesh){this.mesh.trigger("setluminosity",[a,b])}},setVolume:function(a){if(this.mesh){this.mesh.trigger("volume",a)}}},_private:{mesh:null,peerNode:null,isPromptShown:false,activityTimeoutId:-1,isActive:false,numMessages:0,lastMpsTime:-1,mps:.001,numMeasurementsZeroMps:0,bindEvents:function(){var a=this;this.mesh.self.bind("connect",function(b){a.onMeshConnect();
a.onPeerExist.apply(a,arguments)});this.mesh.self.bind("error",function(){a.onMeshClose()});this.mesh.self.bind("close",function(){a.onMeshClose()});this.mesh.self.bind("enter",function(b){a.onPeerEnter(b)});this.mesh.self.bind("leave",function(b){a.onPeerLeave(b)});this.mesh.bind("bind",function(b){a.onPeerBind(b)});AnimationController.getInstance().events.bind(AnimationController.EVENT_FRAME,function(){a.onFrame()});Debug.add(this,"mps","Mobile")},bindPeerEvents:function(a){var b=this;a.bind("progress",function(){b.onPeerProgress.apply(b,arguments)});a.bind("ready",function(){b.onPeerReady()});a.bind("orientation",function(){b.onOrientation.apply(b,arguments)});a.bind("restart",function(){b.onPeerRestart.apply(b,arguments)});a.bind("touch",function(){b.onPeerTouch.apply(b,arguments)})},onPlatformInfo:function(){DetectionController.getInstance().setIsChromeOnIOSonMobile();this.events.trigger(RemoteController.INFO_PLATFROM_CHOME_IOS,[this.mesh.options.name])},onMeshConnect:function(){DetectionController.getInstance().isChromeOnIOSonMobile=false;this.events.trigger(RemoteController.EVENT_CONNECTION_CODE_READY,[this.mesh.options.name]);if(window.LocalAutoConnectSocket!==undefined){LocalAutoConnectSocket.getInstance().connect();LocalAutoConnectSocket.getInstance().publishURL(this.mesh.options.ws,this.mesh.options.name,window.location.hostname)}},onMeshClose:function(){this.events.trigger(RemoteController.EVENT_MESH_CLOSE)},onPeerExist:function(){var a;for(a=0;a<arguments.length;++a){this.onPeerEnter(arguments[a])}},onPeerEnter:function(a){var b=this;if(this.peerNode){this.events.trigger(RemoteController.EVENT_MESH_FULL,[a])}else{a.bind("platform",function(c,d){b.onPeerPlatform(a,c,d)})}},onPeerLeave:function(a){if(this.peerNode&&this.peerNode.id===a.id){this.peerNode=null;this.events.trigger(RemoteController.EVENT_PEER_LEAVE)}},onPeerBind:function(a){switch(a){case"platform":this.mesh.trigger("platform",this.peerNode?RemoteController.EVENT_MESH_FULL:DetectionController.PLATFORM_DESKTOP);break}},onPeerPlatform:function(a,b,c){this.onMessage();if(c==RemoteController.INFO_PLATFROM_CHOME_IOS){this.onPlatformInfo()}if(this.peerNode){return}if(b===DetectionController.PLATFORM_TABLET||b===DetectionController.PLATFORM_MOBILE){this.peerNode=a;this.bindPeerEvents(a);this.events.trigger(RemoteController.EVENT_PEER_ENTER,[a])}else if(b===RemoteController.EVENT_MESH_FULL){this.events.trigger(RemoteController.EVENT_MESH_FULL,[a])}else{this.events.trigger(RemoteController.EVENT_PEER_INVALID_PLATFORM,[a])}a.unbind("platform")},onPeerProgress:function(a){this.onMessage();this.events.trigger(RemoteController.EVENT_PEER_LOADING_PROGRESS,[a])},onPeerReady:function(){this.onMessage();this.events.trigger(RemoteController.EVENT_PEER_READY)},onOrientation:function(a,b,c,d,e,f,g,h){this.onMessage();this.events.trigger(RemoteController.EVENT_PEER_ORIENTATION,[{worldQuaternion:{x:a,y:b,z:c,w:d},worldAcceleration:{x:e,y:f,z:g},timestamp:h}])},onMessage:function(){this.numMessages++},onFrame:function(){var a;if(this.sleepMonitorEnabled){a=(new Date).getTime();if(this.lastMpsTime===-1){this.lastMpsTime=a;this.numMessages=0;return}if(a-this.lastMpsTime>=1e3){this.mps=(this.numMessages*1e3/(a-this.lastMpsTime)).toFixed(2);this.numMessages=0;this.lastMpsTime=a;if(Number(this.mps)===0){if(++this.numMeasurementsZeroMps>=RemoteController.MAX_SECONDS_INACTIVE){this.onDeviceInactive()}}else{this.numMeasurementsZeroMps=0;this.onDeviceActive()}}}},onDeviceActive:function(){if(!this.isActive){this.isActive=true;this.events.trigger(RemoteController.EVENT_DEVICE_ACTIVE)}},onDeviceInactive:function(){console.log("-- inactive");if(this.isActive){this.isActive=false;this.events.trigger(RemoteController.EVENT_DEVICE_INACTIVE)}},onPeerRestart:function(){this.events.trigger(RemoteController.EVENT_EXPERIENCE_RESTART)},onPeerTouch:function(a){this.events.trigger(RemoteController.EVENT_TOUCH,[a.state,a.time])}}});var PerformanceController=Class._extend(Class.SINGLETON,{_static:{TARGET_FRAMES:60,HIGH:"HIGH",MEDIUM:"MEDIUM",LOW:"LOW",BANDWITH:function(){return PerformanceController.getInstance().getBandwitch()},BANDWITH_STATE:function(){return PerformanceController.getInstance().getBandwitchState()},EVENT_PERFORMANCE_BREAKDOWN:"PerformanceController_Breakdown",EVENT_PERFORMANCE_DOWNGRADE:"PerformanceController_Downgrading",EVENT_PERFORMANCE_UPGRADE:"PerformanceController_Upgrading",EVENT_BANDWIDTH_READY:"PerformanceController_EVENT_BANDWIDTH_READY:",INTERNAL_EVENT_BANDWIDTH_TEST_FINISHED:"PerformanceController_INTERNAL_EVENT_BANDWIDTH_TEST_FINISHED",EVENT_LOW_FPS:"PerformanceController_EVENT_LOW_FPS",EVENT_PERFORMANCE_LOW:"PerformanceController_Slow",EVENT_PERFORMANCE_HIGH:"PerformanceController_Fast",THRESHOLD_UNLIMITED:"PerformanceController_THRESHOLD_UNLIMITED",THRESHOLD_LIMITED:"PerformanceController_THRESHOLD_LIMITED",WEBGL_SCORE_FORCE_LOWRES:.75,FRAMERATE_LOW_THRESHOLD:29,FRAMERATE_HIGH_THRESHOLD:59,getFPS:function(){return this.__fps},setFPS:function(a){this.__fps=a},__fps:0,__kbps:0},_public:{enabled:false,webglTestStarted:false,webglPerformanceScore:0,webglTestDone:false,initialize:function(){window.performance=window.performance||{};window.performance.now=function(){return window.performance.now||window.performance.mozNow||window.performance.msNow||window.performance.oNow||window.performance.webkitNow||function(){return(new Date).getTime()}}();window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/PerformanceController.TARGET_FRAMES)}}();window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}();if(window.location.href.indexOf("debug")>-1){this.FLAG_VERBOSE_DEBUG=true;this.addDebugBars()}this.perfromanceSMA.targetSamples=PerformanceController.TARGET_FRAMES*4;this.bandwidthSMA.targetSamples=PerformanceController.TARGET_FRAMES},setQuality:function(a){this.quality=a},getQuality:function(){return this.quality},determineOptimalVideoQuality:function(){return{size:this.getBandwidth()/20*7.5*60,resolution:{width:screen.width,height:screen.height}}},startMonitoringPerformance:function(a){if(a==null){console.log("You need to specify threshold mode.");return}this.thresholdMode=a;this.perfromanceSMA.list=[];this.perfromanceSMA.index=0;this.perfromanceSMA.total=0;this.performanceMonitoringLastSMA=-1;this.performanceTickLoopID=window.requestAnimationFrame(this.performanceTick.bind(this));this.FLAG_MONITORING_PERFORMANCE=true},resetMonitoringPeformance:function(){this.perfromanceSMA.list=[];this.perfromanceSMA.index=0;this.perfromanceSMA.total=0},stopMonitoringPerformance:function(){this.FLAG_MONITORING_PERFORMANCE=false;this.performanceTickLoopID=-1;window.cancelRequestAnimFrame(this.performanceTickLoopID)},setPerformanceThresholds:function(a){if(this.thresholdMode==PerformanceController.THRESHOLD_UNLIMITED){this.performanceModesThresholds.step=a.step;this.performanceModesThresholds.rangeMin=a.min;this.performanceModesThresholds.rangeMax=a.max}else if(this.thresholdMode==PerformanceController.THRESHOLD_LIMITED){this.performanceModesThresholds.modes=a}return true},setCurrentPerformanceMode:function(a){this.thresholdMode=a;return a},setBandwidthThresholds:function(a){this.bandwidthModesThresholds=a},getPerformanceThreshold:function(){if(this.thresholdMode==PerformanceController.THRESHOLD_UNLIMITED){return this.performanceMonitoringLastSMA}else if(this.thresholdMode==PerformanceController.THRESHOLD_LIMITED){return this.performanceLastBroadcastedMode}},getBandwidth:function(){return Number((this.performanceBandwithLastMBpS*8).toFixed(3))},getBandwidthThreshold:function(){var a=this.getBandwidth();for(var b=0;b<=this.bandwidthModesThresholds.length-1;b++){var c=this.bandwidthModesThresholds[b];if(a>=c.min&&a<=c.max){return c.name;break}}return null},beginWebglPerformanceTest:function(){if(this.webglTestStarted)return;this.webglTestStarted=true;var a=this;window.setTimeout(function(){WebglPerformanceTest.create(null,a.endWebglPerformanceTest);WebglPerformanceTest.run()},500)},endWebglPerformanceTest:function(a,b,c){this.webglPerformanceScore=a;this.webglTestDone=true;Debug.add({webglScore:a},"webglScore","Performance");Debug.add({forceLowRes:a>PerformanceController.WEBGL_SCORE_FORCE_LOWRES},"forceLowRes","Performance");Debug.openFolder("Performance");AnalyticsController.getInstance().trackEvent(AnalyticsController.EVENT_PERFORMANCE_WEBGLSCORE,{value:a.toFixed(4)});console.log("WebGL Performance Score: "+a);Player.getInstance().startPreloadingVideo(a>PerformanceController.WEBGL_SCORE_FORCE_LOWRES)}},_private:{FLAG_MONITORING_PERFORMANCE:false,FLAG_VERBOSE_DEBUG:false,SAMPLE_STEP_SIZE:128,TEST_SAMPLE_SIZE_MULTIPLY:8,thresholdMode:"",quality:null,performanceModesThresholds:{step:15,rangeMin:24,rangeMax:40,modes:[{name:"LOW",min:0,max:20},{name:"MEDIUM",min:20,max:40},{name:"HIGH",min:40,max:Infinity}]},bandwidthModesThresholds:[{name:"LOW",min:0,max:6},{name:"MEDIUM",min:6,max:15},{name:"HIGH",min:15,max:Infinity}],perfromanceSMA:{targetSamples:0,index:0,total:0,list:[]},bandwidthSMA:{targetSamples:0,index:0,total:0,list:[]},performanceTickLoopID:-1,performanceMonitoringLastTime:0,performanceMonitoringLastSMA:-1,performanceBandwithLastMBpS:0,performanceLastBroadcasted:0,bandwidthTests:8,bandwidthDetecting:false,performanceStepCounter:0,performanceLastBroadcastedMode:"",performanceLastBroadcastedModeId:0,bandwidthTestStartTime:-1,bandwidthTestRunning:false,processPerformanceData:function(a){var b=this,c=PerformanceController.BANDWITH();if(this.FLAG_VERBOSE_DEBUG){$("#performance-debug").html("PerformanceController.FPS: "+a.sma+"<br>@lastFrameTime: "+a.lastFrameTime+"<br>@precision: "+(a.precision?"microseconds":"miliseconds")+"<br>@speedMBpS: "+(c>0?c+" ("+(c*8).toPrecision(3)+"Mbits)":"calculating..."))}if(this.performanceMonitoringLastSMA!==-1){if(this.thresholdMode==PerformanceController.THRESHOLD_UNLIMITED){if(this.performanceStepCounter++==this.performanceModesThresholds.step){this.performanceStepCounter=0;if(a.sma<=this.performanceModesThresholds.rangeMin){b.events.trigger(PerformanceController.EVENT_PERFORMANCE_DOWNGRADE,[a.sma])}if(a.sma>=this.performanceModesThresholds.rangeMax){b.events.trigger(PerformanceController.EVENT_PERFORMANCE_UPGRADE,[a.sma])}}}else if(this.thresholdMode==PerformanceController.THRESHOLD_LIMITED){var d="";for(var e=0;e<=this.performanceModesThresholds.modes.length-1;e++){var f=this.performanceModesThresholds.modes[e];if(a.sma>f.min&&a.sma<f.max){d=f;break}}if(d!=""&&this.performanceLastBroadcastedMode!=d.name){if(this.performanceLastBroadcastedModeId<e){b.events.trigger(PerformanceController.EVENT_PERFORMANCE_UPGRADE,[d.name])}else{b.events.trigger(PerformanceController.EVENT_PERFORMANCE_DOWNGRADE,[d.name])}this.performanceLastBroadcastedModeId=e;this.performanceLastBroadcastedMode=d.name}}}PerformanceController.setFPS(parseFloat(a.sma));this.performanceMonitoringLastSMA=a.sma},performanceTick:function(a){if(this.FLAG_MONITORING_PERFORMANCE){this.performanceTickLoopID=window.requestAnimationFrame(this.performanceTick.bind(this))}var b,c=a<1e12,d=this.perfromanceSMA.list[this.perfromanceSMA.index],e=this.bandwidthSMA.list[this.bandwidthSMA.index];b=window.performance.now()-this.performanceMonitoringLastTime;this.performanceMonitoringLastTime=window.performance.now();this.perfromanceSMA.total-=isNaN(d)?0:d;this.perfromanceSMA.total+=b;this.perfromanceSMA.list[this.perfromanceSMA.index]=b;if(++this.perfromanceSMA.index===this.perfromanceSMA.targetSamples){this.perfromanceSMA.index=0}this.bandwidthSMA.total-=isNaN(e)?0:e;this.bandwidthSMA.total+=this.performanceBandwithLastMBpS;this.bandwidthSMA.list[this.bandwidthSMA.index]=this.performanceBandwithLastMBpS;if(++this.bandwidthSMA.index===this.bandwidthSMA.targetSamples){this.bandwidthSMA.index=0}this.processPerformanceData({sma:(1e3/(this.perfromanceSMA.total/this.perfromanceSMA.targetSamples)).toPrecision(4),lastFrameTime:b,precision:c})},detectBandwidth:function(){if(this.bandwidthDetecting)return;this.bandwidthDetecting=true;this.bandwidthTests=5;this.beginDetectingBandwidth();this.events.on(PerformanceController.INTERNAL_EVENT_BANDWIDTH_TEST_FINISHED,this.beginDetectingBandwidth.bind(this))},detectLowFPS:function(a){var b=null;var c=20;var d=this;function e(d){if(TimelineController.getInstance().running){var f=PerformanceController.getFPS();if(f>a){b=null}else{if(b===null){b=d}else{if((d-b)/1e3>=c){PerformanceController.getInstance().events.trigger(PerformanceController.EVENT_LOW_FPS);return}}}}window.requestAnimationFrame(e)}window.requestAnimationFrame(e)},beginDetectingBandwidth:function(){if(this.bandwidthTests==1){this.bandwidthDetecting=false;this.events.unbind(PerformanceController.INTERNAL_EVENT_BANDWIDTH_TEST_FINISHED);this.events.trigger(PerformanceController.EVENT_BANDWIDTH_READY,[true]);return}this.bandwidthTests--;this.preformBandwithTest(this.bandwidthTests)},preformBandwithTest:function(a){if(this.bandwidthTestRunning)return;this.bandwidthTestRunning=true;if(a)this.TEST_SAMPLE_SIZE_MULTIPLY=a;var b=this,c=this.SAMPLE_STEP_SIZE*this.TEST_SAMPLE_SIZE_MULTIPLY,d=new XMLHttpRequest;try{d.responseType="text"}catch(e){console.log("skipping responseType on XHR")}d.onreadystatechange=function(){if(d.readyState===4){if(d.status===200){b.bandwidthTestRunning=false;b.updateBandwith(b.bandwidthTestStartTime)}else{b.bandwidthTestRunning=false;PerformanceController.getInstance().preformBandwithTest(this.TEST_SAMPLE_SIZE_MULTIPLY)}}else if(d.readyState===2){b.bandwidthTestStartTime=window.performance.now()}};d.onerror=function(){b.bandwidthTestRunning=false;PerformanceController.getInstance().preformBandwithTest(this.TEST_SAMPLE_SIZE_MULTIPLY)};d.open("GET",Resource.get("sampledata/"+c+".json?t="+(new Date).getTime()),true);if(XMLHttpRequest.prototype.hasOwnProperty("overrideMimeType"))d.overrideMimeType("text/plain; charset=x-user-defined");d.send(null)},updateBandwith:function(a){var b=this.SAMPLE_STEP_SIZE*this.TEST_SAMPLE_SIZE_MULTIPLY;this.performanceBandwithLastMBpS=b/(window.performance.now()-a);this.events.trigger(PerformanceController.INTERNAL_EVENT_BANDWIDTH_TEST_FINISHED,[true])},getBandwitch:function(){return this.bandwidthSMA.total/this.bandwidthSMA.targetSamples},addDebugBars:function(){$("body").append("<div id='performance-debug' style='font-family: monospace;position:fixed;top:0;left:0;background-color:white;'></div>")},detectHighLowFramerate:function(a){var b=null;var c=false;var d=this;var e=3;function f(d){var g=PerformanceController.getFPS();var h=PerformanceController.FRAMERATE_LOW_THRESHOLD;var i=PerformanceController.FRAMERATE_HIGH_THRESHOLD;if((TimelineController.getInstance().running||!a)&&g>0){if(g<i&&g>h){b=null;c=false}else{if(b===null||c!==g<=h){b=d;c=g<=h}else{if((d-b)/1e3>=e){b=null;if(c)PerformanceController.getInstance().events.trigger(PerformanceController.EVENT_PERFORMANCE_LOW);else PerformanceController.getInstance().events.trigger(PerformanceController.EVENT_PERFORMANCE_HIGH);c=true}}}}window.requestAnimationFrame(f)}console.log("start fps detection",b===null);window.requestAnimationFrame(f)}}});var CameraController=Class._extend(Class.SINGLETON,{_static:{EVENT_ALLOW:"CameraController_EVENT_ALLOW",EVENT_DENY:"CameraController_EVENT_DENY",EVENT_VIDEO_READY:"CameraController_EVENT_VIDEO_READY",SCREEN_WIDTH_FOR_HD_WEBCAM:2e3,WEBGL_PERFORMANCE_FOR_HD_WEBCAM_MAC:.6,WEBGL_PERFORMANCE_FOR_HD_WEBCAM_OTHERS:.4},_public:{width:0,height:0,construct:function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;this.initVideo()},getStream:function(){return this.stream},getVideo:function(){return this.video},getRatio:function(){if(this.video&&this.video.videoWidth&&this.video.videoHeight){return this.video.videoWidth/this.video.videoHeight}else{return 16/9}},getNewVideo:function(){var a=document.createElement("video");a.src=window.URL.createObjectURL(this.stream);return a},init:function(){var a=this;if(this.initialised){return}this.initialised=true;if(navigator.getUserMedia){var b={video:{mandatory:{minWidth:1280,minHeight:720}}};var c={video:true};DetectionController.getInstance().detectDisplay();DetectionController.getInstance().detectOs();if(DetectionController.getInstance().isRetina){c=b}else if(PerformanceController.getInstance().webglTestDone){var d=DetectionController.getInstance().isMac?CameraController.WEBGL_PERFORMANCE_FOR_HD_WEBCAM_MAC:CameraController.WEBGL_PERFORMANCE_FOR_HD_WEBCAM_OTHERS;if(PerformanceController.getInstance().webglPerformanceScore<=d)c=b}navigator.getUserMedia(c,function(d){if(window.location.protocol==="https:"&&/HD/.test(steam.getVideoTracks()[0].label)&&c!==b){console.log(steam.getVideoTracks()[0].label+" camera should be started as HD. Restarting the camera with mandatory constraints.");d.stop();navigator.getUserMedia(b,function(b){a.onCameraAllow(b)},function(){a.onCameraDeny()})}else{a.onCameraAllow(d)}},function(){a.onCameraDeny()})}},isVideoEnabled:function(){return this.videoEnabled}},_private:{stream:null,video:null,videoReady:false,videoEnabled:false,initVideo:function(){this.videoReady=false;this.video=document.createElement("video")},onCameraAllow:function(a){var b=this;this.videoEnabled=true;this.stream=a;this.video.src=window.URL.createObjectURL(this.stream);this.video.play();this.video.addEventListener("loadeddata",function(){b.onVideoReady()});AnalyticsController.getInstance().trackEvent(AnalyticsController.EVENT_CAMERA_ALLOW);this.events.trigger(CameraController.EVENT_ALLOW)},onCameraDeny:function(){console.log("Camera Denied");AnalyticsController.getInstance().trackEvent(AnalyticsController.EVENT_CAMERA_DENY);this.events.trigger(CameraController.EVENT_DENY);this.initialised=false;this.videoEnabled=false},onVideoReady:function(){this.videoReady=true;this.width=this.video.videoWidth;this.height=this.video.videoHeight;console.log("Camera res: ",this.width,this.height);this.events.trigger(CameraController.EVENT_VIDEO_READY)}}});var AnimationController=Class._extend(Class.SINGLETON,{_static:{EVENT_FRAME:"AnimationController_EVENT_FRAME"},_public:{construct:function(){this.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}},start:function(){var a=this;if(this.running){return}this.running=true;this.requestAnimationFrame.call(window,function(){a.onFrame()})},stop:function(){this.running=false}},_private:{requestAnimationFrame:null,running:false,onFrame:function(){var a=this;this.events.trigger(AnimationController.EVENT_FRAME);if(this.running){if(window.stats){window.stats.begin()}this.requestAnimationFrame.call(window,function(){a.onFrame()});if(window.stats){window.stats.end()}}}}});var TimelineController=Class._extend(Class.SINGLETON,{_static:{TIMELINE_RAW_DATA:{},TIMELINE_RAW_MOUSE_DATA:{},TIME_TRACKING_ACTIVE_UNTIL:246,KEEP_INTERACTIONS_RUNNING_WHEN_PAUSED:true,EVENT_START:"TimelineController_EVENT_START",EVENT_PAUSE:"TimelineController_EVENT_PAUSE",EVENT_RESUME:"TimelineController_EVENT_RESUME",EVENT_END:"TimelineController_EVENT_END",EVENT_SEEK:"TimelineController_EVENT_SEEK",DISABLE_SEEK_INTERACTION:"TimelineController_DISABLE_SEEK_INTERACTION",ENABLE_SEEK_INTERACTION:"TimelineController_ENABLE_SEEK_INTERACTION",ACTION_ADD_CAPTION:"TimelineController_ACTION_ADD_CAPTION",DIRECT_FLAG:false,RESTARTING_FLAG:false,RENDERING_QUALITIES:[256,512,640,800,960,1120,1280,1440,1600,1760,1920],QUALITY_TRACKING_RATES:{1920:27,1760:26,1600:25,1440:24,1280:24,1120:24,960:22,800:20,640:20,512:18,256:12},QUALITY_FPS_THRESHOLDS:{1920:{low:57,high:59},1760:{low:57,high:59},1600:{low:57,high:59},1440:{low:57,high:59},1280:{low:29,high:59},1120:{low:28,high:50},960:{low:24,high:50},800:{low:24,high:45},640:{low:18,high:45},512:{low:3,high:35},256:{low:2,high:16}}},_public:{initialised:false,video:null,audio:null,player:null,videoTexture:null,seekTarget:0,seeked:false,activeSequences:[],sequences:[],renderSize:1280,trackingRate:24,construct:function(){this.player=Player.getInstance()},init:function(){if(this.initialised){return}this.$interactions=ViewController.getInstance().getView("ExperienceView").$container.find(".interactions");RendererController.getInstance().init();RendererController.getInstance().add(this.$interactions);InputController.getInstance().setContainer($(window));this.player=Player.getInstance();this.video=this.player.video;this.audio=this.player.audio;this.videoTexture=new VideoTexture(this.video,this.video.videoWidth,this.video.videoHeight,Player.VIDEO_FRAMERATE);console.log("Creating Video Texture",this.video,this.video.videoWidth,this.video.videoHeight);Debug.add(this,"renderSize","Performance");Debug.add(this,"trackingRate","Performance");this.initSequences(TimelineController.TIMELINE_RAW_DATA);this.setRenderingQuality(this.videoTexture.width);this.bindEvents();this.initialised=true;this.running=true;this.events.trigger(TimelineController.EVENT_START);Viewport.getInstance().updateBox();this.player.play();var a=this;RemoteController.getInstance().events.bind(RemoteController.EVENT_EXPERIENCE_RESTART+".TimelineController",function(b,c){a.restartExperience()});if(TimelineController.DIRECT_FLAG){CameraController.getInstance().events.bind(CameraController.EVENT_VIDEO_READY+".TimelineController",function(){InputController.getInstance().setMode(InputController.INPUT_TYPE_TRACKING)});CameraController.getInstance().init();RemoteController.getInstance().events.on(RemoteController.EVENT_CONNECTION_CODE_READY+".TimelineController",function(b,c){a.displayConnectionCode(c)});RemoteController.getInstance().events.on(RemoteController.EVENT_PEER_ENTER+".TimelineController",function(){a.removeConnectionCodeBox()});RemoteController.getInstance().events.on(RemoteController.EVENT_PEER_READY+".TimelineController",function(){RemoteController.getInstance().start()});RemoteController.getInstance().events.bind(RemoteController.EVENT_PEER_LEAVE+".TimelineController",function(a,b){console.log("Restarting: ",b);RemoteController.getInstance().host()});if(this.getQueryVariable("t")){this.seekTarget=parseFloat(this.getQueryVariable("t"));this.resume();this.player.seek(this.seekTarget)}if(this.getQueryVariable("i")){var b=this.getQueryVariable("i");for(var c=0;c<=TimelineController.TIMELINE_RAW_DATA.timeline.length-1;c++){if(TimelineController.TIMELINE_RAW_DATA.timeline[c].id==b){this.seekTarget=TimelineController.TIMELINE_RAW_DATA.timeline[c].start;break}}this.resume();this.player.seek(this.seekTarget)}RemoteController.getInstance().host()}},start:function(){var a=this;if(this.initialised){Player.getInstance().play()}else{PreloadController.getInstance().events.on(PreloadController.EVENT_EXPERIENCE_COMPLETE+".TimelineController",function(){a.init()});PreloadController.getInstance().preloadExperience()}this.running=true;PerformanceController.getInstance().events.bind(PerformanceController.EVENT_PERFORMANCE_LOW+".TimelineController",function(){if(!a.running)return;var b=0;var c=TimelineController.RENDERING_QUALITIES;for(var d=0;d<c.length;d++){if(a.renderSize===c[d])b=d}if(b>0){--b;a.setRenderingQuality(TimelineController.RENDERING_QUALITIES[b])}});PerformanceController.getInstance().events.bind(PerformanceController.EVENT_PERFORMANCE_HIGH+".TimelineController",function(){if(!a.running)return;var b=0;for(var c=0;c<TimelineController.RENDERING_QUALITIES.length;c++){if(a.renderSize===TimelineController.RENDERING_QUALITIES[c])b=c}if(b<TimelineController.RENDERING_QUALITIES.length-1){++b;a.setRenderingQuality(TimelineController.RENDERING_QUALITIES[b])}})},getQueryVariable:function(a){var b=window.location.search.substring(1);var c=b.split("&");for(var d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==a){return e[1]}}return false},removeConnectionCodeBox:function(){$("#code-debug").remove()},setRestartFlag:function(){TimelineController.RESTARTING_FLAG=true;this.restartExperience()},displayConnectionCode:function(a){$("#code-debug").remove();$("body").append("<div id='code-debug'></div>");$("#code-debug").html(a)},pause:function(){if(!this.running){return}this.running=false;this.activeSequences.forEach(function(a){a.pause()});this.player.pause();this.events.trigger(TimelineController.EVENT_PAUSE)},restartExperience:function(){this.seekTarget=0;this.player.seek(0);this.player.play();this.events.trigger(TimelineController.EVENT_START);this.running=true;TimelineController.RESTARTING_FLAG=false},resume:function(){if(this.running){return}this.running=true;this.activeSequences.forEach(function(a){a.resume()});this.player.play();this.events.trigger(TimelineController.EVENT_RESUME)},stop:function(){this.player.seek(0);this.pause();this.endFinishedInteractions(true);PerformanceController.getInstance().events.unbind(PerformanceController.EVENT_PERFORMANCE_LOW+".TimelineController");PerformanceController.getInstance().events.unbind(PerformanceController.EVENT_PERFORMANCE_HIGH+".TimelineController")},toggle:function(){if(this.running){this.pause()}else{this.resume()}},canShowDisconnectionError:function(){return InputController.getInstance().mode===InputController.INPUT_TYPE_TRACKING&&Player.getInstance().getCurrentTime()<280&&!ViewController.getInstance().getView("EndScreenView").shown}},_private:{running:false,currentTime:0,initSequences:function(a){var b,c;for(c=0;c<a.timeline.length;c++){if(!a.timeline[c].ignore){b=new window[a.timeline[c]["class"]](a.timeline[c].id,this.$interactions,this.video,this.audio,this.videoTexture);b.audio=this.audio;b.video=this.video;b.videoTexture=this.videoTexture;b.startTime=this.parseTime(a.timeline[c].start);b.endTime=this.parseTime(a.timeline[c].end);b.defaultOptions=this.cloneSettings(a.timeline[c].settings);b.currentOptions=this.cloneSettings(a.timeline[c].settings);b.transitions=a.timeline[c].transitions;b.init();b.changeVideoQuality(this.videoTexture.width,this.videoTexture.height);this.sequences.push(b)}}},bindEvents:function(){var a=this;this.player.events.bind(Player.EVENT_ENDED+".TimelineController",function(){a.onEnd()});AnimationController.getInstance().events.bind(AnimationController.EVENT_FRAME+".TimelineController",function(){a.onFrame()});RemoteController.getInstance().events.bind(RemoteController.EVENT_PEER_ENTER+".TimelineController",function(){a.onPeerEnter()});a.events.bind(TimelineController.EVENT_SEEK+".TimelineController",function(){TimelineController.getInstance().events.trigger(TimelineController.DISABLE_SEEK_INTERACTION,[true]);a.resume();a.player.seek(a.seekTarget*a.player.getDuration())});Player.getInstance().events.bind(Player.EVENT_SEEK_START+".TimelineController",function(){a.onSeekStart()});Player.getInstance().events.bind(Player.EVENT_SEEKED+".TimelineController",function(){a.onSeeked()})},startNewInteractions:function(){var a,b=this.player.getCurrentTimeVideo();for(a=0;a<this.sequences.length;++a){if(b>=this.sequences[a].startTime&&b<=this.sequences[a].endTime){this.sequences[a].active=true;console.log("-- begin",this.sequences[a].id);this.sequences[a].begin();this.activeSequences.push(this.sequences[a]);this.sequences.splice(a,1);--a}}},endFinishedInteractions:function(a){var b,c=this.player.getCurrentTimeVideo();for(b=0;b<this.activeSequences.length;++b){if(c<this.activeSequences[b].startTime||c>this.activeSequences[b].endTime||a){this.activeSequences[b].active=false;var d=this.activeSequences[b];console.log("End:",this.activeSequences[b]);if(this.activeSequences[b].transitions){for(j=0;j<this.activeSequences[b].transitions.length;j++){this.activeSequences[b].transitions[j].active=false;this.activeSequences[b].transitions[j].hasPlayed=false}}if(d.defaultOptions){for(var e in d.defaultOptions){d.currentOptions[e]=d.defaultOptions[e]}}console.log("-- end",this.activeSequences[b].id);this.activeSequences[b].end();this.sequences.push(this.activeSequences[b]);this.activeSequences.splice(b,1);--b}}},updateActiveInteractions:function(a,b){var c=this,d=this.player.getCurrentTimeVideo(),e=d,f=0,g=this.videoTexture.currentFrame,h=0,i=null,j,k,l,m,n;this.activeSequences.forEach(function(o){var p;f=e-o.startTime;h=g-Math.floor(o.startTime*Player.VIDEO_FRAMERATE);if(o.defaultOptions){for(var q in o.currentOptions[p]){o.currentOptions[p]=o.defaultOptions[p]}}if(o.transitions){for(j=0;j<o.transitions.length;j++){i=o.transitions[j];k=false;l=0;switch(i.time){case"absoluteTime":k=e>=i.start&&e<=i.end;l=(e-i.start)/(i.end-i.start);break;case"relativeTime":k=f>=i.start&&f<=i.end;l=(f-i.start)/(i.end-i.start);break;case"absoluteFrame":k=g>=i.start&&g<=i.end;l=(g-i.start)/(i.end-i.start);break;case"relativeFrame":k=h>=i.start&&h<=i.end;l=(h-i.start)/(i.end-i.start);break}if(b)console.log("Transition"+i.name+" > < "+l);if(k){switch(i.type){case"cut":for(p in i.values){if(i.values[p]!==undefined){o.currentOptions[p]=i.values[p]==="default"?o.defaultOptions[p]:i.values[p];i.active=false}}break;default:for(p in i.valuesStart){if(i.valuesStart[p]!==undefined){m=i.valuesStart[p]==="default"?o.defaultOptions[p]:i.valuesStart[p];n=i.valuesEnd[p]==="default"?o.defaultOptions[p]:i.valuesEnd[p];o.currentOptions[p]=m+(n-m)*l;i.active=true}}}}else if(!b&&i.active||l>=1&&!i.hasPlayed||b&&l>=1){if(b)console.log("Forcing Transition End Values:",i.name,l);i.active=false;i.hasPlayed=true;var r=i.valuesEnd||i.values||{};for(p in r){if(r[p]!==undefined){console.log("       "+p,"->",r[p]==="default"?o.defaultOptions[p]:r[p]);o.currentOptions[p]=r[p]==="default"?o.defaultOptions[p]:r[p]}}}else{i.active=false}}}o.onFrame(o.currentOptions,c.videoTexture.currentFrame-Math.floor(o.startTime*23.987),d-o.startTime,(d-o.startTime)/(o.endTime-o.startTime),TrackingController.getInstance().getFrameInfo(),OrientationController.getInstance().getFrameInfo(),a)})},parseTime:function(a){var b,c;if(parseFloat(a)===a){return parseFloat(a,10)/Player.VIDEO_FRAMERATE}b=a.split(":");if(b.length===1){c=parseInt(a,10)}else if(b.length===2){c=parseInt(b[0],10)+parseInt(b[1],10)*.001}else{c=parseInt(b[0],10)*60+parseInt(b[1],10)+parseInt(b[2],10)*.001}return c},cloneSettings:function(a){var b={},c;for(c in a){if(a[c]!==undefined){b[c]=a[c]}}b.auto=true;return b},updateTimeBasedSettings:function(){if(InputController.getInstance().mode===InputController.INPUT_TYPE_TRACKING){TrackingController.getInstance().start()}},checkConnection:function(){if(!RemoteController.getInstance().peerNode&&this.canShowDisconnectionError()){RemoteController.getInstance().events.trigger(RemoteController.EVENT_PEER_LEAVE)}},onFrame:function(){if(!this.running&&!TimelineController.KEEP_INTERACTIONS_RUNNING_WHEN_PAUSED){return}this.currentTime=this.player.getCurrentTimeVideo();InputController.getInstance().update(TrackingController.getInstance().isReady(),TrackingController.getInstance().getFrameInfo(),OrientationController.getInstance().getFrameInfo());this.videoTexture.update();this.endFinishedInteractions();this.startNewInteractions();if(this.seeked)console.log("Seeked Complete");this.updateActiveInteractions(this.running,this.seeked);this.seeked=false;this.videoTexture.endFrame();this.updateTimeBasedSettings()},onSeekStart:function(){var a;for(a=0;a<this.activeSequences.length;++a){this.activeSequences[a].seekStart()}},onSeeked:function(){console.log("onseek",this.shown);this.seeked=true;for(var a=0;a<this.activeSequences.length;++a){this.activeSequences[a].seek()}this.checkConnection();this.updateActiveInteractions(this.running,true)},onPeerEnter:function(){this.onSeeked()},onEnd:function(){this.stop();RemoteController.getInstance().end();RoutingController.getInstance().route("/end")},setRenderingQuality:function(a){var b=Math.floor(a*.525);this.renderSize=a;for(var c=0;c<this.sequences.length;c++){this.sequences[c].changeRenderQuality(a,b)}this.trackingRate=TimelineController.QUALITY_TRACKING_RATES[a.toString()];
var d=TimelineController.QUALITY_FPS_THRESHOLDS[a.toString()];if(d){PerformanceController.FRAMERATE_LOW_THRESHOLD=d.low;PerformanceController.FRAMERATE_HIGH_THRESHOLD=d.high;console.log(">>> Selected a new rendering quality: ",a+"x"+b,", and a new tracking framerate: ",TimelineController.QUALITY_TRACKING_RATES[a.toString()]," <<<");console.log("Peformance FrameRate Thresholds - low:",PerformanceController.FRAMERATE_LOW_THRESHOLD,PerformanceController.FRAMERATE_HIGH_THRESHOLD);TrackingController.getInstance().setUpdateRate(this.trackingRate)}else{console.warn("No threshold for width",a)}}}});var TextureUpdateController=Class._extend(Class.SINGLETON,{_public:{addTexture:function(a,b,c,d){if(!c){throw new Error("Need to set renderer in TextureUpdateManager")}b=b===undefined?24:b;b=1e3/b;this.allTextures.push({texture:a,framerate:b,updateDelay:1e3/b,lastUpdate:0,updateCallback:d,renderer:c,desync:false})},removeTexture:function(a){this.allTextures.forEach(function(b,c){if(b.texture===a){this.allTextures.splice(c,1)}})},updateTextures:function(){var a,b,c=false,d;for(d=0;d<this.allTextures.length;d++){a=this.allTextures[d];if(Date.now()-a.lastUpdate>=a.updateDelay&&!a.desync){a.lastUpdate=true;b=a.texture;if(a.updateCallback){a.updateCallback.call()}if(typeof b.preUpdateCallback==="function"){b.preUpdateCallback()}b.needsUpdate=true;a.renderer.setTexture(b,0);b.wasUpdated=true;b.currentFrame=b.image.currentTime/a.framerate;a.texture.wasUpdated=true;c=true}a.desync=false}if(!c&&this.allTextures.length>1&&this.lastDesync<=0){this.lastDesync=100;this.allTextures[Math.floor(Math.random()*this.allTextures.length)].desync=true;console.log("Desyncing Textures")}else if(!c){this.lastDesync--}return c},forceUpdateTexture:function(){return}},_private:{allTextures:[],lastDesync:0,lastTextureUpdate:0}});var TrackingController=Class._extend(Class.SINGLETON,{_static:{EVENT_READY:"TrackingController_EVENT_READY",EVENT_UPDATE:"TrackingController_EVENT_UPDATE",PATH_TO_TRACKING_WORKER:"/src/desktop/js/worker/",PATH_TO_SHADERS:"/shaders/tracking/",TRACKING_SIZE:256,ORIENTATION_RESET_MAX_MOTION_SPEED:.075},_public:{tracking:null,initialised:false,mainVideo:null,renderer:null,ready:false,debugView:null,construct:function(){},init:function(){if(this.initialised){return}this.initialised=true;var a=this;this.renderer=new THREE.WebGLRenderer({antialias:false});this.renderer.setClearColor(0,0);this.renderer.setSize(TrackingController.TRACKING_SIZE,TrackingController.TRACKING_SIZE);this.renderer.autoClear=false;this.mainVideo=CameraController.getInstance().getVideo();this.tracking=new Tracking;this.tracking.start({renderer:this.renderer,useWebWorkers:true,workerPath:TrackingController.PATH_TO_TRACKING_WORKER,useAnimationFrame:true,video:this.mainVideo,loadVideo:false,shaders:undefined,loadExternalShaders:true,shaderPath:TrackingController.PATH_TO_SHADERS,options:{"static":false},debugView:this.debugView,onresetorientation:function(b){a.onOrientationReset(b)},onluminosity:function(b,c){a.onLuminosity(b,c)},onready:function(b){a.onReady(b)},onerror:function(b){a.onError(b)},onupdate:function(b){a.onUpdate(b)}})},start:function(){if(this.running||InputController.getInstance().mode===InputController.INPUT_TYPE_MOUSE){return}this.running=true;if(this.tracking){this.tracking.resume()}},stop:function(){if(!this.running){return}this.running=false;if(this.tracking){this.tracking.stop()}},getFrameInfo:function(){return this.tracking.getPosition().clone()},getPersistence:function(){return this.tracking.persistence},isTouchingSide:function(){return this.tracking.isTouchingSide},isFrontal:function(){return this.tracking.isFrontal()},isVisible:function(){return this.tracking.foundHole},isReady:function(){return this.ready},setFrontalTolerance:function(a,b,c){this.tracking.frontalTolerance.x=a;this.tracking.frontalTolerance.y=b;this.tracking.frontalTolerance.z=c},getLife:function(){return this.tracking.phoneLife},addDebugView:function(a){this.debugView=a;if(this.tracking)this.tracking.addDebugView(a)},showDebugContours:function(a){if(!this.tracking)return;this.tracking.showDebugContours(a)},setUpdateRate:function(a){if(!this.tracking)return;this.tracking.VIDEO_UPDATE_RATE=1e3/a},toString:function(){return"[Tracking]"}},_private:{onFrame:function(){console.log(this.running);if(!this.running)return;this.tracking.run()},onOrientationReset:function(a){OrientationController.getInstance().resetOrientation(a||clocksync.time())},onLuminosity:function(a,b){RemoteController.getInstance().setLuminosity(a,b)},onReady:function(a){if(!this.ready){this.ready=true;this.events.trigger(TrackingController.EVENT_READY)}},onUpdate:function(a){if(!this.ready){this.ready=true;this.events.trigger(TrackingController.EVENT_READY)}this.events.trigger(TrackingController.EVENT_UPDATE)},onError:function(a){console.log(this+" Error: ",a.toString())}}});var OrientationController=Class._extend(Class.SINGLETON,{_static:{MAX_NUM_OF_RESETS:2},_public:{rawQuaternion:{x:0,y:0,z:0,w:1},worldQuaternion:{x:0,y:0,z:0,w:1},worldAcceleration:{x:0,y:0,z:0},referenceQuaternion:new THREE.Quaternion(0,1,0,0),timesReset:0,lastTime:0,lastDirection:0,smoothMotionSpeed:0,rawMotionSpeed:0,messagesGotTmp:0,touchStartTime:0,lastTouchStartTime:0,touchMoveTime:0,lastTouchMoveTime:0,touchEndTime:0,lastTouchEndTime:0,construct:function(){Debug.add(this,"timesReset","Mobile");Debug.add(this,"touchStartTime","Mobile");Debug.add(this,"touchMoveTime","Mobile");Debug.add(this,"touchEndTime","Mobile");Debug.openFolder("Mobile")},start:function(){var a=this;if(this.started){return}RemoteController.getInstance().events.bind(RemoteController.EVENT_PEER_ORIENTATION+".OrientationController",function(){a.onOrientationChange.apply(a,arguments)});RemoteController.getInstance().events.bind(RemoteController.EVENT_DEVICE_INACTIVE+".OrientationController",function(){a.onDeviceInactive.apply(a,arguments)});RemoteController.getInstance().events.bind(RemoteController.EVENT_TOUCH+".OrientationController",function(){a.onTouch.apply(a,arguments)});AnimationController.getInstance().events.bind(AnimationController.EVENT_FRAME+".OrientationController",function(){a.onFrame()});this.started=true},stop:function(){if(!this.started){return}RemoteController.getInstance().events.unbind(RemoteController.EVENT_PEER_ORIENTATION+".OrientationController");RemoteController.getInstance().events.unbind(RemoteController.EVENT_DEVICE_INACTIVE+".OrientationController");this.started=false},getFrameInfo:function(){return this.worldQuaternion},getRawQuaternion:function(){return this.rawQuaternion},resetOrientation:function(a){if(!this.resetPending){this.resetTimestamp=a;this.resetPending=true}},resetResetInformation:function(){this.timesReset=0}},_private:{started:false,resetPending:false,resetQuaternion:null,touchUp:false,touchUpTimeoutId:-1,calibrate:function(a){console.log(">>> Calibrate <<<");if(this.timesReset<OrientationController.MAX_NUM_OF_RESETS){this.referenceQuaternion=new THREE.Quaternion(a.x,a.y,a.z,-a.w)}else{console.log(">>> Orientation Reset slerp <<<");this.referenceQuaternion.slerp(new THREE.Quaternion(a.x,a.y,a.z,-a.w),.35)}this.timesReset++;this.resetPending=false},onOrientationChange:function(a,b){if(this.resetPending){if(b.timestamp>=this.resetTimestamp){this.calibrate(this.resetQuaternion||b.worldQuaternion)}else{console.log("-- calibrate skip outdated --")}this.resetQuaternion=b.worldQuaternion}var c=Math.max(Math.min((Date.now()-this.lastTime)/100,3),.25);this.lastTime=Date.now();this.worldAcceleration.x=b.worldAcceleration.x;this.worldAcceleration.y=b.worldAcceleration.y;this.worldAcceleration.z=b.worldAcceleration.z;this.rawQuaternion.x=b.worldQuaternion.x;this.rawQuaternion.y=b.worldQuaternion.y;this.rawQuaternion.z=b.worldQuaternion.z;this.rawQuaternion.w=b.worldQuaternion.w;var d=new THREE.Quaternion(this.referenceQuaternion.x,this.referenceQuaternion.y,this.referenceQuaternion.z,this.referenceQuaternion.w);d=d.multiply(this.rawQuaternion);this.worldQuaternion.x=d.x;this.worldQuaternion.y=d.y;this.worldQuaternion.z=d.z;this.worldQuaternion.w=d.w;var e=new THREE.Vector3(0,0,1).applyQuaternion(this.rawQuaternion).z;this.rawMotionSpeed=Math.abs(this.lastDirection-e);this.smoothMotionSpeed=Math.abs(this.lastDirection-e)*.25*c+this.smoothMotionSpeed*(1-.25*c);this.lastDirection=e;return a},onDeviceInactive:function(){console.log(">> Device inactive, losing orientation reset info <<");this.timesReset=0},onTouch:function(a,b,c){switch(b){case"start":this.lastTouchStartTime=c;break;case"move":this.lastTouchMoveTime=c;break;case"end":this.lastTouchEndTime=c;break}},onFrame:function(){var a=clocksync.time();this.touchStartTime=((this.lastTouchStartTime-a)*.001).toFixed(2);this.touchMoveTime=((this.lastTouchMoveTime-a)*.001).toFixed(2);this.touchEndTime=((this.lastTouchEndTime-a)*.001).toFixed(2);if(TimelineController.getInstance().currentTime<ExperienceView.BREAK_FREE_START_TIME&&(this.lastTouchStartTime===0&&this.lastTouchMoveTime===0||Math.max(this.lastTouchStartTime,this.lastTouchMoveTime,this.lastTouchEndTime)===this.lastTouchEndTime)){if(!this.touchUp){this.touchUp=true;clearTimeout(this.touchUpTimeoutId);this.touchUpTimeoutId=setTimeout(function(){$("html").addClass("touch-up")},1e3)}}else{if(this.touchUp){clearTimeout(this.touchUpTimeoutId);this.touchUp=false;$("html").removeClass("touch-up")}}}}});var RendererController=Class._extend(Class.SINGLETON,{_static:{SCALE_TYPE_CSS:"RendererController_SCALE_TYPE_CSS",SCALE_TYPE_WEBGL:"RendererController_SCALE_TYPE_WEBGL",RATIO:1920/1008,SIDE_FLARE_SIZE_MIN:.5,SIDE_FLARE_SIZE_MAX:4,SIDE_FLARE_SIDE_DURATION:2e3,SIDE_FLARE_ALPHA_STANDARD:.35,SIDE_FLARE_ALPHA_INCREASE:.75,NOISE_PATH:["media/images/noise/noise_ps_gray_1/noise_couleur0.jpg","media/images/noise/noise_ps_gray_1/noise_couleur1.jpg","media/images/noise/noise_ps_gray_1/noise_couleur2.jpg"]},_public:{noiseTextures:null,currentNoiseTexture:0,defaultMaterial:null,material:null,flareTexture:null,initialised:false,scene:null,camera:null,renderer:null,plane:null,guiPlanes:[],lastTime:0,hitSideTime:0,hitSide:false,interactionEnabled:true,width:1280,height:672,blendingMode:5,noiseAlpha:.1,nearExposure:.7,flickerNear:.2,flickerFar:.03,crazyMotionExposure:.5,crazyMotionRandom:1.5,construct:function(){},init:function(){var a=this;if(this.initialised){return}console.log("-- render");this.renderer=new THREE.WebGLRenderer({antialias:false,alpha:false});window.renderer=this.renderer;this.scene=new THREE.Scene;this.camera=new THREE.Camera(-1,1,-1,1,-1,1);this.flareTexture=AssetsController.getInstance().getFile("media/images/interface/sides.png");this.flareTexture.format=THREE.RGBAFormat;this.flareTexture.minFilter=THREE.LinearMipMapLinearFilter;this.flareTexture.generateMipmaps=true;this.flareTexture.needsUpdate=true;this.defaultMaterial=this.material=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/renderer/textureNoiseSides.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/renderer/textureNoiseSides.frag"),uniforms:{tDiffuse:{type:"t",value:null},tNoise:{type:"t",value:null},tFlare:{type:"t",value:this.flareTexture},saturation:{type:"f",value:1},exposure:{type:"f",value:1},randomOffset:{type:"v2",value:new THREE.Vector2},blending:{type:"i",value:this.blendingMode},noiseAlpha:{type:"f",value:1},sidesSize:{type:"v2",value:new THREE.Vector2(.005*.525,.005)},sidesSizeInverse:{type:"v2",value:new THREE.Vector2(1-.005*.525,1-.005)},sideFlarePosition:{type:"v2",value:new THREE.Vector2(.25,.25)},sideFlareSize:{type:"f",value:1},sideFlareAlpha:{type:"f",value:RendererController.SIDE_FLARE_ALPHA_STANDARD}},attributes:{},side:THREE.DoubleSide});this.plane=new THREE.Mesh(new THREE.PlaneGeometry(2,2,1,1),this.material);this.scene.add(this.plane);this.guiPlanes=[];if(RendererController.NOISE_PATH&&RendererController.NOISE_PATH.length){this.noiseTextures=[];for(var b=0;b<RendererController.NOISE_PATH.length;b++){this.noiseTextures[b]=AssetsController.getInstance().getFile(RendererController.NOISE_PATH[b]);this.noiseTextures[b].wrapS=THREE.RepeatWrapping;this.noiseTextures[b].wrapT=THREE.RepeatWrapping;this.noiseTextures[b].format=THREE.RGBFormat;this.noiseTextures[b].magFilter=THREE.LinearFilter;this.noiseTextures[b].minFilter=THREE.LinearMipMapLinearFilter;this.noiseTextures[b].generateMipmaps=true;this.noiseTextures[b].needsUpdate=true}}$(window).bind("resize",function(){if(a.container){a.onResize()}});this.initialised=true;this.lastTime=Date.now()},setNoiseTextures:function(a){this.noiseTextures=a},setMaterial:function(a,b){this.noiseTextures=b;this.material=this.plane.material=a},setDefaultMaterial:function(){this.noiseTextures=null;this.material=this.plane.material=this.defaultMaterial},setMaterialUniform:function(a,b){if(this.material.uniforms[a])this.material.uniforms[a].value=b},getRenderer:function(){return this.renderer},onResize:function(){var a,b,c=0,d=0,e=0,f=0;if(!this.container){return}a=this.container.width();b=this.container.height();if(a/b>1920/1008){d=b;c=b*(1920/1008)}else{c=a;d=a*(1008/1920)}e=(a-c)/2;f=(b-d)/2;this.width=Math.min(1280,c);this.height=Math.min(672,d);this.renderer.setSize(this.width,this.height);$(this.renderer.domElement).css({"-webkit-transform":"translate("+e+"px,"+f+"px)","-moz-transform":"translate("+e+"px,"+f+"px)",transform:"translate("+e+"px,"+f+"px)",width:c+"px",height:d+"px"});if(!this.initialised)return;this.renderer.render(this.scene,this.camera)},renderToScreen:function(a,b,c){if(!this.initialised)throw new Error("Trying to render before renderer was initialised.");this.material.uniforms.tDiffuse.value=a;this.plane.scale.x=b?-1:1;this.plane.scale.y=c?-1:1;if(this.material.uniforms.sideFlarePosition){var d=InputController.getInstance().getPositionRaw();var e=this.material.uniforms.sidesSize.value.x;var f=1-this.material.uniforms.sidesSize.value.x;this.material.uniforms.sideFlarePosition.value.set(Math.max(Math.min(d.x*.5*this.plane.scale.x+.5,f),e),Math.max(Math.min(d.y*.5*this.plane.scale.y+.5,f),e));this.material.uniforms.sideFlareSize.value=RendererController.SIDE_FLARE_SIZE_MIN+d.z*(RendererController.SIDE_FLARE_SIZE_MAX-RendererController.SIDE_FLARE_SIZE_MIN);if(this.hitSide&&!TrackingController.getInstance().isTouchingSide()){this.hitSide=false;this.material.uniforms.sideFlareAlpha.value=RendererController.SIDE_FLARE_ALPHA_STANDARD}else if(TrackingController.getInstance().isTouchingSide()){if(!this.hitSide){this.hitSide=true;this.hitSideTime=Date.now()}var g=1-Math.min((Date.now()-this.hitSideTime)/RendererController.SIDE_FLARE_SIDE_DURATION,1);g=Math.sin(g*Math.PI*.5);this.material.uniforms.sideFlareAlpha.value=g*RendererController.SIDE_FLARE_ALPHA_INCREASE+RendererController.SIDE_FLARE_ALPHA_STANDARD}if(InputController.getInstance().isUsingMouse()||!this.interactionEnabled)this.material.uniforms.sideFlareAlpha.value=0}if(this.noiseTextures){this.currentNoiseTexture++;if(this.currentNoiseTexture>=this.noiseTextures.length)this.currentNoiseTexture=0;this.material.uniforms.tNoise.value=this.noiseTextures[this.currentNoiseTexture];this.material.uniforms.randomOffset.value.set(Math.random(),Math.random());this.material.uniforms.noiseAlpha.value=this.noiseAlpha}var h=1-InputController.getInstance().getPositionDirectional().z;h=this.cmap(h,.15,.9,0,1);h=Math.pow(h,1.5);if(!this.interactionEnabled)h=0;var i=this.cmap(h,0,1,this.flickerFar,this.flickerNear);this.material.uniforms.exposure.value=1+this.nearExposure*h+(Math.random()*2-1)*i;if(this.interactionEnabled){this.material.uniforms.exposure.value+=InputController.getInstance().crazyMotion*Math.random()*this.crazyMotionRandom;this.material.uniforms.saturation.value=1+InputController.getInstance().crazyMotion*.75}this.renderer.render(this.scene,this.camera)},renderMaterialFullScreen:function(a,b){this.renderer.render(a,b)},disablePhoneInteraction:function(){this.interactionEnabled=false},enablePhoneInteraction:function(){this.interactionEnabled=true},add:function(a){this.container=a;this.container.append(this.renderer.domElement);this.onResize()},remove:function(){return}},_private:{cmap:function(a,b,c,d,e){return Math.max(Math.min(d+(e-d)*((a-b)/(c-b)),e),d)}}});var AssetsController=Class._extend(Class.SINGLETON,{_public:{addFile:function(a,b){this.allAssets.push(b);this.assetsByName[a]=b},getFile:function(a){if(!this.assetsByName[a]){throw new Error("Asset was not loaded: "+a)}this.usedFiles[a]=true;return this.assetsByName[a]},hasFile:function(a){return Boolean(this.assetsByName[a])},addLoadingFile:function(a){this.loadingAssetsByName[a]=true},fileIsLoading:function(a){return Boolean(this.loadingAssetsByName[a])},fileIsLoaded:function(a){return Boolean(this.assetsByName[a])},getUnusedFiles:function(){console.log("----------------------------------");console.log("Printing list of unused resources:");for(var a in this.assetsByName){if(!this.usedFiles[a]){console.log(a)}}console.log("----------------------------------")}},_private:{loadingAssetsByName:{},assetsByName:{},allAssets:[],usedFiles:{}}});var InputController=Class._extend(Class.SINGLETON,{_static:{INPUT_TYPE_MOUSE:"InputController_INPUT_TYPE_MOUSE",INPUT_TYPE_TRACKING:"InputController_INPUT_TYPE_TRACKING",TRACKING_X_POW:.9,TRACKING_Y_POW:.55,TRACKING_Y_SCALE:1.3,Z_ROTATION_AXIS_VALUE:1,GYRO_SMOOTHING:.3333,DIRECTION_SMOOTHING:.3333,POSITION_SMOOTHING_NEAR:.35,POSITION_SMOOTHING_FAR:1,PERSISTENCE_SMOOTHING_UP:.9,PERSISTENCE_SMOOTHING_DOWN:.15,GYRO_MAX_PERCENTAGE:.75,GYRO_MIN_PERCENTAGE:.1},_public:{mode:"InputController_INPUT_TYPE_TRACKING",$container:null,mouse:new THREE.Vector3(0,0,.5),mousePressed:false,mousePressTime:0,lastMousePress:0,lastDirectionTime:0,lastUpdate:0,lastDirection:new THREE.Vector2(0,0),currentDirection:new THREE.Vector3(0,0,.5),smoothPosition:new THREE.Vector3(0,0),orientationVec:new THREE.Vector2(0,0),orientationMagnitude:0,orientationMagnitudeDeltaRemaining:0,smoothQuaternion:new THREE.Quaternion,smoothDirection:new THREE.Vector3(0,0,.5),currentDirectionX:new THREE.Vector3(1,0,0),lastQuaternion:new THREE.Quaternion,lastSmoothQuaternion:new THREE.Quaternion,lastQuaternionTime:0,smoothPersistence:0,lastTrackingTime:0,lastPosition:new THREE.Vector2(0,0),currentPosition:new THREE.Vector3(0,0,.5),positionVec:new THREE.Vector2(0,0),positionMagnitude:0,finalPhonePosition:new THREE.Vector3,currentRelativeDirectionSmooth:new THREE.Vector2(0,0),currentRelativePositionSmooth:new THREE.Vector2(0,0),construct:function(){var a=this;this.mode=InputController.INPUT_TYPE_MOUSE;this.$container=$(window);window.addEventListener("mousemove",function(b){a.mouse.x=b.pageX/a.$container.width()*2-1;a.mouse.y=b.pageY/a.$container.height()*2-1;return b},false);window.addEventListener("touchmove",function(b){if(b&&b.touches&&b.touches.length!==0){a.mouse.x=b.touches[0].pageX/a.$container.width()*2-1;a.mouse.y=b.touches[0].pageY/a.$container.height()*2-1;b.preventDefault();return false}},false);window.addEventListener("mousedown",function(b){a.mouse.z=Math.max(a.mouse.z-.5,0);a.lastMousePress=a.mousePressTime=Date.now();a.mousePressed=true;return b},false);window.addEventListener("mouseup",function(b){a.mousePressed=false;return b},false)},setContainer:function(a){this.$container=a},setMode:function(a){this.mode=a;if(a===InputController.INPUT_TYPE_MOUSE){$("html").removeClass("mode-webcam").addClass("mode-mouse");TrackingController.getInstance().stop();RemoteController.getInstance().dispose()}else{$("html").removeClass("mode-mouse").addClass("mode-webcam")}},isMouseVersion:function(){return this.mode===InputController.INPUT_TYPE_MOUSE},update:function(a,b,c){var d=(Date.now()-this.lastUpdate)/(1e3/30);d=Math.min(Math.max(d,.333),2);this.lastUpdate=Date.now();if(this.mousePressed){this.mouse.z=Math.max(this.mouse.z*(1-.02*d)-.025*d,0)}else{this.mouse.z=Math.min(this.mouse.z*(1+.05*d)+.05*d,1)}if(this.mode===InputController.INPUT_TYPE_MOUSE)return;if(!this.lastQuaternion.equals(c)){this.lastQuaternion.copy(c);this.lastSmoothQuaternion.copy(this.smoothQuaternion);this.lastQuaternionTime=Date.now();this.smoothQuaternion.slerp(c,.2*d)}var e=TrackingController.getInstance().getPersistence();if(e<this.smoothPersistence)this.smoothPersistence+=(e-this.smoothPersistence)*InputController.PERSISTENCE_SMOOTHING_DOWN;else this.smoothPersistence+=(e-this.smoothPersistence)*InputController.PERSISTENCE_SMOOTHING_UP;if(isNaN(this.smoothPersistence))this.smoothPersistence=1;this.smoothQuaternion.slerp(c,d*InputController.GYRO_SMOOTHING);this.currentDirection.set(0,0,1).applyQuaternion(this.smoothQuaternion);this.currentDirection.y*=-1;this.currentDirection.x*=-1;this.currentDirectionX.set(1,0,0).applyQuaternion(this.smoothQuaternion);var f=Math.atan2(this.currentDirectionX.y,this.currentDirectionX.x);var g=f+Math.PI/2;this.currentDirection.x+=this.currentDirectionX.y*InputController.Z_ROTATION_AXIS_VALUE;this.smoothDirection.lerp(this.currentDirection,d*InputController.DIRECTION_SMOOTHING);if(isNaN(this.currentDirection.x))this.currentDirection.set(0,0,0);if(isNaN(this.smoothDirection.x))this.smoothDirection.set(0,0,0);var h=Math.max((200-(Date.now()-this.lastDirectionTime))/200,0)*.5;if(this.orientationMagnitude>0){this.currentRelativeDirectionSmooth.sub(this.orientationVec.clone().normalize().multiplyScalar(this.orientationMagnitude*h));if(this.currentRelativeDirectionSmooth.x<-1)this.currentRelativeDirectionSmooth.x=-1;if(this.currentRelativeDirectionSmooth.x>1)this.currentRelativeDirectionSmooth.x=1;if(this.currentRelativeDirectionSmooth.y<-1)this.currentRelativeDirectionSmooth.y=-1;if(this.currentRelativeDirectionSmooth.y>1)this.currentRelativeDirectionSmooth.y=1}var i=InputController.POSITION_SMOOTHING_NEAR+Math.pow(Math.min(b.z*2,1),.4)*(InputController.POSITION_SMOOTHING_FAR-InputController.POSITION_SMOOTHING_NEAR);this.currentPosition.copy(b);this.currentPosition.x=this.pow(this.currentPosition.x,InputController.TRACKING_X_POW);this.currentPosition.y=this.pow(this.currentPosition.y,InputController.TRACKING_Y_POW)*InputController.TRACKING_Y_SCALE;this.currentPosition.z=this.cmap(b.z,.2,.8,0,1);if(isNaN(this.smoothPosition.x))this.smoothPosition.set(0,0,.5);if(isNaN(this.currentPosition.x))this.currentPosition.set(0,0,.5);this.smoothPosition.lerp(this.currentPosition,Math.min(i*2,1));this.crazyMotion=Math.min(this.crazyMotion*(.7-d*.2)+Math.min(Math.max((OrientationController.getInstance().accelerationOverThresholdNumFrames-1)/4,0),1),1)},getPositionDirectional:function(){if(this.mode===InputController.INPUT_TYPE_MOUSE){return this.getMouseRaw()}if(this.smoothDirection.length()>0){this.finalPhonePosition.copy(this.smoothPosition).lerp(this.smoothDirection.clone(),1-InputController.GYRO_MIN_PERCENTAGE-(InputController.GYRO_MAX_PERCENTAGE-InputController.GYRO_MIN_PERCENTAGE)*this.smoothPersistence);this.finalPhonePosition.z=this.smoothPosition.z}else{this.finalPhonePosition.set(this.smoothPosition.x,this.smoothPosition.y,this.smoothPosition.z)}return this.finalPhonePosition},getPositionRaw:function(){if(this.mode===InputController.INPUT_TYPE_MOUSE)return this.getMouseRaw();return this.currentPosition},getPositionSmooth:function(){return this.smoothPosition.clone()},getDirectionSmooth:function(){return this.smoothDirection.clone()},getQuaternionSmooth:function(){return this.smoothQuaternion.clone()},getRotationX:function(){return new THREE.Vector3(1,0,0).applyQuaternion(InputController.getInstance().getQuaternionSmooth()).y},getMouseRaw:function(){return this.mouse},isUsingMouse:function(){return this.mode===InputController.INPUT_TYPE_MOUSE}},_private:{map:function(a,b,c,d,e){return d+(e-d)*((a-b)/(c-b))},cmap:function(a,b,c,d,e){return Math.max(Math.min(d+(e-d)*((a-b)/(c-b)),e),d)},pow:function(a,b){return(a<0?-1:1)*Math.pow(Math.abs(a),b)}}});var MouseCursorAppearanceController=Class._extend(Class.SINGLETON,{_static:{CURSOR_VISIBLE:true,TIMEOUT:3e3,EVENT_MOUSE_ACTIVE:"MouseCursorApperanceController_EVENT_MOUSE_ACTIVE",EVENT_MOUSE_INACTIVE:"MouseCursorApperanceController_EVENT_MOUSE_INACTIVE",MODE_INTERACTIVE:"interactive",MODE_NON_INTERACTIVE:"noninteractive"},_public:{mode:null,mouseActivityTimeout:-1,initialized:false,dom:$("body"),lastPoint:{x:0,y:0},cursorShown:false,construct:function(){this.mode=MouseCursorAppearanceController.MODE_INTERACTIVE},startTrackMouseActivity:function(){var a=this;if(this.mouseActivityTimeout>=0){clearTimeout(this.mouseActivityTimeout)}this.mouseActivityTimeout=setTimeout(this.hideMouseCursor.bind(this),MouseCursorAppearanceController.TIMEOUT);if(!this.initialized){this.dom.mousemove(function(b){a.followMouseCursor(b.clientX,b.clientY)});this.initialized=true}},stopTrackMouseActivity:function(){this.dom.unbind("mousemove");clearTimeout(this.mouseActivityTimeout);this.setCursor("default");this.initialized=false},followMouseCursor:function(a,b){if(a===this.lastPoint.x&&b===this.lastPoint.y){return}this.lastPoint.x=a;this.lastPoint.y=b;if(!this.showMouseCursor()&&this.mode===MouseCursorAppearanceController.MODE_NON_INTERACTIVE){this.hideMouseCursor()}},setMode:function(a){this.mode=a},hideMouseCursor:function(){this.setCursor("none");this.cursorShown=false;MouseCursorAppearanceController.CURSOR_VISIBLE=false;this.events.trigger(MouseCursorAppearanceController.EVENT_MOUSE_INACTIVE)},showMouseCursor:function(){if(this.mode===MouseCursorAppearanceController.MODE_INTERACTIVE||this.lastPoint.y>window.innerHeight-90||ViewController.getInstance().getView("HelpView").shown){this.setCursor(this.lastPoint.y>window.innerHeight-90||InputController.getInstance().mode===InputController.INPUT_TYPE_TRACKING||ViewController.getInstance().getView("HelpView").shown?"default":"none");this.cursorShown=true;MouseCursorAppearanceController.CURSOR_VISIBLE=true;this.startTrackMouseActivity();this.events.trigger(MouseCursorAppearanceController.EVENT_MOUSE_ACTIVE);return true}return false},toogleMouseCursor:function(){MouseCursorAppearanceController.CURSOR_VISIBLE=!MouseCursorApperanceController.CURSOR_VISIBLE;this.setCursor(MouseCursorAppearanceController.CURSOR_VISIBLE?"default":"none")},setCursor:function(a){this.dom.css({cursor:a})}}});var VolumeController=Class._extend(Class.SINGLETON,{_static:{VOLUMNE:60,VOLUME_RANGE:{min:20,max:90},EVENT_VOLUME_CHANGE_REQUEST:"VolumeController_EVENT_VOLUME_CHANGE_REQUEST",EVENT_VOLUME_CHANGE:"VolumeController_EVENT_VOLUME_CHANGE",EVENT_CHANGE:"VolumeController_EVENT_CHANGE"},_public:{construct:function(){var a=this;a.volumeWorkingRange=VolumeController.VOLUME_RANGE.max-VolumeController.VOLUME_RANGE.min;a.currentVolume=VolumeController.VOLUME_RANGE.min+VolumeController.VOLUME*a.volumeWorkingRange}},_private:{currentVolume:-1,targetVolume:-1,volumeWorkingRange:-1,uiBarActive:true,setVolume:function(a,b){if(a<0)a=0;if(a>100)a=100;VolumeController.VOLUME=a;self.currentVolume=VolumeController.VOLUME_RANGE.min+VolumeController.VOLUME*self.volumeWorkingRange;if(!b)this.events.trigger(VolumeController.EVENT_VOLUME_CHANGE,[{volume:VolumeController.VOLUME}]);this.events.trigger(VolumeController.EVENT_CHANGE,[{volume:VolumeController.VOLUME}])}}});var AnalyticsController=Class._extend(Class.SINGLETON,{_static:{EVENT_SYNC_START:{category:"sync",action:"start",label:"sync started",value:1},EVENT_SYNC_SUCCESS:{category:"sync",action:"success",label:"sync success",value:1},EVENT_SYNC_FULL:{category:"sync",action:"camera",label:"sync camera",value:1},EVENT_MODE_CAMERA:{category:"mode",action:"phone",label:"phone mode",value:1},EVENT_MODE_MOUSE:{category:"mode",action:"mouse",label:"mouse mode",value:1},EVENT_CAMERA_ALLOW:{category:"camera",action:"allow",label:"allow camera access",value:1},EVENT_CAMERA_DENY:{category:"camera",action:"deny",label:"deny camera access",value:1},EVENT_SHARE_GOOGLE:{category:"share",action:"google",label:"share google",value:1},EVENT_SHARE_FACEBOOK:{category:"share",action:"facebook",label:"share facebook",value:1},EVENT_SHARE_TWITTER:{category:"share",action:"twitter",label:"share twitter",value:1},EVENT_DOWNLOAD_CHROME:{category:"download",action:"chrome",label:"download chrome",value:1},EVENT_PERFORMANCE_WEBGLSCORE:{category:"performance",action:"webglscore",label:"WebGL performance score",value:1},EVENT_TECH_PRESET:{category:"tech",action:"preset",label:"Preset selected",value:1},EVENT_TECH_MODE:{category:"tech",action:"mode",label:"Changed viewing mode",value:1},EVENT_TECH_PARAM:{category:"tech",action:"param",label:"Changed parameters",value:1},EVENT_TECH_SHARE:{category:"tech",action:"share",label:"Shared custom link",value:1},EVENT_TECH_WEBGL:{category:"tech",action:"webgl",label:"Has webgl",value:1},EVENT_TECH_LANG:{category:"tech",action:"language",label:"Set language",value:1},EVENT_TECH_CODE:{category:"tech",action:"code",label:"Got the code",value:1}},_public:{construct:function(){this.setupGoogleAnalyticsAPI()},trackEvent:function(a,b){var c;if(b){for(c in b){if(a[c]){a[c]=b[c]}}}console.log("[event]",a.category,"|",a.action,"|",a.label,"|",a.value);_gaq.push(["_trackEvent",a.category,a.action,a.label,a.value])},trackPageView:function(a){console.log("[pageview]",a);_gaq.push(["_trackPageview","_view_/desktop/"+a])}},_private:{setupGoogleAnalyticsAPI:function(){window._gaq=window._gaq||[];_gaq.push(["_setAccount",Config.getInstance().googleAnalyticsId]);_gaq.push(["_trackPageview"]);!function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}()}}});var MouseModeButtonController=Class._extend(Class.SINGLETON,{_static:{},_public:{registerFieldCopy:function(a){$(a).click(this.buttonOnClick)},buttonOnClick:function(a){}}});var AssetsAdapter=Class._extend(Class.SINGLETON,{_static:{TYPE:{IMAGE:"AssetsAdapterTypeImage",JSON:"AssetsAdapterTypeJsonData",SHADER:"AssetsAdapterTypeShader"},register:function(a,b,c,d,e){return{path:a,type:b,isSequence:c,sequenceId:d,sceneNo:e}}},_public:{}});var Viewport=Class._extend(Class.SINGLETON,{_static:{MOUSE_X:0,MOUSE_Y:0,WIDTH:0,HEIGHT:0},_public:{initialize:function(){return},construct:function(){return},update:function(){document.onmousemove=this.updateCursor;window.onresize=this.updateBox}},_private:{updateCursor:function(a){Viewport.MOUSE_Y=a.clientY;Viewport.MOUSE_X=a.clientX},updateBox:function(){Viewport.WIDTH=$(window).width();Viewport.HEIGHT=$(window).height()}}});var LocalAutoConnectSocket=Class._extend(Class.SINGLETON,{_static:{EVENT_URL_RECEIVED:"LocalAutoConnectSocket_EVENT_URL_RECEIVED",PORT:9999},_public:{enabled:/localhost/.test(window.location.host)||/127.0.0.1/.test(window.location.host)||/^192.168./.test(window.location.host),targetUrl:null,targetCode:null,targetIp:null,construct:function(){},connect:function(){if(!this.enabled||this.socket)return;var a=this;window.WebSocket=window.WebSocket||window.webkitWebSocket||window.MozWebSocket;this.socket=new window.WebSocket("ws://"+window.location.hostname+":"+LocalAutoConnectSocket.PORT);this.socket.addEventListener("message",function(b){console.log(b);a.socketMessage(JSON.parse(b.data))});this.socket.addEventListener("open",function(b){a.socketConnect(b)});this.socket.addEventListener("close",function(b){a.socketClose(b)})},publishURL:function(a,b,c){if(!this.enabled)return;var d=JSON.stringify({action:"publish",url:a,code:b,ip:c});if(!this.connected){this.messageQueue.push(d);this.connect();return}this.socket.send(d)},askForURL:function(){if(!this.enabled)return;var a=JSON.stringify({action:"requestURL"});if(!this.connected){this.messageQueue.push(a);this.connect();return}this.socket.send(a)}},_private:{socket:null,connected:false,messageQueue:[],socketConnect:function(){this.connected=true;for(var a=0;a<this.messageQueue.length;a++){this.socket.send(this.messageQueue[a])}this.messageQueue=[]},socketClose:function(a){this.connected=false;console.warn("LocalAutoConnectSocket Closed: ",a)},socketMessage:function(a){if(a.action==="publish"){targetUrl=a.url;targetCode=a.code;
targetIp=a.ip;this.events.trigger(LocalAutoConnectSocket.EVENT_URL_RECEIVED,[a])}}}});var PerformanceDebugProfiler=Class._extend(Class.SINGLETON,{_static:{},_public:{profiles:{},forceMouse:function(){InputController.getInstance().setMode(InputController.INPUT_TYPE_MOUSE);RoutingController.getInstance().route("/experience-loading")},init:function(){var a=this;AssetsController.getInstance().getFile=function(a){if(!this.assetsByName[a]){throw new Error("Asset was not loaded: "+a)}this.assetsByName[a].profile_id=a;this.usedFiles[a]=true;return this.assetsByName[a]};FramebufferWrapper.prototype.render=function(){var b=performance.now();this.renderer.getContext().finish();this.renderer.setClearColor(this.backgroundColor,this.backgroundAlpha);this.renderer.render(this.scene,this.camera,this.texture,this.forceClear);this.renderer.setClearColor(this.tempColor,this.tempAlpha);this.renderer.getContext().finish();b=performance.now()-b;if(!this.profile_id){if(this.renderPlane&&this.renderPlane.material&&this.renderPlane.material.fragmentShader&&this.renderPlane.material.fragmentShader.profile_id){this.profile_id=this.renderPlane.material.fragmentShader.profile_id}else{this.profile_id=Player.getInstance().getCurrentTime().toPrecision(2)+"___"+Math.floor(Math.random()*100)}}a.profiles[this.profile_id]=a.profiles[this.profile_id]||[];a.profiles[this.profile_id].push(b)}},begin:function(){},end:function(){},getProfiles:function(){console.log("------------------------------------");console.log("----- GPU Performance Profiles -----");console.log("------------------------------------");for(var a in this.profiles){var b=0;var c=0;for(var d=0;d<this.profiles[a].length;d++){b+=this.profiles[a][d];c++}b/=c;console.log(a+" took on average  -> "+b+"ms <-  and ran "+c+" times.")}console.log("--------------------------------------");console.log("--------------------------------------");console.log("--------------------------------------")}}});var Task=Class._extend(Class.ABSTRACT,{_static:{EVENT_PROGRESS:"Task_EVENT_PROGRESS",EVENT_DONE:"Task_EVENT_DONE"},_public:{construct:function(a,b){this.ownWeight=b||0;this.subtasks=a||[];this.events=$({});this.recalculateWeight()},execute:function(){this.bindEvents();for(var a=0;a<this.subtasks.length;a++){this.subtasks[a].execute()}this.run()}},_protected:{ownWeight:0,ownProgress:0,subtasks:[],weight:0,progress:0,done:false,bindEvents:function(){var a=this;for(var b=0;b<this.subtasks.length;b++){this.subtasks[b].events.on(Task.EVENT_PROGRESS,function(b,c){a.onSubtaskProgress(b,c)});this.subtasks[b].events.on(Task.EVENT_COMPLETE,function(b,c){a.onSubtaskDone(b,c)})}},unbindEvents:function(){for(var a=0;a<this.subtasks.length;a++){}},recalculateWeight:function(){this.weight=this.ownWeight;for(var a=0;a<this.subtasks.length;a++){this.weight+=this.subtasks[a].weight}},recalculateProgress:function(){var a=this.ownProgress*this.ownWeight;for(var b=0;b<this.subtasks.length;b++){a+=this.subtasks[b].progress*this.subtasks[b].weight}this.progress=this.weight===0?this.ownWeight===0?1:a/this.ownWeight:a/this.weight},run:function(){},notifyProgress:function(a){this.ownProgress=a;this.recalculateProgress();this.events.trigger(Task.EVENT_PROGRESS,[{progress:this.progress,weight:this.weight}]);if(this.progress===1){this.done=true;this.unbindEvents();this.events.trigger(Task.EVENT_DONE,[{progress:this.progress,weight:this.weight}])}},notifyDone:function(){this.notifyProgress(1)},onSubtaskProgress:function(){this.notifyProgress(this.progress)},onSubtaskDone:function(){this.notifyProgress(this.progress)}},_private:{}});var ImagePreloadTask=Task._extend(Class.ABSTRACT,{_static:{},_public:{construct:function(a){Task.call(this,[],1);this.url=a}},_protected:{url:null,run:function(){var a=this;var b=$("<div/>").css("background-image","url('"+this.url+"')");$(".preload").append(b);var c=new Image;c.onload=function(){a.onComplete()};c.src=this.url}},_private:{url:null,onComplete:function(){this.notifyDone()}}});var AssetPreloadTask=Task._extend(Class.ABSTRACT,{_public:{construct:function(a,b){var c=DetectionController.getInstance().platform,d=DetectionController.getInstance().display,e="img/"+a+"/"+c+"/"+a+"-"+c+"-"+d+"/"+b;Task.call(this,[new ImagePreloadTask(e)],0)}}});var SpriteMapPreloadTask=Task._extend(Class.ABSTRACT,{_static:{},_public:{construct:function(a){Task.call(this,[],1);this.mapName=a}},_protected:{mapName:null,run:function(){var a=this,b,c,d;for(var e=0;e<document.styleSheets.length&&!c;++e){d=document.styleSheets[e].cssRules?document.styleSheets[e].cssRules.length:document.styleSheets[e].rules.length;for(var f=0;f<d;++f){b=document.styleSheets[e].cssRules?document.styleSheets[e].cssRules[f]:document.styleSheets[e].rules[f];if(b.selectorText===".detection .url-"+this.mapName){c=b.cssText?b.cssText.match("url(.*)")[0]:b.style.content;c=c.substring(c.indexOf("img/"),c.indexOf(")")).replace("'","").replace('"',"");break}}}var g=$("<div/>").css("background-image","url('"+c+"')");$(".preload").append(g);var h=new Image;h.onload=function(){a.onPreloadComplete()};h.src=c}},_private:{onPreloadComplete:function(){this.notifyDone()}}});var LocalisationInitTask=Task._extend({_public:{construct:function(){var a=[];Task.call(this,a,1)}},_protected:{run:function(){var a=this;LocalisationController.getInstance().events.on(LocalisationController.EVENT_READY,function(){a.notifyDone()});LocalisationController.getInstance().init()}}});var ClockSyncTask=Task._extend({_public:{construct:function(){var a=[];Task.call(this,a,1)}},_protected:{run:function(){var a=this;clocksync.sync(function(){console.log("clock synced",clocksync.time());a.notifyDone()})}}});var InitialPreloadTask=Task._extend({_static:{},_public:{construct:function(){var a=[new LocalisationInitTask];Task.call(this,a,0)}},_private:{}});var MainPreloadTask=Task._extend({_public:{construct:function(){var a=[new ClockSyncTask,new AssetPreloadTask("main","background-homepage.jpg"),new SpriteMapPreloadTask("main"),new TexturePreloadTask("WebcamControlView","media/images/mask_encre_scene0/mask_encre0.jpg"),new TexturePreloadTask("WebcamControlView","media/images/mask_encre_scene0/mask_encre1.jpg"),new TexturePreloadTask("WebcamControlView","media/images/mask_encre_scene0/mask_encre2.jpg"),new TexturePreloadTask("WebcamControlView","media/images/mask_encre_scene0/mask_encre3.jpg"),new TexturePreloadTask("WebcamControlView","media/images/mask_encre_scene0/mask_encre4.jpg"),new TexturePreloadTask("WebcamControlView","media/images/mask_encre_scene0/mask_encre5.jpg"),new TexturePreloadTask("WebcamControlView","media/images/mask_encre_scene0/mask_encre6.jpg"),new TexturePreloadTask("WebcamControlView","media/images/mask_encre_scene0/mask_encre7.jpg"),new TexturePreloadTask("WebcamControlView","media/images/mask_encre_scene0/mask_encre8.jpg"),new TexturePreloadTask("WebcamControlView","media/images/mask_encre_scene0/mask_encre9.jpg"),new TexturePreloadTask("WebcamControlView","media/images/mask_encre_scene0/mask_encre10.jpg")];Task.call(this,a,0)}}});var LoadAssetsInformation=Task._extend(Class.ABSTRACT,{_static:{},_public:{construct:function(a){Task.call(this,[],1);this.url=a}},_protected:{url:null,run:function(){var a=this;var b="Error loading resources.json. LoadAssetsInformation task failed.";var c=$.get("resources.json",function(a){}).success(function(a){}).error(function(a){console.log(a,b)}).complete(function(b){PreloadController.ASSETS_DATA=JSON.parse(b.responseText);console.log(b,JSON.parse(b.responseText));PreloadController.getInstance().resourcesInfo=JSON.parse(b.responseText);a.onComplete()})}},_private:{url:null,onComplete:function(){this.notifyDone()}}});var LoadTimelineInformation=Task._extend(Class.ABSTRACT,{_static:{},_public:{construct:function(a){Task.call(this,[],1);this.url=a}},_protected:{url:null,run:function(){var a=this;var b="Error loading timeline.json. LoadTimelineInformation task failed.";var c=$.get("timeline.json",function(a){}).success(function(a){}).error(function(a){console.log(a,b)}).complete(function(b){var c=JSON.parse(b.responseText);for(var d=0;d<c.timeline.length;d++){if(c.timeline[d].ignore){console.log("Ignore Timeline Sequence:",c.timeline[d].id);c.timeline.splice(d,1);d--}}TimelineController.TIMELINE_RAW_DATA=c;PreloadController.getInstance().timelineInfo=c;a.onComplete()})}},_private:{url:null,onComplete:function(){this.notifyDone()}}});var ExperiencePreloadTask=Task._extend({_public:{construct:function(a,b,c){var d=this,e=[];for(var f=0;f<b.length;f++){e.push(new SequencePreloadTask(a[b[f]],b[f]))}if(c){e.push(new MediaPreloadTask)}Task.call(this,e,1)}},_protected:{run:function(){},notifyProgress:function(a){var b=0;for(var c=0;c<this.subtasks.length;c++){if(this.subtasks[c].subtasks===0||this.subtasks[c].done||this.subtasks[c].progress>=1){b+=1}else{b+=this.subtasks[c].progress}}this.progress=b/this.subtasks.length;this.events.trigger(Task.EVENT_PROGRESS,[{progress:this.progress,weight:this.weight}]);if(this.progress>=1){this.done=true;this.unbindEvents();this.events.trigger(Task.EVENT_DONE,[{progress:this.progress,weight:this.weight}])}},onDone:function(){this.notifyDone()}}});var TexturePreloadTask=Task._extend(Class.ABSTRACT,{_static:{},_public:{result:null,construct:function(a,b,c,d){Task.call(this,[],d);this.url=b},getResult:function(){return this.result}},_protected:{url:null,run:function(){var a=this;var b=new Image;b.setAttribute("crossOrigin","anonymous");b.onload=function(){var c=new THREE.Texture(b,new THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBAFormat,THREE.UnsignedByteType,1);c.generateMipmaps=false;c.needsUpdate=true;a.result=c;AssetsController.getInstance().addFile(a.url,a.result);a.onComplete()};b.onerror=function(a){console.error(a.target.src,a)};b.crossOrigin="anonymous";b.src=Resource.get(this.url)}},_private:{onComplete:function(){this.notifyDone()}}});var XHRPreloadTask=Task._extend(Class.ABSTRACT,{_static:{},_public:{result:null,construct:function(a,b,c,d){Task.call(this,[],d);this.url=b;this.dataType=c},getResult:function(){return this.result}},_protected:{url:null,dataType:"text",run:function(){var a=this;var b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState===4){if(b.status===200){a.result=a.dataType==="json"?JSON.parse(b.response):b.response;AssetsController.getInstance().addFile(a.url,a.result);a.onComplete()}else{console.error("XHR Loading Error",b);a.onTimeout()}}};b.onerror=function(){console.error(b,b.status)};b.responseType=this.dataType==="json"?"text":this.dataType;b.open("GET",this.dataType==="json"?Resource.get(this.url):this.url,true);b.overrideMimeType("text/plain; charset=x-user-defined");b.send(null)}},_private:{onComplete:function(){this.notifyDone()},onTimeout:function(){this.notifyDone()}}});var SequencePreloadTask=Task._extend({_public:{sequenceName:"sequence",construct:function(a,b){var c=[];this.sequenceName=b;for(var d in a){var e=a[d];switch(e.type){case"texture":c.push(new TexturePreloadTask(b,d,"text",e.filesize));break;case"shader":c.push(new XHRPreloadTask(b,d,"text",e.filesize));break;case"json":c.push(new XHRPreloadTask(b,d,"json",e.filesize));break;case"binary":break;case"video":break}}if(this.subtasks.length==0){this.progress=1}else{this.progress=0}this.loading="Sequence: "+this.sequenceName;this.datController=Debug.add(this,"loading","ExperienceLoading");Task.call(this,c,1)},toString:function(){return"[ SequencePreloadTask "+this.sequenceName+" ]"}},_protected:{datController:null,run:function(){if(this.subtasks.length==0){this.notifyProgress(1)}},notifyProgress:function(a){var b=0;for(var c=0;c<this.subtasks.length;c++){b+=this.subtasks[c].progress}this.progress=this.subtasks.length===0?1:b/this.subtasks.length;if(b>=this.subtasks.length){if(!this.done){this.onDone()}}this.events.trigger(Task.EVENT_PROGRESS,[{progress:this.progress,weight:this.weight}]);if(this.sequenceName==="finale"){console.log(a,b,this.progress,this.subtasks.length)}},onDone:function(){this.progress=1;this.done=true;this.unbindEvents();this.events.trigger(Task.EVENT_DONE,[{progress:this.progress,weight:this.weight}]);Debug.remove(this.datController,"ExperienceLoading")}}});var MediaPreloadTask=Task._extend({_static:{VIDEOS:[{path:"/media/video/480/reflektor_full_audio.webm",resolution:{width:480,height:252},size:34},{path:"/media/video/640/reflektor_full_audio.webm",resolution:{width:640,height:336},size:48},{path:"/media/video/960/reflektor_full_audio.webm",resolution:{width:960,height:505},size:80},{path:"/media/video/1280/reflektor_full_audio.webm",resolution:{width:1280,height:672},size:113}],VIDEO_LOWRES_VERSION:1,VIDEOS_USE_RESOURCE:false,VIDEOS_WITH_AUDIO:true},_public:{construct:function(){var a=this,b=[],c=Player.getInstance();Task.call(this,b,10);this.loading="video";this.datController=Debug.add(this,"loading","ExperienceLoading");if(c.ready){this.onDone()}else{c.events.on(Player.EVENT_LOADING_PROGRESS,function(){a.onProgress()});c.events.on(Player.EVENT_LOADING_READY,function(){a.onDone()})}}},_protected:{loading:"video",datController:null,run:function(){},onProgress:function(a){this.progress=.5;this.events.trigger(Task.EVENT_PROGRESS,[{progress:this.progress,weight:this.weight}])},onDone:function(){this.progress=1;this.done=true;this.events.trigger(Task.EVENT_PROGRESS,[{progress:this.progress,weight:this.weight}]);this.events.trigger(Task.EVENT_DONE,[{progress:this.progress,weight:this.weight}]);console.log("dat",this.datController);Debug.remove(this.datController,"ExperienceLoading")}}});var Model=Class._extend(Class.ABSTRACT,{});var Resource=Class._extend({_static:{CLOUD_STORAGE_URL:"//arcade-fire.commondatastorage.googleapis.com/",local:false,get:function(a,b){var c=Resource.local||b;if(c){return a}else{return Resource.CLOUD_STORAGE_URL+a.replace(/^\//,"")}}}});var FramebufferWrapper=Class._extend({_static:{cloneTextureScene:new THREE.Scene,cloneTextureCamera:new THREE.OrthographicCamera(-1,1,1,-1,-1e3,1e3),cloneTexturePlane:new THREE.Mesh(new THREE.PlaneGeometry(2,2,2,2),new THREE.MeshBasicMaterial({map:null,depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide})),cloneTexture:function(a,b,c){FramebufferWrapper.cloneTexturePlane.material.map=b;if(!FramebufferWrapper.cloneTexturePlane.parent)FramebufferWrapper.cloneTextureScene.add(FramebufferWrapper.cloneTexturePlane);a.render(FramebufferWrapper.cloneTextureScene,FramebufferWrapper.cloneTextureCamera,c,true)}},_public:{construct:function(a,b,c){this.width=a;this.height=b;this.renderer=c.renderer||window.renderer;this.forceClear=true;this.disposed=false;this.texture=c.texture||new THREE.WebGLRenderTarget(a,b);this.texture.antialias=true;this.texture.minFilter=c.minFilter!==undefined?c.minFilter:THREE.LinearFilter;this.texture.magFilter=c.magFilter!==undefined?c.magFilter:THREE.LinearFilter;this.texture.format=c.format!==undefined?c.format:THREE.RGBAFormat;this.texture.type=c.type!==undefined?c.type:THREE.UnsignedByteType;this.texture.depthBuffer=c.depthBuffer!==undefined?c.depthBuffer:false;this.texture.stencilBuffer=c.stencilBuffer!==undefined?c.stencilBuffer:false;this.texture.generateMipmaps=c.generateMipmaps!==undefined?c.generateMipmaps:false;this.texture.flipY=false;this.scene=c.scene||new THREE.Scene;this.defaultMaterial=new THREE.MeshBasicMaterial({color:16777215,transparent:true,opacity:1,depthTest:false,map:this.texture});this.defaultPlane=new THREE.Mesh(new THREE.PlaneGeometry(2,2,1,1),this.defaultMaterial);if(c.camera)this.camera=c.camera;else if(!c.usePerspectiveCamera||c.useOrthographicCamera)this.camera=new THREE.OrthographicCamera(-1,1,-1,1,-1e3,1e3);else this.camera=new THREE.PerspectiveCamera(45,a/b,1,2e4);if(!this.camera.parent)this.scene.add(this.camera);this.renderPlane=c.renderPlane;if(c.renderMaterial!==undefined){this.renderPlane=new THREE.Mesh(new THREE.PlaneGeometry(2,2,2,2),c.renderMaterial)}this.scene.add(this.renderPlane);this.tempColor=new THREE.Color(this.renderer.getClearColor().getHex());this.tempAlpha=this.renderer.getClearAlpha();var d=c.backgroundColor!==undefined?c.backgroundColor:this.renderer.getClearColor().getHex();this.backgroundColor=new THREE.Color(d);this.backgroundAlpha=c.backgroundAlpha||0},render:function(){this.renderer.setClearColor(this.backgroundColor,this.backgroundAlpha);this.renderer.render(this.scene,this.camera,this.texture,this.forceClear);this.renderer.setClearColor(this.tempColor,this.tempAlpha)},addMaterial:function(a){this.renderMaterial=a;this.renderPlane=new THREE.Mesh(new THREE.PlaneGeometry(1,1,1,1),a);this.renderPlane.geometry.applyMatrix((new THREE.Matrix4).makeRotationX(Math.PI/2));this.scene.add(this.renderPlane)},setRenderMaterial:function(a){this.renderMaterial=a;this.renderPlane.material=a},resize:function(a,b,c){this.width=a;this.height=b;this.texture.width=a;this.texture.height=b;if(this.camera&&c){if(this.camera.constructor===THREE.PerspectiveCamera){this.camera.aspect=a/b}}},resizeTexture:function(a,b){this.width=a;this.height=b;this.texture.width=a;this.texture.height=b;var c=this.texture;this.texture=c.clone();c.dispose()},resizeTextureAndCopy:function(a,b){this.width=a;this.height=b;this.texture.width=a;this.texture.height=b;var c=this.texture;this.texture=c.clone();if(!this.disposed)FramebufferWrapper.cloneTexture(this.renderer,c,this.texture);c.dispose()},alloc:function(){if(!this.disposed)return;console.log("Allocating!");this.renderer.clearTarget(this.texture,true,this.texture.depthBuffer,this.texture.stencilBuffer);this.disposed=false},dispose:function(){if(this.disposed)return;console.log("Disposing!");var a=this.texture;this.texture=a.clone();a.dispose();this.disposed=true}}});var VideoTexture=Class._extend({_public:{paused:false,texture:null,videoElement:null,renderer:null,width:1280,height:672,lastUpdateTime:0,wasUpdatedThisframe:false,currentFrame:0,frameUpdateRate:1e3/30,lastCurrentTime:0,lastSrc:"",construct:function(a,b,c,d){this.videoElement=a;var e=new THREE.Texture(a,new THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBFormat,THREE.UnsignedByteType,1);e.premultiplyAlpha=false;e.generateMipmaps=false;e.needsUpdate=false;this.currentFrame=0;this.wasUpdatedThisframe=true;e.width=this.width=b;e.height=this.height=c;this.texture=e;this.renderer=RendererController.getInstance().getRenderer();this.lastUpdateTime=performance.now();this.frameUpdateRate=1e3/28},update:function(){var a=false;while(performance.now()-this.lastUpdateTime>=this.frameUpdateRate){this.lastUpdateTime+=this.frameUpdateRate;a=true}if(this.videoElement&&(this.lastSrc!==this.videoElement.src||Math.abs(this.videoElement.currentTime-this.lastCurrentTime)*Player.VIDEO_FRAMERATE*1.25>=1))a=true;if(a&&!this.paused&&this.videoElement.readyState===this.videoElement.HAVE_ENOUGH_DATA){this.updateTexture()}else{this.texture.needsUpdate=false;this.wasUpdatedThisframe=false}if(this.paused){this.currentFrame=Math.floor(this.videoElement.currentTime*Player.VIDEO_FRAMERATE)}},updateTexture:function(){this.texture.needsUpdate=true;this.lastCurrentTime=this.videoElement.currentTime;this.renderer.setTexture(this.texture,0);this.currentFrame=Math.floor(this.lastCurrentTime*Player.VIDEO_FRAMERATE);this.texture.needsUpdate=false;this.wasUpdatedThisframe=true;this.lastSrc=this.videoElement.src},endFrame:function(){this.wasUpdatedThisframe=false},pauseBrokenMirror:function(){this.paused=true},resumeBrokenMirror:function(){this.paused=false;this.updateTexture();this.lastUpdateTime=performance.now()},resize:function(a,b){this.width=a;this.height=b},resizeTexture:function(a,b,c){var d=this.texture;this.texture=d.clone();d.dispose();this.texture.image=a;this.texture.width=b;this.texture.height=c;this.texture.needsUpdate=true;this.width=b;this.height=c}}});var View=Class._extend(Class.ABSTRACT,{_static:{EVENT_READY:"View_EVENT_READY",TEMPLATES_PATH:"template/view/",TRANSITION_TIME:2e3,forceTransition:false,helpers:[],registerHelper:function(a,b){View.helpers.push({f:a,pre:b===true})}},_public:{forceTransition:false,construct:function(a,b,c){var d=this;this.$container=b?$(b):null;if(b){this.endTransitionHide()}this.id=a;this.model=c;this.hideTimeoutId=-1;if(this.model){this.model.events.on(Model.EVENT_CHANGE,function(a){d.onModelChange(a.data)})}if(this.id){this.loadTemplate();$(window).bind("resize orientationchange",function(){d.onResize.apply(d,arguments)})}},init:function(){return},bindEvents:function(){return},show:function(){clearTimeout(this.hideTimeoutId);if(!this.template){var a=this;clearTimeout(this.showTimeoutId);this.showTimeoutId=setTimeout(function(){a.show()},5);return false}if(this.shown&&!this.forceTransition&&!View.forceTransition){return}setTimeout(function(){View.forceTransition=false},0);this.forceTransition=false;this.shown=true;this.transitionShow();return true},hide:function(){var a=this;clearTimeout(this.showTimeoutId);clearTimeout(this.hideTimeoutId);this.hideTimeoutId=setTimeout(function(){if(!a.shown){return false}a.shown=false;a.transitionHide()},1);return true},transitionShow:function(){clearTimeout(this.showTimeoutId);clearTimeout(this.hideTimeoutId);this.$page.css("opacity",0);this.$container.show();TweenLite.to(this.$page,View.TRANSITION_TIME*.001,{css:{opacity:1},ease:Power2.easeIn,delay:.05});this.endTransitionShow()},endTransitionShow:function(){this.$container.removeClass("hidden");this.$container.removeClass("hiding");this.$container.removeClass("showing");this.$container.addClass("shown")},transitionHide:function(){clearTimeout(this.showTimeoutId);clearTimeout(this.hideTimeoutId);this.endTransitionHide()},endTransitionHide:function(){this.$container.removeClass("hiding");this.$container.removeClass("shown");this.$container.addClass("hidden")},destroy:function(){this.$container.remove()}},_protected:{id:null,$container:null,$page:null,shown:false,template:null,model:null,showTimeoutId:-1,hideTimeoutId:-1,loadTemplate:function(){var a=this;if(Handlebars&&Handlebars.templates&&Handlebars.templates[this.id]){this.onTemplateLoadComplete()}else{$.getScript(View.TEMPLATES_PATH+this.id+".js",function(){a.onTemplateLoadComplete()})}},renderTemplate:function(){this.$container.html(this.template(this.model));this.$page=this.$container?this.$container.find(".page"):$({})},runHelpers:function(a){var b;for(b=0;b<View.helpers.length;++b){if(typeof View.helpers[b].f==="function"&&View.helpers[b].pre===a){View.helpers[b].f.call(this)}}},onTemplateLoadComplete:function(){this.template=Handlebars.templates[this.id];this.renderTemplateCore()},onPreRender:function(){return},onPostRender:function(){return},onModelChange:function(a){return},onResize:function(a){return}},_private:{renderTemplateCore:function(){this.renderTemplate();this.runHelpers(true);this.init();this.runHelpers(false);this.bindEvents();this.onPostRender()}}});var PreloaderView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)},show:function(){if(!View.prototype.show.call(this)){return}$(".code-loader").remove();PreloadController.getInstance().preloadMain();AnalyticsController.getInstance().trackPageView("PreloaderView")},hide:function(){View.prototype.hide.call(this);$(".code-loader").remove()}},_protected:{init:function(){this.$loaderIcon=this.$container.find(".loader-icon")}},_private:{$loaderIcon:null,bindEvents:function(){var a=this;PreloadController.getInstance().events.on(PreloadController.EVENT_MAIN_PROGRESS,function(b,c){a.onProgress(c)});PreloadController.getInstance().events.on(PreloadController.EVENT_MAIN_COMPLETE,function(){a.onComplete()})},onProgress:function(a){},onComplete:function(){this.hide();RoutingController.getInstance().enabled=true;RoutingController.getInstance().route()}}});var FooterGoogleView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)}}});var FooterLinksView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)},show:function(){if(!View.prototype.show.call(this)){return}this.$selectLanguage.find("option").filter(function(){return $(this).val()===i18n.lng().toLowerCase()||i18n.lng().toLowerCase()==="en"&&$(this).val()==="en-us"}).prop("selected",true)}},_private:{$buttonGoogle:null,$buttonTwitter:null,$buttonFacebook:null,$selectLanguage:null,$buttonFullScreen:null,fullScreenTarget:null,init:function(){this.$buttonGoogle=this.$container.find("button.share.google");this.$buttonTwitter=this.$container.find("button.share.twitter");this.$buttonFacebook=this.$container.find("button.share.facebook");this.$selectLanguage=this.$container.find("select.language");this.$buttonFullScreen=this.$container.find("button.fullscreen");this.fullScreenTarget=$(".fullscreen-target")[0]},bindEvents:function(){var a=this;this.$buttonGoogle.bind("click",function(){a.onButtonGoogleClick()});this.$buttonTwitter.bind("click",function(){a.onButtonTwitterClick()});this.$buttonFacebook.bind("click",function(){a.onButtonFacebookClick()});this.$selectLanguage.bind("change",function(){a.onLanguageChange()});this.$buttonFullScreen.bind("click",function(){a.onButtonFullscreenClick()});FullScreenController.getInstance().events.bind(FullScreenController.EVENT_FULLSCREEN_ON,function(){a.onFullScreenOn()});FullScreenController.getInstance().events.bind(FullScreenController.EVENT_FULLSCREEN_OFF,function(){a.onFullScreenOff()})},onButtonGoogleClick:function(){SharingController.getInstance().shareLinkOnGoogle()},onButtonTwitterClick:function(){SharingController.getInstance().shareOnTwitter()},onButtonFacebookClick:function(){SharingController.getInstance().shareLinkOnFacebook()},onLanguageChange:function(){window.location.href=window.location.protocol+"//"+window.location.host+"/?lng="+this.$selectLanguage.val()},onButtonFullscreenClick:function(){FullScreenController.getInstance().toggle(this.fullScreenTarget)},onFullScreenOn:function(){this.$buttonFullScreen.addClass("on")},onFullScreenOff:function(){this.$buttonFullScreen.removeClass("on")}}});var LandingPageView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)},show:function(){if(!View.prototype.show.call(this)){return}if(TimelineController.getInstance().initialised){window.location.href="/";return}this.onResize();InputController.getInstance().setMode(InputController.INPUT_TYPE_TRACKING);AnalyticsController.getInstance().trackPageView("LandingPageView");PerformanceController.getInstance().beginWebglPerformanceTest()}},_private:{$buttonDownloadChrome:null,buttonEnter:null,logo:null,content:null,percXHead:550/1300,init:function(){this.$buttonDownloadChrome=this.$container.find(".error-browser a");this.buttonEnter=this.$container.find("button.enter");this.logo=this.$container.find(".hero-logo");this.content=this.$container.find(".content")},bindEvents:function(){var a=this;this.$buttonDownloadChrome.bind("click",function(b){a.onButtonDownloadChromeClick(b)});this.buttonEnter.bind("click",function(){a.onButtonEnterClick()});if(DetectionController.getInstance().isChrome){this.logo.bind("click",function(){a.onButtonEnterClick()})}},onButtonDownloadChromeClick:function(a){a.preventDefault();AnalyticsController.getInstance().trackEvent(AnalyticsController.EVENT_DOWNLOAD_CHROME);window.open("https://www.google.com/chrome/","_blank")},onButtonEnterClick:function(){if(CameraController.getInstance().videoReady){RoutingController.getInstance().route("/setup")}else{RoutingController.getInstance().route("/instructions")}},onResize:function(){var a=window.innerWidth,b=window.innerHeight;var c=1300/800;var d=a/b;var e,f,g;if(c>d){e=b*c}else{e=a}var h=e*this.percXHead-(e-a)/2;var g=a<=1300?1:Math.min(a/1300,1.6);var i=(h-this.content.width())*.1+10;var j=(b-this.content.height()*g-8)/2.8+this.content.height()*(g-1)/2;g="scale("+g+")";this.content.css({right:i,marginLeft:0,transform:g,WebkitTransform:g,MsTransform:g}).find(".enter").css({transform:"scale(1.001)",WebkitTransform:"scale(1.001)",MsTransform:"scale(1.001)"})}}});var PersistentControlsView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)},isQualityMenuOpen:function(){return this.$qualityMenu.hasClass("open")},slideIn:function(){this.canSlideOut=true;if(this.isSlidIn){return}clearTimeout(this.slideOutTimeoutId);this.isSlidIn=true;this.$container.addClass("in");this.$container.removeClass("out")},slideOut:function(a){var b=this,c=function(){b.isSlidIn=false;b.$container.addClass("out");b.$container.removeClass("in")};if((!this.isSlidIn||!this.canSlideOut)&&(!a||!a.force)){return}if(a&&a.delay){clearTimeout(this.slideOutTimeoutId);this.slideOutTimeoutId=setTimeout(function(){c()},a.delay)}else{c()}},showQuality:function(){return},hideQuality:function(){return},updateVolumeBar:function(a){if(a){var b=a}else{var b=VolumeController.VOLUME/100}var c=b*10;var d=this.$volumeBar.find(".bar");var e=0;d.each(function(a,b){if(a+1<=c){$(b).removeClass("down");e+=1}else{$(b).addClass("down")}});if(e===0){Player.getInstance().setVolume(0)}console.log("dv: ",e,"v: ",Player.getInstance().video.volume)},showVolume:function(){this.$volumeVar.css("display","block");TweenLite.to(this.$volumeBar,{css:{opacity:1,duration:1}})},hideVolume:function(){var a=this;TweenLite.to(this.$volumeBar,{css:{opacity:0,duration:1},onComplete:function(){a.$volumeVar.css("display","none")}})}},_private:{$quality:null,$buttonQuality:null,$qualityMenu:null,$qualityItems:null,$buttonHelp:null,$buttonFullScreen:null,$volumeBar:null,$root:null,fullScreenTarget:null,resumeTimelineAfterHelpCloses:false,volumeBarStartPosition:0,volumeChanging:false,isSlidIn:true,canSlideOut:false,slideOutTimeoutId:-1,slideInDelayId:-1,init:function(){this.$quality=this.$container.find(".quality");this.$buttonQuality=this.$container.find(".quality button");this.$qualityMenu=this.$container.find(".quality .menu");this.$qualityItems=this.$container.find(".quality .menu .item");this.$buttonHelp=this.$container.find("button.help");this.$buttonFullScreen=this.$container.find("button.fullscreen");this.$volumeBar=this.$container.find("div.volume-control-bar");this.$root=$("div.main");this.fullScreenTarget=$(".fullscreen-target")[0];this.hideQuality()},bindEvents:function(){var a=this;this.$buttonQuality.bind("click",function(){a.onButtonQualityClick()});this.$qualityItems.bind("click",function(){a.onQualityItemClick($(this))});this.$buttonHelp.bind("click",function(){a.onButtonHelpClick()});this.$buttonFullScreen.bind("click",function(){a.onButtonFullscreenClick()});FullScreenController.getInstance().events.bind(FullScreenController.EVENT_FULLSCREEN_ON,function(){a.onFullScreenOn()});FullScreenController.getInstance().events.bind(FullScreenController.EVENT_FULLSCREEN_OFF,function(){a.onFullScreenOff()});VolumeController.getInstance().events.bind(VolumeController.EVENT_VOLUME_CHANGE,function(){a.updateVolumeBar()});VolumeController.getInstance().events.bind(VolumeController.EVENT_VOLUME_CHANGE_REQUEST,function(a,b){VolumeController.getInstance().setVolume(Math.ceil(b.volume*100),true)});Player.getInstance().events.bind(Player.EVENT_QUALITY_CHANGE,function(){a.onQualityChange()});$(".PersistentControlsView").bind("onselectstart",function(a){a.preventDefault();return});this.$volumeBar.bind("mousedown",function(b){ViewController.getInstance().uiBarActive=true;b.preventDefault();a.onStartVolumeChange(b)});this.$root.bind("mouseup",function(b){ViewController.getInstance().uiBarActive=false;a.onFinishVolumeChange()});this.$root.bind("mousemove",function(b){b.preventDefault();a.onVolumeChanging(b)})},onButtonQualityClick:function(){this.$qualityMenu.toggleClass("open")},onQualityItemClick:function(a){var b=a.data("width");console.log("selecting width: ",b);Player.getInstance().setQuality(parseInt(b));this.$qualityMenu.removeClass("open")},onButtonHelpClick:function(){if(ViewController.getInstance().getView("HelpView").shown){if(this.resumeTimelineAfterHelpCloses){TimelineController.getInstance().resume()}ViewController.getInstance().getView("HelpView").hide()
}else{this.resumeTimelineAfterHelpCloses=TimelineController.getInstance().running;TimelineController.getInstance().pause();ViewController.getInstance().getView("HelpView").show()}},onButtonFullscreenClick:function(){FullScreenController.getInstance().toggle(this.fullScreenTarget)},onFullScreenOn:function(){this.$buttonFullScreen.addClass("on")},onFullScreenOff:function(){this.$buttonFullScreen.removeClass("on")},onStartVolumeChange:function(a){this.volumeChanging=true;this.onVolumeChanging(a)},onFinishVolumeChange:function(){this.volumeChanging=false},onVolumeChanging:function(a){if(!this.volumeChanging)return;var b=Math.min(Math.max((a.pageX-this.$volumeBar.offset().left)/50,0),1);this.updateVolumeBar(b);Player.getInstance().setVolume(b)},onQualityChange:function(){var a;this.$qualityItems.removeClass("selected");a=this.$qualityItems.filter("[data-width="+Player.getInstance().quality+"]");if(a.length===0){$(this.$qualityItems[this.$qualityItems.length-1]).addClass("selected")}else{a.addClass("selected")}}}});var SetupView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)},init:function(){this.$instructions=this.$container.find(".instructions");this.$instructions.html(this.$instructions.html().replace("{{url}}","<span>"+Config.getInstance().mobileConnectionUrl.replace("http://","").replace("https://","")+"</span>"));this.$instructions.html(this.$instructions.html().replace("{{code}}",'<span class="code"></span>'));this.$code=this.$container.find(".code")},bindEventsShown:function(){var a=this;RemoteController.getInstance().events.bind(RemoteController.EVENT_CONNECTION_CODE_READY,function(b,c){a.onConnectionCodeReady(c)});RemoteController.getInstance().events.bind(RemoteController.EVENT_PEER_ENTER+".SetupView",function(b,c){a.onPeerEnter(c)})},show:function(){if(!View.prototype.show.call(this)){return}this.bindEventsShown();this.$code.hide();RemoteController.getInstance().host();TrackingController.getInstance().start();InputController.getInstance().setMode(InputController.INPUT_TYPE_TRACKING);AnalyticsController.getInstance().trackEvent(AnalyticsController.EVENT_SYNC_START);AnalyticsController.getInstance().trackPageView("SetupView")}},_private:{$instructions:null,$code:null,onConnectionCodeReady:function(a){var b=this;RemoteController.getInstance().events.unbind(RemoteController.EVENT_CONNECTION_CODE_READY);setTimeout(function(){b.$code.fadeIn()},1);this.$code.text(a)},onPeerEnter:function(){RemoteController.getInstance().events.unbind(RemoteController.EVENT_PEER_ENTER+".SetupView");this.hide();AnalyticsController.getInstance().trackEvent(AnalyticsController.EVENT_SYNC_SUCCESS);ViewController.getInstance().getView("HelpView").hide();ViewController.getInstance().getView("SyncSuccessView").show()}}});var SyncSuccessView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)},show:function(){var a=this;if(!View.prototype.show.call(this)){return}AnalyticsController.getInstance().trackPageView("SyncSuccessView");setTimeout(function(){a.onTimeout()},3e3)}},_private:{onTimeout:function(){this.hide();ViewController.getInstance().getView("ExperienceLoadingView").show()}}});var InstructionsView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)},init:function(){this.$buttonMouseMode=this.$container.find(".mouse-mode-camera a")},bindEvents:function(){var a=this;this.$buttonMouseMode.bind("click",function(){a.onButtonMouseModeClick()})},bindEventsShown:function(){var a=this;CameraController.getInstance().events.bind(CameraController.EVENT_ALLOW+".InstructionsView",function(){a.onCameraAllow()});CameraController.getInstance().events.bind(CameraController.EVENT_DENY+".InstructionsView",function(){a.onCameraDeny()})},unbind:function(){CameraController.getInstance().events.unbind(CameraController.EVENT_ALLOW+".InstructionsView");CameraController.getInstance().events.unbind(CameraController.EVENT_DENY+".InstructionsView")},show:function(){if(!View.prototype.show.call(this)){return}this.bindEventsShown();setTimeout(function(){CameraController.getInstance().init()},1);AnalyticsController.getInstance().trackPageView("InstructionsView")},hide:function(){this.unbind();View.prototype.hide.call(this)}},_private:{$buttonMouseMode:null,onCameraAllow:function(){this.unbind();RoutingController.getInstance().route("/setup")},onCameraDeny:function(){this.unbind();RoutingController.getInstance().route("/cameradenied")},onButtonMouseModeClick:function(){InputController.getInstance().setMode(InputController.INPUT_TYPE_MOUSE);RoutingController.getInstance().route("/mousecamera")}}});var MouseAllowCameraView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)},bindEventsShown:function(){var a=this;CameraController.getInstance().events.bind(CameraController.EVENT_ALLOW+".MouseAllowCameraView",function(){a.onCameraAllow()});CameraController.getInstance().events.bind(CameraController.EVENT_DENY+".MouseAllowCameraView",function(){a.onCameraDeny()})},unbind:function(){CameraController.getInstance().events.unbind(CameraController.EVENT_ALLOW+".MouseAllowCameraView");CameraController.getInstance().events.unbind(CameraController.EVENT_DENY+".MouseAllowCameraView")},show:function(){if(!View.prototype.show.call(this)){return}this.bindEventsShown()},hide:function(){this.unbind();View.prototype.hide.call(this)}},_private:{onCameraAllow:function(){this.unbind();RoutingController.getInstance().route("/experience-loading")},onCameraDeny:function(){this.unbind();RoutingController.getInstance().route("/experience-loading")}}});var CameraDeniedView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)},show:function(){if(!View.prototype.show.call(this)){return}AnalyticsController.getInstance().trackPageView("CameraDeniedView")}},_private:{init:function(){this.$mouseMode=this.$container.find("a")},bindEvents:function(){var a=this;this.$mouseMode.bind("click",function(){a.onMouseModeClick()})},onMouseModeClick:function(){InputController.getInstance().setMode(InputController.INPUT_TYPE_MOUSE);RoutingController.getInstance().route("/experience-loading")}}});var ExperienceLoadingView=View._extend({_static:{MIN_LOADING_TIME_MS:2e4,PHONE_NOT_DETECTED_TIMEOUT:2e4,SHOW_DESKTOP_PROGRESS_UNTIL:25,MAX_DESKTOP_PROGRESS_STEP:.1,MAX_PROGRESS_STEP:.4},_public:{construct:function(a,b){View.call(this,a,b);this.loadingTimeoutId=-1},show:function(){if(!View.prototype.show.call(this)){return}if(!this.interactionView){this.interactionView=new WebcamControlView("WebcamControlView",".ExperienceLoadingView .WebcamControlView")}if(InputController.getInstance().mode===InputController.INPUT_TYPE_MOUSE){var a=this.$container.find(".loading-mouse-only");a.html(this.$loading.html());this.$loading=a;this.$progress=this.$loading.find(".progress");this.$loading=this.$loading.find(".loading")}this.paused=false;this.peerReady=false;this.selfReady=false;this.loaded=false;this.tweenedProgress=0;this.peerProgress=0;this.selfProgress=0;this.phoneDetectedFrames=0;this.bindEventsShown();this.loadingStartTime=InputController.getInstance().mode===InputController.INPUT_TYPE_TRACKING?-1:0;OrientationController.getInstance().resetResetInformation();OrientationController.getInstance().start();if(InputController.getInstance().mode===InputController.INPUT_TYPE_TRACKING){this.interactionView.show();this.video.src=Resource.get(DetectionController.getInstance().isChromeOnIOSonMobile?"media/video/instructions-touch-0.webm":"media/video/instructions-regular.webm");this.video.play();if(DetectionController.getInstance().isChromeOnIOSonMobile){this.video2.src=Resource.get("media/video/instructions-touch.webm");this.video2.load()}}this.$loading.stop().show();if(DetectionController.getInstance().isChromeOnIOSonMobile){this.$container.find(".instructions.regular").hide();this.$container.find(".instructions.touch").show()}else{this.$container.find(".instructions.regular").show();this.$container.find(".instructions.touch").hide()}AnalyticsController.getInstance().trackPageView("ExperienceLoadingView");this.waitForPhoneDetected();this.loadingTimeoutId=setTimeout(function(){PreloadController.getInstance().preloadExperience()},View.TRANSITION_TIME);Debug.openFolder("ExperienceLoading")},transitionHide:function(){var a=this;clearTimeout(this.showTimeoutId);clearTimeout(this.hideTimeoutId);this.$container.show();TweenLite.to(this.$page,View.TRANSITION_TIME*.001,{css:{opacity:0},ease:Power2.easeIn,delay:.05,onComplete:function(){a.endTransitionHide()}})},hide:function(){View.prototype.hide.call(this);clearTimeout(this.loadingTimeoutId);clearTimeout(this.phoneNotDetectedTimeoutId);clearTimeout(this.tryGoNextTimeoutId);this.unbindEventsHidden();Debug.closeFolder("ExperienceLoading")},pause:function(){if(!this.shown){return}this.paused=true;this.pauseTime=(new Date).getTime();clearTimeout(this.phoneNotDetectedTimeoutId)},resume:function(){if(!this.shown){return}this.paused=false;this.loadingStartTime+=(new Date).getTime()-this.pauseTime;this.waitForPhoneDetected()}},_private:{$progress:null,$video:null,$error:null,paused:false,pauseTime:0,video:null,interactionView:null,peerReady:false,peerProgress:0,phoneDetectedFrames:0,selfReady:false,loaded:false,selfProgress:0,tweenedProgress:0,loadingStartTime:-1,tryGoNextTimeoutId:-1,lastPosition:{x:0,y:0,z:0},orientationReset:false,phoneNotDetectedTimeoutId:-1,loadingTimeoutId:-1,init:function(){this.$progress=this.$container.find(".progress");this.$loading=this.$container.find(".loading");this.$video=this.$container.find("video");this.$error=this.$container.find(".error");this.video=this.$video[0];this.video.loop=true;this.video2=this.$video[1];this.video2.loop=true;$(this.video2).hide();this.$error.hide();Debug.add(this,"selfProgress","ExperienceLoading");Debug.add(this,"peerProgress","ExperienceLoading")},bindEventsShown:function(){var a=this;PreloadController.getInstance().events.bind(PreloadController.EVENT_EXPERIENCE_PROGRESS+".ExperienceLoadingView",function(b,c){a.onProgress(c)});PreloadController.getInstance().events.bind(PreloadController.EVENT_EXPERIENCE_COMPLETE+".ExperienceLoadingView",function(){a.onComplete()});RemoteController.getInstance().events.bind(RemoteController.EVENT_PEER_LOADING_PROGRESS+".ExperienceLoadingView",function(b,c){a.onPeerProgress(c)});RemoteController.getInstance().events.bind(RemoteController.EVENT_PEER_READY+".ExperienceLoadingView",function(){a.onPeerReady()});TrackingController.getInstance().events.bind(TrackingController.EVENT_UPDATE+".ExperienceLoadingView",function(){a.onTrackingUpdate()});AnimationController.getInstance().events.bind(AnimationController.EVENT_FRAME+".ExperienceLoadingView",function(){a.onFrame()})},unbindEventsHidden:function(){PreloadController.getInstance().events.unbind(PreloadController.EVENT_EXPERIENCE_PROGRESS+".ExperienceLoadingView");PreloadController.getInstance().events.unbind(PreloadController.EVENT_EXPERIENCE_COMPLETE+".ExperienceLoadingView");RemoteController.getInstance().events.unbind(RemoteController.EVENT_PEER_LOADING_PROGRESS+".ExperienceLoadingView");RemoteController.getInstance().events.unbind(RemoteController.EVENT_PEER_READY+".ExperienceLoadingView");TrackingController.getInstance().events.unbind(TrackingController.EVENT_UPDATE+".ExperienceLoadingView");AnimationController.getInstance().events.unbind(AnimationController.EVENT_FRAME+".ExperienceLoadingView")},tryGoNext:function(){var a=this;clearTimeout(this.tryGoNextTimeoutId);if(!this.shown||this.paused||this.loadingStartTime===-1&&InputController.getInstance().mode===InputController.INPUT_TYPE_TRACKING){return}if(this.loaded&&this.selfReady&&(this.peerReady||InputController.getInstance().mode===InputController.INPUT_TYPE_MOUSE)){if(InputController.getInstance().mode===InputController.INPUT_TYPE_TRACKING&&(new Date).getTime()-this.loadingStartTime<ExperienceLoadingView.MIN_LOADING_TIME_MS){this.tryGoNextTimeoutId=setTimeout(function(){a.tryGoNext()},1e3);return}TrackingController.getInstance().events.unbind(TrackingController.EVENT_UPDATE+".ExperienceLoadingView");AnalyticsController.getInstance().trackEvent(AnalyticsController.EVENT_SYNC_FULL);RemoteController.getInstance().start();this.hide();setTimeout(function(){a.interactionView.hide();RoutingController.getInstance().route("/experience")},2500)}},waitForPhoneDetected:function(){var a=this;clearTimeout(this.phoneNotDetectedTimeoutId);this.phoneNotDetectedTimeoutId=setTimeout(function(){a.onPhoneNotDetected()},ExperienceLoadingView.PHONE_NOT_DETECTED_TIMEOUT)},getCombinedProgress:function(){var a=0;if(InputController.getInstance().mode===InputController.INPUT_TYPE_TRACKING){if(this.peerProgress<ExperienceLoadingView.SHOW_DESKTOP_PROGRESS_UNTIL&&this.selfProgress<ExperienceLoadingView.SHOW_DESKTOP_PROGRESS_UNTIL){a=Math.max(this.selfProgress,this.peerProgress)}else if(this.peerProgress<ExperienceLoadingView.SHOW_DESKTOP_PROGRESS_UNTIL){a=ExperienceLoadingView.SHOW_DESKTOP_PROGRESS_UNTIL}else{a=Math.min(this.selfProgress,this.peerProgress)}}else{a=this.selfProgress}return a},updateComplete:function(){if(this.selfReady&&(this.peerReady||InputController.getInstance().mode===InputController.INPUT_TYPE_MOUSE)){if(InputController.getInstance().mode===InputController.INPUT_TYPE_MOUSE){this.tryGoNext()}}},onProgress:function(a){this.selfProgress=a*100},onPeerProgress:function(a){this.peerProgress=a*100},onComplete:function(){this.selfProgress=100;this.selfReady=true},onPeerReady:function(){this.peerReady=true},onTrackingUpdate:function(){var a=TrackingController.getInstance().getFrameInfo();if(this.paused){return}if(ViewController.getInstance().getView("HelpView").shown){return}if((a.x!==this.lastPosition.x||a.y!==this.lastPosition.y||a.z!==this.lastPosition.z)&&TrackingController.getInstance().isVisible()){this.onPhoneDetected()}this.lastPosition.x=a.x;this.lastPosition.y=a.y;this.lastPosition.z=a.z},onPhoneDetected:function(){var a=this;if(++this.phoneDetectedFrames===5){if(DetectionController.getInstance().isChromeOnIOSonMobile){setTimeout(function(){a.video2.style.display="block";a.video2.play();a.video.style.display="none";a.video.pause()},(this.video.duration-this.video.currentTime)*1e3)}}if(this.loadingStartTime===-1){this.loadingStartTime=(new Date).getTime()}this.$error.fadeOut();clearTimeout(this.phoneNotDetectedTimeoutId);this.waitForPhoneDetected();this.tryGoNext()},onPhoneNotDetected:function(){this.$error.fadeIn()},onFrame:function(){if(!ViewController.getInstance().getView("HelpView").shown&&OrientationController.getInstance().timesReset>0&&(Math.abs(OrientationController.getInstance().worldQuaternion.x)>TurnItBackSequence.MIN_ROTATION/180||Math.abs(OrientationController.getInstance().worldQuaternion.y)>TurnItBackSequence.MIN_ROTATION/180)){RemoteController.getInstance().showTurnItBack()}else{RemoteController.getInstance().hideTurnItBack()}if(!this.loaded){this.tweenedProgress+=Math.min(this.getCombinedProgress()-this.tweenedProgress,this.getCombinedProgress()<=ExperienceLoadingView.SHOW_DESKTOP_PROGRESS_UNTIL?ExperienceLoadingView.MAX_DESKTOP_PROGRESS_STEP:ExperienceLoadingView.MAX_PROGRESS_STEP);this.$progress.text(Math.floor(this.tweenedProgress)+"%");if(Math.floor(this.tweenedProgress)>=100){this.$progress.text("100%");this.$loading.fadeOut();this.loaded=true;this.updateComplete()}}},onMouseMode:function(){this.tryGoNext()}}});var ExperienceView=View._extend({_static:{KEY_TOGGLE_PLAYBACK:32,BREAK_FREE_ENABLED:false,MOUSE_DISTANCE_TO_BREAK_FREE:4,GYRO_DIFFERENCE_TO_BREAK_FREE:.018,BREAK_FREE_START_TIME:282,GYRO_BREAK_FREE_START_TIME_OFFSET:6},_public:{construct:function(a,b){View.call(this,a,b)},show:function(){var a=this;if(!View.prototype.show.call(this)){return}if(InputController.getInstance().mode===InputController.INPUT_TYPE_TRACKING){CameraController.getInstance().init()}TrackingController.getInstance().init();TrackingController.getInstance().start();OrientationController.getInstance().start();switch(InputController.getInstance().mode){case InputController.INPUT_TYPE_MOUSE:AnalyticsController.getInstance().trackEvent(AnalyticsController.EVENT_MODE_MOUSE);break;case InputController.INPUT_TYPE_TRACKING:AnalyticsController.getInstance().trackEvent(AnalyticsController.EVENT_MODE_CAMERA);break}this.onDeviceActive();this.$inactiveOverlay.css("display","none");this.wasExperiencePlayingBeforeInactive=false;this.hideOverlay();this.canShowOverlay=false;Player.getInstance().startPreloadingVideo();RoutingController.getInstance().historyStates=[];AnalyticsController.getInstance().trackPageView("ExperienceView");TimelineController.getInstance().start();ViewController.getInstance().getView("TimelineView").slideOut(true);ViewController.getInstance().getView("PersistentControlsView").showQuality();ViewController.getInstance().getView("PersistentControlsView").slideIn();ViewController.getInstance().getView("PersistentControlsView").canSlideOut=false;setTimeout(function(){ViewController.getInstance().getView("PersistentControlsView").canSlideOut=true},9e3);ViewController.getInstance().getView("PersistentControlsView").slideOut({delay:1e4,force:true});AnimationController.getInstance().events.bind(AnimationController.EVENT_FRAME+".ExperienceView",function(){a.onFrame()});$(document).bind("mousemove.ExperienceView",function(b){a.onMouseMove(b)});$(document).bind("click.ExperienceView",function(){a.onMouseClick()});RemoteController.getInstance().sleepMonitorEnabled=true;console.log("-- starting to monitor device sleep")},hide:function(){View.prototype.hide.call(this);AnimationController.getInstance().events.unbind(AnimationController.EVENT_FRAME+".ExperienceView");$(document).unbind("mousemove.ExperienceView");$(document).unbind("click.ExperienceView");TimelineController.getInstance().stop();ViewController.getInstance().getView("PersistentControlsView").hideQuality()}},_private:{$breakFree:null,$inactiveOverlay:null,keyDown:false,breakFreeStyle:null,lastMousePosition:{x:0,y:0},currentMousePosition:{x:0,y:0},lastGyroVector:{x:0,y:0,z:0},isBreakFree:false,canBreakFree:true,clicked:true,wasExperiencePlayingBeforeInactive:false,inactive:false,canShowOverlay:false,showOverlay:function(){if(this.canShowOverlay){$(".ExperienceView .overlay").stop().fadeIn()}else{this.canShowOverlay=true}},hideOverlay:function(){$(".ExperienceView .overlay").stop().fadeOut()},init:function(){this.$breakFree=this.$container.find(".break-free-content");this.$inactiveOverlay=this.$container.find(".inactive-overlay");this.$inactiveOverlay.css("display","none");this.breakFreeStyle=this.$breakFree[0].style;this.breakFreeStyle.opacity=0},breakFree:function(){var a=this;if(this.canBreakFree){TweenLite.to(this.$breakFree,0,{css:{opacity:1}});TweenLite.to(this.$breakFree,0,{css:{opacity:0},delay:.3});TweenLite.to(this.$breakFree,.3+(InputController.getInstance().mode===InputController.INPUT_TYPE_TRACKING?3:0),{onComplete:function(){a.canBreakFree=true}});this.canBreakFree=false}},unBreakFree:function(){return},bindEvents:function(){var a=this;Player.getInstance().events.bind(Player.EVENT_CONNECTING_MESSAGE_SHOW+".ExperienceView",function(){a.showOverlay()});Player.getInstance().events.bind(Player.EVENT_CONNECTING_MESSAGE_HIDE+".ExperienceView",function(){a.hideOverlay()});Player.getInstance().events.bind(Player.EVENT_SEEKED+".ExperienceView",function(){a.onSeeked()});RemoteController.getInstance().events.bind(RemoteController.EVENT_DEVICE_ACTIVE+".ExperienceView",function(){a.onDeviceActive()});RemoteController.getInstance().events.bind(RemoteController.EVENT_DEVICE_INACTIVE+".ExperienceView",function(){a.onDeviceInactive()});$(document).bind("keydown.ExperienceView",function(b){a.onKeyDown(b)});$(document).bind("keyup.ExperienceView",function(b){a.onKeyUp(b)})},onKeyDown:function(a){if(this.shown&&!this.keyDown){if(a.which===ExperienceView.KEY_TOGGLE_PLAYBACK&&!this.inactive&&!ViewController.getInstance().getView("DeviceDisconnectedView").shown){this.keyDown=true;TimelineController.getInstance().toggle()}}},onKeyUp:function(a){if(a.which===ExperienceView.KEY_TOGGLE_PLAYBACK){this.keyDown=false}},onMouseMove:function(a){this.currentMousePosition.x=a.originalEvent.pageX;this.currentMousePosition.y=a.originalEvent.pageY},onMouseClick:function(){if(TimelineController.getInstance().currentTime>ExperienceView.BREAK_FREE_START_TIME){this.clicked=true}},onFrame:function(){var a,b,c,d,e,f;if(!this.shown){return}if(ExperienceView.BREAK_FREE_ENABLED&&TimelineController.getInstance().currentTime>ExperienceView.BREAK_FREE_START_TIME){if(this.isBreakFree){this.unBreakFree()}else{if(InputController.getInstance().mode===InputController.INPUT_TYPE_TRACKING){if(TimelineController.getInstance().currentTime>ExperienceView.BREAK_FREE_START_TIME+ExperienceView.GYRO_BREAK_FREE_START_TIME_OFFSET){c=new THREE.Vector3(0,0,1);c.applyQuaternion(OrientationController.getInstance().worldQuaternion);d=c.x-this.lastGyroVector.x;e=c.y-this.lastGyroVector.y;f=c.z-this.lastGyroVector.z;if(d>ExperienceView.GYRO_DIFFERENCE_TO_BREAK_FREE||d<-ExperienceView.GYRO_DIFFERENCE_TO_BREAK_FREE||e>ExperienceView.GYRO_DIFFERENCE_TO_BREAK_FREE||e<-ExperienceView.GYRO_DIFFERENCE_TO_BREAK_FREE||f>ExperienceView.GYRO_DIFFERENCE_TO_BREAK_FREE||f<-ExperienceView.GYRO_DIFFERENCE_TO_BREAK_FREE){this.breakFree()}}}else{if(this.currentMousePosition.y<window.innerHeight-60&&this.clicked){this.breakFree()}}}}if(!c){c=new THREE.Vector3(0,0,1);c.applyQuaternion(OrientationController.getInstance().worldQuaternion)}this.lastGyroVector.x=c.x;this.lastGyroVector.y=c.y;this.lastGyroVector.z=c.z;this.lastMousePosition.x=this.currentMousePosition.x;this.lastMousePosition.y=this.currentMousePosition.y;this.clicked=false},onDeviceActive:function(){if(this.inactive){this.inactive=false;ViewController.getInstance().getView("DeviceDisconnectedView").onPeerReady()}},onDeviceInactive:function(){if(!this.inactive){this.inactive=true;if(TimelineController.getInstance().canShowDisconnectionError()){ViewController.getInstance().getView("DeviceDisconnectedView").show(true)}}},onSeeked:function(){if(this.inactive){this.inactive=false;this.onDeviceInactive()}}}});var TimelineView=View._extend({_static:{SHOW_TRUE_BUFFER:false},_public:{construct:function(a,b){View.call(this,a,b)},show:function(){if(!View.prototype.show.call(this)){return}this.isSlidIn=true;this.slideOut();MouseCursorAppearanceController.getInstance().startTrackMouseActivity()},hide:function(){View.prototype.hide.call(this);MouseCursorAppearanceController.getInstance().stopTrackMouseActivity()},slideIn:function(a){if(this.isSlidIn||InputController.getInstance().mode===InputController.INPUT_TYPE_TRACKING&&!RemoteController.getInstance().isActive&&TimelineController.getInstance().currentTime<ExperienceView.BREAK_FREE_START_TIME){return}if(a&&a.delay){var b=this;clearTimeout(this.slideInDelayId);clearTimeout(b.slideOutTimeoutId);this.slideInDelayId=setTimeout(function(){clearTimeout(b.slideOutTimeoutId);b.isSlidIn=true;b.$container.addClass("in");b.$container.removeClass("out");ViewController.getInstance().getView("PersistentControlsView").slideIn()},2e3);return}this.isSlidIn=true;this.$container.addClass("in");this.$container.removeClass("out");ViewController.getInstance().getView("PersistentControlsView").slideIn()},slideOut:function(a){var b=this;if(!this.isSlidIn){return}if(ViewController.getInstance().getView("PersistentControlsView")&&ViewController.getInstance().getView("PersistentControlsView").isQualityMenuOpen()){this.slideOutTimeoutId=setTimeout(function(){b.slideOut(a)},100);return}clearTimeout(this.slideInDelayId);this.isSlidIn=false;this.$container.addClass("out");this.$container.removeClass("in");if(!a&&ViewController.getInstance().getView("PersistentControlsView")){ViewController.getInstance().getView("PersistentControlsView").slideOut()}}},_private:{$buttonPlayPause:null,$timeElapsed:null,$timeTotal:null,$seekButton:null,timeElapsedElement:null,timeTotalElement:null,draggingSeek:false,draggingPoint:{x:0,y:0},isSlidIn:false,seekButtonEnabled:true,slideInDelayId:-1,slideOutTimeoutId:-1,currentlySyncingDevices:false,captions:[],init:function(){this.$buttonPlayPause=this.$container.find("button.play-pause");this.$timeElapsed=this.$container.find(".time .elapsed");this.$timeTotal=this.$container.find(".time .total");this.$seekButton=$("#seeker-button");this.bufferCanvas=this.$container.find("canvas.buffer")[0];this.bufferCanvas.height=4;this.bufferContext=this.bufferCanvas.getContext("2d");this.timeElapsedElement=this.$timeElapsed[0];this.timeTotalElement=this.$timeTotal[0];this.isSlidIn=true;this.slideOut()},changeButtonsBehaviour:function(){this.currentlySyncingDevices=true},restoreButtonsBehaviour:function(){this.currentlySyncingDevices=false},bindEvents:function(){var a=this;Player.getInstance().events.bind(Player.EVENT_CONNECTING_MESSAGE_SHOW,function(){a.changeButtonsBehaviour()});Player.getInstance().events.bind(Player.EVENT_CONNECTING_MESSAGE_HIDE,function(){a.restoreButtonsBehaviour()});Player.getInstance().events.bind(Player.EVENT_CONNECTING_MESSAGE_SHOW+".TimelineView",function(){a.onConnecting()});Player.getInstance().events.bind(Player.EVENT_CONNECTING_MESSAGE_HIDE+".TimelineView",function(){a.onConnected()});AnimationController.getInstance().events.on(AnimationController.EVENT_FRAME,function(){a.onFrame()});TimelineController.getInstance().events.bind(TimelineController.EVENT_START,function(){a.onStart()});TimelineController.getInstance().events.bind(TimelineController.EVENT_RESUME,function(){a.onResume()});TimelineController.getInstance().events.bind(TimelineController.EVENT_PAUSE,function(){a.onPause()});TimelineController.getInstance().events.bind(TimelineController.EVENT_END,function(){a.onEnd()});TimelineController.getInstance().events.bind(TimelineController.ENABLE_SEEK_INTERACTION,function(){a.seekButtonEnabled=true});TimelineController.getInstance().events.bind(TimelineController.DISABLE_SEEK_INTERACTION,function(){a.seekButtonEnabled=false});TimelineController.getInstance().events.on(TimelineController.ACTION_ADD_CAPTION,function(b,c){a.addDebugCaption(c.name,c.startTime,c.endTime,c.scene,c.totalTime)});MouseCursorAppearanceController.getInstance().events.bind(MouseCursorAppearanceController.EVENT_MOUSE_ACTIVE+".TimelineView",function(){a.onMouseActive()});MouseCursorAppearanceController.getInstance().events.bind(MouseCursorAppearanceController.EVENT_MOUSE_INACTIVE+".TimelineView",function(){a.onMouseInactive()});this.$buttonPlayPause.bind("click",function(){a.onPlayPauseClick()});this.$seekButton.bind("mousedown",function(b){if(!a.seekButtonEnabled)return;a.startDragSeekButton(b)});this.$seekButton.bind("mouseup",function(){a.stopDragSeekButton()});$("body").bind("mouseup",function(){a.stopDragSeekButton()});$(".seeker .bar").bind("mouseup",function(b){if(!a.seekButtonEnabled)return;a.draggingSeek=true;a.draggingPoint={x:0,y:0};a.stopDragSeekButton()})},startDragSeekButton:function(a){this.draggingPoint={x:a.offsetX,y:a.offsetY};this.draggingSeek=true},stopDragSeekButton:function(){if(!this.draggingSeek){return}this.draggingSeek=false;if(Viewport.MOUSE_Y<window.innerHeight-100){return}var a=(Viewport.MOUSE_X-this.draggingPoint.x)/Viewport.WIDTH;TimelineController.getInstance().seekTarget=a;TimelineController.getInstance().events.trigger(TimelineController.EVENT_SEEK,[{position:a}])},secondsToMinutesString:function(a){var b=Math.floor(a/60);var c=Math.round(a-b*60);if(c===60){b+=1;c=0}return b+":"+(c<10?"0"+c:c)},updateTime:function(){this.timeElapsedElement.innerHTML=this.secondsToMinutesString(Player.getInstance().getCurrentTime());this.timeTotalElement.innerHTML=isNaN(Player.getInstance().getDuration())?"--:--":this.secondsToMinutesString(Player.getInstance().getDuration());$(".seeker .bar .progress").width(Player.getInstance().getProgress()*100+"%")},updateBuffer:function(){var a=TimelineView.SHOW_TRUE_BUFFER?Player.getInstance().getBufferRanges():[{start:0,end:1}],b,c;this.bufferContext.fillStyle="#ffffff";this.bufferContext.clearRect(0,0,this.bufferCanvas.width,this.bufferCanvas.height);for(b=0;b<a.length;++b){c=a[b].start*this.bufferCanvas.width;this.bufferContext.fillRect(c,0,a[b].end*this.bufferCanvas.width-c,this.bufferCanvas.height)}},milisecondsToTime:function(a){function b(a){return(a<10?"0":"")+a}s=a/1e3;var c=s%60;s=(s-c)/60;var d=s%60;var e=(s-d)/60;return b(d)+":"+b(c)},addDebugCaption:function(a,b,c,d,e){var f=$('<div class="caption '+a+'" style="width: '+(c-b)*100/e+"%"+'">'+'<div class="progress"></div>'+'<div class="caption-extra-info">'+'<p class="time"><i>'+this.milisecondsToTime(b*1e3).toPrecision(4)+" - "+this.milisecondsToTime(c*1e3).toPrecision(4)+" </i></p>"+"</div>"+'<p class="name"><u>'+a+"</u></p>"+"</div>");this.captions.push({object:f,position:b/e,length:(c-b)/e});$("#timeline-captions").append(f)},onPlayPauseClick:function(){if(this.currentlySyncingDevices){}else{TimelineController.getInstance().toggle()}ViewController.getInstance().getView("HelpView").hide()},onStart:function(){this.$buttonPlayPause.addClass("on")},onResume:function(){this.$buttonPlayPause.addClass("on")},onPause:function(){this.$buttonPlayPause.removeClass("on")},onEnd:function(){return},onConnecting:function(){TweenLite.to(this.$buttonPlayPause,0,{css:{opacity:0}})},onConnected:function(){TweenLite.to(this.$buttonPlayPause,.5,{css:{opacity:1}})},onMouseInactive:function(){this.slideOut()},onMouseActive:function(){if(InputController.getInstance().mode===InputController.INPUT_TYPE_MOUSE){if(MouseCursorAppearanceController.getInstance().lastPoint.y>$(window).height()-30){this.slideIn({delay:true});return}else if(MouseCursorAppearanceController.getInstance().lastPoint.y<$(window).height()-70){this.slideOut();return}}this.slideIn()},onFrame:function(){this.updateTime();this.updateBuffer();for(var a=0;a<=this.captions.length-1;a++){this.captions[a].object.css({"-webkit-transform":"translateX("+this.captions[a].position*Viewport.WIDTH+"px)"});this.captions[a].object.find(".actual-time").css({width:this.captions[a].length*Viewport.WIDTH+"px"})}if(this.draggingSeek){this.$seekButton.css({position:"absolute","-webkit-transform":"translateX("+(Viewport.MOUSE_X-this.draggingPoint.x)+"px)","-moz-transform":"translateX("+(Viewport.MOUSE_X-this.draggingPoint.x)+"px)"})}else{this.$seekButton.css({position:"absolute","-webkit-transform":"translateX("+Math.floor(Player.getInstance().getProgress()*window.innerWidth)+"px)","-moz-transform":"translateX("+Math.floor(Player.getInstance().getProgress()*window.innerWidth)+"px)",transform:"translateX("+Math.floor(Player.getInstance().getProgress()*window.innerWidth)+"px)"})}},onResize:function(){this.bufferCanvas.width=window.innerWidth;this.updateBuffer()}}});var HelpView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)},show:function(){if(!View.prototype.show.call(this)){return}CameraController.getInstance().init();this.trackingDebugView.show();this.initTracking();RemoteController.getInstance().hideTurnItBack();this.$code.text(RemoteController.getInstance().getConnectionCode());this.$container.removeClass("active");if(CameraController.getInstance().videoReady){this.onCameraReady()}if(DetectionController.getInstance().isChromeOnIOSonMobile){this.$container.find(".two-columns .regular").hide();this.$container.find(".two-columns .touch").show()}else{this.$container.find(".two-columns .regular").show();this.$container.find(".two-columns .touch").hide()}ViewController.getInstance().getView("ExperienceLoadingView").pause();AnalyticsController.getInstance().trackPageView("HelpView");TrackingController.getInstance().start();RemoteController.getInstance().hideAxelle()},hide:function(){View.prototype.hide.call(this);ViewController.getInstance().getView("ExperienceLoadingView").resume();this.unbindEventsHidden();if(this.trackingDebugView)this.trackingDebugView.hide();this.stopTracking()}},_private:{trackingDebugView:null,$code:null,$buttonClose:null,$camera:null,$buttonDownloadChrome:null,cameraInitialised:false,init:function(){this.$code=this.$container.find(".code");this.$buttonClose=this.$container.find("button.close");
this.$camera=this.$container.find(".camera");this.$buttonDownloadChrome=this.$container.find(".disconnected p a");this.$buttonDownloadChrome.attr("target","_blank");this.trackingDebugView=new DebugView("HelpTrackingView",".HelpView .display.trackingDebug");TrackingController.getInstance().addDebugView(this.trackingDebugView)},bindEvents:function(){var a=this;if(!CameraController.getInstance().videoReady){CameraController.getInstance().events.bind(CameraController.EVENT_VIDEO_READY+".HelpView",function(){a.onCameraReady()})}else{this.onCameraReady()}RemoteController.getInstance().events.bind(RemoteController.EVENT_PEER_ENTER+".HelpView",function(){a.onPeerEnter()});this.$buttonClose.bind("click",function(){a.onButtonCloseClick()})},initTracking:function(){TrackingController.getInstance().init();TrackingController.getInstance().start()},stopTracking:function(){},unbindEventsHidden:function(){TrackingController.getInstance().events.unbind(TrackingController.EVENT_UPDATE+".HelpView")},onButtonCloseClick:function(){ViewController.getInstance().getView("PersistentControlsView").onButtonHelpClick()},onCameraReady:function(){this.$container.addClass("active");this.$container.removeClass("break-free");if(TimelineController.getInstance().currentTime>ExperienceView.BREAK_FREE_START_TIME){this.$container.addClass("break-free")}else if(RemoteController.getInstance().isConnected()){this.$container.addClass("connected")}else{this.$container.removeClass("connected")}},onPeerEnter:function(){if(this.shown){this.onButtonCloseClick()}}}});var HelpOrientationView=View._extend({_static:{WIDTH:320,HEIGHT:240},_public:{construct:function(a,b){View.call(this,a,b)},show:function(){if(!View.prototype.show.call(this)){return}this.initShown();this.bindEventsShown()},hide:function(){View.prototype.hide.call(this);this.unbindEventsHidden()}},_private:{$buttonReset:null,initialised:false,camera:null,renderer:null,scene:null,phoneModel:null,init:function(){this.$buttonReset=this.$container.find("button.reset-orientation")},initShown:function(){if(this.initialised){return}var a;this.camera=new THREE.PerspectiveCamera;this.camera.position.z=200;this.renderer=new THREE.WebGLRenderer;this.renderer.setClearColor(16777215);this.renderer.setSize(HelpOrientationView.WIDTH,HelpOrientationView.HEIGHT);this.scene=new THREE.Scene;this.$container.find(".three").append(this.renderer.domElement);a=new THREE.MeshLambertMaterial({color:4521796});this.phoneModel=new THREE.Mesh(new THREE.CubeGeometry(40,80,7),a);this.phoneModel.useQuaternion=true;var b=new THREE.PointLight(16777215);b.position.x=10;b.position.y=50;b.position.z=130;this.scene.add(b);this.scene.add(this.phoneModel);this.initialised=true},bindEvents:function(){var a=this;this.$buttonReset.bind("click",function(){a.onButtonResetClick()})},bindEventsShown:function(){var a=this;AnimationController.getInstance().events.bind(AnimationController.EVENT_FRAME+".HelpOrientationView",function(){a.onFrame()})},unbindEventsHidden:function(){AnimationController.getInstance().events.unbind(AnimationController.EVENT_FRAME+".HelpOrientationView")},rotatePhone:function(){this.phoneModel.quaternion.copy(OrientationController.getInstance().getQuaternionSmooth())},render:function(){this.renderer.render(this.scene,this.camera)},onFrame:function(){this.rotatePhone();this.render()},onButtonResetClick:function(){OrientationController.getInstance().resetOrientation()}}});var DebugView=View._extend({_static:{WIDTH:256,HEIGHT:256},_public:{initialized:false,renderer:null,scene:null,camera:null,border:10,planeScale:1,allTextures:[],allPlanes:[],allCanvas:{},allFbos:{},scaleX:16/9/(256/256),planesAdded:false,construct:function(a,b){View.call(this,a,b);TrackingController.getInstance().events.bind(TrackingController.INIT_DEBUG,this.setup.bind(this))},setup:function(){if(this.initialized)return;var a=this;a.renderer=TrackingController.getInstance().renderer;a.renderer.setSize(240*5,320);a.renderer.autoClear=false;$(".HelpView .debug").append(a.renderer.domElement);this.scene=new THREE.Scene;this.camera=new THREE.OrthographicCamera(0,240*6,0,320,-1e3,1e3);this.camera.position.set(0,0,1);this.camera.lookAt(new THREE.Vector3);this.initDebug();this.initialized=true},show:function(){this.isShown=true;TrackingController.getInstance().canClear=false;TrackingController.getInstance().showDebugContours(true)},hide:function(){this.isShown=false;TrackingController.getInstance().canClear=false;TrackingController.getInstance().showDebugContours(false)},initTexturePlanes:function(a,b){if(this.planesAdded)return;this.planesAdded=true;this.addTexture(a,0,0);this.addCanvasTexture("contours",1,0);this.addRenderTexture("pose",2,0)},updateData:function(a,b,c,d,e){if(!this.isShown)return;if(a.contours)this.updateCanvasWithBlobs("contours",b,a.contours);if(a.candidates)this.updateCanvasWithCandidates("contours",Boolean(a.contours)?null:b,a.candidates);this.updatePhoneSmooth("pose",c,d,a.foundHole,a.useEstimate);if(a.useEstimate)this.updateCanvasWithEstimate("contours",null,a.estimatedX,a.estimatedY);if(a.motionX&&a.motionY)this.updateCanvasWithMotion("contours",null,a.motionX,a.motionY)},render:function(){if(!this.isShown)return;for(var a in this.allFbos){this.allFbos[a].render()}this.renderer.render(this.scene,this.camera)}},_private:{initDebug:function(){},bindEvents:function(){},bindEventsShown:function(){},unbindEventsHidden:function(){},onFrame:function(){},onTrackingUpdate:function(a){},addTexture:function(a,b,c){var d=new THREE.Mesh(new THREE.PlaneGeometry(DebugView.WIDTH,DebugView.HEIGHT,1,1),new THREE.MeshBasicMaterial({color:16777215,map:a,side:THREE.DoubleSide,transparent:true}));d.scale.set(-this.planeScale*this.scaleX,-this.planeScale,this.planeScale);d.position.x=(this.border+DebugView.WIDTH*this.planeScale*this.scaleX)*(b+.5);d.position.y=this.border*2+(this.border+DebugView.HEIGHT*this.planeScale)*(c+.5);this.scene.add(d);this.allPlanes.push(d);this.allTextures.push(a)},addCanvasTexture:function(a,b,c){var d=document.createElement("canvas");d.c=d.getContext("2d");d.width=DebugView.WIDTH;d.height=DebugView.HEIGHT;d.c.fillStyle="black";d.c.fillRect(0,0,DebugView.WIDTH,DebugView.HEIGHT);d.c.fillStyle="white";var e=new THREE.Texture(d,new THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBAFormat,THREE.UnsignedByteType,1);e.needsUpdate=true;e.generateMipmaps=false;d.texture=e;TextureUpdateController.getInstance().addTexture(e,24,this.renderer);var f=new THREE.Mesh(new THREE.PlaneGeometry(DebugView.WIDTH,DebugView.HEIGHT,1,1),new THREE.MeshBasicMaterial({color:16777215,map:e,side:THREE.DoubleSide,transparent:false}));f.scale.set(-this.planeScale*this.scaleX,-this.planeScale,this.planeScale);f.position.x=(this.border+DebugView.WIDTH*this.planeScale*this.scaleX)*(b+.5);f.position.y=this.border*2+(this.border+DebugView.HEIGHT*this.planeScale)*(c+.5);this.scene.add(f);this.allPlanes.push(f);this.allTextures.push(e);this.allCanvas[a]=d},addRenderTexture:function(a,b,c){var d=new FramebufferWrapper(DebugView.WIDTH,DebugView.HEIGHT,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,type:THREE.UnsignedByteType,camera:new THREE.PerspectiveCamera(45,1/1,.05,1e3),depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,backgroundColor:7829367,backgroundAlpha:1,renderer:TrackingController.getInstance().renderer});d.camera.lookAt(new THREE.Vector3(0,0,1));d.phone=this.createDebugPhoneModel(1,false);d.phone.position.set(0,0,-500);d.scene.add(d.phone);d.camera.lookAt(new THREE.Vector3(0,0,1));d.phoneEst=this.createDebugPhoneModel(1,true);d.phoneEst.position.set(0,0,-500);var e=new THREE.DirectionalLight(16777215);e.position.set(0,0,-1).normalize();e.lookAt(new THREE.Vector3(0,0,1));d.scene.add(e);var f=new THREE.Mesh(new THREE.PlaneGeometry(DebugView.WIDTH,DebugView.HEIGHT,1,1),new THREE.MeshBasicMaterial({color:16777215,map:d.texture,side:THREE.DoubleSide,transparent:false}));f.scale.set(-this.planeScale*this.scaleX,-this.planeScale,this.planeScale);f.position.x=(this.border+DebugView.WIDTH*this.planeScale*this.scaleX)*(b+.5);f.position.y=this.border*2+(this.border+DebugView.HEIGHT*this.planeScale)*(c+.5);this.scene.add(f);this.allPlanes.push(f);this.allTextures.push(d.texture);this.allFbos[a]=d;d.render()},createDebugPhoneModel:function(a,b){var c=new THREE.CubeGeometry(37*a,70*a,10*a);var d=new THREE.CubeGeometry(31*a,55*a,1*a);b=b?true:false;var e=new THREE.MeshLambertMaterial({color:4521898,transparent:true,depthTest:true,depthWrite:true});var f=new THREE.MeshLambertMaterial({color:3355443,transparent:true,depthTest:true,depthWrite:true});if(b){e.opacity=f.opacity=.25;e.color=new THREE.Color(16711680)}var g=new THREE.Mesh(c,e);var h=new THREE.Mesh(d,f);h.position.y=3*a;h.position.z=-5*a;var i=new THREE.AxisHelper(50*a);i.rotation.x=Math.PI;var j=new THREE.Object3D;j.add(g);j.add(h);j.add(i);j.useQuaternion=true;j.quaternion=new THREE.Quaternion;j.projectedPosition=new THREE.Vector3(0,0,0);j.mat=e;return j},updateCanvasWithBlobs:function(a,b,c){var d=this.allCanvas[a];if(!d){console.error("Debug Error - Blob Canvas "+a+" doesn't exist");return}var e=d.c;if(b)e.drawImage(b,0,0,DebugView.WIDTH,DebugView.HEIGHT);e.globalAlpha=.75;e.fillStyle="black";e.fillRect(0,0,DebugView.WIDTH,DebugView.HEIGHT);e.fillStyle="white";e.globalAlpha=1;for(var f=0;f<c.length;f++){if(c[f].length>8){e.save();e.globalAlpha=.8;e.strokeStyle="#00ff00";if(c[f].hole)e.strokeStyle="#ff0000";e.beginPath();e.moveTo(c[f][0].x,DebugView.HEIGHT-c[f][0].y);for(var g=1;g<c[f].length;g++){nc=c[f][g];e.lineTo(nc.x,DebugView.HEIGHT-nc.y)}e.closePath();e.stroke();if(c[f].edist){e.font="8pt Arial";e.fillStyle="white"}e.restore()}}d.texture.needsUpdate=true},updateCanvasWithCandidates:function(a,b,c){var d=this.allCanvas[a];if(!d){console.error("Debug Error - Candidates Canvas "+a+" doesn't exist");return}var e=d.c;if(b)e.drawImage(b,0,0,DebugView.WIDTH,DebugView.HEIGHT);e.save();for(var f=0;f<c.length;f++){if(c[f].hasHole)e.fillStyle="green";else e.fillStyle="blue";if(c[f].wasMatched)e.fillStyle="red";for(var g=0;g<c[f].length;g++){e.fillRect(c[f][g].x,DebugView.HEIGHT-c[f][g].y,4,4)}}if(TrackingController.getInstance().foundHole){e.fillStyle="#00ffff";e.fillRect((TrackingController.getInstance().normalizedPosition.x-.5)*DebugView.WIDTH*.31+DebugView.WIDTH*.66,0,1,DebugView.HEIGHT);e.fillRect(0,DebugView.HEIGHT-TrackingController.getInstance().normalizedPosition.y*DebugView.HEIGHT*.42-DebugView.HEIGHT*.5,DebugView.WIDTH,1)}e.restore();d.texture.needsUpdate=true},updateCanvasWithEstimate:function(a,b,c,d){var e=this.allCanvas[a];if(!e){console.error("Debug Error - Candidates Canvas "+a+" doesn't exist");return}var f=e.c;if(b)f.drawImage(b,0,0,DebugView.WIDTH,DebugView.HEIGHT);f.save();f.fillStyle="yellow";f.fillRect(c-3,DebugView.HEIGHT-d-.5,6,1);f.fillRect(c-.5,DebugView.HEIGHT-d-3,1,6);f.restore();e.texture.needsUpdate=true},updateCanvasWithMotion:function(a,b,c,d){var e=this.allCanvas[a];if(!e){console.error("Debug Error - Candidates Canvas "+a+" doesn't exist");return}var f=e.c;if(b)f.drawImage(b,0,0,DebugView.WIDTH,DebugView.HEIGHT);if(!f.motionX||isNaN(f.motionX))f.motionX=128;if(!f.motionY||isNaN(f.motionY))f.motionY=128;f.motionX=f.motionX*.6+c*.4;f.motionY=f.motionY*.6+d*.4;f.save();f.fillStyle="#00ffff";f.fillRect(f.motionX-3,DebugView.HEIGHT-f.motionY-.5,6,1);f.fillRect(f.motionX-.5,DebugView.HEIGHT-f.motionY-3,1,6);f.restore();e.texture.needsUpdate=true},renderPhone:function(a){var b=this.allFbos[a];if(!b){console.error("Debug Error - Fbo Canvas "+a+" doesn't exist");return}b.render()},updatePhoneTranslationRotation:function(a,b,c){},updatePhoneTranslationRotationEstimate:function(a,b,c){},updatePhoneSmooth:function(a,b,c,d,e){var f=this.allFbos[a],g=new THREE.Quaternion(-OrientationController.getInstance().worldQuaternion.x,OrientationController.getInstance().worldQuaternion.y,-OrientationController.getInstance().worldQuaternion.z,OrientationController.getInstance().worldQuaternion.w),h=InputController.getInstance().getQuaternionSmooth(),i=new THREE.Quaternion(-h.x,h.y,-h.z,h.w);if(!f){console.error("Debug Error - Fbo Canvas "+a+" doesn't exist");return}if(e)f.phone.mat.color=new THREE.Color(16711680);else f.phone.mat.color=new THREE.Color(255);if(d)f.phone.mat.color=new THREE.Color(65535);f.phone.useQuaternion=true;f.phone.quaternion.copy(i);f.phone.position.x=-b.x*(1/CameraController.getInstance().getRatio());f.phone.position.y=b.y;f.phone.position.z=b.z;f.render()}}});var EndScreenView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)},show:function(){var a=this;if(!View.prototype.show.call(this)){return}AnalyticsController.getInstance().trackPageView("EndScreenView")}},_protected:{$buttonRestart:null,$buttonCredits:null,$buttonShareGoogle:null,$buttonShareFacebook:null,$buttonShareTwitter:null,init:function(){this.$buttonRestart=this.$container.find("button.restart");this.$buttonCredits=this.$container.find("button.credits");this.$buttonShareGoogle=this.$container.find("button.share.google");this.$buttonShareTwitter=this.$container.find("button.share.twitter");this.$buttonShareFacebook=this.$container.find("button.share.facebook")},bindEvents:function(){var a=this;this.$buttonRestart.bind("click",function(){a.onRestartClick()});this.$buttonCredits.bind("click",function(){a.onCreditsClick()});this.$buttonShareGoogle.bind("click",function(){a.onButtonGoogleClick()});this.$buttonShareTwitter.bind("click",function(){a.onButtonTwitterClick()});this.$buttonShareFacebook.bind("click",function(){a.onButtonFacebookClick()})},onRestartClick:function(){this.hide();if(RemoteController.getInstance().peerNode||InputController.getInstance().mode===InputController.INPUT_TYPE_MOUSE){RemoteController.getInstance().restart();RoutingController.getInstance().route("/experience");TimelineController.getInstance().setRestartFlag()}else{window.location.href="/"}},onCreditsClick:function(){RemoteController.getInstance().restart()},onButtonGoogleClick:function(){SharingController.getInstance().shareLinkOnGoogle()},onButtonTwitterClick:function(){SharingController.getInstance().shareOnTwitter()},onButtonFacebookClick:function(){SharingController.getInstance().shareLinkOnFacebook()}}});var WebcamTipView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)},init:function(){},bindEvents:function(){var a=this},transitionShow:function(){this.$container.fadeIn()},transitionHide:function(){this.$container.fadeOut()},showJoin:function(){this.$sectionJoin.show()},showHost:function(){this.$sectionHost.show();RemoteController.getInstance().startDesktop()}},_private:{}});var AboutView=View._extend({_public:{player:null,player2:null,construct:function(a,b){View.call(this,a,b)},init:function(){this.$buttonLogo=this.$container.find(".logo button");this.$buttonClose=this.$container.find("button.close");this.$linkCine=this.$container.find('a[href="http://www.cineinstitute.com"]');var a=document.createElement("script");a.src="//www.youtube.com/player_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b);var c=this;window.onYouTubePlayerAPIReady=function(){c.player=new YT.Player("ytPlayer_about",{height:"240",width:"320",videoId:"_3D8hYIfpqg",playerVars:{allowScriptAccess:"always",wmode:"opaque"}});c.player2=new YT.Player("ytPlayer_about2",{height:"240",width:"320",videoId:"KW63DY8dvww",playerVars:{allowScriptAccess:"always",wmode:"opaque"}})}},bindEvents:function(){var a=this;this.$buttonLogo.unbind("click").bind("click",function(){a.onButtonCloseClick()});this.$buttonClose.unbind("click").bind("click",function(){a.onButtonCloseClick()});this.$linkCine.unbind("click").bind("click",function(b){a.onLinkCineClick(b)})},show:function(){if(!View.prototype.show.call(this)){return}$(".AboutView").find(".column.left").css("width",$(".AboutView").find(".column.left").parent().width()-$(".AboutView").find(".column.right").outerWidth(true)+"px");$(window).resize(function(){$(".AboutView").find(".column.left").css("width",$(".AboutView").find(".column.left").parent().width()-$(".AboutView").find(".column.right").outerWidth(true)+"px")});AnalyticsController.getInstance().trackPageView("AboutView")},hide:function(){View.prototype.hide.call(this);if(this.player&&this.player.stopVideo){this.player.stopVideo()}}},_private:{$buttonLogo:null,$buttonClose:null,$linkCine:null,onButtonCloseClick:function(){this.hide();View.forceTransition=true;if(ViewController.getInstance().getView("LandingPageView").shown){RoutingController.getInstance().route("/",{trigger:true})}else if(ViewController.getInstance().getView("EndScreenView").shown){ViewController.getInstance().getView("EndScreenView").show()}},onLinkCineClick:function(a){a.preventDefault();window.open("http://www.cineinstitute.com","_blank")}}});var WebcamControlView=View._extend({_static:{WIDTH:1280,HEIGHT:672,MARGIN_RIGHT:530,vertexShader:["varying mediump vec2 vUv;","void main() {","   vUv = vec2(uv.x,uv.y);","    gl_Position = projectionMatrix *  modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),webcamFragmentShader:["varying mediump vec2 vUv;","uniform sampler2D tWebcam;","uniform lowp float exposure;","uniform lowp float offset;","uniform lowp float noiseAlpha;","uniform mediump vec2 randomUV;","uniform mediump float minBlack;","const lowp vec3 rgb2luma = vec3(0.1,0.550,0.400);","mediump float rand( mediump vec2 co ){","    return fract( sin( dot( co.xy ,vec2( 12.9898,78.233 ) ) ) * 43758.5453 );","}","void main() {","   gl_FragColor = vec4(vec3(  max((dot(texture2D(tWebcam, vUv).rgb,rgb2luma) + offset) * exposure * (1.0 + rand(randomUV+vUv) * noiseAlpha - noiseAlpha*0.5),minBlack) ),1.0);","}"].join("\n"),linesFragmentShader:["varying vec2 vUv;","uniform mediump vec2 randomUV;","uniform mediump float lineNoise;","uniform mediump float opacity;","mediump float rand( mediump vec2 co ){","    return fract( sin( dot( co.xy ,vec2( 12.9898,78.233 ) ) ) * 43758.5453 );","}","void main() {","   mediump float side = 1.0 - max(0.5-vUv.x,0.0) * 2.0 - max(vUv.x-0.5,0.0) * 2.0;","   side = side * side;","   mediump float noise = side * rand(randomUV+vUv) * 2.0 - 1.0;","   side = side + noise * lineNoise;","   gl_FragColor = vec4(","       side,","       side,","       side,","       opacity","   );","}"].join("\n"),lightHaloShader:["varying vec2 vUv;","uniform sampler2D tBeam;","uniform mediump vec2 randomUV;","uniform mediump float noiseAlpha;","uniform mediump float beamAlpha;","uniform mediump float blobSize;","uniform mediump float exp;","uniform mediump float opacity;","mediump float rand( mediump vec2 co ){","    return fract( sin( dot( co.xy ,vec2( 12.9898,78.233 ) ) ) * 43758.5453 );","}","void main() {","   mediump float haloExp = pow( max(min(0.5-length(0.5-vUv), 1.0), 0.0),exp)*10.0;","   haloExp *= 1.0 + rand(haloExp*randomUV)*noiseAlpha - noiseAlpha*0.5;","   gl_FragColor = vec4(","       vec3(haloExp) + beamAlpha * (1.0-texture2D(tBeam,(vUv-0.5)*blobSize+0.5).rgb),","       opacity","   );","}"].join("\n"),blobTexturePaths:["media/images/mask_encre_scene0/mask_encre0.jpg","media/images/mask_encre_scene0/mask_encre1.jpg","media/images/mask_encre_scene0/mask_encre2.jpg","media/images/mask_encre_scene0/mask_encre3.jpg","media/images/mask_encre_scene0/mask_encre4.jpg","media/images/mask_encre_scene0/mask_encre5.jpg","media/images/mask_encre_scene0/mask_encre6.jpg","media/images/mask_encre_scene0/mask_encre7.jpg","media/images/mask_encre_scene0/mask_encre8.jpg","media/images/mask_encre_scene0/mask_encre9.jpg","media/images/mask_encre_scene0/mask_encre10.jpg"]},_public:{running:false,runAsSequence:true,renderer:null,options:{exposure:1.8,offset:-.6,noise:.15,lineNoise:.5,lineWidthMin:10,lineWidthMax:10,lineOffsetMin:0,lineOffsetMax:0,beamSize:675*2,beamDistance:120,beamOpacity:.8,blobOpacity:.9,blobSize:2},owidth:1280,oheight:672,phonePosition:new THREE.Vector3(0,0,1),construct:function(a,b){View.call(this,a,b)},show:function(){var a=this;if(!View.prototype.show.call(this)){return}console.log("showing Webcam Control View");CameraController.getInstance().init();TrackingController.getInstance().init();TrackingController.getInstance().start();this.renderer=new THREE.WebGLRenderer({antialias:false,alpha:false});this.renderer.setClearColor(0,1);this.renderer.setSize(WebcamControlView.WIDTH,WebcamControlView.HEIGHT);this.$container.append(this.renderer.domElement);$(this.renderer.domElement).css({"border-style":"solid","border-width":"1px","border-color":"#ffffff"});this.runAsSequence=false;if(!this.running)AnimationController.getInstance().events.bind(AnimationController.EVENT_FRAME+".WebcamControlView",function(){a.onFrame(null)});this.onResize();this.initLinesRendering();AnimationController.getInstance().start();if(this.sceneFbo)this.sceneFbo.alloc();this.running=true},hide:function(){View.prototype.hide.call(this);AnimationController.getInstance().events.unbind(AnimationController.EVENT_FRAME+".WebcamControlView");if(this.sceneFbo)this.sceneFbo.dispose();if(this.blobTexturesReady&&this.blobTextures){for(var a=0;a<this.blobTextures.length;a++){this.blobTextures[a].dispose()}this.blobTexturesReady=false;this.blobTextures=[]}if(this.webcamTexture){this.webcamTexture.dispose()}},initLinesRendering:function(){var a=WebcamControlView.WIDTH,b=WebcamControlView.HEIGHT,c=this.runAsSequence?RendererController.getInstance().getRenderer():this.renderer;this.owidth=a;this.oheight=b;this.sceneFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,type:THREE.UnsignedByteType,camera:new THREE.PerspectiveCamera(45,a/b,.001,1e4),depthBuffer:true,stencilBuffer:false,premultiplyAlpha:true,generateMipmaps:false,renderer:c});this.sceneFbo.camera.position.z=this.getCameraZ(this.sceneFbo.camera,b);this.loadBlobTextures();this.webcamCanvas=document.createElement("canvas");this.webcamCanvas.width=512;this.webcamCanvas.height=512;this.webcamCanvas.c=this.webcamCanvas.getContext("2d");this.webcamTexture=new THREE.Texture(this.webcamCanvas,new THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBAFormat,THREE.UnsignedByteType,1);this.webcamTexture.generateMipmaps=false;this.webcamTexture.needsUpdate=true;this.webcamVideo=CameraController.getInstance().getVideo();this.webcamMaterial=new THREE.ShaderMaterial({vertexShader:WebcamControlView.vertexShader,fragmentShader:WebcamControlView.webcamFragmentShader,attributes:{},uniforms:{tWebcam:{type:"t",value:this.webcamTexture},exposure:{type:"f",value:1},offset:{type:"f",value:0},noiseAlpha:{type:"f",value:.05},minBlack:{type:"f",value:0},randomUV:{type:"v2",value:new THREE.Vector2(0,0)}},depthTest:false,transparent:true,blending:THREE.AdditiveBlending,side:THREE.DoubleSide});this.webcamPlane=new THREE.Mesh(new THREE.PlaneGeometry(a,b,1,1),this.webcamMaterial);this.webcamPlane.scale.x=-1;this.sceneFbo.scene.add(this.webcamPlane);this.lineMaterial=new THREE.ShaderMaterial({vertexShader:WebcamControlView.vertexShader,fragmentShader:WebcamControlView.linesFragmentShader,attributes:{},uniforms:{randomUV:{type:"v2",value:new THREE.Vector2(0,0)},lineNoise:{type:"f",value:.5},opacity:{type:"f",value:0}},depthTest:false,transparent:true,blending:THREE.AdditiveBlending,side:THREE.DoubleSide});var d=new THREE.PlaneGeometry(1,1,2,1);this.lineLeftA=new THREE.Mesh(d,this.lineMaterial);this.lineRightA=new THREE.Mesh(d,this.lineMaterial);this.lineLeftB=new THREE.Mesh(d,this.lineMaterial);this.lineRightB=new THREE.Mesh(d,this.lineMaterial);this.lineLeftA.scale.x=10;this.lineLeftA.scale.y=a*5;this.lineLeftA.rotation.z=Math.PI*.25;this.lineRightA.scale.x=10;this.lineRightA.scale.y=a*5;this.lineRightA.rotation.z=Math.PI*.25;this.lineLeftB.scale.x=10;this.lineLeftB.scale.y=a*5;this.lineLeftB.rotation.z=-Math.PI*.25;this.lineRightB.scale.x=10;this.lineRightB.scale.y=a*5;this.lineRightB.rotation.z=-Math.PI*.25;this.lineContainer=new THREE.Object3D;this.lineContainer.add(this.lineLeftA);this.lineContainer.add(this.lineRightA);this.lineContainer.add(this.lineLeftB);this.lineContainer.add(this.lineRightB);this.lineContainer.add(this.lineForward);this.sceneFbo.scene.add(this.lineContainer);this.lightConeMaterial=new THREE.MeshBasicMaterial({color:16777215,opacity:.1,transparent:true,vertexColors:THREE.VertexColors,blending:THREE.AdditiveBlending});var e=new THREE.CylinderGeometry(300,30,500,32,5,true);e.applyMatrix((new THREE.Matrix4).makeTranslation(0,250,0));e.applyMatrix((new THREE.Matrix4).makeRotationX(Math.PI*.5));e.colors=[];for(var f=0;f<e.vertices.length;f++){e.colors[f]=new THREE.Color(16711680)}e.colorsNeedUpdate=true;this.lightCone=new THREE.Mesh(e,this.lightConeMaterial);this.lightBeamMaterial=new THREE.ShaderMaterial({vertexShader:WebcamControlView.vertexShader,fragmentShader:WebcamControlView.lightHaloShader,attributes:{},uniforms:{tBeam:{type:"t",value:null},randomUV:{type:"v2",value:new THREE.Vector2(0,0)},beamAlpha:{type:"f",value:.5},noiseAlpha:{type:"f",value:.2},exp:{type:"f",value:2},opacity:{type:"f",value:0},blobSize:{type:"f",value:1}},depthTest:false,transparent:true,blending:THREE.AdditiveBlending,side:THREE.DoubleSide});this.lightBeamPlane=new THREE.Mesh(new THREE.PlaneGeometry(1,1,1,1),this.lightBeamMaterial)},onFrame:function(a){this.update(a||this.options);this.render()},transitionShow:function(){this.$container.fadeIn()},transitionHide:function(){this.$container.fadeOut()},begin:function(){this.initLinesRendering()},changeVideoQuality:function(){},changeRenderQuality:function(){}},_private:{sceneFbo:null,webcamVideo:null,webcamCanvas:null,webcamTexture:null,webcamMaterial:null,webcamPlane:null,lineMaterial:null,lineLeftA:null,lineRightA:null,lineLeftB:null,lineRightB:null,lightBeamPlane:null,lightBeamMaterial:null,lightCone:null,lightConeMaterial:null,lineContainer:null,blobTextures:[],blobTexturesReady:false,lastMaskFrameUpdate:0,currentMask:0,maskRate:1e3/24,bindEvents:function(){var a=this},loadBlobTextures:function(){if(this.blobTexturesReady)return;this.blobTexturesReady=true;for(var a=0;a<WebcamControlView.blobTexturePaths.length;a++){if(!AssetsController.getInstance().hasFile(WebcamControlView.blobTexturePaths[a]))this.blobTexturesReady=false}if(this.blobTexturesReady){for(var a=0;a<WebcamControlView.blobTexturePaths.length;a++){this.blobTextures[a]=AssetsController.getInstance().getFile(WebcamControlView.blobTexturePaths[a]);this.blobTextures[a].minFilter=THREE.LinearMipMapLinearFilter;this.blobTextures[a].generateMipmaps=true;this.blobTextures[a].needsUpdate=true}}},update:function(a){if(!this.runAsSequence)InputController.getInstance().update(TrackingController.getInstance().isReady(),TrackingController.getInstance().getFrameInfo(),OrientationController.getInstance().getFrameInfo());var b=this.phonePosition.lerp(InputController.getInstance().getPositionRaw().clone(),.75),c=WebcamControlView.WIDTH,d=WebcamControlView.HEIGHT;this.sceneFbo.camera.position.z=this.getCameraZ(this.sceneFbo.camera,d);b.z=Math.max(b.z,.01);var e=(a.lineOffsetMax-a.lineOffsetMin)*(1-b.z)+a.lineOffsetMin;this.lineRightA.position.x=e*Math.cos(Math.PI*.25);this.lineRightA.position.y=e*Math.sin(Math.PI*.25);this.lineLeftA.position.x=-e*Math.cos(Math.PI*.25);this.lineLeftA.position.y=-e*Math.sin(Math.PI*.25);this.lineRightB.position.x=e*Math.cos(-Math.PI*.25);this.lineRightB.position.y=e*Math.sin(-Math.PI*.25);this.lineLeftB.position.x=-e*Math.cos(-Math.PI*.25);this.lineLeftB.position.y=-e*Math.sin(-Math.PI*.25);this.lineContainer.position.set(b.x*c*.5,b.y*-d*.15,0);this.lineContainer.rotation.z=InputController.getInstance().getRotationX()*-1+Math.PI/2;if(Date.now()-this.lastMaskFrameUpdate>=this.maskRate&&this.blobTexturesReady){this.lastMaskFrameUpdate=Date.now();this.currentMask++;if(this.currentMask>=this.blobTextures.length)this.currentMask=0;this.lightBeamMaterial.uniforms.tBeam.value=this.blobTextures[this.currentMask]}else if(!this.blobTexturesReady){this.loadBlobTextures()}var f=OrientationController.getInstance().timesReset>0?a.beamDistance*.75:a.beamDistance*.5;if(OrientationController.getInstance().timesReset>1)f=a.beamDistance;this.lightBeamPlane.position.copy(this.lineContainer.position);var g=new THREE.Vector3(0,0,1).applyQuaternion(InputController.getInstance().getQuaternionSmooth());g.multiplyScalar(f*b.z+f);g.x*=-1;g.z=Math.abs(g.z);g.z*=this.sceneFbo.camera.position.z/800;this.lightBeamPlane.position.add(g);var h=1280/c*a.beamSize*b.z;this.lightBeamPlane.scale.set(h,h,h);this.lightBeamPlane.scale.z=1;if(this.lightBeamPlane.scale.length()<=.01)this.lightBeamPlane.scale.set(.001,.001,1);this.lightBeamMaterial.uniforms.opacity.value=(a.beamOpacity+Math.random()*.1)*InputController.getInstance().smoothPersistence;this.lightCone.position.copy(this.lineContainer.position);this.lightCone.lookAt(this.lightBeamPlane.position);this.lightBeamMaterial.uniforms.exp.value=1.95+Math.random()*.1;this.lightBeamMaterial.uniforms.beamAlpha.value=a.blobOpacity;this.lightBeamMaterial.uniforms.blobSize.value=a.blobSize;this.webcamMaterial.uniforms.randomUV.value.set(Math.random(),Math.random());this.lineMaterial.uniforms.randomUV.value.set(Math.random(),Math.random());this.lightBeamMaterial.uniforms.randomUV.value.set(Math.random(),Math.random());this.webcamMaterial.uniforms.exposure.value=a.exposure;this.webcamMaterial.uniforms.noiseAlpha.value=a.noise;this.webcamMaterial.uniforms.offset.value+=.1*(a.offset*(1-TrackingController.getInstance().tracking.lowLightScore)-this.webcamMaterial.uniforms.offset.value);this.lineMaterial.uniforms.opacity.value=TrackingController.getInstance().getPersistence();this.lineMaterial.uniforms.lineNoise.value=a.lineNoise;this.lineRightA.scale.x=this.lineLeftA.scale.x=this.lineLeftB.scale.x=this.lineRightB.scale.x=Math.max(a.lineWidthMin+(1-b.z)*(a.lineWidthMax-a.lineWidthMin),.01)},render:function(){var a=this.runAsSequence?RendererController.getInstance().getRenderer():this.renderer;a.setClearColor(new THREE.Color(0));a.clear();if(this.webcamVideo&&this.webcamVideo.readyState===this.webcamVideo.HAVE_ENOUGH_DATA){if(this.webcamCanvas.width!==this.webcamVideo.videoWidth)this.webcamCanvas.width=this.webcamVideo.videoWidth;if(this.webcamCanvas.height!==this.webcamVideo.videoHeight)this.webcamCanvas.height=this.webcamVideo.videoHeight;this.webcamCanvas.c.drawImage(this.webcamVideo,0,0,this.webcamVideo.videoWidth,this.webcamVideo.videoHeight);this.webcamTexture.needsUpdate=true}if(this.runAsSequence){this.sceneFbo.render();RendererController.getInstance().renderToScreen(this.sceneFbo.texture,false,true)}else{this.renderer.render(this.sceneFbo.scene,this.sceneFbo.camera)}},getCameraZ:function(a,b){return b/(2*Math.tan(a.fov/2*(Math.PI/180)))},onResize:function(){if(this.runAsSequence)return;var a=CameraController.getInstance().getRatio(),b=$(window).width()-40-WebcamControlView.MARGIN_RIGHT,c=$(window).height()-120,d=b/c,e=0,f=0,g,h;if(!this.renderer){return}g=this.renderer.domElement;h=$(this.renderer.domElement);if(a>d){e=b;f=e/a}else{f=c;e=f*a}g.width=e;g.height=f;WebcamControlView.WIDTH=e;WebcamControlView.HEIGHT=f;this.$container.closest(".content").css("margin-top",(c-f)*.5);this.renderer.setSize(e,f)}}});var Player=Class._extend(Class.SINGLETON,{_static:{AV_RESYNC_ENABLED:false,AUDIO_VIDEO_SEPARATE:false,MIN_BUFFER_TO_PLAY:.1,REQUIRE_MIN_BUFFER_FOR_READY:false,DEFAULT_TOLERANCE:4/24,MAX_RESYNC_DELAY_COUNT:10,MIN_OFFSET_FRAMES_TO_RESYNC:10,EVENT_LOADING_PROGRESS:"Player_Event_Loading_Progress",EVENT_LOADING_READY:"Player_Event_Loading_Ready",EVENT_ENDED:"Player_Event_Ended",EVENT_SEEK_START:"Player_event_SEEK_START",EVENT_SEEKED:"Player_event_Seeked",EVENT_QUALITY_CHANGE:"Player_EVENT_QUALITY_CHANGE",SEEKABLE_PROPERTY:"seekable",VIDEO_FRAMERATE:23.976,MAX_TIME_WAITING:2e3,MAX_NUM_WAITING:4,EVENT_CONNECTING_MESSAGE_SHOW:"Player_EVENT_CONNECTING_MESSAGE_SHOW",EVENT_CONNECTING_MESSAGE_HIDE:"Player_EVENT_CONNECTING_MESSAGE_HIDE"},_public:{audio:null,video:null,url:"",readyToPlay:"false",currentTime:1e-5,bufferTime:1e-5,buffer:1e-5,canPlayThrough:"false",ready:false,videoUrl:null,audioUrl:null,videoWidth:1280,videoHeight:672,videoLoadReady:false,audioLoadReady:false,loadStarted:false,forcePlayAfterSeek:false,pauseOnTimeUpdate:true,forcedResolution:false,volume:1,tolerance:4/24,playing:false,seeking:false,videoSeekTime:0,quality:0,qualityChanged:false,qualityChangeVideoTime:0,resyncingVideoCurrentTime:0,resyncStartTime:0,resyncDelays:[],resyncStartDifference:0,resyncDifferences:[.15],offsetFramesCount:0,lastFrameTime:-1,waitStartTime:-1,waiting:false,blocked:false,numWaiting:0,seekStartTime:0,construct:function(){this.volume=1
},init:function(a,b){var c=this;this.tolerance=b||Player.DEFAULT_TOLERANCE;this.video=document.createElement("video");this.ready=false;if(Player.AUDIO_VIDEO_SEPARATE){this.audio=document.createElement("audio");this.audioUrl=a}if(MediaPreloadTask.VIDEOS_USE_RESOURCE||Config.getInstance()._class===ConfigLocal||window.location.host.indexOf("test2")!==-1){this.video.setAttribute("crossOrigin","anonymous");if(this.audio){this.audio.setAttribute("crossOrigin","anonymous")}}AnimationController.getInstance().events.bind(AnimationController.EVENT_FRAME,function(){c.onFrame()});Debug.add(this,"url","Video");Debug.add(this,"readyToPlay","Video");Debug.add(this,"canPlayThrough","Video");Debug.add(this,"currentTime","Video");Debug.add(this,"bufferTime","Video");Debug.add(this,"buffer","Video");this.bindEvents()},setVideoSize:function(a,b){this.videoWidth=a;this.videoHeight=b},setQuality:function(a){var b;var c=parseInt(this.getQueryVariable("res"));if(c>0){a=c;this.quality=a;this.forcedResolution=true;this.setVideoUrl("/media/video/"+a+"/reflektor_full_audio.webm")}if(this.quality===a){return}for(b=0;b<MediaPreloadTask.VIDEOS.length;++b){if(MediaPreloadTask.VIDEOS[b].resolution.width===a){this.quality=a;this.setVideoUrl(MediaPreloadTask.VIDEOS[b].path);this.events.trigger(Player.EVENT_QUALITY_CHANGE);break}}},switchToLowerQuality:function(){var a;for(a=MediaPreloadTask.VIDEOS.length-1;a>-1;--a){if(MediaPreloadTask.VIDEOS[a].resolution.width<this.quality){console.log("-- SWITCHING TO LOWER QUALITY: ",MediaPreloadTask.VIDEOS[a].resolution.width,"--");this.setQuality(MediaPreloadTask.VIDEOS[a].resolution.width);return true}}console.log("-- NO LOWER QUALITY --");return false},setVideoUrl:function(a){var b=a;if(Config.getInstance()._class===ConfigLocal){b=Resource.get(b.replace("_audio",""))}else if(this.getQueryVariable("lightversion")){b=Resource.get("media/videos/1280/reflektor_full_light.webm")}else{if(!MediaPreloadTask.VIDEOS_WITH_AUDIO||window.location.host.indexOf("test2")!==-1){b=b.replace("_audio","")}if(MediaPreloadTask.VIDEOS_USE_RESOURCE||window.location.host.indexOf("test2")!==-1){b=Resource.get(b)}}this.videoUrl=b;this.url=this.videoUrl.substring(this.videoUrl.indexOf("video/")+"video/".length);if(this.video){if(this.video.src){this.qualityChanged=true;this.qualityChangeVideoTime=this.video&&this.video.src?this.video.currentTime:0;this.events.trigger(Player.EVENT_CONNECTING_MESSAGE_SHOW,[true])}this.video.src=b;console.log("[video] url:",b)}},startPreloadingVideo:function(a){var b,c;if(this.videoPreloaded){return}this.videoPreloaded=true;if(Config.getInstance()._class===ConfigLocal){c=Resource.get("/audio/local.mp3")}else{c=window.location.host.indexOf("test2")===-1?"/audio/reflektor.mp3":Resource.get("/media/audio/audio2_sd.mp3")}this.init(c);b=this.getOptimalVideo(a);this.setQuality(b.resolution.width);this.setVideoSize(b.resolution.width,b.resolution.height);this.load();Debug.openFolder("Video")},getOptimalVideo:function(a){var b=MediaPreloadTask.VIDEOS[MediaPreloadTask.VIDEO_LOWRES_VERSION],c=PerformanceController.getInstance().determineOptimalVideoQuality(),d;if(a){console.log("WebGL Performance is forcing a low resolution");for(d=0;d<MediaPreloadTask.VIDEOS.length;d++){if(MediaPreloadTask.VIDEOS[d].resolution.width===640){return MediaPreloadTask.VIDEOS[d]}}}for(d=1;d<MediaPreloadTask.VIDEOS.length;++d){if(c.size>=MediaPreloadTask.VIDEOS[d].size&&c.resolution.width>=MediaPreloadTask.VIDEOS[d].resolution.width&&c.resolution.height>=MediaPreloadTask.VIDEOS[d].resolution.height){b=MediaPreloadTask.VIDEOS[d]}else{break}}return b},getQueryVariable:function(a){var b=window.location.search.substring(1);var c=b.split("&");for(var d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==a){return e[1]}}return false},load:function(){if(this.loadStarted){throw new Error("Error: Trying to start loading Audio & Video twice.")}console.log("-- videoUrl: ",this.videoUrl);this.video.src=this.videoUrl;this.video.load();this.video.volume=0;this.video.play();if(Player.AUDIO_VIDEO_SEPARATE){this.audio.src=this.audioUrl;this.audio.load();this.audio.volume=0;this.audio.play();$(".preload").append(this.audio)}this.pauseOnTimeUpdate=true;this.loadStarted=true;$(".preload").append(this.video)},play:function(a){if(this.playing||!this.video){return}this.playing=true;this.pauseOnTimeUpdate=false;this.video.volume=this.volume;if(this.audio){this.audio.volume=this.volume}clearTimeout(this.resyncTimeoutId);if(a){this.video.play();if(this.audio){this.audio.play()}RemoteController.getInstance().play()}else{this.seek(this.getCurrentTime()<1.5?0:this.getCurrentTime())}},pause:function(){if(this.video){this.playing=false;this.forcePlayAfterSeek=false;this.video.pause();if(this.audio){this.audio.pause()}clearTimeout(this.resyncTimeoutId);RemoteController.getInstance().pause()}},seek:function(a){if(this.video){this.seekStartTime=window.performance.now();a=this.getMaxSeekTime(a);if(this.playing){this.pause();this.forcePlayAfterSeek=true}clearTimeout(this.resyncTimeoutId);this.events.trigger(Player.EVENT_SEEK_START);this.videoSeekTime=this.video.currentTime;try{this.video.currentTime=a}catch(b){console.debug("video seek exception")}if(this.audio){this.audio.currentTime=a}this.seeking=true;this.events.trigger(Player.EVENT_CONNECTING_MESSAGE_SHOW,[true])}},getCurrentTime:function(){return this.audio?this.audio.currentTime:this.video?this.video.currentTime:0},getDuration:function(){return this.audio?this.audio.duration:this.video?this.video.duration:1},getProgress:function(){return this.getCurrentTime()/this.getDuration()},getBufferedAudio:function(){if(!this.audio){return 99999999}return this.getMaxSeekTimeForMedia(this.audio,9999999)/this.audio.duration},getBufferedVideo:function(){if(!this.video){return 0}return this.getMaxSeekTimeForMedia(this.video,9999999)/this.video.duration},getBuffered:function(){return Math.min(this.getBufferedAudio(),this.getBufferedVideo())},getBufferRanges:function(){var a=[],b,c,d,e;if(!this.video){return a}for(b=0;b<this.video.buffered.length;++b){d=this.video.buffered.start(b);e=this.video.buffered.end(b);if(this.audio){for(c=0;c<this.audio.buffered.length;++c){if(this.audio.buffered.end(c)>=d&&this.audio.buffered.start(c)<=e){a.push({start:Math.max(this.audio.buffered.start(c),d)/this.video.duration,end:Math.min(this.audio.buffered.end(c),e)/this.video.duration})}}}else{a.push({start:d/this.video.duration,end:e/this.video.duration})}}return a},getCurrentTimeVideo:function(){if(!this.video){return 0}if(this.video.seeking){return this.videoSeekTime}return this.video.currentTime},getCurrentFrame:function(){if(!this.video){return 0}return Math.floor(this.video.currentTime*Player.VIDEO_FRAMERATE)},getSeekableRange:function(){return this.audio?Math.min(this.video.seekable.end(0),this.audio.seekable.end(0)):this.video.seekable.end(0)},setVolume:function(a){this.volume=a;if(!this.pauseOnTimeUpdate){this.video.volume=a;if(this.audio){this.audio.volume=a}}RemoteController.getInstance().setVolume(a)}},_protected:{resync:false,resyncTimeoutId:-1,videoPreloaded:false,bindEvents:function(){var a=this;this.video.addEventListener("canplaythrough",function(b){a.loadReadyVideo(b)},false);this.video.addEventListener("progress",function(b){a.loadProgress(b)},false);this.video.addEventListener("timeupdate",function(b){a.timeUpdate()},false);this.video.addEventListener("error",function(a){console.error(a)},false);this.video.addEventListener("seeked",function(b){a.onSeekComplete()},false);this.video.addEventListener("waiting",function(b){a.onWaiting()},false);this.video.addEventListener("ended",function(b){a.events.trigger(Player.EVENT_ENDED)},false);if(this.audio){this.audio.addEventListener("timeupdate",function(b){a.timeUpdate(b)},false);this.audio.addEventListener("canplaythrough",function(b){a.loadReadyAudio(b)},false);this.audio.addEventListener("progress",function(b){a.loadProgress(b)},false);this.audio.addEventListener("seeked",function(b){a.onSeekComplete()},false);this.audio.addEventListener("error",function(a){switch(a.target.error.code){case a.target.error.MEDIA_ERR_ABORTED:console.error("You aborted the audio playback.");break;case a.target.error.MEDIA_ERR_NETWORK:console.error("A network error caused the audio download to fail.");break;case a.target.error.MEDIA_ERR_DECODE:console.error("The audio playback was aborted due to a corruption problem or because the audio used features your browser did not support.");break;case a.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:console.error("The audio was not loaded, either because the server or network failed or because the format is not supported.");break;default:console.error("An unknown error occurred.");break}},false)}},timeUpdate:function(a){if(this.pauseOnTimeUpdate){if(this.audio&&this.audio.currentTime>0){this.audio.currentTime=0;this.audio.pause()}if(this.video.currentTime>0){this.video.currentTime=0;this.video.pause()}}if(Player.AV_RESYNC_ENABLED&&Player.AUDIO_VIDEO_SEPARATE&&!this.seeking&&this.playing){if(Math.abs(this.video.currentTime-this.audio.currentTime)>this.tolerance&&this.audio.currentTime<this.video.duration){if(++this.offsetFramesCount>=Player.MIN_OFFSET_FRAMES_TO_RESYNC){this.offsetFramesCount=0;this.resyncVideoToAudioTime()}}else{this.offsetFramesCount=0}}if(this.video){this.currentTime=this.video.currentTime}},resyncVideoToAudioTime:function(){console.log("Resyncing Audio & Video ( delay is ",this.audio.currentTime-this.video.currentTime,")");this.resyncingVideoCurrentTime=this.video.currentTime;this.resyncStartTime=performance.now();this.seek(this.audio.currentTime)},loadProgress:function(a){if(this.video.buffered.length!==0){this.buffer=this.video.buffered.end(0)/this.video.duration;this.bufferTime=this.video.buffered.end(0);this.checkReady()}},loadReadyAudio:function(a){this.audioLoadReady=true;if(this.videoLoadReady){this.loadComplete()}},loadReadyVideo:function(a){this.videoLoadReady=true;this.canPlayThrough="true";if(!this.audio||this.audioLoadReady){this.loadComplete()}},loadComplete:function(a){this.loadReady=true;this.checkReady()},checkReady:function(){if(Player.REQUIRE_MIN_BUFFER_FOR_READY){if(this.video&&this.buffer>Player.MIN_BUFFER_TO_PLAY){this.onReadyToPlay()}}else{if(this.video&&(this.loadReady||this.buffer>Player.MIN_BUFFER_TO_PLAY)){this.onReadyToPlay()}}},getAverageResyncDifference:function(a){if(this.resyncDifferences.length===0)return 0;this.resyncDifferences=this.resyncDifferences.slice(Math.max(this.resyncDifferences.length-6,0));var b=0;var c=this.resyncDifferences.slice();if(c.length>2){c.sort();c=c.slice(1,c.length-1)}for(var d=0;d<c.length;d++){b+=c[d]}return b/c.length},getMaxSeekTime:function(a){return this.audio?Math.min(this.getMaxSeekTimeForMedia(this.audio,a),this.getMaxSeekTimeForMedia(this.video,a)):this.getMaxSeekTimeForMedia(this.video,a)},getMaxSeekTimeForMedia:function(a,b){var c=-1,d;for(d=0;d<a[Player.SEEKABLE_PROPERTY].length;++d){if(a[Player.SEEKABLE_PROPERTY].start(d)<b){if(a[Player.SEEKABLE_PROPERTY].end(d)<b){c=Math.max(a[Player.SEEKABLE_PROPERTY].end(d)-.5,0)}else{c=b;break}}}return c},onReadyToPlay:function(){if(this.qualityChanged){this.qualityChanged=false;return this.seek(this.qualityChangeVideoTime)}if(!this.ready){this.ready=true;this.readyToPlay="true";this.events.trigger(Player.EVENT_LOADING_READY)}},onWaiting:function(){console.log("waiting...")},onSeekComplete:function(){var a=this;console.log("** SEEK COMPLETE **","seeking:",this.seeking,"audio ready:",!this.audio||!this.audio.seeking,"video ready:",!this.video.seeking);if(this.seeking&&(!this.audio||!this.audio.seeking)&&!this.video.seeking){RemoteController.getInstance().resyncExperienceTime(this.getCurrentTime()*1e3);clearTimeout(this.resyncTimeoutId);this.resyncTimeoutId=setTimeout(function(){a.events.trigger(Player.EVENT_CONNECTING_MESSAGE_HIDE,[true]);a.seeking=false;TimelineController.getInstance().events.trigger(TimelineController.ENABLE_SEEK_INTERACTION,[true]);a.events.trigger(Player.EVENT_SEEKED);if(a.forcePlayAfterSeek){a.play(true)}console.log("[DEBUG] seek time:",window.performance.now()-a.seekStartTime)},InputController.getInstance().mode===InputController.INPUT_TYPE_TRACKING?RemoteController.RESYNC_TIME:0)}},onBlocked:function(){console.log("!!!! blocked !!!!");if(this.forcedResolution){console.log("this is a forced resolution, not applying any fix")}if(!this.switchToLowerQuality()){TimelineController.getInstance().resume();this.seek(this.video.currentTime+.1)}this.waiting=false;this.blocked=false;this.numWaiting=0},onFrame:function(){if(this.playing&&!this.qualityChanged){if(this.video.currentTime===this.lastFrameTime){if(!this.waiting){console.log("!!!! waiting !!!!",this.numWaiting);this.numWaiting+=1;this.waiting=true;this.waitStartTime=performance.now()}if(!this.blocked&&(performance.now()-this.waitStartTime>Player.MAX_TIME_WAITING||this.numWaiting>Player.MAX_NUM_WAITING)){this.blocked=true;this.onBlocked()}}else{if(this.waiting){console.log("!!!! wait fix auto !!!!")}if(this.blocked){console.log("!!!! BLOCK FIX !!!!")}this.waiting=false;this.blocked=false}this.lastFrameTime=this.video.currentTime}}}});var PlatformNotSupportedView=View._extend({_static:{COPY:{hasCanvas:"PlatformNotSupportedView.browser",hasWebSockets:"PlatformNotSupportedView.browser",hasWebGL:"PlatformNotSupportedView.hardware",hasMinimumBandwidth:"PlatformNotSupportedView.network"}},_public:{construct:function(a,b){View.call(this,a,b)},show:function(a){if(!View.prototype.show.call(this,a)){return}this.$message.html($.t(PlatformNotSupportedView.COPY[a.reason[0].property]));console.log("-------- SUPPORT INFO ---------");console.log(JSON.stringify(a));console.log("----- END OF SUPPORT INFO -----");AnalyticsController.getInstance().trackPageView("PlatformNotSupportedView")}},_private:{$message:null,init:function(){this.$message=this.$container.find(".message bdo")}}});var PerformanceWarningView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)},show:function(){if(!View.prototype.show.call(this)){return}AnalyticsController.getInstance().trackPageView("PerformanceWarningView");this.wasRunning=TimelineController.getInstance().running;if(this.wasRunning){TimelineController.getInstance().pause()}},hide:function(){View.prototype.hide.call(this);if(this.wasRunning){TimelineController.getInstance().resume()}}},_private:{wasRunning:false,init:function(){this.$button=this.$container.find("button")},bindEvents:function(){this.$button.on("click",$.proxy(function(){this.hide()},this))}}});var DeviceDisconnectedView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)},show:function(a){if(!View.prototype.show.call(this,a)){return}this.$connected.stop().hide();this.$disconnected.stop().show();if(a){this.experienceWasPlaying=TimelineController.getInstance().running;TimelineController.getInstance().pause();RemoteController.getInstance().pause();ViewController.getInstance().getView("ExperienceLoadingView").pause();ViewController.getInstance().getView("TimelineView").slideOut();OrientationController.getInstance().resetResetInformation();this.bindEventsReconnect();this.$container.addClass("reconnect");this.$code.text(RemoteController.getInstance().mesh.id)}else{this.$container.removeClass("reconnect");TimelineController.getInstance().stop()}AnalyticsController.getInstance().trackPageView("DeviceDisconnectedView")},hide:function(){View.prototype.hide.call(this);this.unbindEventsReconnect()}},_private:{$buttonMouseMode:null,$disconnected:null,$connected:null,$code:null,experienceWasPlaying:false,init:function(){this.$buttonMouseMode=this.$container.find(".link.mouse-mode a");this.$disconnected=this.$container.find(".disconnected");this.$connected=this.$container.find(".connected");this.$code=this.$container.find(".code")},bindEvents:function(){var a=this;this.$buttonMouseMode.unbind("click").bind("click",function(){a.onMouseMode()});return},bindEventsReconnect:function(){var a=this;RemoteController.getInstance().events.bind(RemoteController.EVENT_PEER_ENTER+".DeviceDisconnectedView",function(){a.onPeerEnter()});RemoteController.getInstance().events.bind(RemoteController.EVENT_PEER_LEAVE+".DeviceDisconnectedView",function(){a.onPeerLeave()});RemoteController.getInstance().events.bind(RemoteController.EVENT_PEER_READY+".DeviceDisconnectedView",function(){a.onPeerReady()})},unbindEventsReconnect:function(){RemoteController.getInstance().events.unbind(RemoteController.EVENT_PEER_ENTER+".DeviceDisconnectedView");RemoteController.getInstance().events.unbind(RemoteController.EVENT_PEER_LEAVE+".DeviceDisconnectedView");RemoteController.getInstance().events.unbind(RemoteController.EVENT_PEER_READY+".DeviceDisconnectedView")},onPeerEnter:function(){this.$disconnected.stop().fadeOut();this.$connected.stop().fadeIn()},onPeerLeave:function(){this.$disconnected.stop().fadeIn();this.$connected.stop().fadeOut()},onPeerReady:function(){this.hide();if(ViewController.getInstance().getView("ExperienceLoadingView").shown){ViewController.getInstance().getView("ExperienceLoadingView").resume()}else if(this.experienceWasPlaying){TimelineController.getInstance().resume()}},onMouseMode:function(){InputController.getInstance().setMode(InputController.INPUT_TYPE_MOUSE);if(ViewController.getInstance().getView("ExperienceLoadingView").shown){ViewController.getInstance().getView("ExperienceLoadingView").onMouseMode()}else{ViewController.getInstance().getView("ExperienceView").onDeviceActive()}this.onPeerReady()}}});var RuntimeErrorView=View._extend({_public:{construct:function(a,b){View.call(this,a,b)}}});var Sequence=Class._extend(Class.ABSTRACT,{_public:{id:null,settings:null,startTime:0,endTime:60,defaultOptions:{},currentOptions:{},transitions:[],averageRenderTime:0,buff:new Uint8Array(4),isPaused:false,construct:function(a,b,c,d,e){var f=this;this.id=a;this.video=c;this.audio=d;this.videoTexture=e;if(a)this.init()},init:function(){this.wasInitialised=true},begin:function(){},end:function(){},pause:function(){this.isPaused=true},resume:function(){this.isPaused=false},seekStart:function(){},seek:function(a){},onFrame:function(a,b,c,d,e,f){var g,h=performance.now();if(this.lastFrameTime!==-1){g=h-this.lastFrameTime;this.delta=Math.max(Math.min(g/(1e3/60),3),.333);this.update(a,b,this.delta,c,d,e,f);this.render()}this.lastFrameTime=h},changeVideoQuality:function(a,b){},changeRenderQuality:function(a,b){}},_protected:{id:null,audio:null,video:null,videoTexture:null,active:false,lastFrameTime:-1,delta:1,wasInitialised:false,renderWidth:1280,renderHeight:672,settingsTimeline:null,currentSettings:null,nextSettings:null,currentSettingsStart:-1,update:function(a,b,c,d,e,f){},render:function(){}}});var DeformMaskSequence=Sequence._extend({_public:{drawingMaterial:null,drawingFboPing:null,drawingFboPong:null,drawingIsPing:false,drawingFeedbackMaterial:null,drawingFeedbackOriginalMaterial:null,drawingFeedbackNewMaterial:null,drawingFeedbackFboPing:null,drawingFeedbackFboPong:null,drawingFeedbackIsPing:false,preAddMaterial:null,preAddFbo:null,distMixMaterial:null,distMixFbo:null,revealExposureMaterial:null,revealExposureFboPing:null,revealExposureFboPong:null,revealExposureIsPing:false,lightGlowMaterial:null,lightGlowFboPing:null,lightGlowFboPong:null,lightGlowIsPing:false,raysMaterial:null,raysFboPing:null,raysFboPong:null,raysFbo:null,compositeMaterial:null,compositeFbo:null,useGodRays:false,useGodRaysTransition:false,godRaysTransitionPc:0,blobTexturePaths:["media/images/mask_encre_scene0/mask_encre0.jpg","media/images/mask_encre_scene0/mask_encre1.jpg","media/images/mask_encre_scene0/mask_encre2.jpg","media/images/mask_encre_scene0/mask_encre3.jpg","media/images/mask_encre_scene0/mask_encre4.jpg","media/images/mask_encre_scene0/mask_encre5.jpg","media/images/mask_encre_scene0/mask_encre6.jpg","media/images/mask_encre_scene0/mask_encre7.jpg","media/images/mask_encre_scene0/mask_encre8.jpg","media/images/mask_encre_scene0/mask_encre9.jpg","media/images/mask_encre_scene0/mask_encre10.jpg"],blobTextures:[],lastMaskFrameUpdate:0,currentMask:0,maskRate:1e3/24,construct:function(a,b,c,d,e){Sequence.call(this,a,b,c,d,e)},init:function(){if(this.wasInitialised)return;Sequence.prototype.init.call(this);console.log("initializing deformmask");var a=this.videoTexture.width,b=this.videoTexture.height,c=RendererController.getInstance().getRenderer();for(var d=0;d<this.blobTexturePaths.length;d++){this.blobTextures[d]=AssetsController.getInstance().getFile(this.blobTexturePaths[d]);this.blobTextures[d].minFilter=THREE.LinearMipMapLinearFilter;this.blobTextures[d].generateMipmaps=true;this.blobTextures[d].needsUpdate=true}this.drawingMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/deformmask/vertexRatio.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/deformmask/drawingDirection.frag"),attributes:{},uniforms:{tAccum:{type:"t",value:null},center:{type:"v2",value:new THREE.Vector2},drawingSize:{type:"f",value:.25},drawingOpacity:{type:"f",value:.1},accumSpeed:{type:"f",value:.25}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.drawingFboPing=new FramebufferWrapper(a/2,b/2,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.drawingMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.drawingFboPong=new FramebufferWrapper(a/2,b/2,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.drawingMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.drawingFeedbackNewMaterial=this.drawingFeedbackMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/deformmask/vertexRatio.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/deformmask/drawingFeedbackRadial2.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.videoTexture.texture},tAccum:{type:"t",value:null},tDrawing:{type:"t",value:null},center:{type:"v2",value:new THREE.Vector2},drawingSize:{type:"f",value:.25},drawingOpacity:{type:"f",value:.1},accumSpeed:{type:"f",value:.25},drawingDiffExp:{type:"f",value:1.5},centerFadeSize:{type:"f",value:.1},offset:{type:"v2",value:new THREE.Vector2(2/a,2/b)},rayRadius:{type:"f",value:100},noiseAlpha:{type:"f",value:100},randomUV:{type:"v2",value:new THREE.Vector2}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.drawingFeedbackFboPing=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.drawingFeedbackMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.drawingFeedbackFboPong=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.drawingFeedbackMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.drawingFeedbackOriginalMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/deformmask/vertexRatio.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/deformmask/drawingFeedbackRadial.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.videoTexture.texture},tAccum:{type:"t",value:null},tDrawing:{type:"t",value:null},center:{type:"v2",value:new THREE.Vector2},drawingSize:{type:"f",value:.25},drawingOpacity:{type:"f",value:.1},accumSpeed:{type:"f",value:.25},drawingDiffExp:{type:"f",value:1.5},centerFadeSize:{type:"f",value:.1},offset:{type:"v2",value:new THREE.Vector2(2/a,2/b)},rayRadius:{type:"f",value:100},noiseAlpha:{type:"f",value:100},randomUV:{type:"v2",value:new THREE.Vector2}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.preAddMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertex.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/deformmask/addDrawing.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.videoTexture.texture},tDrawing:{type:"t",value:null},drawingAdditive:{type:"f",value:0},drawingDiffExp:{type:"f",value:0},drawingAlpha:{type:"f",value:1}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.preAddFbo=new FramebufferWrapper(a/2,b/2,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.preAddMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.distMixMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/deformmask/vertexRatio.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/deformmask/distMix.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.videoTexture.texture},tDrawing:{type:"t",value:null},tRays:{type:"t",value:null},center:{type:"v2",value:new THREE.Vector2(.5,.5)}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.distMixFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.distMixMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.revealExposureMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/deformmask/vertexRatio.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/deformmask/revealExposure.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.preAddFbo.texture},tDrawing:{type:"t",value:null},tAccum:{type:"t",value:null},tBlob:{type:"t",value:null},offset:{type:"v2",value:new THREE.Vector2(1.66/a,1.66/b)},center:{type:"v2",value:new THREE.Vector2(.5,.5)},drawingSize:{type:"f",value:.5},blobScale:{type:"f",value:3},accumSpeed:{type:"f",value:.98},exposure:{type:"f",value:1}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.revealExposureFboPing=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.revealExposureMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.revealExposureFboPong=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.revealExposureMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.lightGlowMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/deformmask/vertexRatio.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/deformmask/lightGlow.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.preAddFbo.texture},tDrawing:{type:"t",value:null},tAccum:{type:"t",value:null},tBlob:{type:"t",value:null},tReveal:{type:"t",value:null},center:{type:"v2",value:new THREE.Vector2(.5,.5)},drawingSize:{type:"f",value:.5},blobScale:{type:"f",value:3},offset:{type:"v2",value:new THREE.Vector2(13.5/a,13.5/b)},accumSpeed:{type:"f",value:.99}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.lightGlowFboPing=new FramebufferWrapper(a/4,b/4,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.lightGlowMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.lightGlowFboPong=new FramebufferWrapper(a/5,b/5,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.lightGlowMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.raysMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertex.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/deformmask/drawingGodRays.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.videoTexture.texture},tDrawing:{type:"t",value:null},tAccum:{type:"t",value:null},randomUV:{type:"v2",value:new THREE.Vector2},noiseOffset:{type:"f",value:.05},drawingAdditive:{type:"f",value:0},offset:{type:"v2",value:new THREE.Vector2(1/a,1/b)},center:{type:"v2",value:new THREE.Vector2(.5,.5)},alpha:{type:"f",value:1},raysExp:{type:"f",value:1},fStepSize:{type:"f",value:0},rotation:{type:"v2",value:new THREE.Vector2(0,0)}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.raysFboPing=new FramebufferWrapper(a/8,b/8,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.raysMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.raysFboPong=new FramebufferWrapper(a/2,b/2,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.raysMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.raysFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.raysMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.compositeMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertex.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/deformmask/add.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.videoTexture.texture},tDrawing:{type:"t",value:this.videoTexture.texture},tRays:{type:"t",value:this.videoTexture.texture},videoAlpha:{type:"f",value:1},drawingAlpha:{type:"f",value:.1},raysAlpha:{type:"f",value:1}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.compositeFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.compositeMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c})},begin:function(){Sequence.prototype.begin.call(this);console.log("begin deformmask");this.drawingFboPing.alloc();this.drawingFboPong.alloc();this.drawingFeedbackFboPing.alloc();this.drawingFeedbackFboPong.alloc();this.preAddFbo.alloc();this.raysFboPing.alloc();this.raysFboPong.alloc();this.raysFbo.alloc();this.compositeFbo.alloc();this.drawingFeedbackMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.raysMaterial.uniforms.tVideo.value=this.videoTexture.texture;
this.preAddMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.compositeMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.drawingFeedbackNewMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.drawingFeedbackOriginalMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.preAddMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.distMixMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.revealExposureMaterial.uniforms.tVideo.value=this.videoTexture.texture},end:function(){Sequence.prototype.end.call(this);this.drawingFboPing.dispose();this.drawingFboPong.dispose();this.drawingFeedbackFboPing.dispose();this.drawingFeedbackFboPong.dispose();this.preAddFbo.dispose();this.raysFboPing.dispose();this.raysFboPong.dispose();this.raysFbo.dispose();this.compositeFbo.dispose()},changeVideoQuality:function(a,b){this.drawingFeedbackMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.raysMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.preAddMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.compositeMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.compositeMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.compositeMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.drawingFeedbackNewMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.drawingFeedbackOriginalMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.preAddMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.distMixMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.revealExposureMaterial.uniforms.tVideo.value=this.videoTexture.texture},changeRenderQuality:function(a,b){var c=RendererController.getInstance().getRenderer();this.renderWidth=a;this.renderHeight=b;this.drawingFboPing.resizeTextureAndCopy(a/2,b/2);this.drawingFboPong.resizeTextureAndCopy(a/2,b/2);this.drawingFeedbackFboPing.resizeTextureAndCopy(a/2,b/2);this.drawingFeedbackFboPong.resizeTextureAndCopy(a/2,b/2);this.preAddFbo.resizeTexture(a/2,b/2);this.raysFboPing.resizeTexture(a/8,b/8);this.raysFboPong.resizeTexture(a/2,b/2);this.raysFbo.resizeTexture(a,b);this.compositeFbo.resizeTexture(a,b)}},_protected:{update:function(a,b,c,d,e,f,g){var h=InputController.getInstance().getPositionDirectional();var i=.9;var j=1.25;if(InputController.getInstance().isMouseVersion()){i+=(.5-i)*(1-h.z);j+=(.5-j)*(1-h.z)}else{i+=(.5-i)*(1-h.z)*.2;j+=(.5-j)*(1-h.z)*.2}this.drawingMaterial.uniforms.center.value.set(h.x*i+.5,h.y*-j+.5);this.drawingFeedbackMaterial.uniforms.center.value.set(h.x*i+.5,h.y*-j+.5);this.raysMaterial.uniforms.center.value.set(h.x*i+.5,h.y*j+.5);this.revealExposureMaterial.uniforms.center.value.set(h.x*-i+.5,h.y*j+.5);this.lightGlowMaterial.uniforms.center.value.set(h.x*-i+.5,h.y*j+.5);this.distMixMaterial.uniforms.center.value.set(h.x*-i+.5,h.y*j+.5);if(Date.now()-this.lastMaskFrameUpdate>=this.maskRate){this.lastMaskFrameUpdate=Date.now();this.currentMask++;if(this.currentMask>=this.blobTextures.length)this.currentMask=0;this.revealExposureMaterial.uniforms.tBlob.value=this.blobTextures[this.currentMask];this.lightGlowMaterial.uniforms.tBlob.value=this.blobTextures[this.currentMask]}this.godRaysTransitionPc=a.godRaysTransition;if(!this.useGodRays){if(this.godRaysTransitionPc>=1){this.useGodRays=true;this.useGodRaysTransition=false}else if(this.godRaysTransitionPc>0){this.useGodRays=false;this.useGodRaysTransition=true}}else if(this.useGodRays&&this.godRaysTransitionPc<1){this.useGodRays=false;this.useGodRaysTransition=this.godRaysTransitionPc>0}if(!this.useGodRays){this.drawingFeedbackMaterial=this.drawingFeedbackNewMaterial;this.drawingFeedbackFboPong.renderPlane.material=this.drawingFeedbackMaterial;this.drawingFeedbackFboPing.renderPlane.material=this.drawingFeedbackMaterial}else{this.drawingFeedbackMaterial=this.drawingFeedbackOriginalMaterial;this.drawingFeedbackFboPong.renderPlane.material=this.drawingFeedbackMaterial;this.drawingFeedbackFboPing.renderPlane.material=this.drawingFeedbackMaterial}this.revealExposureMaterial.uniforms.drawingSize.value=a.drawingSize;this.lightGlowMaterial.uniforms.drawingSize.value=a.drawingSize;this.drawingMaterial.uniforms.drawingSize.value=a.drawingSize+(1-a.drawingSize)*h.z;this.drawingMaterial.uniforms.drawingSize.value+=(1-this.drawingMaterial.uniforms.drawingSize.value)*a.fade;this.drawingMaterial.uniforms.drawingOpacity.value=a.drawingOpacity;this.drawingMaterial.uniforms.accumSpeed.value=a.accumSpeed;this.drawingFeedbackMaterial.uniforms.drawingSize.value=a.drawingSizeRays;this.drawingFeedbackMaterial.uniforms.drawingOpacity.value=a.drawingOpacityRays+.2*h.z;this.drawingFeedbackMaterial.uniforms.accumSpeed.value=a.accumSpeedRays*(1+.033*h.z);this.drawingFeedbackMaterial.uniforms.rayRadius.value=a.noiseRadiusRays;this.drawingFeedbackMaterial.uniforms.noiseAlpha.value=a.noiseAlphaRays;this.drawingFeedbackMaterial.uniforms.randomUV.value.set(Math.random(),Math.random()*1.5);this.drawingFeedbackMaterial.uniforms.drawingDiffExp.value=a.drawingDiffExp;this.drawingFeedbackMaterial.uniforms.centerFadeSize.value=a.centerFadeSizeRays*h.z;if(!this.useGodRays)this.drawingFeedbackMaterial.uniforms.centerFadeSize.value=0;this.preAddMaterial.uniforms.drawingAdditive.value=a.drawingAdditive;this.preAddMaterial.uniforms.drawingAlpha.value=a.drawingAlphaComposite*(1-a.fade);this.raysMaterial.uniforms.randomUV.value.set(Math.random(),Math.random());this.raysMaterial.uniforms.noiseOffset.value=0;this.raysMaterial.uniforms.alpha.value=1;this.raysMaterial.uniforms.drawingAdditive.value=0;this.raysMaterial.uniforms.raysExp.value=(10-this.godRaysTransitionPc*9)*(1+h.z*2+2*a.fade);if(this.useGodRaysTransition){if(this.godRaysTransitionPc<=.5)this.raysMaterial.uniforms.raysExp.value*=.5-this.godRaysTransitionPc+.5;else this.raysMaterial.uniforms.raysExp.value*=(this.godRaysTransitionPc-.5)*1+.5}this.raysMaterial.uniforms.alpha.value=1-a.fade;this.raysMaterial.uniforms.rotation.value.set(Math.cos(InputController.getInstance().getRotationX()*.5),Math.sin(InputController.getInstance().getRotationX()*.5));this.compositeMaterial.uniforms.videoAlpha.value=a.videoAlphaComposite;this.compositeMaterial.uniforms.drawingAlpha.value=a.drawingAlphaComposite;this.compositeMaterial.uniforms.raysAlpha.value=a.godRaysAlphaComposite*(1-a.fade);if(!this.useGodRays||this.useGodRaysTransition){var k=this.map(h.z,0,1,.15,.325);var l=.15*(1-h.z);l=this.random(1-l,1+l);this.revealExposureMaterial.uniforms.drawingSize.value=2*k*l;this.lightGlowMaterial.uniforms.drawingSize.value=k;this.drawingMaterial.uniforms.drawingSize.value=k*l;this.drawingMaterial.uniforms.drawingOpacity.value=this.map(h.z,1,0,.45,2);this.drawingMaterial.uniforms.accumSpeed.value=this.map(h.z,1,0,.98,.95);this.drawingFeedbackMaterial.uniforms.drawingSize.value=this.map(h.z,1,0,.7,2);this.drawingFeedbackMaterial.uniforms.drawingOpacity.value=this.cmap(h.z,1,0,.9,1.2);this.drawingFeedbackMaterial.uniforms.accumSpeed.value=.8;this.revealExposureMaterial.uniforms.exposure.value=this.map(h.z,0,1,1,.65);this.revealExposureMaterial.uniforms.accumSpeed.value=this.map(h.z,1,0,.98,.995)}},render:function(){if(false&&!this.useGodRays){var a=this.drawingIsPing?this.drawingFboPing:this.drawingFboPong;var b=this.drawingIsPing?this.drawingFboPong:this.drawingFboPing;this.drawingMaterial.uniforms.tAccum.value=b.texture;a.render();this.drawingIsPing=!this.drawingIsPing;var c=this.revealExposureIsPing?this.revealExposureFboPing:this.revealExposureFboPong;var d=this.revealExposureIsPing?this.revealExposureFboPong:this.revealExposureFboPing;this.revealExposureIsPing=!this.revealExposureIsPing;this.revealExposureMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.revealExposureMaterial.uniforms.tDrawing.value=a.texture;this.revealExposureMaterial.uniforms.tAccum.value=d.texture;c.render();var e=this.drawingFeedbackIsPing?this.drawingFeedbackFboPing:this.drawingFeedbackFboPong;var f=this.drawingFeedbackIsPing?this.drawingFeedbackFboPong:this.drawingFeedbackFboPing;this.drawingFeedbackMaterial.uniforms.tVideo.value=c.texture;this.drawingFeedbackMaterial.uniforms.tAccum.value=f.texture;this.drawingFeedbackMaterial.uniforms.tDrawing.value=a.texture;e.render();this.drawingFeedbackIsPing=!this.drawingFeedbackIsPing;this.distMixMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.distMixMaterial.uniforms.tDrawing.value=a.texture;this.distMixMaterial.uniforms.tRays.value=e.texture;this.distMixFbo.render();RendererController.getInstance().renderToScreen(e.texture,false,true)}else{var a=this.drawingIsPing?this.drawingFboPing:this.drawingFboPong;var b=this.drawingIsPing?this.drawingFboPong:this.drawingFboPing;this.drawingMaterial.uniforms.tAccum.value=b.texture;a.render();this.drawingIsPing=!this.drawingIsPing;var c=this.revealExposureIsPing?this.revealExposureFboPing:this.revealExposureFboPong;var d=this.revealExposureIsPing?this.revealExposureFboPong:this.revealExposureFboPing;this.revealExposureIsPing=!this.revealExposureIsPing;this.revealExposureMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.revealExposureMaterial.uniforms.tDrawing.value=a.texture;this.revealExposureMaterial.uniforms.tAccum.value=d.texture;c.render();var e=this.drawingFeedbackIsPing?this.drawingFeedbackFboPing:this.drawingFeedbackFboPong;var f=this.drawingFeedbackIsPing?this.drawingFeedbackFboPong:this.drawingFeedbackFboPing;this.drawingFeedbackMaterial.uniforms.tVideo.value=c.texture;this.drawingFeedbackMaterial.uniforms.tAccum.value=f.texture;this.drawingFeedbackMaterial.uniforms.tDrawing.value=a.texture;e.render();this.drawingFeedbackIsPing=!this.drawingFeedbackIsPing;this.preAddMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.preAddMaterial.uniforms.tDrawing.value=e.texture;this.preAddFbo.render();if(!this.useGodRays&&!this.useGodRaysTransition){RendererController.getInstance().renderToScreen(e.texture,false,true)}else{this.raysMaterial.uniforms.tVideo.value=e.texture;this.raysMaterial.uniforms.tDrawing.value=a.texture;var g=1;var h=6;var i=1;var j=g*Math.pow(h,-i);this.raysMaterial.uniforms.center.value.y=1-this.raysMaterial.uniforms.center.value.y;this.raysMaterial.uniforms.fStepSize.value=j;this.raysMaterial.uniforms.tAccum.value=this.videoTexture.texture;this.raysFboPing.renderPlane.scale.y=1;this.raysFboPing.render();i=2;j=g*Math.pow(h,-i);this.raysMaterial.uniforms.fStepSize.value=j;this.raysMaterial.uniforms.tAccum.value=this.raysFboPing.texture;this.raysFboPong.renderPlane.scale.y=1;this.raysFboPong.render();i=3;j=g*Math.pow(h,-i);this.raysMaterial.uniforms.fStepSize.value=j;this.raysMaterial.uniforms.tAccum.value=this.raysFboPong.texture;this.raysFbo.renderPlane.scale.y=1;this.raysFbo.render();this.compositeMaterial.uniforms.tDrawing.value=e.texture;this.compositeMaterial.uniforms.tRays.value=this.raysFbo.texture;RendererController.getInstance().renderToScreen(this.raysFbo.texture,false,true)}}},random:function(a,b){return a+Math.random()*(b-a)},map:function(a,b,c,d,e){return d+(e-d)*((a-b)/(c-b))},cmap:function(a,b,c,d,e){return Math.max(Math.min(d+(e-d)*((a-b)/(c-b)),e),d)}}});var OpticalFeedbackSequence=Sequence._extend({_public:{scene:null,windowCamera:null,planesFbo:null,allTextures:[],allPlanes:[],numPlanes:10,MAX_TEXTURES:35,MAX_TEXTURES_SHARP:5,alphaExtractionMaterial:null,alphaExtractionFbo:null,noAlphaMaterial:null,precompMaterial:null,feedbackSpeed:.5,scalingmax:.5,firstFrame:true,lastMaskFrameUpdate:0,currentMask:0,maskRate:1e3/24,deformTextures:[],deformImagesPaths:["media/images/encre/texture_encre0.jpg","media/images/encre/texture_encre1.jpg","media/images/encre/texture_encre2.jpg","media/images/encre/texture_encre4.jpg","media/images/encre/texture_encre5.jpg","media/images/encre/texture_encre6.jpg","media/images/encre/texture_encre7.jpg","media/images/encre/texture_encre8.jpg"],construct:function(a,b,c,d,e){Sequence.call(this,a,b,c,d,e)},init:function(){if(this.wasInitialised)return;Sequence.prototype.init.call(this);console.log("init opticalfeedback");var a=this.videoTexture.width,b=this.videoTexture.height,c=RendererController.getInstance().getRenderer();for(var d=0;d<this.deformImagesPaths.length;d++){this.deformTextures[d]=AssetsController.getInstance().getFile(this.deformImagesPaths[d]);this.deformTextures[d].minFilter=THREE.LinearMipMapLinearFilter;this.deformTextures[d].generateMipmaps=true;this.deformTextures[d].needsUpdate=true}this.scene=new THREE.Scene;this.camera=new THREE.OrthographicCamera(-.5,.5,-.5,.5,-1e4,1e4);this.windowCamera=new THREE.OrthographicCamera(-a/2,a/2,b/2,-b/2,-1e4,1e4);this.windowCamera.lookAt(new THREE.Vector3);this.planesFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,camera:this.windowCamera,scene:new THREE.Scene,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.alphaExtractionMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/opticalfeedback/alphaExtraction.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/opticalfeedback/alphaExtraction.frag"),attributes:{},uniforms:{texture:{type:"t",value:this.videoTexture.texture},alphaRatio:{type:"f",value:.25},pixelFix:{type:"f",value:0/a}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.alphaExtractionFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.alphaExtractionMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.noAlphaMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertexinv.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/opticalfeedback/diffuseExtraction.frag"),attributes:{},uniforms:{texture:{type:"t",value:this.alphaExtractionFbo.texture}},depthTest:false,transparent:false,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.precompMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertex.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/opticalfeedback/chromaticdiff.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.alphaExtractionFbo.texture},tMask:{type:"t",value:this.deformTextures[0]},offset:{type:"v2",value:new THREE.Vector2(1/a,1/b)},center:{type:"v2",value:new THREE.Vector2(.5,.5)},alpha:{type:"f",value:.1},time:{type:"f",value:0}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.precompMaterial2=new THREE.MeshBasicMaterial({map:this.allTextures[0],depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});for(var d=0;d<this.MAX_TEXTURES;d++){var e=d<this.MAX_TEXTURES_SHARP?1:.25;var f=d<this.MAX_TEXTURES_SHARP?this.precompMaterial:this.precompMaterial2;this.allTextures[d]=new FramebufferWrapper(Math.floor(a*e),Math.floor(b*e),{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:f,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});if(d>=this.MAX_TEXTURES_SHARP)this.allTextures[d].renderPlane.scale.y=-1}this.createPlanes(this.numPlanes)},begin:function(){Sequence.prototype.begin.call(this);console.log("begin opticalfeedback");this.alphaExtractionFbo.alloc();for(var a=0;a<this.MAX_TEXTURES;a++){this.allTextures[a].alloc()}this.planesFbo.alloc();this.precompMaterial.uniforms.tVideo.value=this.alphaExtractionFbo.texture;this.alphaExtractionMaterial.uniforms.texture.value=this.videoTexture.texture;this.firstFrame=true},end:function(){Sequence.prototype.end.call(this);for(var a=0;a<this.MAX_TEXTURES;a++){this.allTextures[a].dispose()}this.alphaExtractionFbo.dispose();this.planesFbo.dispose()},changeVideoQuality:function(a,b){this.alphaExtractionFbo.resizeTexture(a,b);this.alphaExtractionMaterial.uniforms.texture.value=this.videoTexture.texture;this.precompMaterial.uniforms.tVideo.value=this.alphaExtractionFbo.texture;this.precompMaterial.uniforms.offset.value.set(1/a,1/b);for(var c=this.MAX_TEXTURES_SHARP;c<this.MAX_TEXTURES;c++){this.allTextures[c].resizeTextureAndCopy(a,b)}},changeRenderQuality:function(a,b){var c=RendererController.getInstance().getRenderer();this.renderWidth=a;this.renderHeight=b;for(var d=this.MAX_TEXTURES_SHARP;d<this.MAX_TEXTURES;d++){var e=.25;this.allTextures[d].resizeTextureAndCopy(Math.floor(a*e),Math.floor(b*e))}this.planesFbo.resizeTexture(a,b)}},_protected:{update:function(a,b,c,d,e,f,g){var h=InputController.getInstance().getPositionDirectional(),i=InputController.getInstance().getRotationX();i=1-i*i;var j=1;if(this.numPlanes!==Math.floor(Math.max(a.numPlanesClose,a.numPlanesFar)))this.createPlanes(Math.floor(Math.max(a.numPlanesClose,a.numPlanesFar)));if(Date.now()-this.lastMaskFrameUpdate>=this.maskRate){this.lastMaskFrameUpdate=Date.now();this.currentMask++;if(this.currentMask>=this.deformTextures.length)this.currentMask=0;this.precompMaterial.uniforms.tMask.value=this.deformTextures[this.currentMask]}this.precompMaterial.uniforms.alpha.value=a.effectAlpha;this.precompMaterial.uniforms.center.value.set(h.x*-1+.5,h.y*-1+.5);this.precompMaterial.uniforms.alpha.value=(.25+(a.effectAlpha-.25)*(1-h.z))*(1-a.fade);this.feedbackSpeed=this.cmap(1-h.z,0,1,a.feedbackSpeedNear,a.feedbackSpeedFar);var k=this.allPlanes,l=1280,m=672;k[k.length-1].position.set(h.x*a.rangeX,Math.min(h.y,1)*a.rangeY*-1,0);k[k.length-1].position.z=k.length-1;for(var n=k.length-2;n>0;n--){var o=(n-1)/(k.length-1);o=o;k[n].position.set(0,0,0).lerp(k[k.length-1].position,o);k[n].position.z=n}var p=Math.floor(this.cmap(h.z,0,1,a.numPlanesClose,a.numPlanesFar));for(var n=0;n<k.length;n++){var q=k[n];if(!q.visible&&n<p)q.visible=true;if(q.visible&&n>p)q.visible=false;q.position.z=n}var r=this.cmap(h.z,0,1,a.opacityNear,a.opacityFar);this.scalingmax=this.scalingmax*.8+.2*this.cmap(1-h.z,0,1,a.scalingFar,a.scalingNear);for(var n=1;n<k.length;n++){var s=new THREE.Vector2(h.x,h.y*.5).length();s=Math.min(s,.75);op=this.map(s,.75,0,r,a.centerOpacityDec*r);op*=1-a.fade;op=op*(1-a.opacityDiff*((n-1)/(k.length-2)));op*=j;k[n].material.opacity=op;k[n].material.blending=a.blending==="alpha"?THREE.NormalBlending:THREE.AdditiveBlending;var o=n/(k.length-1);var t=1+o*o*this.scalingmax;k[n].scale.set(t,t,t)}k[0].material.opacity=1;for(var n=0;n<k.length;n++){k[n].position.y=Math.min(k[n].position.y,this.videoTexture.height/2*k[n].scale.y-this.videoTexture.height/2)}},render:function(){if(this.firstFrame){RendererController.getInstance().getRenderer().setClearColor(new THREE.Color(0));RendererController.getInstance().getRenderer().clear()}else{RendererController.getInstance().getRenderer().setClearColor(new THREE.Color(0));RendererController.getInstance().getRenderer().clear()}if(this.videoTexture.wasUpdatedThisframe){this.alphaExtractionFbo.render();var a=this.allTextures.splice(this.MAX_TEXTURES_SHARP-1,1)[0];var b=this.allTextures.pop();b.renderPlane.material.map=a.texture;b.render();a.render();this.allTextures.unshift(a);this.allTextures.splice(this.MAX_TEXTURES_SHARP,0,b)}for(var c=0;c<this.allPlanes.length;c++){this.allPlanes[c].material.map=this.allTextures[Math.floor(c*this.feedbackSpeed)+1].texture}this.allPlanes[0].material.map=this.allTextures[0].texture;this.allPlanes[0].material.uniforms.texture.value=this.allTextures[0].texture;this.planesFbo.render();if(!this.firstFrame)RendererController.getInstance().renderToScreen(this.planesFbo.texture,false,true);this.firstFrame=false}},_private:{createPlanes:function(a){if(this.allPlanes){for(var b=0;b<this.allPlanes.length;b++){this.planesFbo.scene.remove(this.allPlanes[b])}}this.allPlanes=[];this.numPlanes=a;for(var b=0;b<a;b++){this.allPlanes[b]=new THREE.Mesh(new THREE.PlaneGeometry(this.videoTexture.width,this.videoTexture.height,1,1),new THREE.MeshBasicMaterial({map:this.allTextures[0].texture,side:THREE.DoubleSide,transparent:true,depthTest:true,depthWrite:true,blending:THREE.AdditiveBlending}));this.allPlanes[b].position.z=0;this.planesFbo.scene.add(this.allPlanes[b])}this.allPlanes[0].material=this.noAlphaMaterial;this.allPlanes[1].material=this.noAlphaMaterial},getCameraZ:function(a,b){return b/(2*Math.tan(a.fov/2*(Math.PI/180)))},map:function(a,b,c,d,e){return d+(e-d)*((a-b)/(c-b))},cmap:function(a,b,c,d,e){return Math.max(Math.min(d+(e-d)*((a-b)/(c-b)),e),d)}}});var LanmeSequence=Sequence._extend({_public:{DRAWING_EFFECT_SIZE:.25,allTextures:[],NUM_TEXTURES:10,currentDrawingShader:"drawingBlurDirection.frag",drawingMaterial:null,drawingFboPing:null,drawingFboPong:null,drawingIsPing:false,compTimeMaterial:null,compTimeFboPing:null,compTimeFboPong:null,compTimeIsPing:false,currentCompositeShader:"chromadiffDirectionStatic.frag",finalCompositeMaterial:null,finalCompositeFbo:null,currentPassShown:null,firstFrame:true,construct:function(a,b,c,d,e){Sequence.call(this,a,b,c,d,e)},init:function(){if(this.wasInitialised)return;Sequence.prototype.init.call(this);console.log("initializing lanme");var a=this.videoTexture.width,b=this.videoTexture.height,c=RendererController.getInstance().getRenderer();var d=new THREE.MeshBasicMaterial({map:this.videoTexture.texture,side:THREE.DoubleSide,transparent:false,depthTest:false});for(var e=0;e<this.NUM_TEXTURES;e++){this.allTextures[e]=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,type:THREE.UnsignedByteType,renderMaterial:d,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:true,generateMipmaps:false,renderer:c})}this.drawingMaterial=this.reloadShader(this.currentDrawingShader);this.drawingFboPing=new FramebufferWrapper(a*this.DRAWING_EFFECT_SIZE,b*this.DRAWING_EFFECT_SIZE,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.drawingMaterial,depthBuffer:true,stencilBuffer:false,premultiplyAlpha:true,generateMipmaps:false,renderer:c});this.drawingFboPong=new FramebufferWrapper(a*this.DRAWING_EFFECT_SIZE,b*this.DRAWING_EFFECT_SIZE,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.drawingMaterial,depthBuffer:true,stencilBuffer:false,premultiplyAlpha:true,generateMipmaps:false,renderer:c});this.compTimeMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/lanme/EdgeBlurCompositeTime.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/lanme/EdgeBlurCompositeTime.frag"),attributes:{},uniforms:{timeGradient:{type:"t",value:this.drawingFboPong.texture},tAccum:{type:"t",value:null},tFrame:{type:"t",value:this.allTextures[0].texture},tFrameNext:{type:"t",value:this.allTextures[0].texture},frameDiff:{type:"f",value:1/this.NUM_TEXTURES},frameMin:{type:"f",value:0},frameMax:{type:"f",value:1}},depthTest:false,transparent:false,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.compTimeFboPing=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.compTimeMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.compTimeFboPong=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.compTimeMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.finalCompositeMaterial=this.reloadShader(this.currentCompositeShader);this.finalCompositeFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.finalCompositeMaterial,depthBuffer:true,stencilBuffer:false,premultiplyAlpha:true,generateMipmaps:false,renderer:c})},begin:function(){Sequence.prototype.begin.call(this);console.log("begin lanme");for(var a=0;a<this.NUM_TEXTURES;a++){this.allTextures[a].alloc()}this.drawingFboPing.alloc();this.drawingFboPong.alloc();this.compTimeFboPing.alloc();this.compTimeFboPong.alloc();this.finalCompositeFbo.alloc();this.firstFrame=true;if(this.drawingMaterial.uniforms.tDiffuse)this.drawingMaterial.uniforms.tDiffuse.value=this.videoTexture.texture},end:function(){Sequence.prototype.end.call(this);for(var a=0;a<this.NUM_TEXTURES;a++){this.allTextures[a].dispose()}this.drawingFboPing.dispose();this.drawingFboPong.dispose();this.compTimeFboPing.dispose();this.compTimeFboPong.dispose();this.finalCompositeFbo.dispose();this.firstFrame=true},changeVideoQuality:function(a,b){if(this.drawingMaterial.uniforms.tDiffuse)this.drawingMaterial.uniforms.tDiffuse.value=this.videoTexture.texture;for(var c=0;c<this.NUM_TEXTURES;c++){this.allTextures[c].renderPlane.material.map=this.videoTexture.texture;this.allTextures[c].resizeTextureAndCopy(a,b)}},changeRenderQuality:function(a,b){var c=RendererController.getInstance().getRenderer();this.renderWidth=a;this.renderHeight=b;this.drawingFboPing.resizeTextureAndCopy(a*this.DRAWING_EFFECT_SIZE,b*this.DRAWING_EFFECT_SIZE);this.drawingFboPong.resizeTextureAndCopy(a*this.DRAWING_EFFECT_SIZE,b*this.DRAWING_EFFECT_SIZE);this.compTimeFboPing.resizeTextureAndCopy(a,b);this.compTimeFboPong.resizeTextureAndCopy(a,b);this.finalCompositeFbo.resizeTexture(a,b)}},_protected:{update:function(a,b,c,d,e,f,g){var h=InputController.getInstance().getPositionDirectional(),i=this.videoTexture.width,j=this.videoTexture.height,k=this;if(a.shader!==this.currentCompositeShader){this.currentCompositeShader=a.shader;$.get("shaders/lanme/"+this.currentCompositeShader).done(function(a){k.finalCompositeMaterial=k.reloadShader(k.currentCompositeShader,a);k.finalCompositeFbo.renderPlane.material=k.finalCompositeMaterial}).error(function(){alert("Shader Loading Error: "+k.currentCompositeShader)})}if(this.drawingMaterial.uniforms.center)this.drawingMaterial.uniforms.center.value.set(h.x*.75+.5,h.y*.5+.5);if(this.drawingMaterial.uniforms.offset)this.drawingMaterial.uniforms.offset.value.set(a.blurSize/i*this.DRAWING_EFFECT_SIZE,a.blurSize/j*this.DRAWING_EFFECT_SIZE);if(this.drawingMaterial.uniforms.timep)this.drawingMaterial.uniforms.timep.value=performance.now()*.01;if(this.drawingMaterial.uniforms.accumulationpc){this.drawingMaterial.uniforms.accumulationpc.value=a.accumulation}if(this.drawingMaterial.uniforms.fade)this.drawingMaterial.uniforms.fade.value=a.fade;if(this.finalCompositeMaterial.uniforms.center)this.finalCompositeMaterial.uniforms.center.value.set(h.x*.75+.5,h.y*.5+.5);if(this.finalCompositeMaterial.uniforms.offset)this.finalCompositeMaterial.uniforms.offset.value.set(a.blurSize/i*this.DRAWING_EFFECT_SIZE,a.blurSize/j*this.DRAWING_EFFECT_SIZE);if(this.finalCompositeMaterial.uniforms.timep)this.finalCompositeMaterial.uniforms.timep.value=performance.now()*.01;if(this.finalCompositeMaterial.uniforms.accumulationpc){this.finalCompositeMaterial.uniforms.accumulationpc.value=a.accumulation}if(this.finalCompositeMaterial.uniforms.drawingSize)this.finalCompositeMaterial.uniforms.drawingSize.value=a.drawingSize;if(this.finalCompositeMaterial.uniforms.fade)this.finalCompositeMaterial.uniforms.fade.value=1-a.fade;if(this.finalCompositeMaterial.uniforms.randomUV)this.finalCompositeMaterial.uniforms.randomUV.value.set(Math.random(),Math.random());var l=this.cmap(h.z,.1,.9,0,1);var m=this.map(l,0,1,a.effectAlphaNear,a.effectAlphaFar);this.finalCompositeMaterial.uniforms.effectAlpha.value=m;var n=(a.drawingSizeFar-a.drawingSizeNear)*l+a.drawingSizeNear;n=n*(1-a.pulse)+n*Math.random()*a.pulse;this.finalCompositeMaterial.uniforms.drawingSize.value=n;this.drawingMaterial.uniforms.drawingSize.value=n;this.currentPassShown=a.pass},render:function(){RendererController.getInstance().getRenderer().setClearColor(new THREE.Color(0));RendererController.getInstance().getRenderer().clear();if(this.videoTexture.wasUpdatedThisframe){this.allTextures.unshift(this.allTextures.pop());this.allTextures[0].render();if(this.firstFrame){this.firstFrame=false;for(var a=0;a<this.allTextures.length;a++){this.allTextures.unshift(this.allTextures.pop());this.allTextures[0].render()}}}var b=this.drawingIsPing?this.drawingFboPing:this.drawingFboPong;this.drawingMaterial.uniforms.tAccum.value=this.drawingIsPing?this.drawingFboPong.texture:this.drawingFboPing.texture;b.render();this.drawingIsPing=!this.drawingIsPing;var c;for(var a=0;a<this.NUM_TEXTURES;a++){c=this.compTimeIsPing?this.compTimeFboPing:this.compTimeFboPong;this.compTimeMaterial.uniforms.tAccum.value=this.compTimeIsPing?this.compTimeFboPong.texture:this.compTimeFboPing.texture;this.compTimeMaterial.uniforms.timeGradient.value=b.texture;this.compTimeMaterial.uniforms.tFrame.value=this.allTextures[this.NUM_TEXTURES-a-1].texture;if(this.NUM_TEXTURES-a-2>=0)this.compTimeMaterial.uniforms.tFrameNext.value=this.allTextures[this.NUM_TEXTURES-a-2].texture;else this.compTimeMaterial.uniforms.tFrameNext.value=this.allTextures[0].texture;this.compTimeMaterial.uniforms.frameMin.value=a/this.NUM_TEXTURES;this.compTimeMaterial.uniforms.frameMax.value=(a+1)/this.NUM_TEXTURES;c.render();this.compTimeIsPing=!this.compTimeIsPing}this.finalCompositeMaterial.uniforms.tDiffuse.value=c.texture;if(this.finalCompositeMaterial.uniforms.tDrawing)this.finalCompositeMaterial.uniforms.tDrawing.value=b.texture;this.finalCompositeFbo.render();var d={drawing:b,timeComposite:c,finalComposite:this.finalCompositeFbo}[this.currentPassShown].texture;RendererController.getInstance().renderToScreen(d,false,false)}},_private:{map:function(a,b,c,d,e){return d+(e-d)*((a-b)/(c-b))},cmap:function(a,b,c,d,e){return Math.max(Math.min(d+(e-d)*((a-b)/(c-b)),e),d)},reloadShader:function(a,b){var c,d=this.videoTexture.width,e=this.videoTexture.height;switch(a){case"pass.frag":c=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertex.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/common/pass.frag"),attributes:{},uniforms:{tDiffuse:{type:"t",value:null}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});break;case"vibranceNoise.frag":case"vibrance.frag":b=b||AssetsController.getInstance().getFile("shaders/lanme/"+a);c=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertex.vert"),fragmentShader:b,attributes:{},uniforms:{tDiffuse:{type:"t",value:null},tDrawing:{type:"t",value:null},center:{type:"v2",value:new THREE.Vector2(.5,.5)},drawingSize:{type:"f",value:.175},effectAlpha:{type:"f",value:1},timep:{type:"f",value:0},ratio:{type:"v2",value:new THREE.Vector2(d/e,1)},offset:{type:"v2",value:new THREE.Vector2(1.33/d*this.DRAWING_EFFECT_SIZE,1.33/e*this.DRAWING_EFFECT_SIZE)}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});break;case"drawingSine.frag":case"drawingBlur.frag":case"drawingBlurDirection.frag":c=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/lanme/drawingBlurDirection.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/lanme/"+a),attributes:{},uniforms:{tDiffuse:{type:"t",value:this.videoTexture.texture},tAccum:{type:"t",value:null},offset:{type:"v2",value:new THREE.Vector2(1.33/d*this.DRAWING_EFFECT_SIZE,1.33/e*this.DRAWING_EFFECT_SIZE)},center:{type:"v2",value:new THREE.Vector2(.5,.5)},drawingSize:{type:"f",value:.175},accumulationpc:{type:"f",value:.05},timep:{type:"f",value:0},ratio:{type:"v2",value:new THREE.Vector2(d/e,1)},fade:{type:"f",value:0}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});
break;case"difference.frag":b=b||AssetsController.getInstance().getFile("shaders/lanme/"+a);c=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertex.vert"),fragmentShader:b,attributes:{},uniforms:{tDiffuse:{type:"t",value:null},tDrawing:{type:"t",value:null},tVideo:{type:"t",value:this.videoTexture.texture},center:{type:"v2",value:new THREE.Vector2(.5,.5)},drawingSize:{type:"f",value:.175},effectAlpha:{type:"f",value:1},randomUV:{type:"v2",value:new THREE.Vector2},timep:{type:"f",value:0},ratio:{type:"v2",value:new THREE.Vector2(d/e,1)},offset:{type:"v2",value:new THREE.Vector2(1.33/d*this.DRAWING_EFFECT_SIZE,1.33/e*this.DRAWING_EFFECT_SIZE)}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});break;default:b=b||AssetsController.getInstance().getFile("shaders/lanme/"+a);c=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertex.vert"),fragmentShader:b,attributes:{},uniforms:{tDiffuse:{type:"t",value:null},tDrawing:{type:"t",value:null},center:{type:"v2",value:new THREE.Vector2(.5,.5)},drawingSize:{type:"f",value:.175},effectAlpha:{type:"f",value:1},randomUV:{type:"v2",value:new THREE.Vector2},timep:{type:"f",value:0},ratio:{type:"v2",value:new THREE.Vector2(d/e,1)},offset:{type:"v2",value:new THREE.Vector2(1.33/d*this.DRAWING_EFFECT_SIZE,1.33/e*this.DRAWING_EFFECT_SIZE)}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});break}return c}}});var VideoGridSequence=Sequence._extend({_public:{LOADED_MESH_SCALE_BASE:new THREE.Vector3(2,2,0),LOADED_MESH_OFFSET_BASE:new THREE.Vector3(-1,-1,0),LOADED_MESH_SCALE:new THREE.Vector3(2,2,0),LOADED_MESH_OFFSET:new THREE.Vector3(-1,-1,0),trackingPointsSource:null,trackingPoints:null,centerX:null,centerY:null,gridPoints:[],gridPointsByTrackingId:{},centerPoint:null,CENTER_POINT_ID:21,center:new THREE.Vector3,activePoints:[],sortedGridPoints:[],lastLineUpdate:0,lineUpdateSpeed:0,currentLineId:0,lastLineId:0,fadeSpeed:0,lineGeometry:null,line:null,lineGeometryUnder:null,lineUnder:null,lineCount:120,pointGeom:null,linesBlurMaterialA:null,linesBlurMaterialB:null,finalCompositionMaterial:null,linesFbo:null,linesBlurFboA:null,linesBlurFboPing:null,linesBlurFboPong:null,finalCompositionFbo:null,lineFboBlurIsPing:true,stars:[],starTextureSmall:[],starTextureLarge:[],starTextureSmallNames:["media/images/videogrid/dot_glow_S_0.png","media/images/videogrid/dot_glow_S_1.png","media/images/videogrid/dot_glow_S_2.png","media/images/videogrid/dot_glow_S_3.png","media/images/videogrid/dot_glow_S_4.png","media/images/videogrid/dot_glow_S_5.png"],starTextureLargeNames:["media/images/videogrid/dot_glow_L_0.png","media/images/videogrid/dot_glow_L_1.png","media/images/videogrid/dot_glow_L_2.png","media/images/videogrid/dot_glow_L_3.png","media/images/videogrid/dot_glow_L_4.png","media/images/videogrid/dot_glow_L_5.png"],starsFbo:null,construct:function(a,b,c,d,e){Sequence.call(this,a,b,c,d,e)},init:function(){if(this.wasInitialised)return;Sequence.prototype.init.call(this);console.log("init videogrid");var a=this.videoTexture.width,b=this.videoTexture.height,c=RendererController.getInstance().getRenderer();this.trackingPointsSource=AssetsController.getInstance().getFile("media/tracking/videogrid.json");this.trackingPoints=this.trackingPointsSource.tracks;this.centerX=this.trackingPointsSource.centerX;this.centerY=this.trackingPointsSource.centerY;for(var d=0;d<this.trackingPoints.length;d++){this.gridPoints[d]=new GridPoint(this.trackingPoints[d],d);this.gridPoints[d].frameOffset=-0;this.gridPointsByTrackingId[this.gridPoints[d].trackingId]=this.gridPoints[d]}this.centerPoint=this.gridPointsByTrackingId[this.CENTER_POINT_ID];var e=new THREE.OrthographicCamera(-1,1,-1,1,-1e3,1e3);e.position.set(0,0,1);e.lookAt(new THREE.Vector3);this.lineGeometry=new THREE.Geometry;for(var d=0;d<this.lineCount*2;d++){this.lineGeometry.vertices[d]=new THREE.Vector3(0,0,0);this.lineGeometry.colors[d]=new THREE.Color(16777215);this.lineGeometry.vertices[d].meshScale=(new THREE.Vector3).copy(this.LOADED_MESH_SCALE_BASE);this.lineGeometry.vertices[d].meshOffset=(new THREE.Vector3).copy(this.LOADED_MESH_OFFSET_BASE);this.lineGeometry.vertices[d].shakeOffset=new THREE.Vector3}this.line=new THREE.Line(this.lineGeometry,new THREE.LineBasicMaterial({color:16777215,linewidth:1,transparent:true,opacity:4,blending:THREE.AdditiveBlending,linecap:"round",linejoin:"round",vertexColors:THREE.VertexColors,fog:false}),THREE.LinePieces);this.lineGeometryUnder=new THREE.Geometry;for(var d=0;d<this.lineCount*10;d++){this.lineGeometryUnder.vertices[d]=new THREE.Vector3(0,0,0);this.lineGeometryUnder.colors[d]=new THREE.Color(0)}this.lineUnder=new THREE.Line(this.lineGeometryUnder,new THREE.LineBasicMaterial({color:16777215,linewidth:1,transparent:true,opacity:1,blending:THREE.AdditiveBlending,linecap:"round",linejoin:"round",vertexColors:THREE.VertexColors,fog:false}),THREE.LinePieces);this.linesBlurMaterialA=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/videogrid/blur.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/videogrid/blur.frag"),attributes:{},uniforms:{tDiffuse:{type:"t",value:null},offset:{type:"v2",value:new THREE.Vector2(2/a,2/b)},blurFactor:{type:"f",value:2}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.linesBlurMaterialB=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/videogrid/blur.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/videogrid/blur.frag"),attributes:{},uniforms:{tDiffuse:{type:"t",value:null},tAccum:{type:"t",value:null},accumpc:{type:"f",value:.995},offset:{type:"v2",value:new THREE.Vector2(3.33/512,3.33/512)},blurFactor:{type:"f",value:2}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.finalCompositionMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/videogrid/neonLinesNoise.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/videogrid/neonLinesNoise.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:null},tLines:{type:"t",value:null},tBlurA:{type:"t",value:null},tBlurB:{type:"t",value:null},neonColor:{type:"v4",value:new THREE.Vector4(1,1,1,1)},noiseuv:{type:"v2",value:new THREE.Vector2(Math.random(),Math.random())},fade:{type:"f",value:1}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.linesFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,camera:e,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:true,generateMipmaps:false,renderer:c});this.linesBlurFboA=new FramebufferWrapper(512,512,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.linesBlurMaterialA,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.linesBlurFboPing=new FramebufferWrapper(256,256,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.linesBlurMaterialB,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.linesBlurFboPong=new FramebufferWrapper(a/4,b/4,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.linesBlurMaterialB,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.finalCompositionFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.finalCompositionMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.linesBlurMaterialA.uniforms.tDiffuse.value=this.linesFbo.texture;this.linesBlurMaterialB.uniforms.tDiffuse.value=this.linesBlurFboA.texture;this.finalCompositionMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.finalCompositionMaterial.uniforms.tLines.value=this.linesFbo.texture;this.finalCompositionMaterial.uniforms.tBlurA.value=this.linesBlurFboA.texture;this.finalCompositionMaterial.uniforms.tBlurB.value=this.linesBlurFboPing.texture;this.linesFbo.scene.add(this.line);this.linesFbo.scene.add(this.lineUnder)},begin:function(){Sequence.prototype.begin.call(this);console.log("begin videogrid");this.linesFbo.alloc();this.linesBlurFboA.alloc();this.linesBlurFboPing.alloc();this.linesBlurFboPong.alloc();this.finalCompositionFbo.alloc();this.finalCompositionMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.linesBlurMaterialA.uniforms.tDiffuse.value=this.linesFbo.texture;this.linesBlurMaterialB.uniforms.tDiffuse.value=this.linesBlurFboA.texture;this.finalCompositionMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.finalCompositionMaterial.uniforms.tLines.value=this.linesFbo.texture;this.finalCompositionMaterial.uniforms.tBlurA.value=this.linesBlurFboA.texture;this.finalCompositionMaterial.uniforms.tBlurB.value=this.linesBlurFboPing.texture},end:function(){Sequence.prototype.end.call(this);this.linesFbo.dispose();this.linesBlurFboA.dispose();this.linesBlurFboPing.dispose();this.linesBlurFboPong.dispose();this.finalCompositionFbo.dispose()},changeVideoQuality:function(a,b){this.finalCompositionMaterial.uniforms.tVideo.value=this.videoTexture.texture},changeRenderQuality:function(a,b){var c=RendererController.getInstance().getRenderer();this.renderWidth=a;this.renderHeight=b;this.linesFbo.resizeTexture(this.renderWidth,this.renderHeight);this.linesBlurFboA.resizeTexture(this.renderWidth*.4,this.renderHeight*.4);this.linesBlurFboPing.resizeTextureAndCopy(this.renderWidth*.2,this.renderHeight*.2);this.linesBlurFboPong.resizeTextureAndCopy(this.renderWidth*.25,this.renderHeight*.25);if(this.renderWidth>=640)this.finalCompositionFbo.resizeTexture(this.renderWidth,this.renderHeight);else this.finalCompositionFbo.resizeTexture(640,336);var d=new THREE.OrthographicCamera(-1,1,-1,1,-1e3,1e3);d.position.set(0,0,1);d.lookAt(new THREE.Vector3);this.linesBlurMaterialA.uniforms.tDiffuse.value=this.linesFbo.texture;this.linesBlurMaterialB.uniforms.tDiffuse.value=this.linesBlurFboA.texture;this.finalCompositionMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.finalCompositionMaterial.uniforms.tLines.value=this.linesFbo.texture;this.finalCompositionMaterial.uniforms.tBlurA.value=this.linesBlurFboA.texture;this.finalCompositionMaterial.uniforms.tBlurB.value=this.linesBlurFboPing.texture;this.line.parent.remove(this.line);this.linesFbo.scene.add(this.line);this.lineUnder.parent.remove(this.lineUnder);this.linesFbo.scene.add(this.lineUnder);this.linesBlurMaterialA.uniforms.offset.value.set(2/this.renderWidth,2/this.renderHeight);this.linesBlurMaterialB.uniforms.offset.value.set(3/this.renderWidth*.4,3/this.renderHeight*.4)}},_protected:{update:function(a,b,c,d,e,f,g){var h=InputController.getInstance().getPositionDirectional();currentFrame=b;currentFrame+=TimelineController.getInstance().initialised?51:50;if(!InputController.getInstance().isMouseVersion())h.multiply(new THREE.Vector3(1.8,2,1));this.LOADED_MESH_SCALE.x=this.LOADED_MESH_SCALE.y=a.followSize*2;this.LOADED_MESH_OFFSET.x=this.LOADED_MESH_OFFSET.y=-a.followSize;this.finalCompositionMaterial.uniforms.noiseuv.value.set(Math.random(),Math.random());this.finalCompositionMaterial.uniforms.fade.value=1-a.fade;this.line.material.linewidth=a.lineWidth*(this.renderWidth/1280);this.lineUnder.material.linewidth=a.lineWidth*(this.renderWidth/1280);this.fadeSpeed=this.cmap(1-h.z,.1,.9,a.fadeSpeedNear,a.fadeSpeedFar);this.center=this.centerPoint.getPosition(currentFrame,this.LOADED_MESH_SCALE_BASE,this.LOADED_MESH_OFFSET_BASE);this.activePoints=[];this.sortedGridPoints=[];var i=(new THREE.Matrix4).makeTranslation(-this.center.x,-this.center.y,0);var j=(new THREE.Matrix4).makeScale(a.followSize,a.followSize,a.followSize);var k=(new THREE.Matrix4).makeTranslation(this.center.x,this.center.y,0);var l=i.multiply(j).multiply(k);for(var m=0;m<this.gridPoints.length;m++){if(this.gridPoints[m].isActive(currentFrame)){this.sortedGridPoints.push(this.gridPoints[m]);this.activePoints.push(this.gridPoints[m]);var n=new THREE.Vector3;n.copy(this.gridPoints[m].getPosition(currentFrame,this.LOADED_MESH_SCALE_BASE,this.LOADED_MESH_OFFSET_BASE));this.gridPoints[m].lastBaseVertice.copy(this.gridPoints[m].latestBaseVertice);this.gridPoints[m].latestBaseVertice.copy(n);n.applyMatrix4(l);var o=this.gridPoints[m].trackingPoint.positions[currentFrame].x;var p=this.gridPoints[m].trackingPoint.positions[currentFrame].y;n.x=n.x-(n.x-(o*this.LOADED_MESH_SCALE.x+this.LOADED_MESH_OFFSET.x))*a.scaleFromCenter;n.y=n.y-(n.y-(-p*this.LOADED_MESH_SCALE.y-this.LOADED_MESH_OFFSET.y))*a.scaleFromCenter;this.gridPoints[m].lastVertice.copy(this.gridPoints[m].latestVertice);this.gridPoints[m].latestVertice.copy(n)}}this.updateLines(h,a,currentFrame);var q=0;for(var m=0;m<this.gridPoints.length;m++){this.gridPoints[m].currentMotion.set(0,0,0);if(a.showPoints&&q<this.pointGeom.vertices.length&&this.gridPoints[m].isActive(currentFrame)){q++}}this.lineGeometry.verticesNeedUpdate=true},render:function(){RendererController.getInstance().getRenderer().setClearColor(new THREE.Color(0));RendererController.getInstance().getRenderer().clear();this.linesFbo.render();this.linesBlurFboA.render();var a=this.lineFboBlurIsPing?this.linesBlurFboPing:this.linesBlurFboPong;var b=this.lineFboBlurIsPing?this.linesBlurFboPong:this.linesBlurFboPing;this.lineFboBlurIsPing=!this.lineFboBlurIsPing;this.linesBlurMaterialB.uniforms.tAccum.value=b.texture;this.finalCompositionMaterial.uniforms.tBlurB.value=a.texture;a.render();this.finalCompositionFbo.render();RendererController.getInstance().renderToScreen(this.finalCompositionFbo.texture,false,true)}},_private:{updateLines:function(a,b,c){var d=0;if(Date.now()-this.lastLineUpdate>this.lineUpdateSpeed){this.lastLineUpdate=Date.now();var e=this.lineGeometry.vertices.shift();var f=this.lineGeometry.vertices.shift();this.lineGeometry.vertices.push(e);this.lineGeometry.vertices.push(f);e.set(a.x,a.y,0);f.copy(e);e.active=true;e.near=false;f.near=false;e.point=null;f.point=null;e.startTime=Date.now();e.pointconn=[];e.point=this.getNearestPoint(e,false,0);this.lastLineId=this.currentLineId;this.currentLineId++;if(this.currentLineId>=this.lineCount)this.currentLineId=1}var g=0;var h=b.numConnectionsFar+(1-a.z)*(b.numConnectionsNear-b.numConnectionsFar);for(var i=0;i<this.lineGeometry.vertices.length/2;i++){var e=this.lineGeometry.vertices[i*2];var f=i>0?this.lineGeometry.vertices[i*2-1]:null;if(!e.point||!e.point.isActive(c)){e.point=this.getNearestPoint(e,e.near,0)}if(e.point){if(e.near)e.add(e.point.getMotionCenteredBase());else e.add(e.point.getMotionCentered())}if(f)f.copy(e);if(e.active){var j=1-Math.min((Date.now()-e.startTime)/this.fadeSpeed,1);if(j<=0){e.active=false}this.lineGeometry.colors[i*2].setRGB(j,j,j);if(f)this.lineGeometry.colors[i*2-1].setRGB(j,j,j);var k=j*b.snapWidth;for(var l=0;l<h;l++){if(!e.pointconn[l]||!e.pointconn[l].isActive(c)){e.pointconn[l]=this.getNearestPoint(e,e.near,l)}if(e.pointconn[l]){this.lineGeometryUnder.vertices[g*2].copy(e);this.lineGeometryUnder.vertices[g*2+1].copy(e.pointconn[l].latestBaseVertice);this.lineGeometryUnder.colors[g*2].setRGB(k,k,k);this.lineGeometryUnder.colors[g*2+1].setRGB(k,k,k);e.pointconn[l].fs=k;g++}}}else{this.lineGeometry.colors[i*2].setRGB(0,0,0);if(f)this.lineGeometry.colors[i*2-1].setRGB(0,0,0)}}for(var i=g*2;i<this.lineGeometryUnder.vertices.length;i++){this.lineGeometryUnder.colors[i].setRGB(0,0,0)}this.lineGeometryUnder.verticesNeedUpdate=true;this.lineGeometryUnder.colorsNeedUpdate=true;this.lineGeometry.verticesNeedUpdate=true;this.lineGeometry.colorsNeedUpdate=true},getNearestPoint:function(a,b,c){var d=c||0;if(b){for(var e=0;e<this.activePoints.length;e++){this.activePoints[e].currentMouseDistance=this.activePoints[e].latestBaseVertice.distanceTo(a)}}else{for(var e=0;e<this.activePoints.length;e++){this.activePoints[e].currentMouseDistance=this.activePoints[e].latestVertice.distanceTo(a)}}this.activePoints.sort(this.sortPoints);return this.activePoints[d]},sortPoints:function(a,b){if(a.currentMouseDistance===b.currentMouseDistance)return 0;return a.currentMouseDistance>b.currentMouseDistance?1:-1},cmap:function(a,b,c,d,e){return Math.max(Math.min(d+(e-d)*((a-b)/(c-b)),e),d)}}});function GridPoint(a,b){var c=new THREE.Vector3(1,-1,1);this.id=b;this.trackingId=a.id;this.frameOffset=0;this.trackingPoint=a;this.lastVertice=new THREE.Vector3;this.lastBaseVertice=new THREE.Vector3;this.latestBaseVertice=new THREE.Vector3;this.latestVertice=new THREE.Vector3;this.vertice=new THREE.Vector3;this.currentMotion=new THREE.Vector3;this.currentMotionB=new THREE.Vector3;this.numConnectedVertices=0;this.connectedVerticesIds=[];this.isNear=false;this.isFollowed=false;this.currentMouseDistance=0;this.connectedVerticesDistance=[];this.colorSourceByConnectedPoint={};this.colorTargetByConnectedPoint={};this.vertexSourceByConnectedPoint={};this.vertexTargetByConnectedPoint={};this.isActive=function(a){var b=a+this.frameOffset;return this.trackingPoint.startFrame<=b&&this.trackingPoint.endFrame>=b&&this.trackingPoint.positions[b]};this.getPositionFromCenter=function(a,b,d,e,f,g,h){this.vertice.set(this.trackingPoint.positions[a].x,this.trackingPoint.positions[a].y,0).multiply(b).add(d).multiply(c);this.vertice.applyMatrix4((new THREE.Matrix4).makeTranslation(-g.x,-g.y,0));this.vertice.applyMatrix4((new THREE.Matrix4).makeScale(options.followSize,options.followSize,1));this.vertice.applyMatrix4((new THREE.Matrix4).makeTranslation(g.x,g.y,0));return this.vertice};this.getMotionCentered=function(){return this.latestVertice.clone().sub(this.lastVertice)};this.getMotionCenteredBase=function(){return this.latestBaseVertice.clone().sub(this.lastBaseVertice)};this.getPosition=function(a,b,d){var e=a+this.frameOffset;if(!this.trackingPoint.positions[e])return this.vertice;this.vertice.set(this.trackingPoint.positions[e].x,this.trackingPoint.positions[e].y,0).multiply(b).add(d).multiply(c);return this.vertice};this.getMotion=function(a,b,d,e,f,g){var h=a+this.frameOffset;var i=e+this.frameOffset;if(!this.trackingPoint.positions[h]||!this.trackingPoint.positions[i])return this.currentMotion.set(0,0,0);this.currentMotion.set(this.trackingPoint.positions[h].x,this.trackingPoint.positions[h].y,0).multiply(b).add(d).multiply(c);this.currentMotionB.set(this.trackingPoint.positions[i].x,this.trackingPoint.positions[i].y,0).multiply(f).add(g).multiply(c);return this.currentMotionB.sub(this.currentMotion)};this.getConnectionIds=function(a){var b=a+this.frameOffset;if(!this.trackingPoint.connections||!this.trackingPoint.connections[b])return[];return this.trackingPoint.connections[b]}}var FeedbackSequence=Sequence._extend({_public:{MAX_TEXTURES:35,NUM_PLANES:-1,PLANE_DEPTH:-800,PLANE_OFFSET:-2,sceneFbo:null,scene:null,camera:null,isBlackAndWhite:false,blackAndWhiteMaterial:null,colorMaterial:null,allPlanes:[],allTextures:[],currentFrameSkip:0,useAccumulation:false,accumMaterial:null,accumFboPing:null,accumFboPong:null,accumIsPing:false,construct:function(a,b,c,d,e){Sequence.call(this,a,b,c,d,e)},init:function(){if(this.wasInitialised)return;Sequence.prototype.init.call(this);console.log("initializing feedback");var a=this.videoTexture.width,b=this.videoTexture.height,c=RendererController.getInstance().getRenderer();this.scene=new THREE.Scene;this.camera=new THREE.OrthographicCamera(-1,1,1,-1,-10,10);var d=new THREE.PerspectiveCamera(55,a/b,1,1e4);d.position.set(0,0,1);d.lookAt(new THREE.Vector3);this.sceneFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,type:THREE.UnsignedByteType,camera:d,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.blackAndWhiteMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertexinv.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/feedback/blackAndWhite.frag"),attributes:{},uniforms:{tDiffuse:{type:"t",value:this.videoTexture.texture},tColor:{type:"c",value:new THREE.Color(16777215)}},side:THREE.DoubleSide});this.colorMaterial=new THREE.MeshBasicMaterial({color:16777215,map:this.videoTexture.texture,opacity:.5,side:THREE.DoubleSide});for(var e=0;e<this.MAX_TEXTURES;e++){var f=this.blackAndWhiteMaterial;var g=e%3==0?.25:e%2==0?1:.5;this.allTextures[e]=new FramebufferWrapper(a*g,b*g,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,type:THREE.UnsignedByteType,renderMaterial:f,usePerspectiveCamera:false,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.allTextures[e].wsize=g;this.allTextures[e].bwMaterial=f;this.allTextures[e].colorMaterial=this.colorMaterial.clone();this.allTextures[e].renderPlane.material=this.allTextures[e].colorMaterial;this.allTextures[e].currentFrame=e}this.accumMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertex.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/feedback/linesBlurAccumulation.frag"),attributes:{},uniforms:{videoTexture:{type:"t",value:this.sceneFbo.texture},texture:{type:"t",value:null},offset:{type:"v2",value:new THREE.Vector2(1/a,1/b)},blurA:{type:"f",value:.25},blurB:{type:"f",value:.25},blurC:{type:"f",value:.25},blurD:{type:"f",value:.25},off:{type:"f",value:-8/255}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.BackSide});this.accumFboPing=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.accumMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.accumFboPong=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.accumMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c})},begin:function(){Sequence.prototype.begin.call(this);console.log("begin feedback");for(var a=0;a<this.allTextures.length;a++){this.allTextures[a].alloc()}this.sceneFbo.alloc();this.accumFboPing.alloc();this.accumFboPong.alloc();this.accumMaterial.uniforms.videoTexture.value=this.sceneFbo.texture},end:function(){Sequence.prototype.end.call(this);for(var a=0;a<this.allTextures.length;a++){this.allTextures[a].dispose()}this.sceneFbo.dispose();this.accumMaterial.uniforms.videoTexture.value=this.sceneFbo.texture;this.accumFboPing.dispose();this.accumFboPong.dispose()},changeVideoQuality:function(a,b){for(var c=0;c<this.allTextures.length;c++){this.allTextures[c].bwMaterial.map=this.videoTexture.texture;this.allTextures[c].colorMaterial.map=this.videoTexture.texture;this.allTextures[c].resizeTextureAndCopy(a*this.allTextures[c].wsize,b*this.allTextures[c].wsize)}},changeRenderQuality:function(a,b){var c=RendererController.getInstance().getRenderer();this.renderWidth=a;this.renderHeight=b;this.sceneFbo.resizeTexture(a,b);this.accumMaterial.uniforms.videoTexture.value=this.sceneFbo.texture;this.accumMaterial.uniforms.offset.value.set(1/a,1/b);this.accumFboPing.resizeTextureAndCopy(a,b);this.accumFboPong.resizeTextureAndCopy(a,b)}},_protected:{update:function(a,b,c,d,e,f,g){var h=InputController.getInstance().getPositionDirectional(),i=this.videoTexture.width,j=this.videoTexture.height;if(this.isBlackAndWhite!==a.blackAndWhite){this.isBlackAndWhite=a.blackAndWhite;if(this.isBlackAndWhite){for(var k=0;k<this.allTextures.length;k++){this.allTextures[k].setRenderMaterial(this.allTextures[k].bwMaterial)}}else{for(var k=0;k<this.allTextures.length;k++){this.allTextures[k].setRenderMaterial(this.allTextures[k].colorMaterial)}}}if(this.allPlanes.length!==this.NUM_PLANES||this.NUM_PLANES!=parseInt(a.numberOfPlanes)){this.NUM_PLANES=parseInt(a.numberOfPlanes);for(var k=0;k<this.NUM_PLANES;k++){this.sceneFbo.scene.remove(this.allPlanes[k])}this.allPlanes=[];var l=new THREE.PlaneGeometry(1280,672,1,1);l.applyMatrix((new THREE.Matrix4).makeScale(1,-1,1));var m,n;for(var k=0;k<this.NUM_PLANES;k++){m=new THREE.Mesh(l,new THREE.MeshBasicMaterial({blending:THREE.AdditiveBlending,transparent:true,color:new THREE.Color(16777215),side:THREE.DoubleSide}));m.position.z=this.PLANE_DEPTH;this.sceneFbo.scene.add(m);m.quaternion=new THREE.Quaternion;this.allPlanes[k]=m;this.allPlanes[k].scale.set(a.scaleFar,a.scaleFar,a.scaleFar)}}if(this.videoTexture.wasUpdatedThisframe){var o=this.allTextures.pop();this.allTextures.unshift(o)}for(var k=0;k<this.allPlanes.length;k++){this.allPlanes[k].material.map=this.allTextures[Math.round(this.MAX_TEXTURES/this.NUM_PLANES*k)].texture;if(!a.colors||a.colors==="none"){this.allPlanes[k].material.color.setHex(16777215)}else if(a.colors&&a.colors==="blue/green"){this.allPlanes[k].material.color.setRGB(0,k/this.NUM_PLANES,(this.NUM_PLANES-k)/this.NUM_PLANES)}else if(a.colors&&a.colors==="hsv"){this.allPlanes[k].material.color.setHSV(k/this.NUM_PLANES,1,1)}this.allPlanes[k].material.color.r*=1-a.fade;this.allPlanes[k].material.color.g*=1-a.fade;this.allPlanes[k].material.color.b*=1-a.fade}var p=(new THREE.Vector3).setEulerFromQuaternion(g);for(var k=0;k<this.allPlanes.length;k++){this.allPlanes[k].useQuaternion=a.useRotation}for(var k=0;k<this.allPlanes.length-1;k++){this.allPlanes[k].position.lerp(this.allPlanes[k+1].position,.15*c);this.allPlanes[k].quaternion.slerp(this.allPlanes[k+1].quaternion,.1*c);this.allPlanes[k].scale.lerp(this.allPlanes[k+1].scale,.2*c)}this.allPlanes[this.allPlanes.length-1].position.lerp(new THREE.Vector3(h.x*i/2,-h.y*j/2,this.PLANE_DEPTH),.07*c);var q=a.scaleFar+(a.scaleNear-a.scaleFar)*(1-h.z);this.allPlanes[this.allPlanes.length-1].scale.lerp(new THREE.Vector3(q,q,q),.4*c);this.allPlanes[k].quaternion.slerp(g,.1*c);this.useAccumulation=a.useAccumulation;this.accumMaterial.uniforms.offset.value.set(a.blurOffset/i,a.blurOffset/j);this.accumMaterial.uniforms.off.value=-7/255*c},render:function(){RendererController.getInstance().getRenderer().setClearColor(new THREE.Color(0));RendererController.getInstance().getRenderer().clear();if(this.videoTexture.wasUpdatedThisframe){this.allTextures[0].render()}this.sceneFbo.render();if(!this.useAccumulation){RendererController.getInstance().renderToScreen(this.sceneFbo.texture,false,true)}else{var a=this.accumIsPing?this.accumFboPing:this.accumFboPong;var b=this.accumIsPing?this.accumFboPong:this.accumFboPing;this.accumMaterial.uniforms.texture.value=b.texture;a.render();RendererController.getInstance().renderToScreen(this.ping.texture,false,false);this.accumIsPing=!this.accumIsPing}}}});var ZombiesSequence=Sequence._extend({_public:{LOADED_MESH_SCALE_BASE:new THREE.Vector3(1280,672,1),LOADED_MESH_OFFSET_BASE:new THREE.Vector3(-1280/2,-672/2,0),LOADED_MESH_SCALE:new THREE.Vector3(2,2,0),LOADED_MESH_OFFSET:new THREE.Vector3(-1,-1,0),LOADED_MESH_FLIP:new THREE.Vector3(1,-1,1),REFLEKTOR_BURST_TIME:280,REFLEKTOR_BURST_TIME_END:292,NUM_LINES_BURST:150,gridPointsAxelle:[],gridPointsZombies:[],gridPointsById:[],trackingPointsSourceZombies:[],trackingPointsSourceAxelle:[],trackingPointsZombies:[],trackingPointsAxelle:[],trianglesAxelle:[],trianglesZombies:[],verticesAxelle:[],centerX:[],centerY:[],perlin:null,numZombiePoints:200,zombiesCloudGeom:null,zombiesCloudMesh:null,numAxellePoints:100,axelleCloudGeom:null,axelleCloudMesh:null,maxBeams:100,axelleBeams:[],beamTexture:null,beamTipTexture:null,beamTipPlane:null,zombieFlareMode:true,zombieTransferMode:false,maxZombieFlares:100,zombieFlareTexture:null,zombieFlarePlanes:[],maxTrailBeams:30,trailBeams:[],trailBeamsTexture:null,windowCamera:null,linesFbo:null,linesFbo2:null,linesFbo3:null,beamWidthA:10,beamWidthB:50,beamWidthC:100,linesBlurMaterial:null,lightMaterial:null,lightFboPing:null,lightFboPong:null,lightFboIsPing:false,finalCompositionMaterial:null,finalCompositionFbo:null,finalPhonePosition:new THREE.Vector3(0,0,.5),nearScale:1,starTextureSmall:[],starTextureLarge:[],starTextureSmallNames:["media/images/videogrid/dot_glow_S_0.png","media/images/videogrid/dot_glow_S_1.png","media/images/videogrid/dot_glow_S_2.png","media/images/videogrid/dot_glow_S_3.png","media/images/videogrid/dot_glow_S_4.png","media/images/videogrid/dot_glow_S_5.png"],starTextureLargeNames:["media/images/videogrid/dot_glow_L_0.png","media/images/videogrid/dot_glow_L_1.png","media/images/videogrid/dot_glow_L_2.png","media/images/videogrid/dot_glow_L_3.png","media/images/videogrid/dot_glow_L_4.png","media/images/videogrid/dot_glow_L_5.png"],construct:function(a,b,c,d,e){Sequence.call(this,a,b,c,d,e)},init:function(){if(this.wasInitialised)return;Sequence.prototype.init.call(this);console.log("init zombies");var a=1280,b=672,c=RendererController.getInstance().getRenderer();this.perlin=new SimplexNoise(Math);this.windowCamera=new THREE.PerspectiveCamera(45,a/b,.001,1e5);this.windowCamera.position.z=this.getCameraZ(this.windowCamera,b);this.trackingPointsSourceZombies=AssetsController.getInstance().getFile("media/tracking/zombies_final.json");this.trackingPointsSourceAxelle=AssetsController.getInstance().getFile("media/tracking/axelle_final.json");this.trackingPointsZombies=this.trackingPointsSourceZombies.tracks;this.trackingPointsAxelle=this.trackingPointsSourceAxelle.tracks;this.trianglesAxelle=this.trackingPointsSourceAxelle.triangles;this.trianglesZombies=this.trackingPointsSourceZombies.triangles;this.verticesAxelle=this.trackingPointsSourceAxelle.vertices;this.centerX=this.trackingPointsSourceAxelle.centerX;this.centerY=this.trackingPointsSourceAxelle.centerY;for(var d=0;d<this.trackingPointsAxelle.length;d++){this.gridPointsAxelle[d]=new GridPoint(this.trackingPointsAxelle[d],d);this.gridPointsAxelle[d].frameOffset=-0;this.gridPointsById[this.gridPointsAxelle[d].trackingId]=this.gridPointsAxelle[d]}for(var d=0;d<this.trackingPointsZombies.length;d++){this.gridPointsZombies[d]=new GridPoint(this.trackingPointsZombies[d],d)}for(var d=0;d<this.starTextureSmallNames.length;d++){this.starTextureSmall[d]=AssetsController.getInstance().getFile(this.starTextureSmallNames[d]);this.starTextureSmall[d].generateMipmaps=true}for(var d=0;d<this.starTextureLargeNames.length;d++){this.starTextureLarge[d]=AssetsController.getInstance().getFile(this.starTextureLargeNames[d]);this.starTextureLarge[d].generateMipmaps=true}this.linesFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,camera:this.windowCamera,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.linesFbo2=new FramebufferWrapper(a/2,b/2,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,scene:this.linesFbo.scene,camera:this.windowCamera,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.linesFbo3=new FramebufferWrapper(a/4,b/4,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,scene:this.linesFbo.scene,camera:this.windowCamera,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});
this.zombieFlareTexture=AssetsController.getInstance().getFile("media/images/zombies/axelle_light_0.png");for(var d=0;d<this.maxZombieFlares;d++){var e=new THREE.PlaneGeometry(1,1,1,1);this.zombieFlarePlanes[d]=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:16777215,map:this.starTextureSmall[0],opacity:1,transparent:true,side:THREE.DoubleSide}));this.zombieFlarePlanes[d].isFollowing=false}this.finalCompositionMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertexinv.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/zombies/linesCompositeNoise.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.videoTexture.texture},tLines:{type:"t",value:this.linesFbo.texture},tLinesBlur:{type:"t",value:this.linesFbo2.texture},tLinesBlur2:{type:"t",value:this.linesFbo3.texture},center:{type:"v2",value:new THREE.Vector2(.5,.5)},randomUV:{type:"v2",value:new THREE.Vector2(Math.random(),Math.random())},blurDistance:{type:"f",value:.35},blurDistance2:{type:"f",value:.15}},depthTest:false,transparent:true,blending:THREE.AdditiveBlending,side:THREE.DoubleSide});this.finalCompositionFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.finalCompositionMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.beamTexture=AssetsController.getInstance().getFile("media/images/zombies/axelle_light_beam_6.png");this.beamTipTexture=AssetsController.getInstance().getFile("media/images/zombies/axelle_light_0.png");this.beamTipPlane=new THREE.Mesh(new THREE.PlaneGeometry(1,1,1,1),new THREE.MeshBasicMaterial({map:this.beamTipTexture,color:16777215,transparent:true,opacity:.5}));this.linesFbo.scene.add(this.beamTipPlane);for(var d=0;d<this.maxBeams;d++){var f=new THREE.PlaneGeometry(1,1.04,1,4);f.applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));this.axelleBeams[d]=new THREE.Mesh(f,new THREE.MeshBasicMaterial({color:16777215,map:this.beamTexture,opacity:1,transparent:true}));this.axelleBeams[d].isFollowed=false}},begin:function(){Sequence.prototype.begin.call(this);console.log("begin zombies");this.linesFbo.alloc();this.linesFbo2.alloc();this.linesFbo3.alloc();this.finalCompositionFbo.alloc();this.finalCompositionMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.finalCompositionMaterial.uniforms.tLines.value=this.linesFbo.texture;this.finalCompositionMaterial.uniforms.tLinesBlur.value=this.linesFbo2.texture;this.finalCompositionMaterial.uniforms.tLinesBlur2.value=this.linesFbo3.texture},end:function(){Sequence.prototype.end.call(this);this.linesFbo.dispose();this.linesFbo2.dispose();this.linesFbo3.dispose();this.finalCompositionFbo.dispose()},changeVideoQuality:function(a,b){this.finalCompositionMaterial.uniforms.tVideo.value=this.videoTexture.texture},changeRenderQuality:function(a,b){this.renderWidth=a;this.renderHeight=b;this.linesFbo.resizeTexture(a,b);this.linesFbo2.resizeTexture(a/2,b/2);this.linesFbo3.resizeTexture(a/4,b/4);this.finalCompositionFbo.resizeTexture(a,b);this.finalCompositionMaterial.uniforms.tLines.value=this.linesFbo.texture;this.finalCompositionMaterial.uniforms.tLinesBlur.value=this.linesFbo2.texture;this.finalCompositionMaterial.uniforms.tLinesBlur2.value=this.linesFbo3.texture}},_protected:{update:function(a,b,c,d,e,f,g){var h=InputController.getInstance().getPositionDirectional().clone(),i=h.distanceTo(this.finalPhonePosition),j=InputController.getInstance().isMouseVersion()?h.clone():this.finalPhonePosition.lerp(h,Math.max(a.smoothingMaxDistance-i,0)*((1-a.smoothingMaxDistance)/a.smoothingMaxDistance)+a.smoothingMaxDistance).clone(),k=this.videoTexture.width,l=this.videoTexture.height;var m=this.cmap(j.z,.1,.9,0,1);this.lastFrame=this.currentFrame;this.currentFrame=b+(TimelineController.getInstance().initialised?2:1);var n=[];for(var o=0;o<this.gridPointsZombies.length;o++){if(this.gridPointsZombies[o].isActive(this.currentFrame)){this.gridPointsZombies[o].isFollowed=false;n.push(this.gridPointsZombies[o])}}var p=[];for(var o=0;o<this.gridPointsAxelle.length;o++){if(this.gridPointsAxelle[o].isActive(this.currentFrame)){p.push(this.gridPointsAxelle[o])}}var q=Math.atan2(j.y,j.x);var r=Math.sqrt(j.x*j.x+j.y*j.y);j.x=this.centerX[this.currentFrame]+Math.cos(q)*r*2;j.y=this.centerY[this.currentFrame]*-.5+0+Math.sin(q)*r*2;if(a.zombieTransfer>0&&a.zombieTransfer<1){this.zombieTransferMode=true}else{this.zombieTransferMode=false}if(a.zombieFlare>0&&a.zombieFlare<=1){this.zombieFlareMode=true}else{this.zombieFlareMode=false}var s=a.numBeams;s+=(50-a.numBeams)*(1-m);s=Math.floor(s);var t=a.randomBeamsConsider;t+=(50-a.randomBeamsConsider)*(1-m);t=Math.floor(t);this.nearScaling=1+(1-m)*a.nearScaling;this.beamWidthA=a.beamWidth*(1280/this.renderWidth);this.beamWidthB=a.beamWidthBlur;this.beamWidthC=a.beamWidthBlur2;this.finalCompositionMaterial.uniforms.center.value.set(j.x*.5+.5,j.y*.5+.5);this.finalCompositionMaterial.uniforms.randomUV.value.set(Math.random(),Math.random());this.finalCompositionMaterial.uniforms.blurDistance.value=a.blurDistance;this.finalCompositionMaterial.uniforms.blurDistance2.value=a.blurDistance2;this.beamTipPlane.position.x=j.x*1280/2;this.beamTipPlane.position.y=j.y*672/2;this.beamTipPlane.position.z=0;this.beamTipPlane.scale.set(a.beamTip,a.beamTip,a.beamTip);this.beamTipPlane.material.opacity=a.beamTipOpacity;var u=new THREE.Vector3(j.x,j.y,0);for(var o=0;o<p.length;o++){p[o].currentMouseDistance=p[o].getPosition(this.currentFrame,this.LOADED_MESH_SCALE,this.LOADED_MESH_OFFSET,this.LOADED_MESH_FLIP).distanceTo(u)}p.sort(this.sortPoints);var v=[];for(var o=0;o<t;o++){if(p[o])v.push(p[o])}for(var o=0;o<this.axelleBeams.length;o++){if(o<s&&!this.axelleBeams[o].parent)this.linesFbo.scene.add(this.axelleBeams[o]);if(o>=s&&this.axelleBeams[o].parent)this.linesFbo.scene.remove(this.axelleBeams[o])}var w,x;if(!this.zombieTransferMode&&!this.zombieFlareMode){for(var o=0;o<s;o++){w=this.axelleBeams[o];if(!w.targetPoint||!w.targetPoint.isActive(this.currentFrame)||w.targetPoint.life>=a.maxBeamLife){if(w.targetPoint){w.targetPoint.isFollowed=false;w.targetPoint.life=0;w.targetPoint=null}v=this.shuffle(v);for(var y=0;y<v.length;y++){if(!v[y].isFollowed){w.targetPoint=v[y];w.targetPoint.isFollowed=true;w.targetPoint.life=0;y=v.length}}}if(w.targetPoint){w.targetPoint.life++;var z=w.targetPoint.getPosition(this.currentFrame,this.LOADED_MESH_SCALE_BASE,this.LOADED_MESH_OFFSET_BASE,this.LOADED_MESH_FLIP).clone();var A=w.targetPoint.getPosition(this.currentFrame,this.LOADED_MESH_SCALE,this.LOADED_MESH_OFFSET,this.LOADED_MESH_FLIP).clone();var B=A.x*1280-u.x*1280;var C=A.y*672-u.y*672;var q=Math.atan2(C,B);w.rotation.z=q+Math.PI/2;w.scale.y=Math.sqrt(B*B+C*C)*.5;w.scale.x=a.beamWidth;w.scale.z=a.beamWidth;w.position.copy(z)}else{this.linesFbo.scene.remove(w)}}for(var o=s;o<this.maxBeams;o++){if(this.axelleBeams[o].targetPoint){this.axelleBeams[o].targetPoint.isFollowed=false;this.axelleBeams[o].targetPoint.life=0;this.axelleBeams[o].targetPoint=null}}}if(this.zombieTransferMode){this.beamTipPlane.material.opacity=a.beamTipOpacity*Math.pow(a.zombieTransfer,6);for(var o=0;o<p.length;o++){p[o].isFollowed=false}var D=Math.floor(Math.pow(a.zombieTransfer,3)*(this.axelleBeams.length-1)+1);for(var o=0;o<D;o++){w=this.axelleBeams[o];var E=n[Math.floor(Math.random()*n.length)];var z=E.getPosition(this.currentFrame,this.LOADED_MESH_SCALE_BASE,this.LOADED_MESH_OFFSET_BASE,this.LOADED_MESH_FLIP).clone();var A=E.getPosition(this.currentFrame,this.LOADED_MESH_SCALE,this.LOADED_MESH_OFFSET,this.LOADED_MESH_FLIP).clone();if(Math.random()<Math.pow(Math.max(a.zombieTransfer-.5,0)*2,10)){A.copy(u);z.copy(A);z.x*=1280*.5;z.y*=672*.5}for(var y=0;y<p.length;y++){p[y].currentMouseDistance=p[y].getPosition(this.currentFrame,this.LOADED_MESH_SCALE,this.LOADED_MESH_OFFSET,this.LOADED_MESH_FLIP).distanceTo(A)}p.sort(this.sortPoints);var F=p[Math.floor(Math.random()*t)];if(F&&z){var x=F.getPosition(this.currentFrame,this.LOADED_MESH_SCALE,this.LOADED_MESH_OFFSET,this.LOADED_MESH_FLIP).clone();E.isFollowed=true;var B=A.x*1280-x.x*1280;var C=A.y*672-x.y*672;var q=Math.atan2(C,B);w.rotation.z=q+Math.PI/2;w.scale.y=Math.sqrt(B*B+C*C)*.5;w.scale.x=a.beamWidth;w.scale.z=a.beamWidth;w.position.copy(z);if(!w.parent)this.linesFbo.scene.add(w)}else{if(w.parent)this.linesFbo.scene.remove(w)}}for(var o=D;o<this.axelleBeams.length;o++){if(this.axelleBeams[o].parent)this.linesFbo.scene.remove(this.axelleBeams[o])}}if(this.zombieFlareMode){var G=u.clone().multiply(new THREE.Vector3(1280,672,1));for(var o=0;o<n.length;o++){n[o].currentMouseDistance=u.distanceTo(n[o].getPosition(this.currentFrame,this.LOADED_MESH_SCALE,this.LOADED_MESH_OFFSET,this.LOADED_MESH_FLIP))}n=n.sort(this.sortPoints);var H=Math.floor(n.length*.75);for(var o=0;o<H;o++){if(this.zombieFlarePlanes[o]&&n[o]){this.zombieFlarePlanes[o].isFollowing=true;if(!this.zombieFlarePlanes[o].parent)this.linesFbo.scene.add(this.zombieFlarePlanes[o]);this.zombieFlarePlanes[o].position.copy(n[o].getPosition(this.currentFrame,this.LOADED_MESH_SCALE_BASE,this.LOADED_MESH_OFFSET_BASE,this.LOADED_MESH_FLIP).clone());var r=Math.pow(1*(1-o/H),1.25);this.zombieFlarePlanes[o].scale.x=this.zombieFlarePlanes[o].scale.y=a.zombieFlareSize*.5+a.zombieFlareSize*r*1;this.zombieFlarePlanes[o].material.map=this.starTextureLarge[Math.floor(Math.random()*this.starTextureLarge.length)];if(Math.random()<.5)this.zombieFlarePlanes[o].material.map=this.starTextureSmall[Math.floor(Math.random()*this.starTextureSmall.length)];this.zombieFlarePlanes[o].material.opacity=Math.random()*a.zombieFlare*r+.8}}for(var o=H;o<this.zombieFlarePlanes.length;o++){if(this.zombieFlarePlanes[o].parent)this.linesFbo.scene.remove(this.zombieFlarePlanes[o])}if(!this.zombieTransferMode){for(var o=0;o<this.maxBeams;o++){if(this.axelleBeams[o].targetPoint){this.axelleBeams[o].targetPoint.isFollowed=false;this.axelleBeams[o].targetPoint.life=0;this.axelleBeams[o].targetPoint=null}if(this.axelleBeams[o].parent){this.linesFbo.scene.remove(this.axelleBeams[o])}}}}else{for(var o=0;o<this.zombieFlarePlanes.length;o++){if(this.zombieFlarePlanes[o].parent)this.linesFbo.scene.remove(this.zombieFlarePlanes[o])}}},render:function(){RendererController.getInstance().getRenderer().setClearColor(new THREE.Color(0));RendererController.getInstance().getRenderer().clear();this.beamTipPlane.scale.multiplyScalar(this.nearScaling);for(var a=0;a<this.axelleBeams.length;a++){this.axelleBeams[a].scale.x=this.axelleBeams[a].scale.z=this.beamWidthA*this.nearScaling}this.linesFbo.render();for(var a=0;a<this.axelleBeams.length;a++){this.axelleBeams[a].scale.x=this.axelleBeams[a].scale.z=this.beamWidthB*this.nearScaling}for(var a=0;a<this.zombieFlarePlanes.length;a++){this.zombieFlarePlanes[a].scale.multiplyScalar(Math.random()*1+.5)}this.beamTipPlane.scale.multiplyScalar(4).multiplyScalar(this.nearScaling);this.linesFbo2.render();for(var a=0;a<this.axelleBeams.length;a++){this.axelleBeams[a].scale.x=this.axelleBeams[a].scale.z=this.beamWidthC*this.nearScaling}for(var a=0;a<this.zombieFlarePlanes.length;a++){this.zombieFlarePlanes[a].scale.multiplyScalar(Math.random()*1+1)}this.beamTipPlane.scale.multiplyScalar(1.5).multiplyScalar(this.nearScaling);this.linesFbo3.render();this.finalCompositionFbo.render();RendererController.getInstance().renderToScreen(this.finalCompositionFbo.texture,false,true)}},_private:{cmap:function(a,b,c,d,e){return Math.max(Math.min(d+(e-d)*((a-b)/(c-b)),e),d)},getCameraZ:function(a,b){return b/(2*Math.tan(a.fov/2*(Math.PI/180)))},sortPoints:function(a,b){if(a.currentMouseDistance===b.currentMouseDistance)return 0;return a.currentMouseDistance>b.currentMouseDistance?1:-1},shuffle:function(a){var b=a.slice();var c=[];for(var d=0;d<a.length;d++){c.push(b.splice(Math.floor(Math.random()*b.length),1)[0])}return c}}});var MirrorSequence=Sequence._extend({_public:{webcamVideo:null,webcamStarted:false,webcamLastUpdate:0,WEBCAM_TEXTURE_SIZE:512,mirrorKidCenter:{},diffuseFbo:null,diffuseMaterial:null,mirrorMaskMaterial:null,mirrorMaskFbo:null,mirrorMaskPremultMaterial:null,mirrorMaskPremultFbo:null,mirrorKidGradient:null,mirrorKidMaterial:null,mirrorKidFbo:null,paletteTexture:null,mirrorRaysMaterial:null,mirrorRaysFbo:null,mirrorRaysFboPing:null,mirrorRaysFboPong:null,mirrorRaysIsPing:false,raysIteration:7,finalCompositeMaterial:null,finalCompositeFbo:null,construct:function(a,b,c,d,e){Sequence.call(this,a,b,c,d,e)},init:function(){if(this.wasInitialised)return;Sequence.prototype.init.call(this);console.log("initializing mirror");var a=this.videoTexture.width,b=this.videoTexture.height,c=RendererController.getInstance().getRenderer();this.mirrorKidCenter=AssetsController.getInstance().getFile("media/tracking/mirrorBoy.json");this.paletteTexture=AssetsController.getInstance().getFile("media/images/noise_lumiere1.png");this.paletteTexture.wrapS=this.paletteTexture.wrapT=THREE.ClampToEdgeWrapping;this.paletteTexture.magFilter=THREE.NearestFilter;this.paletteTexture.minFilter=THREE.NearestFilter;this.paletteTexture.generateMipmaps=false;this.paletteTexture.needsUpdate=true;this.mirrorKidGradient=AssetsController.getInstance().getFile("media/images/gradient_miroir.png");this.mirrorKidGradient.wrapS=THREE.RepeatWrapping;this.mirrorKidGradient.wrapT=THREE.RepeatWrapping;this.mirrorKidGradient.magFilter=THREE.LinearFilter;this.mirrorKidGradient.minFilter=THREE.LinearFilter;this.mirrorKidGradient.generateMipmaps=false;this.mirrorKidGradient.needsUpdate=true;this.mirrorMaskMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/mirror/mirrorMask.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/mirror/mirrorMask.frag"),attributes:{},uniforms:{texture:{type:"t",value:this.videoTexture.texture},maskRatio:{type:"f",value:.25},maskScale:{type:"f",value:1},maskOffset:{type:"f",value:0},mirrorThreshold:{type:"f",value:.45},offset:{type:"v2",value:new THREE.Vector2(1.5/a,1.5/b)}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.mirrorMaskFbo=new FramebufferWrapper(a/4,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.mirrorMaskMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.diffuseMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/mirror/diffuseExtraction.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/mirror/diffuseExtraction.frag"),attributes:{},uniforms:{texture:{type:"t",value:this.videoTexture.texture},maskRatio:{type:"f",value:.25}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.diffuseFbo=new FramebufferWrapper(Math.floor(a*3/4),b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.diffuseMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.mirrorMaskPremultMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertex.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/mirror/mirrorMaskMultiply.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.diffuseFbo.texture},tMask:{type:"t",value:this.mirrorMaskFbo.texture},maskAlpha:{type:"v4",value:new THREE.Vector4(0,0,0,1)}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.mirrorMaskPremultFbo=new FramebufferWrapper(a/2,b/2,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.mirrorMaskPremultMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.mirrorKidMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertex.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/mirror/simpleFoil.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.diffuseFbo.texture},tWebcam:{type:"t",value:null},tDirection:{type:"t",value:this.mirrorMaskFbo.texture},tGradient:{type:"t",value:this.mirrorKidGradient},center:{type:"v2",value:new THREE.Vector2(.5,.5)},headCenter:{type:"v2",value:new THREE.Vector2(.5,.5)},effectAlpha:{type:"f",value:1},webcamAlpha:{type:"f",value:1},foilRadius:{type:"f",value:1},foilDisplacement:{type:"f",value:.01},offset:{type:"v2",value:new THREE.Vector2(1/a,1/b)}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.mirrorKidFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.mirrorKidMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.mirrorRaysMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertex.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/mirror/lightRaysPalette.frag"),attributes:{},uniforms:{tAccum:{type:"t",value:null},tPalette:{type:"t",value:this.paletteTexture},center:{type:"v2",value:new THREE.Vector2(.5,.5)},lightPosition:{type:"v2",value:new THREE.Vector2(.5,.5)},pass:{type:"f",value:0},effectAlpha:{type:"f",value:1},raysAlpha:{type:"f",value:1},raysRadius:{type:"f",value:1},randomuv:{type:"v2",value:new THREE.Vector2(0,0)},offset:{type:"v2",value:new THREE.Vector2(1/a,1/b)},ratio:{type:"v2",value:new THREE.Vector2(b/a,1)}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.mirrorRaysFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.mirrorRaysMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:true,generateMipmaps:false,renderer:c});this.mirrorRaysFboPing=new FramebufferWrapper(a/8,b/8,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.mirrorRaysMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:true,generateMipmaps:false,renderer:c});this.mirrorRaysFboPong=new FramebufferWrapper(a/16,b/16,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.mirrorRaysMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:true,generateMipmaps:false,renderer:c});this.finalCompositeMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/common/vertex.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/mirror/SimpleAdditive.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.diffuseFbo.texture},tAccum:{type:"t",value:this.mirrorRaysFbo.texture},tMirrorKid:{type:"t",value:this.mirrorKidFbo.texture},center:{type:"v2",value:new THREE.Vector2(.5,.5)},lightPosition:{type:"v2",value:new THREE.Vector2(.5,.5)},randomuv:{type:"v2",value:new THREE.Vector2(0,0)},offset:{type:"v2",value:new THREE.Vector2(1/a,1/b)},ratio:{type:"v2",value:new THREE.Vector2(b/a,1)},globalColor:{type:"v4",value:new THREE.Vector4(1,1,1,1)}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.finalCompositeFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.finalCompositeMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:true,generateMipmaps:false,renderer:c})},begin:function(){Sequence.prototype.begin.call(this);console.log("begin mirror");this.diffuseFbo.alloc();this.mirrorMaskFbo.alloc();this.mirrorKidFbo.alloc();this.mirrorRaysFbo.alloc();this.mirrorRaysFboPing.alloc();this.mirrorRaysFboPong.alloc();this.finalCompositeFbo.alloc();this.mirrorMaskPremultFbo.alloc();this.diffuseMaterial.uniforms.texture.value=this.videoTexture.texture;this.mirrorMaskMaterial.uniforms.texture.value=this.videoTexture.texture;this.mirrorKidMaterial.uniforms.tVideo.value=this.diffuseFbo.texture;this.mirrorKidMaterial.uniforms.tDirection.value=this.mirrorMaskFbo.texture;this.finalCompositeMaterial.uniforms.tVideo.value=this.diffuseFbo.texture;this.finalCompositeMaterial.uniforms.tAccum.value=this.mirrorRaysFbo.texture;this.finalCompositeMaterial.uniforms.tMirrorKid.value=this.mirrorKidFbo.texture;this.mirrorMaskPremultMaterial.uniforms.tVideo.value=this.diffuseFbo.texture;this.mirrorMaskPremultMaterial.uniforms.tMask.value=this.mirrorMaskFbo.texture},end:function(){Sequence.prototype.end.call(this);this.diffuseFbo.dispose();this.mirrorMaskFbo.dispose();this.mirrorKidFbo.dispose();this.mirrorRaysFbo.dispose();this.mirrorRaysFboPing.dispose();this.mirrorRaysFboPong.dispose();this.finalCompositeFbo.dispose();this.mirrorMaskPremultFbo.dispose()},changeVideoQuality:function(a,b){console.log(this.videoTexture.texture);this.diffuseFbo.resizeTexture(Math.floor(a*3/4),b);this.mirrorMaskFbo.resizeTexture(a/4,b);this.diffuseMaterial.uniforms.texture.value=this.videoTexture.texture;this.mirrorMaskMaterial.uniforms.texture.value=this.videoTexture.texture;this.mirrorKidMaterial.uniforms.tVideo.value=this.diffuseFbo.texture;this.mirrorKidMaterial.uniforms.tDirection.value=this.mirrorMaskFbo.texture;this.mirrorMaskPremultMaterial.uniforms.tVideo.value=this.diffuseFbo.texture;this.mirrorMaskPremultMaterial.uniforms.tMask.value=this.mirrorMaskFbo.texture;this.finalCompositeMaterial.uniforms.tVideo.value=this.diffuseFbo.texture},changeRenderQuality:function(a,b){var c=RendererController.getInstance().getRenderer();this.renderWidth=a;this.renderHeight=b;this.mirrorMaskPremultFbo.resizeTexture(a/2,b/2);this.mirrorKidFbo.resizeTexture(a,b);this.mirrorRaysFbo.resizeTexture(a,b);this.mirrorRaysFboPing.resizeTexture(a/8,b/8);this.mirrorRaysFboPong.resizeTexture(a/16,b/16);this.finalCompositeFbo.resizeTexture(a,b);if(a<=512){this.raysIteration=5}else if(a<=800){this.raysIteration=5}else if(a<=1440){this.raysIteration=7}else if(a<=1920){this.raysIteration=9}this.finalCompositeMaterial.uniforms.tAccum.value=this.mirrorRaysFbo.texture;this.finalCompositeMaterial.uniforms.tMirrorKid.value=this.mirrorKidFbo.texture;this.mirrorRaysMaterial.uniforms.offset.value.set(1/a,1/b)}},_protected:{update:function(a,b,c,d,e,f,g,h){var i=InputController.getInstance().getPositionDirectional(),j=i.clone();if(a.phoneRangeLeft!==undefined||a.phoneRangeRight!==undefined){j.x=this.cmap(i.x,-1,1,a.phoneRangeLeft,a.phoneRangeRight);j.y=this.cmap(i.y,-1,1,-a.phoneRangeY,a.phoneRangeY)}var k=this.cmap(i.z,.1,.9,0,1);this.diffuseMaterial.uniforms.maskRatio.value=a.maskRatio;this.mirrorMaskPremultMaterial.uniforms.maskAlpha.value.set(a.mirrorKidGlowNear*Math.pow(1-i.z,2),a.mirrorKidGlowNear*Math.pow(1-i.z,2),0,a.mirrorMaskExposure);this.mirrorMaskMaterial.uniforms.maskRatio.value=a.maskRatio;this.mirrorMaskMaterial.uniforms.maskScale.value=a.maskScale;this.mirrorMaskMaterial.uniforms.maskOffset.value=a.maskOffset;var l=new THREE.Vector2(0,0);var m=this.mirrorKidCenter[parseInt(b+5402).toString()];if(m!==undefined&&m.length){l.x=m[0]-.75;l.y=m[1]*-2+1}var n=new THREE.Vector2(i.x<0?i.x/Math.abs(-1-l.x):i.x/Math.abs(1-l.x),i.y<0?i.y/Math.abs(-1-l.y):i.y/Math.abs(1-l.y));n.y*=-1;n.x-=(n.x-l.x)*.25;n.y-=(n.y-l.y)*.25;if(this.mirrorKidMaterial.uniforms.effectAlpha)this.mirrorKidMaterial.uniforms.effectAlpha.value=a.mirrorKidAlpha;if(this.mirrorKidMaterial.uniforms.center)this.mirrorKidMaterial.uniforms.center.value.set(n.x*.5+.5,n.y*.5+.5,0);if(this.mirrorKidMaterial.uniforms.headCenter)this.mirrorKidMaterial.uniforms.headCenter.value.set(l.x,1-l.y);if(this.mirrorKidMaterial.uniforms.webcamAlpha)this.mirrorKidMaterial.uniforms.webcamAlpha.value=a.webcamAlpha*a.mirrorKidAlpha;if(this.mirrorKidMaterial.uniforms.foilRadius)this.mirrorKidMaterial.uniforms.foilRadius.value=a.mirrorKidFoilRadius;if(this.mirrorKidMaterial.uniforms.foilDisplacement)this.mirrorKidMaterial.uniforms.foilDisplacement.value=a.mirrorKidFoilDisplacement;var o=(1-k)*(a.effectAlphaNear-a.effectAlphaFar)+a.effectAlphaFar;o*=1+(7/this.raysIteration-1)*.5;if(this.mirrorRaysMaterial.uniforms.effectAlpha)this.mirrorRaysMaterial.uniforms.effectAlpha.value=o;if(this.mirrorRaysMaterial.uniforms.lightPosition)this.mirrorRaysMaterial.uniforms.lightPosition.value.set(j.x*-.5+.5,j.y*.5+.5,0);if(this.mirrorRaysMaterial.uniforms.center&&a.mirrorCenterX!==undefined)this.mirrorRaysMaterial.uniforms.center.value.set(a.mirrorCenterX,a.mirrorCenterY);if(this.mirrorRaysMaterial.uniforms.randomuv)this.mirrorRaysMaterial.uniforms.randomuv.value.set(Math.random(),Math.random());if(this.mirrorRaysMaterial.uniforms.raysAlpha)this.mirrorRaysMaterial.uniforms.raysAlpha.value=a.raysAlpha;if(this.mirrorRaysMaterial.uniforms.raysRadius)this.mirrorRaysMaterial.uniforms.raysRadius.value=a.raysRadius;var p=1+a.colorFlash,q=1-a.colorFlash;this.finalCompositeMaterial.uniforms.globalColor.value.set(this.random(1,p),this.random(1,p),this.random(1,p),1)},render:function(){RendererController.getInstance().getRenderer().setClearColor(new THREE.Color(0));RendererController.getInstance().getRenderer().clear();if(this.videoTexture.wasUpdatedThisframe){this.mirrorMaskFbo.render();this.diffuseFbo.render();this.mirrorMaskPremultFbo.render()}this.mirrorKidFbo.render();var a,b,c=1;for(c;c<this.raysIteration;c++){if(this.mirrorIsPing){a=this.mirrorRaysFboPing;b=this.mirrorRaysFboPong}else{b=this.mirrorRaysFboPing;a=this.mirrorRaysFboPong}this.mirrorIsPing=!this.mirrorIsPing;this.mirrorRaysMaterial.uniforms.pass.value=1/c;this.mirrorRaysMaterial.uniforms.tAccum.value=c===1?this.mirrorMaskPremultFbo.texture:b.texture;a.render()}this.mirrorRaysMaterial.uniforms.pass.value=1/c;this.mirrorRaysMaterial.uniforms.tAccum.value=a.texture;this.mirrorRaysFbo.render();this.finalCompositeFbo.render();RendererController.getInstance().renderToScreen(this.finalCompositeFbo.texture,false,true)}},_private:{map:function(a,b,c,d,e){return d+(e-d)*((a-b)/(c-b))},cmap:function(a,b,c,d,e){return Math.max(Math.min(d+(e-d)*((a-b)/(c-b)),e),d)},random:function(a,b){return Math.random()*(b-a)+a}}});var BrokenMirrorSequence=Sequence._extend({_public:{sceneFbo:null,webcamVideo:null,webcamCanvas:null,webcamTexture:null,webcamStarted:false,webcamCanvasSize:512,textureDiffuse:null,textureEdges:null,textureMask:null,textureLight:null,mirrorFbo:null,mirrorMaterial:null,perlin:null,mirrorFboMask:null,mirrorMaterialMask:null,paletteTexture:null,glitchTextures:[],mirrorRaysMaterial:null,mirrorRaysFbo:null,mirrorRaysFboPing:null,mirrorRaysFboPong:null,mirrorRaysIsPing:false,raysIteration:6,lastGlitchUdpate:0,firstFrame:true,lastMouse:new THREE.Vector3(0,0,0),mouseSpeed:0,construct:function(a,b,c,d,e){Sequence.call(this,a,b,c,d,e)},init:function(){if(this.wasInitialised)return;Sequence.prototype.init.call(this);console.log("initializing brokenmirror");this.textureDiffuse=AssetsController.getInstance().getFile("media/images/brokenmirror/mirror_diffuse.jpg");this.textureDiffuse.format=THREE.RGBFormat;this.textureDiffuse.minFilter=THREE.LinearMipMapLinearFilter;this.textureDiffuse.wrapS=this.textureDiffuse.wrapT=THREE.MirroredRepeatWrapping;this.textureDiffuse.generateMipmaps=true;this.textureDiffuse.needsUpdate=true;this.textureMask=AssetsController.getInstance().getFile("media/images/brokenmirror/mirror_mask.png");this.textureMask.format=THREE.RGBAFormat;this.textureMask.wrapS=this.textureMask.wrapT=THREE.MirroredRepeatWrapping;this.textureMask.minFilter=THREE.LinearMipMapLinearFilter;this.textureMask.generateMipmaps=true;this.textureMask.needsUpdate=true;var a=1280,b=672,c=RendererController.getInstance().getRenderer();this.perlin=new SimplexNoise(Math);this.textureEdges=AssetsController.getInstance().getFile("media/images/brokenmirror/mirror_edges_and_dust.jpg");this.textureEdges.format=THREE.RGBFormat;this.textureEdges.wrapS=this.textureEdges.wrapT=THREE.MirroredRepeatWrapping;this.textureEdges.minFilter=THREE.LinearMipMapLinearFilter;this.textureEdges.generateMipmaps=true;this.textureEdges.needsUpdate=true;this.textureLight=AssetsController.getInstance().getFile("media/images/brokenmirror/mirror_light.jpg");this.textureLight.format=THREE.LuminanceFormat;this.textureLight.wrapS=this.textureEdges.wrapT=THREE.MirroredRepeatWrapping;this.textureLight.minFilter=THREE.LinearFilter;this.textureLight.generateMipmaps=false;this.textureLight.needsUpdate=true;for(var d=0;d<3;d++){this.glitchTextures[d]=AssetsController.getInstance().getFile("media/images/brokenmirror/glitch4/noise_"+(d+1)+".jpg");this.glitchTextures[d].format=THREE.RGBFormat;this.glitchTextures[d].wrapS=this.glitchTextures[d].wrapT=THREE.RepeatWrapping;this.glitchTextures[d].minFilter=THREE.LinearFilter;this.glitchTextures[d].generateMipmaps=false;this.glitchTextures[d].needsUpdate=true}this.mirrorMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/brokenmirror/brokenmirror.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/brokenmirror/brokenmirror.frag"),attributes:{},uniforms:{tWebcam:{type:"t",value:this.videoTexture.texture},tDiffuse:{type:"t",value:this.textureDiffuse},tMask:{type:"t",value:this.textureMask},tEdges:{type:"t",value:this.textureEdges},tGlitch:{type:"t",value:this.glitchTextures[0]},center:{type:"v2",value:new THREE.Vector2(.5,.5)},offset:{type:"v2",value:new THREE.Vector2(1/this.videoTexture.width,1/this.videoTexture.height)},maxOffset:{type:"v2",value:new THREE.Vector2(1/this.videoTexture.width,1/this.videoTexture.height)},rotation:{type:"v2",value:new THREE.Vector2(0,0)},rotationPerspective:{type:"f",value:1},parallax:{type:"f",value:.5},uvRatio:{type:"v2",value:new THREE.Vector2(.525,1)},uvOffset:{type:"v2",value:new THREE.Vector2(0,.15)},uvScale:{type:"f",value:1},uvRandom:{type:"v2",value:new THREE.Vector2(0,0)},maxScale:{type:"f",value:0},chromaticAberration:{type:"f",value:0},perspective:{type:"f",value:0},edgesDiffraction:{type:"f",value:0},globalColor:{type:"v4",value:new THREE.Vector4(1,1,1,1)},dustOpacity:{type:"f",value:1},glitchOpacity:{type:"f",value:0},glitchScale:{type:"f",value:2},blackAndWhite:{type:"f",value:0},glitchOpacityFade:{type:"f",value:0}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});if(CameraController.getInstance().isVideoEnabled()){this.setupWebcam()}var e=new THREE.PlaneGeometry(a*2,b*2,12,12);var f=e.faceVertexUvs[0];for(var d=0;d<f.length;d++){for(var g=0;g<f[d].length;g++){f[d][g].x=Math.abs(f[d][g].x*2-.5);f[d][g].y=Math.abs(f[d][g].y*2-.5)}}e.uvsNeedUpdate=true;e.verticesNeedUpdate=true;console.log("videoWidth",a);console.log("videoHeight",b);this.mirrorFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,type:THREE.UnsignedByteType,renderPlane:new THREE.Mesh(e,this.mirrorMaterial),camera:new THREE.PerspectiveCamera(45,a/b,.001,1e4),depthBuffer:true,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.mirrorFbo.camera.position.z=this.getCameraZ(this.mirrorFbo.camera,b);
this.mirrorMaterialMask=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/brokenmirror/brokenmirrorMask.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/brokenmirror/brokenmirrorMask.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.mirrorFbo.texture},tMask:{type:"t",value:this.textureLight}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.mirrorFboMask=new FramebufferWrapper(a/2,b/2,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderPlane:new THREE.Mesh(e,this.mirrorMaterialMask),camera:this.mirrorFbo.camera,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.paletteTexture=AssetsController.getInstance().getFile("media/images/noise_lumiere1.png");this.paletteTexture.wrapS=this.paletteTexture.wrapT=THREE.ClampToEdgeWrapping;this.paletteTexture.magFilter=THREE.NearestFilter;this.paletteTexture.minFilter=THREE.NearestFilter;this.paletteTexture.generateMipmaps=false;this.paletteTexture.needsUpdate=true;this.mirrorRaysMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/brokenmirror/lightRays.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/brokenmirror/lightRays.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.mirrorFbo.texture},tAccum:{type:"t",value:null},tPalette:{type:"t",value:this.paletteTexture},center:{type:"v2",value:new THREE.Vector2(.5,.5)},lightPosition:{type:"v2",value:new THREE.Vector2(.5,.5)},pass:{type:"f",value:0},FINAL_PASS:{type:"f",value:1.002/this.raysIteration},effectAlpha:{type:"f",value:1},raysAlpha:{type:"f",value:1},raysRadius:{type:"f",value:1},randomuv:{type:"v2",value:new THREE.Vector2(0,0)},offset:{type:"v2",value:new THREE.Vector2(1/a,1/b)},ratio:{type:"v2",value:new THREE.Vector2(b/a,1)},finalAlpha:{type:"f",value:0}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.mirrorRaysFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.mirrorRaysMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:true,generateMipmaps:false,renderer:c});this.mirrorRaysFboPing=new FramebufferWrapper(a/8,b/8,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.mirrorRaysMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:true,generateMipmaps:false,renderer:c});this.mirrorRaysFboPong=new FramebufferWrapper(a/16,b/16,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.mirrorRaysMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:true,generateMipmaps:false,renderer:c});RendererController.getInstance().getRenderer().setTexture(this.textureLight,0);RendererController.getInstance().getRenderer().setTexture(this.textureEdges,0);RendererController.getInstance().getRenderer().setTexture(this.textureMask,0);RendererController.getInstance().getRenderer().setTexture(this.textureDiffuse,0);this.textureLight.needsUpdate=false;this.textureEdges.needsUpdate=false;this.textureMask.needsUpdate=false;this.textureDiffuse.needsUpdate=false},begin:function(){Sequence.prototype.begin.call(this);console.log("begin brokenmirror");this.mirrorFbo.alloc();this.mirrorFboMask.alloc();this.mirrorRaysFboPing.alloc();this.mirrorRaysFboPong.alloc();this.mirrorRaysFbo.alloc();if(!this.webcamVideo){this.mirrorMaterial.uniforms.tWebcam.value=this.videoTexture.texture}else{this.mirrorMaterial.uniforms.tWebcam.value=this.webcamTexture;this.webcamCanvas.c.drawImage(this.webcamVideo,0,0,this.webcamCanvasSize,this.webcamCanvasSize);this.webcamTexture.needsUpdate=true;this.videoTexture.pauseBrokenMirror()}this.mirrorMaterialMask.uniforms.tVideo.value=this.mirrorFbo.texture;this.mirrorRaysMaterial.uniforms.tAccum.value=this.mirrorFbo.texture;this.mirrorRaysMaterial.uniforms.tVideo.value=this.mirrorFbo.texture;this.firstFrame=true},end:function(){Sequence.prototype.end.call(this);this.mirrorFbo.dispose();this.mirrorFboMask.dispose();this.mirrorRaysFboPing.dispose();this.mirrorRaysFboPong.dispose();this.mirrorRaysFbo.dispose();this.videoTexture.resumeBrokenMirror()},changeVideoQuality:function(a,b){if(!this.webcamVideo){this.mirrorMaterial.uniforms.tWebcam.value=this.videoTexture.texture;this.mirrorMaterial.uniforms.offset.value.set(1/a,1/b);this.mirrorMaterial.uniforms.maxOffset.value.set(1/a,1/b)}},changeRenderQuality:function(a,b){var c=RendererController.getInstance().getRenderer();this.renderWidth=a;this.renderHeight=b;this.mirrorFbo.resizeTexture(a,b);this.mirrorFboMask.resizeTexture(a/2,b/2);this.mirrorRaysFbo.resizeTexture(a,b);this.mirrorRaysFboPing.resizeTexture(a/8,b/8);this.mirrorRaysFboPong.resizeTexture(a/16,b/16);this.mirrorMaterialMask.uniforms.tVideo.value=this.mirrorFbo.texture;this.webcamCanvasSize=256;if(a>=640)this.webcamCanvasSize=256;if(a>=1080)this.webcamCanvasSize=512;if(a>=1600)this.webcamCanvasSize=1024;if(this.webcamCanvas){this.webcamCanvas.width=this.webcamCanvasSize;this.webcamCanvas.height=this.webcamCanvasSize;this.webcamTexture=new THREE.Texture(this.webcamCanvas,new THREE.UVMapping,THREE.MirroredRepeatWrapping,THREE.MirroredRepeatWrapping,THREE.LinearFilter,THREE.LinearMipMapLinearFilter,THREE.RGBFormat,THREE.UnsignedByteType,1);this.webcamTexture.generateMipmaps=true;this.mirrorMaterial.uniforms.tWebcam.value=this.webcamTexture;this.mirrorMaterial.uniforms.offset.value.set(1/this.webcamVideo.videoWidth,1/this.webcamVideo.videoHeight);this.mirrorMaterial.uniforms.maxOffset.value.set(1/this.webcamVideo.videoWidth,1/this.webcamVideo.videoHeight);if(this.webcamVideo.videoWidth)this.mirrorMaterial.uniforms.uvRatio.value.set(this.webcamVideo.videoHeight/this.webcamVideo.videoWidth,1);this.mirrorMaterial.uniforms.uvOffset.value.set(0,.2)}this.mirrorRaysMaterial.uniforms.tVideo.value=this.mirrorFbo.texture}},_protected:{setupWebcam:function(){if(this.webcamVideo)return;this.webcamVideo=CameraController.getInstance().getVideo();this.webcamCanvas=document.createElement("canvas");this.webcamCanvas.width=this.webcamCanvasSize;this.webcamCanvas.height=this.webcamCanvasSize;this.webcamCanvas.c=this.webcamCanvas.getContext("2d");this.webcamTexture=new THREE.Texture(this.webcamCanvas,new THREE.UVMapping,THREE.MirroredRepeatWrapping,THREE.MirroredRepeatWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBFormat,THREE.UnsignedByteType,1);this.webcamTexture.generateMipmaps=false;this.mirrorMaterial.uniforms.tWebcam.value=this.webcamTexture;this.mirrorMaterial.uniforms.offset.value.set(1/this.webcamCanvasSize,1/this.webcamCanvasSize);this.mirrorMaterial.uniforms.maxOffset.value.set(1/this.webcamCanvasSize,1/this.webcamCanvasSize);if(this.webcamVideo.videoWidth)this.mirrorMaterial.uniforms.uvRatio.value.set(this.webcamVideo.videoHeight/this.webcamVideo.videoWidth,1);this.mirrorMaterial.uniforms.uvOffset.value.set(0,.2)},update:function(a,b,c,d,e,f,g){var h=InputController.getInstance().getPositionDirectional(),i=1280,j=672;if(!TimelineController.getInstance().initialised){RendererController.getInstance().disablePhoneInteraction()}if(!this.webcamVideo&&CameraController.getInstance().isVideoEnabled()){this.setupWebcam();this.videoTexture.pauseBrokenMirror()}if(this.webcamVideo){this.mirrorMaterial.uniforms.maxOffset.value.set(a.maxOffset/512,a.maxOffset/512)}else{this.mirrorMaterial.uniforms.maxOffset.value.set(a.maxOffset/this.videoTexture.width,a.maxOffset/this.videoTexture.height)}this.mirrorMaterial.uniforms.center.value.set(h.x,h.y);this.mirrorMaterial.uniforms.maxScale.value=a.maxScale;this.mirrorMaterial.uniforms.chromaticAberration.value=a.chromaticAberration;this.mirrorMaterial.uniforms.perspective.value=a.perspective;this.mirrorMaterial.uniforms.edgesDiffraction.value=a.edgesDiffraction;this.mirrorMaterial.uniforms.parallax.value=a.parallax;this.mirrorMaterial.uniforms.uvScale.value=a.scale;this.mirrorMaterial.uniforms.dustOpacity.value=a.dustOpacity;this.mirrorMaterial.uniforms.uvRandom.value.set(Math.random()*2-1,Math.random()*2-1);this.mirrorMaterial.uniforms.glitchScale.value=a.glitchScale;if(this.webcamVideo&&this.webcamVideo.videoWidth)this.mirrorMaterial.uniforms.uvRatio.value.set(this.webcamVideo.videoHeight/this.webcamVideo.videoWidth,1);var k=new THREE.Vector3;k.x=i*a.rangeXYB*this.perlin.noise(Date.now()*a.cameraSpeedB*1e-4,0);k.y=j*a.rangeXYB*this.perlin.noise(0,Date.now()*a.cameraSpeedB*1e-4);k.z=0;this.mirrorFbo.camera.position.x=i*a.rangeXYA*this.perlin.noise(Date.now()*a.cameraSpeedA*1e-4,0);this.mirrorFbo.camera.position.y=j*a.rangeXYA*this.perlin.noise(0,Date.now()*a.cameraSpeedA*1e-4);this.mirrorFbo.camera.position.z=this.getCameraZ(this.mirrorFbo.camera,j);this.mirrorFbo.camera.position.z+=.5*i*a.rangeZB*this.perlin.noise(Date.now()*a.cameraSpeedB*.5*.001,Date.now()*a.cameraSpeedB*.5*1e-4);this.mirrorFbo.camera.position.z+=.5*j*a.rangeZA*this.perlin.noise(Date.now()*a.cameraSpeedA*.5*.001,Date.now()*a.cameraSpeedA*.5*1e-4);this.mirrorFbo.camera.lookAt(k);if(Date.now()-this.lastGlitchUdpate>=1e3/24){this.lastGlitchUdpate=Date.now();this.mirrorMaterial.uniforms.tGlitch.value=this.glitchTextures[Math.floor(Math.random()*this.glitchTextures.length)]}var l=1+a.colorFlash,m=1-a.colorFlash;this.mirrorMaterial.uniforms.globalColor.value.set(this.random(1,l),this.random(1,l),this.random(1,l),1);this.mirrorMaterial.uniforms.globalColor.value.addScalar(a.fadeOut);if(this.mirrorRaysMaterial.uniforms.effectAlpha)this.mirrorRaysMaterial.uniforms.effectAlpha.value=a.raysBrightness;if(this.mirrorRaysMaterial.uniforms.lightPosition)this.mirrorRaysMaterial.uniforms.lightPosition.value.set(h.x*-1+.5,h.y*-1+.5);if(this.mirrorRaysMaterial.uniforms.center)this.mirrorRaysMaterial.uniforms.center.value.set(.5,.5);if(this.mirrorRaysMaterial.uniforms.randomuv)this.mirrorRaysMaterial.uniforms.randomuv.value.set(Math.random(),Math.random());if(this.mirrorRaysMaterial.uniforms.raysAlpha)this.mirrorRaysMaterial.uniforms.raysAlpha.value=.7+Math.random()*.2;if(this.mirrorRaysMaterial.uniforms.raysRadius)this.mirrorRaysMaterial.uniforms.raysRadius.value=.2+Math.random()*.1;this.mirrorRaysMaterial.uniforms.finalAlpha.value=a.raysFinalAlpha*Math.random();this.mirrorRaysMaterial.uniforms.randomuv.value.set(Math.random(),Math.random());if(InputController.getInstance().isMouseVersion()){this.mouseSpeed=this.mouseSpeed*(1-.15*c)+this.lastMouse.clone().sub(h).length()*.5*c;this.mouseSpeed=Math.min(this.mouseSpeed,1);this.lastMouse.copy(h);this.mirrorRaysMaterial.uniforms.finalAlpha.value=a.raysFinalAlpha*Math.min(this.mouseSpeed*2.5+(1-h.z)*.5,1)*Math.random();var n=Math.min(this.mouseSpeed*.01+(1-h.z)*2,1);n=Math.pow(n,4);this.mirrorMaterial.uniforms.glitchOpacity.value=Math.min(n*a.mouseNoise+a.glitchOpacity,.85)}else{this.mouseSpeed=this.mouseSpeed*(1-.5*c)+OrientationController.getInstance().rawMotionSpeed*2.5;this.mirrorRaysMaterial.uniforms.finalAlpha.value=a.raysFinalAlpha*Math.min(this.mouseSpeed*9,1)*Math.random();this.breakFreeSpeed=this.mouseSpeed*(1-.2*c)+OrientationController.getInstance().rawMotionSpeed*3;var n=Math.max(Math.min(this.breakFreeSpeed,1),0);n=Math.pow(this.breakFreeSpeed,2);this.mirrorMaterial.uniforms.glitchOpacity.value=Math.min(n*a.motionNoise+a.glitchOpacity,.85)}this.mirrorMaterial.uniforms.glitchOpacityFade.value=a.glitchOpacityFade},render:function(){if(this.firstFrame){RendererController.getInstance().getRenderer().setClearColor(new THREE.Color(16777215));RendererController.getInstance().getRenderer().clear();if(this.webcamVideo&&this.webcamVideo.readyState===this.webcamVideo.HAVE_ENOUGH_DATA){this.webcamCanvas.c.drawImage(this.webcamVideo,0,0,this.webcamCanvasSize,this.webcamCanvasSize);this.webcamTexture.needsUpdate=true}this.mirrorFbo.render();this.firstFrame=false}else{RendererController.getInstance().getRenderer().setClearColor(new THREE.Color(0));RendererController.getInstance().getRenderer().clear();if(!this.isPaused&&this.webcamVideo&&this.webcamVideo.readyState===this.webcamVideo.HAVE_ENOUGH_DATA){this.webcamCanvas.c.drawImage(this.webcamVideo,0,0,this.webcamCanvasSize,this.webcamCanvasSize);this.webcamTexture.needsUpdate=true}this.mirrorFbo.render();this.mirrorFboMask.render();var a,b,c=1;for(c;c<this.raysIteration;c++){if(this.mirrorIsPing){a=this.mirrorRaysFboPing;b=this.mirrorRaysFboPong}else{b=this.mirrorRaysFboPing;a=this.mirrorRaysFboPong}this.mirrorIsPing=!this.mirrorIsPing;this.mirrorRaysMaterial.uniforms.pass.value=1/c;this.mirrorRaysMaterial.uniforms.tAccum.value=c<=1?this.mirrorFboMask.texture:b.texture;a.render()}this.mirrorRaysMaterial.uniforms.pass.value=1/this.raysIteration;this.mirrorRaysMaterial.uniforms.tAccum.value=a.texture;this.mirrorRaysFbo.render();RendererController.getInstance().renderToScreen(this.mirrorRaysFbo.texture,false,false);this.firstFrame=false}}},_private:{getCameraZ:function(a,b){return b/(2*Math.tan(a.fov/2*(Math.PI/180)))},random:function(a,b){return Math.random()*(b-a)+a}}});var FinaleSequence=Sequence._extend({_public:{breakFreeTexture:null,breakFreeMaterial:null,breakFreeFbo:null,breakFreeSpeed:0,mouseSpeed:0,lastMouse:new THREE.Vector2,paletteTexture:null,mirrorRaysMaterial:null,mirrorRaysFboPing:null,mirrorRaysFboPong:null,mirrorRaysFbo:null,mirrorRaysFboIsPing:false,raysIteration:4,glitchTextures:[],lastGlitchUpdate:0,glitchUpdateRate:1e3/30,scene:null,camera:null,renderPlane:null,construct:function(a,b,c,d,e){Sequence.call(this,a,b,c,d,e)},init:function(){if(this.wasInitialised)return;Sequence.prototype.init.call(this);console.log("initializing finale");var a=this.videoTexture.width,b=this.videoTexture.height,c=RendererController.getInstance().getRenderer();for(var d=0;d<3;d++){this.glitchTextures[d]=AssetsController.getInstance().getFile("media/images/brokenmirror/glitch4/noise_"+(d+1)+".jpg");this.glitchTextures[d].format=THREE.RGBFormat;this.glitchTextures[d].wrapS=this.glitchTextures[d].wrapT=THREE.RepeatWrapping;this.glitchTextures[d].minFilter=THREE.LinearFilter;this.glitchTextures[d].generateMipmaps=false;this.glitchTextures[d].needsUpdate=true}this.breakFreeTexture=AssetsController.getInstance().getFile("media/images/break_free.png");this.breakFreeTexture.needsUpdate=true;this.breakFreeMaterial=new THREE.ShaderMaterial({vertexShader:AssetsController.getInstance().getFile("shaders/finale/breakFreeNoiseFS.vert"),fragmentShader:AssetsController.getInstance().getFile("shaders/finale/breakFreeNoiseFS.frag"),attributes:{},uniforms:{tVideo:{type:"t",value:this.videoTexture.texture},tBreakFree:{type:"t",value:this.breakFreeTexture},tNoise:{type:"t",value:this.glitchTextures[0]},randomUV:{type:"v2",value:new THREE.Vector2(Math.random(),Math.random())},glitchScale:{type:"v2",value:new THREE.Vector2(1,1)},noiseAlpha:{type:"f",value:.1},blackAndWhite:{type:"f",value:0},breakFreeAlpha:{type:"f",value:1},breakFreeSize:{type:"f",value:2},minBlack:{type:"f",value:0},maxWhite:{type:"f",value:1},screenAlpha:{type:"f",value:.5},darkenAlpha:{type:"f",value:.5},exposureMultiply:{type:"f",value:2},exposureOffset:{type:"f",value:1}},depthTest:false,transparent:true,blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.OneFactor,blendDst:THREE.ZeroFactor,side:THREE.DoubleSide});this.breakFreeFbo=new FramebufferWrapper(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.UnsignedByteType,renderMaterial:this.breakFreeMaterial,depthBuffer:false,stencilBuffer:false,premultiplyAlpha:false,generateMipmaps:false,renderer:c});this.scene=new THREE.Scene;this.camera=new THREE.OrthographicCamera(-1,1,-1,1,-1,1);this.renderPlane=new THREE.Mesh(new THREE.PlaneGeometry(2,2,2,2),this.breakFreeMaterial);this.scene.add(this.renderPlane)},begin:function(){Sequence.prototype.begin.call(this);console.log("begin finale");MouseCursorAppearanceController.getInstance().setMode(MouseCursorAppearanceController.MODE_NON_INTERACTIVE);this.breakFreeMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.breakFreeFbo.alloc()},end:function(){Sequence.prototype.end.call(this);this.breakFreeFbo.dispose();MouseCursorAppearanceController.getInstance().setMode(MouseCursorAppearanceController.MODE_INTERACTIVE)},changeVideoQuality:function(a,b){this.breakFreeMaterial.uniforms.tVideo.value=this.videoTexture.texture;this.breakFreeFbo.resizeTexture(Math.max(a,this.renderWidth),Math.max(b,this.renderHeight))},changeRenderQuality:function(a,b){this.breakFreeFbo.resizeTexture(Math.max(a,this.videoTexture.width),Math.max(b,this.videoTexture.height))}},_protected:{update:function(a,b,c,d,e,f,g){var h=InputController.getInstance().getPositionDirectional();if(!TimelineController.getInstance().initialised){RendererController.getInstance().disablePhoneInteraction()}if(this.glitchTextures&&this.glitchTextures.length>0&&Date.now()-this.lastGlitchUpdate>=this.glitchUpdateRate){this.lastGlitchUpdate=Date.now();this.breakFreeMaterial.uniforms.tNoise.value=this.glitchTextures[Math.floor(Math.random()*this.glitchTextures.length)];this.breakFreeMaterial.uniforms.randomUV.value.set(Math.random()*3,Math.random()*3)}if(InputController.getInstance().isMouseVersion()){this.mouseSpeed=this.mouseSpeed*(1-.05*c)+this.lastMouse.clone().sub(h).length()*.5*c;this.mouseSpeed=Math.min(this.mouseSpeed,1);this.lastMouse.copy(h);var i=Math.min(this.mouseSpeed*.01+(1-h.z)*2,1);i=Math.pow(i,3);this.breakFreeMaterial.uniforms.noiseAlpha.value=i*a.motionNoise;this.breakFreeMaterial.uniforms.breakFreeAlpha.value=(i>.9?1:0)*(1-Math.random()*a.breakFreeFlickering);this.breakFreeMaterial.uniforms.blackAndWhite.value=Math.min(Math.pow(i,1.5)*1.5,1)}else{this.mouseSpeed+=OrientationController.getInstance().rawMotionSpeed*13.5;this.mouseSpeed=Math.min(this.mouseSpeed,2.15);var i=Math.min(this.mouseSpeed,1);i=Math.pow(i,1.3);i=isNaN(i)?0:i;this.breakFreeMaterial.uniforms.noiseAlpha.value=i*a.motionNoise;this.breakFreeMaterial.uniforms.breakFreeAlpha.value=(i>.75?1:0)*(1-Math.random()*a.breakFreeFlickering);this.breakFreeMaterial.uniforms.blackAndWhite.value=Math.min(Math.pow(Math.max(i-.5,0)*2,3.5),1);if(i<=.75)this.mouseSpeed*=1-.25*c;else this.mouseSpeed*=1-.06*c}if(a.fade>.5)this.breakFreeMaterial.uniforms.breakFreeAlpha.value=0;this.breakFreeMaterial.uniforms.noiseAlpha.value*=1-a.fade;this.breakFreeMaterial.uniforms.blackAndWhite.value*=1-a.fade;var j=RendererController.getInstance().width;var k=j/1280;this.breakFreeMaterial.uniforms.breakFreeSize.value=a.breakFreeSize;this.breakFreeMaterial.uniforms.glitchScale.value.set(a.glitchScale*k,a.glitchScale*k);this.breakFreeMaterial.uniforms.screenAlpha.value=a.screenAlpha;this.breakFreeMaterial.uniforms.darkenAlpha.value=a.darkenAlpha;this.breakFreeMaterial.uniforms.exposureMultiply.value=a.exposureMultiply;this.breakFreeMaterial.uniforms.exposureOffset.value=a.exposureOffset;this.breakFreeMaterial.uniforms.minBlack.value=a.minBlack;this.breakFreeMaterial.uniforms.maxWhite.value=a.maxWhite;OrientationController.getInstance().rawMotionSpeed*=1-.49*c},render:function(){RendererController.getInstance().getRenderer().setClearColor(new THREE.Color(0));RendererController.getInstance().getRenderer().clear();this.breakFreeFbo.render();RendererController.getInstance().renderToScreen(this.breakFreeFbo.texture,false,true)}}});var AxelleSequence=Sequence._extend({_static:{MIN_ROTATION:100},_public:{construct:function(a,b){Sequence.call(this,a,b)},pause:function(){console.log("-- AxelleSequence pause");RemoteController.getInstance().pauseAxelle(this.lastProgress)},resume:function(){console.log("-- AxelleSequence resume");this.showAxelle=true},begin:function(){this.showAxelle=true;console.log("-- AxelleSequence begin");if(typeof this.defaultOptions.animationEnd==="string"){this.defaultOptions.animationEnd=TimelineController.getInstance().parseTime(this.defaultOptions.animationEnd)}RendererController.getInstance().disablePhoneInteraction()},end:function(){console.log("-- AxelleSequence end");RemoteController.getInstance().hideAxelle();RendererController.getInstance().enablePhoneInteraction()},seekStart:function(){this.pause()},seek:function(){console.log("-- AxelleSequence seek");this.showAxelle=true},update:function(a,b,c,d,e,f,g){e=d/(this.defaultOptions.animationEnd-this.startTime);if(this.showAxelle){console.log("-- AxelleSequence show Axelle remote",e);this.lastProgress=e;RemoteController.getInstance().showAxelle(e);this.showAxelle=false}}},_private:{showAxelle:false,isPromptShown:false,lastProgress:0}});var TurnItBackSequence=Sequence._extend({_static:{MIN_ROTATION:110},_public:{started:false,construct:function(a,b){Sequence.call(this,a,b)},begin:function(){var a=this;if(this.started)return;this.started=true;AnimationController.getInstance().events.bind(AnimationController.EVENT_FRAME+".TurnItBackSequence",function(){a.onFrame()})},end:function(){if(!this.started)return;this.started=false;AnimationController.getInstance().events.unbind(AnimationController.EVENT_FRAME+".TurnItBackSequence")}},_private:{isPromptShown:false,resetPreformed:false,resetCount:0,onFrame:function(){if(!ViewController.getInstance().getView("HelpView").shown&&OrientationController.getInstance().timesReset>0&&(Math.abs(OrientationController.getInstance().worldQuaternion.x)>TurnItBackSequence.MIN_ROTATION/180||Math.abs(OrientationController.getInstance().worldQuaternion.y)>TurnItBackSequence.MIN_ROTATION/180)){RemoteController.getInstance().showTurnItBack()}else{RemoteController.getInstance().hideTurnItBack()}}}});!function(a,b){function c(){AppController.getInstance().start();a.pageTransitionTime=800}function d(c){if(b.addEventListener){b.addEventListener("DOMContentLoaded",c,false)}else if(/KHTML|WebKit|iCab/i.test(navigator.userAgent)){var d=setInterval(function(){if(/loaded|complete/i.test(b.readyState)){clearInterval(d);c()}},10)}else{a.onload=c}}d(function(){c()})}(window,document);
/*
//@ sourceMappingURL=/js/main.js.map
*/